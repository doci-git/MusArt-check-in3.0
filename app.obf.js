(function(s){try{(0,eval)(atob(s));}catch(e){console.error('obf error',e);}})('KCgpID0+IHsNCiAgInVzZSBzdHJpY3QiOw0KDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICAvLyBDT05GSUdVUkFaSU9ORSBFIElOSVpJQUxJWlpBWklPTkUNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIGNvbnN0IGZpcmViYXNlQ29uZmlnID0gew0KICAgIGFwaUtleTogIkFJemFTeUN1eTNTYWs5NnNvQ2xhN2I1WWI1d21rZFZmTXFBWG1vayIsDQogICAgYXV0aERvbWFpbjogImNoZWNrLWluLTRlMGU5LmZpcmViYXNlYXBwLmNvbSIsDQogICAgZGF0YWJhc2VVUkw6DQogICAgICAiaHR0cHM6Ly9jaGVjay1pbi00ZTBlOS1kZWZhdWx0LXJ0ZGIuZXVyb3BlLXdlc3QxLmZpcmViYXNlZGF0YWJhc2UuYXBwIiwNCiAgICBwcm9qZWN0SWQ6ICJjaGVjay1pbi00ZTBlOSIsDQogICAgc3RvcmFnZUJ1Y2tldDogImNoZWNrLWluLTRlMGU5LmZpcmViYXNlc3RvcmFnZS5hcHAiLA0KICAgIG1lc3NhZ2luZ1NlbmRlcklkOiAiNzIzODgwOTkwMTc3IiwNCiAgICBhcHBJZDogIjE6NzIzODgwOTkwMTc3OndlYjpmMDAyNzMzYjJjYzJlNTBkMTcyZWEwIiwNCiAgICBtZWFzdXJlbWVudElkOiAiRy1IOTdHQjlMNEY1IiwNCiAgfTsNCg0KICBjb25zdCBCQVNFX1VSTF9TRVQgPQ0KICAgICJodHRwczovL3NoZWxseS03My1ldS5zaGVsbHkuY2xvdWQvdjIvZGV2aWNlcy9hcGkvc2V0L3N3aXRjaCI7DQogIGNvbnN0IFNFQ1JFVF9LRVkgPSAibXVzYXJ0X3NlY3JldF8xMjNfZml4ZWRfa2V5IjsNCiAgY29uc3QgQ09ERV9WRVJTSU9OX0tFWSA9ICJjb2RlX3ZlcnNpb24iOw0KICBjb25zdCBLRUVQX1RPS0VOX0lOX1VSTCA9IHRydWU7IC8vIG1hbnRpZW5pIGlsIHRva2VuIG5lbGwnVVJMIGRvcG8gbGEgdmVyaWZpY2ENCiAgY29uc3QgVU5CTE9DS19WRVJTSU9OX0tFWSA9ICJ1bmJsb2NrX3ZlcnNpb24iOw0KDQogIC8vIENvbmZpZ3VyYXppb25lIGRpc3Bvc2l0aXZpIFNoZWxseSAoaW1tdXRhYmlsZSkNCiAgY29uc3QgREVWSUNFUyA9IE9iamVjdC5mcmVlemUoWw0KICAgIHsNCiAgICAgIGlkOiAiZTRiMDYzZjBjMzhjIiwNCiAgICAgIGF1dGhfa2V5Og0KICAgICAgICAiTVdJMk1EYzRkV2xrNDkwOEE3MURBODA5RkNFQzA1QzVEMUYzNjA5NDNGQkZDNkE3OTM0RUMwRkQ5RTNDRkVBRjAzRjhGNUE2QTRBMEM2MDY2NUI5N0ExQUEyRTIiLA0KICAgICAgc3RvcmFnZV9rZXk6ICJjbGlja3NfTWFpbkRvb3IiLA0KICAgICAgYnV0dG9uX2lkOiAiTWFpbkRvb3IiLA0KICAgICAgdmlzaWJsZTogdHJ1ZSwNCiAgICB9LA0KICAgIHsNCiAgICAgIGlkOiAiMzQ5NDU0NzhkNTk1IiwNCiAgICAgIGF1dGhfa2V5Og0KICAgICAgICAiTVdJMk1EYzRkV2xrNDkwOEE3MURBODA5RkNFQzA1QzVEMUYzNjA5NDNGQkZDNkE3OTM0RUMwRkQ5RTNDRkVBRjAzRjhGNUE2QTRBMEM2MDY2NUI5N0ExQUEyRTIiLA0KICAgICAgc3RvcmFnZV9rZXk6ICJjbGlja3NfQXB0RG9vciIsDQogICAgICBidXR0b25faWQ6ICJBcHREb29yIiwNCiAgICAgIHZpc2libGU6IHRydWUsDQogICAgfSwNCiAgICB7DQogICAgICBpZDogIjM0OTQ1NDdhYjE2MSIsDQogICAgICBhdXRoX2tleToNCiAgICAgICAgIk1XSTJNRGM0ZFdsazQ5MDhBNzFEQTgwOUZDRUMwNUM1RDFGMzYwOTQzRkJGQzZBNzkzNEVDMEZEOUUzQ0ZFQUYwM0Y4RjVBNkE0QTBDNjA2NjVCOTdBMUFBMkUyIiwNCiAgICAgIHN0b3JhZ2Vfa2V5OiAiY2xpY2tzX0V4dHJhRG9vcjEiLA0KICAgICAgYnV0dG9uX2lkOiAiRXh0cmFEb29yMSIsDQogICAgICB2aXNpYmxlOiBmYWxzZSwNCiAgICB9LA0KICAgIHsNCiAgICAgIGlkOiAicGxhY2Vob2xkZXJfaWRfMiIsDQogICAgICBhdXRoX2tleTogInBsYWNlaG9sZGVyX2F1dGhfa2V5XzIiLA0KICAgICAgc3RvcmFnZV9rZXk6ICJjbGlja3NfRXh0cmFEb29yMiIsDQogICAgICBidXR0b25faWQ6ICJFeHRyYURvb3IyIiwNCiAgICAgIHZpc2libGU6IGZhbHNlLA0KICAgIH0sDQogIF0pOw0KDQogIC8vIFZhcmlhYmlsaSBnbG9iYWxpL2RpIHN0YXRvDQogIGxldCBNQVhfQ0xJQ0tTID0gcGFyc2VJbnQobG9jYWxTdG9yYWdlLmdldEl0ZW0oIm1heF9jbGlja3MiKSkgfHwgMzsNCiAgbGV0IFRJTUVfTElNSVRfTUlOVVRFUyA9CiAgICBwYXJzZUludChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgidGltZV9saW1pdF9taW51dGVzIikpIHx8IDUwMDAwOwogIC8vIExpbWl0ZSBwZXIgc2Vzc2lvbmkgdG9rZW4gZG9wbyBzdWJtaXQgKGRpIGRlZmF1bHQgdWd1YWxlIGEgVElNRV9MSU1JVF9NSU5VVEVTKQogIGNvbnN0IFRPS0VOX0xJTUlUX01JTlVURVMgPQogICAgcGFyc2VJbnQobG9jYWxTdG9yYWdlLmdldEl0ZW0oInRva2VuX3RpbWVfbGltaXRfbWludXRlcyIpKSB8fAogICAgVElNRV9MSU1JVF9NSU5VVEVTOwogIGxldCBDT1JSRUNUX0NPREUgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgic2VjcmV0X2NvZGUiKSB8fCAiMjI0NSI7DQogIGxldCBjdXJyZW50Q29kZVZlcnNpb24gPQ0KICAgIHBhcnNlSW50KGxvY2FsU3RvcmFnZS5nZXRJdGVtKENPREVfVkVSU0lPTl9LRVkpKSB8fCAxOw0KDQogIC8vIE9yYXJpIGRpIGNoZWNrw6LigqzigJhpbiAoZGkgZGVmYXVsdCwgcG9pIGFycml2YW5vIGRhIEZpcmViYXNlKQ0KICBsZXQgQ0hFQ0tJTl9TVEFSVF9USU1FID0gIjE0OjAwIjsNCiAgbGV0IENIRUNLSU5fRU5EX1RJTUUgPSAiMjI6MDAiOw0KICBsZXQgQ0hFQ0tJTl9USU1FX0VOQUJMRUQgPSB0cnVlOw0KDQogIC8vIFN0YXRvIHJ1bnRpbWUNCiAgbGV0IGlzVG9rZW5TZXNzaW9uID0gZmFsc2U7IC8vIFVTQVJFIFNFTVBSRSBRVUVTVEENCiAgbGV0IGN1cnJlbnRUb2tlbklkID0gbnVsbDsNCiAgbGV0IGN1cnJlbnRUb2tlbkN1c3RvbUNvZGUgPSBudWxsOw0KICBsZXQgc2Vzc2lvblN0YXJ0VGltZSA9IG51bGw7DQogIGxldCBjdXJyZW50RGV2aWNlID0gbnVsbDsNCg0KICAvLyBJbnRlcnZhbGxpL2xpc3RlbmVyDQogIGxldCB0aW1lQ2hlY2tJbnRlcnZhbCA9IG51bGw7DQogIGxldCBjb2RlQ2hlY2tJbnRlcnZhbCA9IG51bGw7DQogIGxldCBMSU5LX0NIRUNLX0lOVEVSVkFMID0gbnVsbDsNCiAgbGV0IHNldHRpbmdzUmVmID0gbnVsbDsNCiAgbGV0IHRva2VuUmVmID0gbnVsbDsNCg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgLy8gRmlyZWJhc2UgaW5pdCAoY29uIGd1YXJkaWEpDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICBpZiAoIWZpcmViYXNlLmFwcHMgfHwgZmlyZWJhc2UuYXBwcy5sZW5ndGggPT09IDApIHsNCiAgICBmaXJlYmFzZS5pbml0aWFsaXplQXBwKGZpcmViYXNlQ29uZmlnKTsNCiAgfQ0KICBjb25zdCBkYXRhYmFzZSA9IGZpcmViYXNlLmRhdGFiYXNlKCk7DQoNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIC8vIFVUSUxTDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICBmdW5jdGlvbiBxcyhpZCkgew0KICAgIHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7DQogIH0NCg0KICBmdW5jdGlvbiBvbihpZCwgZXZ0LCBoYW5kbGVyKSB7DQogICAgY29uc3QgZWwgPSBxcyhpZCk7DQogICAgaWYgKGVsKSBlbC5hZGRFdmVudExpc3RlbmVyKGV2dCwgaGFuZGxlcik7DQogIH0NCg0KICBmdW5jdGlvbiBzaG93Tm90aWZpY2F0aW9uKG1lc3NhZ2UsIHR5cGUgPSAiaW5mbyIpIHsNCiAgICBjb25zdCBleGlzdGluZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb2RlQ2hhbmdlTm90aWZpY2F0aW9uIik7DQogICAgaWYgKGV4aXN0aW5nKSBleGlzdGluZy5yZW1vdmUoKTsNCg0KICAgIGNvbnN0IG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICBuLmlkID0gImNvZGVDaGFuZ2VOb3RpZmljYXRpb24iOw0KICAgIG4uc3R5bGUuY3NzVGV4dCA9IGANCiAgICAgIHBvc2l0aW9uOiBmaXhlZDsgdG9wOiAyMHB4OyByaWdodDogMjBweDsgei1pbmRleDogMTAwMDA7DQogICAgICBiYWNrZ3JvdW5kOiAkew0KICAgICAgICB0eXBlID09PSAid2FybmluZyINCiAgICAgICAgICA/ICIjRkZBNTAwIg0KICAgICAgICAgIDogdHlwZSA9PT0gImVycm9yIg0KICAgICAgICAgID8gIiNGRjVBNUYiDQogICAgICAgICAgOiAiIzRDQUY1MCINCiAgICAgIH07DQogICAgICBjb2xvcjogI2ZmZjsgcGFkZGluZzogMTVweCAyMHB4OyBib3JkZXItcmFkaXVzOiA4cHg7IGJveC1zaGFkb3c6IDAgNHB4IDEycHggcmdiYSgwLDAsMCwuMTIpOw0KICAgICAgZGlzcGxheTpmbGV4OyBnYXA6MTBweDsgYWxpZ24taXRlbXM6Y2VudGVyOyBtYXgtd2lkdGg6MzYwcHg7DQogICAgYDsNCiAgICBuLmlubmVySFRNTCA9IGANCiAgICAgIDxpIGNsYXNzPSJmYXMgZmEtaW5mby1jaXJjbGUiPjwvaT4NCiAgICAgIDxzcGFuPiR7bWVzc2FnZX08L3NwYW4+DQogICAgICA8YnV0dG9uIG9uY2xpY2s9InRoaXMucGFyZW50RWxlbWVudC5yZW1vdmUoKSIgc3R5bGU9ImJhY2tncm91bmQ6bm9uZTtib3JkZXI6bm9uZTtjb2xvcjojZmZmO2N1cnNvcjpwb2ludGVyIj4NCiAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS10aW1lcyI+PC9pPg0KICAgICAgPC9idXR0b24+YDsNCiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG4pOw0KICAgIHNldFRpbWVvdXQoKCkgPT4gbi5wYXJlbnRFbGVtZW50ICYmIG4ucmVtb3ZlKCksIDUwMDApOw0KICB9DQoNCiAgZnVuY3Rpb24gZm9ybWF0VGltZSh0aW1lU3RyaW5nKSB7DQogICAgY29uc3QgW2gsIG1dID0gU3RyaW5nKHRpbWVTdHJpbmcgfHwgIiIpLnNwbGl0KCI6Iik7DQogICAgcmV0dXJuIGAke2g/LnBhZFN0YXJ0KDIsICIwIil9OiR7bT8ucGFkU3RhcnQoMiwgIjAiKX1gOw0KICB9DQoNCiAgZnVuY3Rpb24gZmV0Y2hXaXRoVGltZW91dCh1cmwsIG9wdGlvbnMgPSB7fSwgdGltZW91dE1zID0gMTIwMDApIHsNCiAgICBjb25zdCBjb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpOw0KICAgIGNvbnN0IGlkID0gc2V0VGltZW91dCgoKSA9PiBjb250cm9sbGVyLmFib3J0KCksIHRpbWVvdXRNcyk7DQogICAgY29uc3QgcCA9IGZldGNoKHVybCwgeyAuLi5vcHRpb25zLCBzaWduYWw6IGNvbnRyb2xsZXIuc2lnbmFsIH0pLmZpbmFsbHkoDQogICAgICAoKSA9PiBjbGVhclRpbWVvdXQoaWQpDQogICAgKTsNCiAgICByZXR1cm4gcDsNCiAgfQ0KDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICAvLyBTVE9SQUdFIChsb2NhbFN0b3JhZ2UgKyBjb29raWUgY29tcGF0KQ0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgZnVuY3Rpb24gc2V0U3RvcmFnZShrZXksIHZhbHVlLCBtaW51dGVzKSB7DQogICAgdHJ5IHsNCiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgdmFsdWUpOw0KICAgICAgY29uc3QgZXhwaXJhdGlvbkRhdGUgPSBuZXcgRGF0ZSgpOw0KICAgICAgZXhwaXJhdGlvbkRhdGUuc2V0VGltZShleHBpcmF0aW9uRGF0ZS5nZXRUaW1lKCkgKyBtaW51dGVzICogNjAgKiAxMDAwKTsNCiAgICAgIGNvbnN0IGV4cGlyZXMgPSAiZXhwaXJlcz0iICsgZXhwaXJhdGlvbkRhdGUudG9VVENTdHJpbmcoKTsNCiAgICAgIGRvY3VtZW50LmNvb2tpZSA9IGAke2tleX09JHt2YWx1ZX07ICR7ZXhwaXJlc307IHBhdGg9LzsgU2FtZVNpdGU9U3RyaWN0YDsNCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgY29uc29sZS5lcnJvcigiRXJyb3JlIG5lbCBzYWx2YXRhZ2dpbyBkZWkgZGF0aToiLCBlcnJvcik7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gZ2V0U3RvcmFnZShrZXkpIHsNCiAgICB0cnkgew0KICAgICAgY29uc3QgbG9jYWxWYWx1ZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSk7DQogICAgICBpZiAobG9jYWxWYWx1ZSAhPT0gbnVsbCkgcmV0dXJuIGxvY2FsVmFsdWU7DQogICAgICBjb25zdCBjb29raWVzID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCI7Iik7DQogICAgICBmb3IgKGNvbnN0IGNvb2tpZSBvZiBjb29raWVzKSB7DQogICAgICAgIGNvbnN0IFtuYW1lLCB2YWx1ZV0gPSBjb29raWUudHJpbSgpLnNwbGl0KCI9Iik7DQogICAgICAgIGlmIChuYW1lID09PSBrZXkpIHJldHVybiB2YWx1ZTsNCiAgICAgIH0NCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgY29uc29sZS5lcnJvcigiRXJyb3JlIG5lbCByZWN1cGVybyBkZWkgZGF0aToiLCBlcnJvcik7DQogICAgfQ0KICAgIHJldHVybiBudWxsOw0KICB9DQoNCiAgZnVuY3Rpb24gY2xlYXJTdG9yYWdlKGtleSkgew0KICAgIHRyeSB7DQogICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpOw0KICAgICAgZG9jdW1lbnQuY29va2llID0gYCR7a2V5fT07IGV4cGlyZXM9VGh1LCAwMSBKYW4gMTk3MCAwMDowMDowMCBVVEM7IHBhdGg9LztgOw0KICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICBjb25zb2xlLmVycm9yKCJFcnJvcmUgbmVsbGEgcmltb3ppb25lIGRlaSBkYXRpOiIsIGVycm9yKTsNCiAgICB9DQogIH0NCg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgLy8gQ1JJVFRPR1JBRklBDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICBhc3luYyBmdW5jdGlvbiBnZW5lcmF0ZUhhc2goc3RyKSB7DQogICAgY29uc3QgZW5jb2RlciA9IG5ldyBUZXh0RW5jb2RlcigpOw0KICAgIGNvbnN0IGRhdGEgPSBlbmNvZGVyLmVuY29kZShzdHIpOw0KICAgIGNvbnN0IGhhc2hCdWZmZXIgPSBhd2FpdCBjcnlwdG8uc3VidGxlLmRpZ2VzdCgiU0hBLTI1NiIsIGRhdGEpOw0KICAgIGNvbnN0IGhhc2hBcnJheSA9IEFycmF5LmZyb20obmV3IFVpbnQ4QXJyYXkoaGFzaEJ1ZmZlcikpOw0KICAgIHJldHVybiBoYXNoQXJyYXkubWFwKChiKSA9PiBiLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCAiMCIpKS5qb2luKCIiKTsNCiAgfQ0KDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICAvLyBJTVBPU1RBWklPTkkgKEZpcmViYXNlKQ0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgYXN5bmMgZnVuY3Rpb24gbG9hZFNldHRpbmdzRnJvbUZpcmViYXNlKCkgew0KICAgIHRyeSB7DQogICAgICBjb25zdCBzbmFwc2hvdCA9IGF3YWl0IGRhdGFiYXNlLnJlZigic2V0dGluZ3MiKS5vbmNlKCJ2YWx1ZSIpOw0KICAgICAgcmV0dXJuIHNuYXBzaG90LmV4aXN0cygpID8gc25hcHNob3QudmFsKCkgOiBudWxsOw0KICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICBjb25zb2xlLmVycm9yKA0KICAgICAgICAiRXJyb3JlIG5lbCBjYXJpY2FtZW50byBkZWxsZSBpbXBvc3RhemlvbmkgZGEgRmlyZWJhc2U6IiwNCiAgICAgICAgZXJyb3INCiAgICAgICk7DQogICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBhcHBseUZpcmViYXNlU2V0dGluZ3Moc2V0dGluZ3MpIHsNCiAgICBpZiAoc2V0dGluZ3M/LnNlY3JldF9jb2RlKSB7DQogICAgICBDT1JSRUNUX0NPREUgPSBzZXR0aW5ncy5zZWNyZXRfY29kZTsNCiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJzZWNyZXRfY29kZSIsIHNldHRpbmdzLnNlY3JldF9jb2RlKTsNCiAgICB9DQogICAgaWYgKHNldHRpbmdzPy5tYXhfY2xpY2tzKSB7DQogICAgICBNQVhfQ0xJQ0tTID0gcGFyc2VJbnQoc2V0dGluZ3MubWF4X2NsaWNrcywgMTApOw0KICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oIm1heF9jbGlja3MiLCBzZXR0aW5ncy5tYXhfY2xpY2tzKTsNCiAgICB9DQogICAgaWYgKHNldHRpbmdzPy50aW1lX2xpbWl0X21pbnV0ZXMpIHsNCiAgICAgIFRJTUVfTElNSVRfTUlOVVRFUyA9IHBhcnNlSW50KHNldHRpbmdzLnRpbWVfbGltaXRfbWludXRlcywgMTApOw0KICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oInRpbWVfbGltaXRfbWludXRlcyIsIHNldHRpbmdzLnRpbWVfbGltaXRfbWludXRlcyk7DQogICAgfQ0KICAgIGlmICh0eXBlb2Ygc2V0dGluZ3M/LmNoZWNraW5fc3RhcnRfdGltZSA9PT0gInN0cmluZyIpDQogICAgICBDSEVDS0lOX1NUQVJUX1RJTUUgPSBzZXR0aW5ncy5jaGVja2luX3N0YXJ0X3RpbWU7DQogICAgaWYgKHR5cGVvZiBzZXR0aW5ncz8uY2hlY2tpbl9lbmRfdGltZSA9PT0gInN0cmluZyIpDQogICAgICBDSEVDS0lOX0VORF9USU1FID0gc2V0dGluZ3MuY2hlY2tpbl9lbmRfdGltZTsNCiAgICBpZiAodHlwZW9mIHNldHRpbmdzPy5jaGVja2luX3RpbWVfZW5hYmxlZCAhPT0gInVuZGVmaW5lZCIpDQogICAgICBDSEVDS0lOX1RJTUVfRU5BQkxFRCA9IFN0cmluZyhzZXR0aW5ncy5jaGVja2luX3RpbWVfZW5hYmxlZCkgIT09ICJmYWxzZSI7DQoNCiAgICB1cGRhdGVDaGVja2luVGltZURpc3BsYXkoKTsNCiAgICBERVZJQ0VTLmZvckVhY2godXBkYXRlQnV0dG9uU3RhdGUpOw0KICAgIHVwZGF0ZVN0YXR1c0JhcigpOw0KICB9DQoNCiAgZnVuY3Rpb24gc2V0dXBTZXR0aW5nc0xpc3RlbmVyKCkgew0KICAgIGlmIChzZXR0aW5nc1JlZikgcmV0dXJuOyAvLyBldml0YSBkb3BwaW8gbGlzdGVuZXINCiAgICBzZXR0aW5nc1JlZiA9IGRhdGFiYXNlLnJlZigic2V0dGluZ3MiKTsNCiAgICBzZXR0aW5nc1JlZi5vbigidmFsdWUiLCAoc25hcCkgPT4gew0KICAgICAgY29uc3QgcyA9IHNuYXAudmFsKCkgfHwge307DQogICAgICBhcHBseUZpcmViYXNlU2V0dGluZ3Mocyk7DQoNCiAgICAgIC8vIEtpbGwtc3dpdGNoOiBjYW1iaW8gY29kaWNlIGdsb2JhbGUgPT4gYmxvY2NhIGUgZm9yemEgbG9nb3V0DQogICAgICBjb25zdCBzZXJ2ZXJDb2RlVmVyID0gcGFyc2VJbnQocy5jb2RlX3ZlcnNpb24gfHwgMSwgMTApOw0KICAgICAgY29uc3QgbG9jYWxDb2RlVmVyID0gcGFyc2VJbnQoDQogICAgICAgIGxvY2FsU3RvcmFnZS5nZXRJdGVtKENPREVfVkVSU0lPTl9LRVkpIHx8ICIxIiwNCiAgICAgICAgMTANCiAgICAgICk7DQogICAgICBpZiAoc2VydmVyQ29kZVZlciA+IGxvY2FsQ29kZVZlcikgew0KICAgICAgICAvLyBBZ2dpb3JuYSB2ZXJzaW9uZSBsb2NhbGUNCiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oQ09ERV9WRVJTSU9OX0tFWSwgU3RyaW5nKHNlcnZlckNvZGVWZXIpKTsNCiAgICAgICAgLy8gU2UgaWwgZGlzcG9zaXRpdm8gaGEgdHJhY2NlIGRpIHVuIGxpbmsvdG9rZW4gYXBlcnRvLCBibG9jY2Fsby4NCiAgICAgICAgLy8gQWx0cmltZW50aSBtb3N0cmEgaWwgZm9ybSBkaSBsb2dpbiBzZW56YSBibG9jY28gcGVyc2lzdGVudGUuDQogICAgICAgIGlmIChoYXNUb2tlbkZvb3RwcmludCgpKSB7DQogICAgICAgICAgY29uc3QgbXNnID0gcy5nbG9iYWxfYmxvY2tfbWVzc2FnZSB8fCAiQ29kaWNlIGFnZ2lvcm5hdG86IGlsIGxpbmsgbm9uIGUnIHBpdScgdmFsaWRvIjsNCiAgICAgICAgICBmb3JjZUxvZ291dEZyb21Ub2tlbihtc2cpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHVuYmxvY2tBY2Nlc3MoKTsNCiAgICAgICAgICBxcygiU2NhZHV0YU92ZXJsYXkiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7DQogICAgICAgICAgcXMoInNlc3Npb25TY2FkdXRhIik/LmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOw0KICAgICAgICAgIHFzKCJjb250cm9sUGFuZWwiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7DQogICAgICAgICAgcmVzZXRTZXNzaW9uRm9yTmV3Q29kZSgpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCg0KICAgICAgLy8gUmlwcmlzdGlubyBnbG9iYWxlOiBzYmxvY2NhIGUgdG9ybmEgYWwgbG9naW4NCiAgICAgIGNvbnN0IHNlcnZlclVuYmxvY2tWZXIgPSBwYXJzZUludChzLnNlc3Npb25fcmVzZXRfdmVyc2lvbiB8fCAwLCAxMCk7DQogICAgICBjb25zdCBsb2NhbFVuYmxvY2tWZXIgPSBwYXJzZUludCgNCiAgICAgICAgbG9jYWxTdG9yYWdlLmdldEl0ZW0oVU5CTE9DS19WRVJTSU9OX0tFWSkgfHwgIjAiLA0KICAgICAgICAxMA0KICAgICAgKTsNCiAgICAgIGlmIChzZXJ2ZXJVbmJsb2NrVmVyID4gbG9jYWxVbmJsb2NrVmVyKSB7DQogICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFVOQkxPQ0tfVkVSU0lPTl9LRVksIFN0cmluZyhzZXJ2ZXJVbmJsb2NrVmVyKSk7DQogICAgICAgIHVuYmxvY2tBY2Nlc3MoKTsNCiAgICAgICAgcXMoIlNjYWR1dGFPdmVybGF5Iik/LmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOw0KICAgICAgICBxcygic2Vzc2lvblNjYWR1dGEiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7DQogICAgICAgIHFzKCJjb250cm9sUGFuZWwiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7DQogICAgICAgIHNob3dBdXRoRm9ybSgpOw0KICAgICAgICB1cGRhdGVEb29yVmlzaWJpbGl0eSgpOw0KICAgICAgICBzaG93Tm90aWZpY2F0aW9uKA0KICAgICAgICAgIHMuZ2xvYmFsX3VuYmxvY2tfbWVzc2FnZSB8fA0KICAgICAgICAgICAgIlNlc3Npb25lIHJpcHJpc3RpbmF0YS4gSW5zZXJpc2NpIGlsIGNvZGljZSBwZXIgYWNjZWRlcmUuIg0KICAgICAgICApOw0KICAgICAgfQ0KICAgIH0pOw0KICB9DQoNCiAgZnVuY3Rpb24gbW9uaXRvckZpcmViYXNlQ29ubmVjdGlvbigpIHsNCiAgICBjb25zdCBjb25uZWN0ZWRSZWYgPSBkYXRhYmFzZS5yZWYoIi5pbmZvL2Nvbm5lY3RlZCIpOw0KICAgIGNvbm5lY3RlZFJlZi5vbigidmFsdWUiLCAoc25hcCkgPT4gew0KICAgICAgaWYgKHNuYXAudmFsKCkgPT09IHRydWUpIHsNCiAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCJmaXJlYmFzZS1vZmZsaW5lIik7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoImZpcmViYXNlLW9mZmxpbmUiKTsNCiAgICAgICAgc2hvd05vdGlmaWNhdGlvbigNCiAgICAgICAgICAiQ29ubmVzc2lvbmUgYSBGaXJlYmFzZSBwZXJzYS4gTGUgbW9kaWZpY2hlIHBvdHJlYmJlcm8gbm9uIGVzc2VyZSBzaW5jcm9uaXp6YXRlLiIsDQogICAgICAgICAgIndhcm5pbmciDQogICAgICAgICk7DQogICAgICB9DQogICAgfSk7DQogIH0NCg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAvLyBURU1QTy9TRVNTSU9ORQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogIGFzeW5jIGZ1bmN0aW9uIHNldFVzYWdlU3RhcnRUaW1lKCkgewogICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKS50b1N0cmluZygpOw0KICAgIGNvbnN0IGhhc2ggPSBhd2FpdCBnZW5lcmF0ZUhhc2gobm93ICsgU0VDUkVUX0tFWSk7DQogICAgc2V0U3RvcmFnZSgidXNhZ2Vfc3RhcnRfdGltZSIsIG5vdywgVElNRV9MSU1JVF9NSU5VVEVTKTsNCiAgICBzZXRTdG9yYWdlKCJ1c2FnZV9oYXNoIiwgaGFzaCwgVElNRV9MSU1JVF9NSU5VVEVTKTsNCiAgICB1cGRhdGVTdGF0dXNCYXIoKTsNCiAgfQoKICBhc3luYyBmdW5jdGlvbiBzZXRMb2dpblN0YXJ0VGltZSgpIHsKICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCkudG9TdHJpbmcoKTsKICAgIGNvbnN0IGhhc2ggPSBhd2FpdCBnZW5lcmF0ZUhhc2gobm93ICsgU0VDUkVUX0tFWSk7CiAgICBzZXRTdG9yYWdlKCJsb2dpbl9zdGFydF90aW1lIiwgbm93LCBQUkVfVVNFX0xJTUlUX01JTlVURVMpOwogICAgc2V0U3RvcmFnZSgibG9naW5faGFzaCIsIGhhc2gsIFBSRV9VU0VfTElNSVRfTUlOVVRFUyk7CiAgICB1cGRhdGVTdGF0dXNCYXIoKTsKICB9CgogIGFzeW5jIGZ1bmN0aW9uIHNldFRva2VuVXNhZ2VTdGFydFRpbWUodG9rZW5JZCkgewogICAgaWYgKCF0b2tlbklkKSByZXR1cm47CiAgICBjb25zdCBrZXlUID0gYHRva2VuX3RzXyR7dG9rZW5JZH1gOwogICAgY29uc3Qga2V5SCA9IGB0b2tlbl90aF8ke3Rva2VuSWR9YDsKICAgIHRyeSB7CiAgICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXlUKSkgcmV0dXJuOyAvLyBub24gc292cmFzY3JpdmVyZSBzZSBnacODwqAgYXZ2aWF0bwogICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpLnRvU3RyaW5nKCk7CiAgICAgIGNvbnN0IGhhc2ggPSBhd2FpdCBnZW5lcmF0ZUhhc2gobm93ICsgU0VDUkVUX0tFWSArIHRva2VuSWQpOwogICAgICBzZXRTdG9yYWdlKGtleVQsIG5vdywgVE9LRU5fTElNSVRfTUlOVVRFUyk7CiAgICAgIHNldFN0b3JhZ2Uoa2V5SCwgaGFzaCwgVE9LRU5fTElNSVRfTUlOVVRFUyk7CiAgICB9IGNhdGNoIHt9CiAgfQoKICBmdW5jdGlvbiBjbGVhclRva2VuVXNhZ2VTdGFydCh0b2tlbklkKSB7CiAgICBpZiAoIXRva2VuSWQpIHJldHVybjsKICAgIHRyeSB7CiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGB0b2tlbl90c18ke3Rva2VuSWR9YCk7CiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGB0b2tlbl90aF8ke3Rva2VuSWR9YCk7CiAgICB9IGNhdGNoIHt9CiAgfQoKICBhc3luYyBmdW5jdGlvbiBjaGVja1RpbWVMaW1pdCgpIHsKICAgIC8vIFRpbWVyIGFuY2hlIHBlciBzZXNzaW9uaSB0b2tlbiBkb3BvIHN1Ym1pdAogICAgaWYgKGlzVG9rZW5TZXNzaW9uKSB7CiAgICAgIGNvbnN0IHQgPQogICAgICAgIGN1cnJlbnRUb2tlbklkIHx8IG5ldyBVUkxTZWFyY2hQYXJhbXMobG9jYXRpb24uc2VhcmNoKS5nZXQoInRva2VuIik7CiAgICAgIGlmICghdCkgcmV0dXJuIGZhbHNlOwogICAgICBjb25zdCBrZXlUID0gYHRva2VuX3RzXyR7dH1gOwogICAgICBjb25zdCBrZXlIID0gYHRva2VuX3RoXyR7dH1gOwogICAgICBjb25zdCB0cyA9IGdldFN0b3JhZ2Uoa2V5VCk7CiAgICAgIGNvbnN0IGhzID0gZ2V0U3RvcmFnZShrZXlIKTsKICAgICAgaWYgKHRzICYmIGhzKSB7CiAgICAgICAgY29uc3QgY2FsYyA9IGF3YWl0IGdlbmVyYXRlSGFzaCh0cyArIFNFQ1JFVF9LRVkgKyB0KTsKICAgICAgICBpZiAoY2FsYyAhPT0gaHMpIHsKICAgICAgICAgIC8vIGhhc2ggbWlzbWF0Y2ggPT4gY29uc2lkZXJhIHNjYWR1dGEKICAgICAgICAgIGNsZWFyVG9rZW5Vc2FnZVN0YXJ0KHQpOwogICAgICAgICAgdHJ5IHsgZm9yY2VMb2dvdXRGcm9tVG9rZW4oIlNlc3Npb25lIHRva2VuIG5vbiB2YWxpZGEiKTsgfSBjYXRjaCB7fQogICAgICAgICAgLy8gTmFzY29uZGkgcGFubmVsbG8gZSBtb3N0cmEgb3ZlcmxheQogICAgICAgICAgcXMoImNvbnRyb2xQYW5lbCIpPy5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsKICAgICAgICAgIHFzKCJTY2FkdXRhT3ZlcmxheSIpPy5jbGFzc0xpc3QucmVtb3ZlKCJoaWRkZW4iKTsKICAgICAgICAgIHFzKCJzZXNzaW9uU2NhZHV0YSIpPy5jbGFzc0xpc3QucmVtb3ZlKCJoaWRkZW4iKTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBtaW5zID0gKERhdGUubm93KCkgLSBwYXJzZUludCh0cywgMTApKSAvICgxMDAwICogNjApOwogICAgICAgIGlmIChtaW5zID49IFRPS0VOX0xJTUlUX01JTlVURVMpIHsKICAgICAgICAgIGNsZWFyVG9rZW5Vc2FnZVN0YXJ0KHQpOwogICAgICAgICAgdHJ5IHsgZm9yY2VMb2dvdXRGcm9tVG9rZW4oIlNlc3Npb25lIHRva2VuIHNjYWR1dGEiKTsgfSBjYXRjaCB7fQogICAgICAgICAgcXMoImNvbnRyb2xQYW5lbCIpPy5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsKICAgICAgICAgIHFzKCJTY2FkdXRhT3ZlcmxheSIpPy5jbGFzc0xpc3QucmVtb3ZlKCJoaWRkZW4iKTsKICAgICAgICAgIHFzKCJzZXNzaW9uU2NhZHV0YSIpPy5jbGFzc0xpc3QucmVtb3ZlKCJoaWRkZW4iKTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgaWYgKCFzZXNzaW9uU3RhcnRUaW1lKSByZXR1cm4gZmFsc2U7Cg0KICAgIGNvbnN0IHN0YXJ0VGltZSA9IGdldFN0b3JhZ2UoInVzYWdlX3N0YXJ0X3RpbWUiKTsNCiAgICBjb25zdCBzdG9yZWRIYXNoID0gZ2V0U3RvcmFnZSgidXNhZ2VfaGFzaCIpOw0KICAgIGlmICghc3RhcnRUaW1lIHx8ICFzdG9yZWRIYXNoKSByZXR1cm4gZmFsc2U7DQoNCiAgICBjb25zdCBjYWxjSGFzaCA9IGF3YWl0IGdlbmVyYXRlSGFzaChzdGFydFRpbWUgKyBTRUNSRVRfS0VZKTsNCiAgICBpZiAoY2FsY0hhc2ggIT09IHN0b3JlZEhhc2gpIHsNCiAgICAgIHNob3dGYXRhbEVycm9yKCLDosWhwqDDr8K4wo8gVmlvbGF6aW9uZSBkaSBzaWN1cmV6emEgcmlsZXZhdGEhIik7DQogICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpOw0KICAgIGNvbnN0IG1pbnV0ZXNQYXNzZWQgPSAobm93IC0gcGFyc2VJbnQoc3RhcnRUaW1lLCAxMCkpIC8gKDEwMDAgKiA2MCk7DQogICAgaWYgKG1pbnV0ZXNQYXNzZWQgPj0gVElNRV9MSU1JVF9NSU5VVEVTKSB7DQogICAgICBzaG93U2Vzc2lvblNjYWR1dGEoKTsNCiAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIHVwZGF0ZVN0YXR1c0JhcigpOw0KICAgIHJldHVybiBmYWxzZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNob3dGYXRhbEVycm9yKG1lc3NhZ2UpIHsNCiAgICBpZiAodGltZUNoZWNrSW50ZXJ2YWwpIGNsZWFySW50ZXJ2YWwodGltZUNoZWNrSW50ZXJ2YWwpOw0KICAgIGlmIChjb2RlQ2hlY2tJbnRlcnZhbCkgY2xlYXJJbnRlcnZhbChjb2RlQ2hlY2tJbnRlcnZhbCk7DQogICAgZG9jdW1lbnQuYm9keS5pbm5lckhUTUwgPSBgDQogICAgICA8ZGl2IHN0eWxlPSJwb3NpdGlvbjpmaXhlZDtpbnNldDowO2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO2FsaWduLWl0ZW1zOmNlbnRlcjtiYWNrZ3JvdW5kOiMxMjExMTE7Y29sb3I6I2ZmNmI2Yjtmb250LXNpemU6MjRweDt0ZXh0LWFsaWduOmNlbnRlcjtwYWRkaW5nOjIwcHg7ei1pbmRleDo5OTk5OyI+DQogICAgICAgICR7bWVzc2FnZX0NCiAgICAgIDwvZGl2PmA7DQogIH0NCg0KICBmdW5jdGlvbiBzaG93U2Vzc2lvblNjYWR1dGEoKSB7DQogICAgaWYgKGlzVG9rZW5TZXNzaW9uKSByZXR1cm47IC8vIG92ZXJsYXkgc29sbyBwZXIgc2Vzc2lvbmkgbWFudWFsaQ0KICAgIGlmICh0aW1lQ2hlY2tJbnRlcnZhbCkgY2xlYXJJbnRlcnZhbCh0aW1lQ2hlY2tJbnRlcnZhbCk7DQogICAgaWYgKGNvZGVDaGVja0ludGVydmFsKSBjbGVhckludGVydmFsKGNvZGVDaGVja0ludGVydmFsKTsNCg0KICAgIHFzKCJTY2FkdXRhT3ZlcmxheSIpPy5jbGFzc0xpc3QucmVtb3ZlKCJoaWRkZW4iKTsNCiAgICBxcygiY29udHJvbFBhbmVsIik/LmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOw0KICAgIHFzKCJzZXNzaW9uU2NhZHV0YSIpPy5jbGFzc0xpc3QucmVtb3ZlKCJoaWRkZW4iKTsNCiAgICBxcygidGVzdDIiKSAmJiAocXMoInRlc3QyIikuc3R5bGUuZGlzcGxheSA9ICJub25lIik7DQoNCiAgICBERVZJQ0VTLmZvckVhY2goKGRldmljZSkgPT4gew0KICAgICAgY29uc3QgYnRuID0gcXMoZGV2aWNlLmJ1dHRvbl9pZCk7DQogICAgICBpZiAoYnRuKSB7DQogICAgICAgIGJ0bi5kaXNhYmxlZCA9IHRydWU7DQogICAgICAgIGJ0bi5jbGFzc0xpc3QuYWRkKCJidG4tZXJyb3IiKTsNCiAgICAgIH0NCiAgICB9KTsNCg0KICAgIGNvbnN0IHNlY3VyaXR5U3RhdHVzID0gcXMoInNlY3VyaXR5U3RhdHVzIik7DQogICAgaWYgKHNlY3VyaXR5U3RhdHVzKSB7DQogICAgICBzZWN1cml0eVN0YXR1cy50ZXh0Q29udGVudCA9ICJTY2FkdXRhIjsNCiAgICAgIHNlY3VyaXR5U3RhdHVzLnN0eWxlLmNvbG9yID0gInZhcigtLWVycm9yKSI7DQogICAgfQ0KDQogICAgc2Vzc2lvblN0YXJ0VGltZSA9IG51bGw7DQogIH0NCg0KICBmdW5jdGlvbiBpc1Nlc3Npb25TdHVjaygpIHsNCiAgICB0cnkgew0KICAgICAgY29uc3QgYXV0aFZlcmlmaWVkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oImF1dGhfdmVyaWZpZWQiKTsNCiAgICAgIGNvbnN0IGF1dGhUaW1lc3RhbXAgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiYXV0aF90aW1lc3RhbXAiKTsNCiAgICAgIGNvbnN0IHVzYWdlU3RhcnRUaW1lID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oInVzYWdlX3N0YXJ0X3RpbWUiKTsNCg0KICAgICAgaWYgKGF1dGhWZXJpZmllZCA9PT0gInRydWUiICYmIGF1dGhUaW1lc3RhbXApIHsNCiAgICAgICAgY29uc3QgYXV0aFRpbWUgPSBwYXJzZUludChhdXRoVGltZXN0YW1wLCAxMCk7DQogICAgICAgIGlmIChEYXRlLm5vdygpIC0gYXV0aFRpbWUgPiAyNCAqIDYwICogNjAgKiAxMDAwKSByZXR1cm4gdHJ1ZTsNCiAgICAgIH0NCiAgICAgIGlmICh1c2FnZVN0YXJ0VGltZSkgew0KICAgICAgICBjb25zdCBzdGFydFRpbWUgPSBwYXJzZUludCh1c2FnZVN0YXJ0VGltZSwgMTApOw0KICAgICAgICBjb25zdCBtaW51dGVzUGFzc2VkID0gKERhdGUubm93KCkgLSBzdGFydFRpbWUpIC8gKDEwMDAgKiA2MCk7DQogICAgICAgIGlmIChtaW51dGVzUGFzc2VkID4gVElNRV9MSU1JVF9NSU5VVEVTICsgNjApIHJldHVybiB0cnVlOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yZSBuZWwgY29udHJvbGxvIHNlc3Npb25lIGJsb2NjYXRhOiIsIGUpOw0KICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgfQ0KDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICAvLyBDSEVDS8Oi4oKs4oCYSU4gVElNRQ0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgZnVuY3Rpb24gaXNDaGVja2luVGltZSgpIHsNCiAgICBpZiAoIUNIRUNLSU5fVElNRV9FTkFCTEVEKSByZXR1cm4gdHJ1ZTsNCg0KICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7DQogICAgY29uc3QgY3VycmVudCA9IG5vdy5nZXRIb3VycygpICogNjAgKyBub3cuZ2V0TWludXRlcygpOw0KICAgIGNvbnN0IFtzaCwgc21dID0gQ0hFQ0tJTl9TVEFSVF9USU1FLnNwbGl0KCI6IikubWFwKE51bWJlcik7DQogICAgY29uc3QgW2VoLCBlbV0gPSBDSEVDS0lOX0VORF9USU1FLnNwbGl0KCI6IikubWFwKE51bWJlcik7DQogICAgY29uc3Qgc3RhcnQgPSBzaCAqIDYwICsgc207DQogICAgY29uc3QgZW5kID0gZWggKiA2MCArIGVtOw0KICAgIHJldHVybiBjdXJyZW50ID49IHN0YXJ0ICYmIGN1cnJlbnQgPD0gZW5kOw0KICB9DQoNCiAgZnVuY3Rpb24gdXBkYXRlQ2hlY2tpblRpbWVEaXNwbGF5KCkgew0KICAgIGNvbnN0IHN0YXJ0RWwgPSBxcygiY2hlY2tpblN0YXJ0RGlzcGxheSIpOw0KICAgIGNvbnN0IGVuZEVsID0gcXMoImNoZWNraW5FbmREaXNwbGF5Iik7DQogICAgY29uc3Qgc3RhcnRQb3B1cCA9IHFzKCJjaGVja2luU3RhcnRQb3B1cCIpOw0KICAgIGNvbnN0IGVuZFBvcHVwID0gcXMoImNoZWNraW5FbmRQb3B1cCIpOw0KICAgIGNvbnN0IGN1cnJlbnRTdGFydCA9IHFzKCJjdXJyZW50Q2hlY2tpblN0YXJ0VGltZSIpOw0KICAgIGNvbnN0IGN1cnJlbnRFbmQgPSBxcygiY3VycmVudENoZWNraW5FbmRUaW1lIik7DQogICAgaWYgKHN0YXJ0RWwpIHN0YXJ0RWwudGV4dENvbnRlbnQgPSBmb3JtYXRUaW1lKENIRUNLSU5fU1RBUlRfVElNRSk7DQogICAgaWYgKGVuZEVsKSBlbmRFbC50ZXh0Q29udGVudCA9IGZvcm1hdFRpbWUoQ0hFQ0tJTl9FTkRfVElNRSk7DQogICAgaWYgKHN0YXJ0UG9wdXApIHN0YXJ0UG9wdXAudGV4dENvbnRlbnQgPSBmb3JtYXRUaW1lKENIRUNLSU5fU1RBUlRfVElNRSk7DQogICAgaWYgKGVuZFBvcHVwKSBlbmRQb3B1cC50ZXh0Q29udGVudCA9IGZvcm1hdFRpbWUoQ0hFQ0tJTl9FTkRfVElNRSk7DQogICAgaWYgKGN1cnJlbnRTdGFydCkgY3VycmVudFN0YXJ0LnRleHRDb250ZW50ID0gZm9ybWF0VGltZShDSEVDS0lOX1NUQVJUX1RJTUUpOw0KICAgIGlmIChjdXJyZW50RW5kKSBjdXJyZW50RW5kLnRleHRDb250ZW50ID0gZm9ybWF0VGltZShDSEVDS0lOX0VORF9USU1FKTsNCg0KICAgIGNvbnN0IHN0YXR1c0VsZW1lbnQgPSBxcygiY3VycmVudFRpbWVTdGF0dXMiKTsNCiAgICBpZiAoIXN0YXR1c0VsZW1lbnQpIHJldHVybjsNCg0KICAgIGlmICghQ0hFQ0tJTl9USU1FX0VOQUJMRUQpIHsNCiAgICAgIHN0YXR1c0VsZW1lbnQuaW5uZXJIVE1MID0NCiAgICAgICAgJzxpIGNsYXNzPSJmYXMgZmEtcG93ZXItb2ZmIiBzdHlsZT0iY29sb3I6b3JhbmdlOyI+PC9pPiBUaW1lIGNvbnRyb2wgZGlzYWJsZWQgw6LigqzigJ0gY2hlY2staW4gYWxsb3dlZCBhdCBhbnkgdGltZSc7DQogICAgICByZXR1cm47DQogICAgfQ0KDQogICAgaWYgKGlzQ2hlY2tpblRpbWUoKSkgew0KICAgICAgc3RhdHVzRWxlbWVudC5pbm5lckhUTUwgPQ0KICAgICAgICAnPGkgY2xhc3M9ImZhcyBmYS1jaGVjay1jaXJjbGUiIHN0eWxlPSJjb2xvcjpncmVlbjsiPjwvaT4gQ2hlY2staW4gbm93IGF2YWlsYWJsZSc7DQogICAgICByZXR1cm47DQogICAgfQ0KDQogICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTsNCiAgICBjb25zdCBjdXJyZW50ID0gbm93LmdldEhvdXJzKCkgKiA2MCArIG5vdy5nZXRNaW51dGVzKCk7DQogICAgY29uc3QgW3NoLCBzbV0gPSBDSEVDS0lOX1NUQVJUX1RJTUUuc3BsaXQoIjoiKS5tYXAoTnVtYmVyKTsNCiAgICBjb25zdCBbZWgsIGVtXSA9IENIRUNLSU5fRU5EX1RJTUUuc3BsaXQoIjoiKS5tYXAoTnVtYmVyKTsNCiAgICBjb25zdCBzdGFydCA9IHNoICogNjAgKyBzbTsNCiAgICBjb25zdCBlbmQgPSBlaCAqIDYwICsgZW07DQoNCiAgICBpZiAoY3VycmVudCA8IHN0YXJ0KSB7DQogICAgICBjb25zdCBkaWZmID0gc3RhcnQgLSBjdXJyZW50Ow0KICAgICAgY29uc3QgaCA9IE1hdGguZmxvb3IoZGlmZiAvIDYwKTsNCiAgICAgIGNvbnN0IG0gPSBkaWZmICUgNjA7DQogICAgICBzdGF0dXNFbGVtZW50LmlubmVySFRNTCA9IGA8aSBjbGFzcz0iZmFzIGZhLWNsb2NrIiBzdHlsZT0iY29sb3I6b3JhbmdlOyI+PC9pPiBDaGVjay1pbiB3aWxsIGJlIGF2YWlsYWJsZSBpbiAke2h9aCAke219bWA7DQogICAgfSBlbHNlIHsNCiAgICAgIGNvbnN0IHRvbW9ycm93ID0gbmV3IERhdGUobm93KTsNCiAgICAgIHRvbW9ycm93LnNldERhdGUodG9tb3Jyb3cuZ2V0RGF0ZSgpICsgMSk7DQogICAgICB0b21vcnJvdy5zZXRIb3VycyhzaCwgc20sIDAsIDApOw0KICAgICAgY29uc3QgZGlmZiA9IHRvbW9ycm93IC0gbm93Ow0KICAgICAgY29uc3QgaCA9IE1hdGguZmxvb3IoZGlmZiAvICgxMDAwICogNjAgKiA2MCkpOw0KICAgICAgY29uc3QgbSA9IE1hdGguZmxvb3IoKGRpZmYgJSAoMTAwMCAqIDYwICogNjApKSAvICgxMDAwICogNjApKTsNCiAgICAgIHN0YXR1c0VsZW1lbnQuaW5uZXJIVE1MID0gYDxpIGNsYXNzPSJmYXMgZmEtY2xvY2siIHN0eWxlPSJjb2xvcjpvcmFuZ2U7Ij48L2k+IENoZWNrLWluIHdpbGwgYmUgYXZhaWxhYmxlIHRvbW9ycm93IGluICR7aH1oICR7bX1tYDsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBzaG93RWFybHlDaGVja2luUG9wdXAoKSB7DQogICAgY29uc3QgZWwgPSBxcygiZWFybHlDaGVja2luUG9wdXAiKTsNCiAgICBpZiAoZWwpIGVsLnN0eWxlLmRpc3BsYXkgPSAiZmxleCI7DQogIH0NCiAgZnVuY3Rpb24gY2xvc2VFYXJseUNoZWNraW5Qb3B1cCgpIHsNCiAgICBjb25zdCBlbCA9IHFzKCJlYXJseUNoZWNraW5Qb3B1cCIpOw0KICAgIGlmIChlbCkgZWwuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCiAgfQ0KDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICAvLyBJTlRFUkZBQ0NJQS9TVEFUTw0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgZnVuY3Rpb24gdXBkYXRlU3RhdHVzQmFyKCkgew0KICAgIGNvbnN0IG1haW5Eb29yQ291bnRlciA9IHFzKCJtYWluRG9vckNvdW50ZXIiKTsNCiAgICBjb25zdCBhcHREb29yQ291bnRlciA9IHFzKCJhcHREb29yQ291bnRlciIpOw0KICAgIGNvbnN0IHRpbWVSZW1haW5pbmcgPSBxcygidGltZVJlbWFpbmluZyIpOw0KDQogICAgaWYgKG1haW5Eb29yQ291bnRlcikgew0KICAgICAgbWFpbkRvb3JDb3VudGVyLnRleHRDb250ZW50ID0gYCR7Z2V0Q2xpY2tzTGVmdCgNCiAgICAgICAgREVWSUNFU1swXS5zdG9yYWdlX2tleQ0KICAgICAgKX0gY2xpY2sgbGVmdGA7DQogICAgfQ0KICAgIGlmIChhcHREb29yQ291bnRlcikgew0KICAgICAgYXB0RG9vckNvdW50ZXIudGV4dENvbnRlbnQgPSBgJHtnZXRDbGlja3NMZWZ0KA0KICAgICAgICBERVZJQ0VTWzFdLnN0b3JhZ2Vfa2V5DQogICAgICApfSBjbGljayBsZWZ0YDsNCiAgICB9DQoNCiAgICBpZiAoIXNlc3Npb25TdGFydFRpbWUgfHwgIXRpbWVSZW1haW5pbmcpIHsNCiAgICAgIGlmICh0aW1lUmVtYWluaW5nKSB7DQogICAgICAgIGNvbnN0IG1pbnV0ZXMgPSBNYXRoLmZsb29yKFRJTUVfTElNSVRfTUlOVVRFUyk7DQogICAgICAgIGNvbnN0IHNlY29uZHMgPSBNYXRoLmZsb29yKChUSU1FX0xJTUlUX01JTlVURVMgJSAxKSAqIDYwKTsNCiAgICAgICAgdGltZVJlbWFpbmluZy50ZXh0Q29udGVudCA9IGAke1N0cmluZyhtaW51dGVzKS5wYWRTdGFydCgNCiAgICAgICAgICAyLA0KICAgICAgICAgICIwIg0KICAgICAgICApfToke1N0cmluZyhzZWNvbmRzKS5wYWRTdGFydCgyLCAiMCIpfWA7DQogICAgICAgIHRpbWVSZW1haW5pbmcuc3R5bGUuY29sb3IgPSAidmFyKC0tcHJpbWFyeSkiOw0KICAgICAgfQ0KICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIGNvbnN0IHN0YXJ0VGltZSA9IGdldFN0b3JhZ2UoInVzYWdlX3N0YXJ0X3RpbWUiKTsNCiAgICBpZiAoIXN0YXJ0VGltZSkgcmV0dXJuOw0KDQogICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTsNCiAgICBjb25zdCBtaW51dGVzUGFzc2VkID0gKG5vdyAtIHBhcnNlSW50KHN0YXJ0VGltZSwgMTApKSAvICgxMDAwICogNjApOw0KICAgIGNvbnN0IG1pbnV0ZXNMZWZ0ID0gTWF0aC5tYXgoDQogICAgICAwLA0KICAgICAgTWF0aC5mbG9vcihUSU1FX0xJTUlUX01JTlVURVMgLSBtaW51dGVzUGFzc2VkKQ0KICAgICk7DQogICAgY29uc3Qgc2Vjb25kc0xlZnQgPSBNYXRoLm1heCgwLCBNYXRoLmZsb29yKDYwIC0gKG1pbnV0ZXNQYXNzZWQgJSAxKSAqIDYwKSk7DQoNCiAgICB0aW1lUmVtYWluaW5nLnRleHRDb250ZW50ID0gYCR7U3RyaW5nKG1pbnV0ZXNMZWZ0KS5wYWRTdGFydCgNCiAgICAgIDIsDQogICAgICAiMCINCiAgICApfToke1N0cmluZyhzZWNvbmRzTGVmdCkucGFkU3RhcnQoMiwgIjAiKX1gOw0KICAgIGlmIChtaW51dGVzTGVmdCA8IDEpIHRpbWVSZW1haW5pbmcuc3R5bGUuY29sb3IgPSAidmFyKC0tZXJyb3IpIjsNCiAgICBlbHNlIGlmIChtaW51dGVzTGVmdCA8IDUpIHRpbWVSZW1haW5pbmcuc3R5bGUuY29sb3IgPSAidmFyKC0td2FybmluZykiOw0KICAgIGVsc2UgdGltZVJlbWFpbmluZy5zdHlsZS5jb2xvciA9ICJ2YXIoLS1wcmltYXJ5KSI7DQogIH0NCg0KICBmdW5jdGlvbiBnZXRDbGlja3NMZWZ0KGtleSkgew0KICAgIGNvbnN0IHN0b3JlZCA9IGdldFN0b3JhZ2Uoa2V5KTsNCiAgICByZXR1cm4gc3RvcmVkID09PSBudWxsID8gTUFYX0NMSUNLUyA6IHBhcnNlSW50KHN0b3JlZCwgMTApOw0KICB9DQoNCiAgZnVuY3Rpb24gc2V0Q2xpY2tzTGVmdChrZXksIGNvdW50KSB7DQogICAgc2V0U3RvcmFnZShrZXksIFN0cmluZyhjb3VudCksIFRJTUVfTElNSVRfTUlOVVRFUyk7DQogICAgdXBkYXRlU3RhdHVzQmFyKCk7DQogIH0NCg0KICBmdW5jdGlvbiB1cGRhdGVCdXR0b25TdGF0ZShkZXZpY2UpIHsNCiAgICBjb25zdCBidG4gPSBxcyhkZXZpY2UuYnV0dG9uX2lkKTsNCiAgICBpZiAoIWJ0bikgcmV0dXJuOw0KICAgIGNvbnN0IGNsaWNrc0xlZnQgPSBnZXRDbGlja3NMZWZ0KGRldmljZS5zdG9yYWdlX2tleSk7DQogICAgYnRuLmRpc2FibGVkID0gY2xpY2tzTGVmdCA8PSAwIHx8ICFpc0NoZWNraW5UaW1lKCk7DQogICAgaWYgKGNsaWNrc0xlZnQgPD0gMCkgew0KICAgICAgYnRuLmNsYXNzTGlzdC5hZGQoImJ0bi1lcnJvciIpOw0KICAgICAgYnRuLmNsYXNzTGlzdC5yZW1vdmUoImJ0bi1zdWNjZXNzIik7DQogICAgfSBlbHNlIGlmICghaXNDaGVja2luVGltZSgpKSB7DQogICAgICBidG4uY2xhc3NMaXN0LnJlbW92ZSgiYnRuLWVycm9yIiwgImJ0bi1zdWNjZXNzIik7DQogICAgfSBlbHNlIHsNCiAgICAgIGJ0bi5jbGFzc0xpc3QuYWRkKCJidG4tc3VjY2VzcyIpOw0KICAgICAgYnRuLmNsYXNzTGlzdC5yZW1vdmUoImJ0bi1lcnJvciIpOw0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIHVwZGF0ZURvb3JWaXNpYmlsaXR5KCkgew0KICAgIERFVklDRVMuZm9yRWFjaCgoZGV2aWNlKSA9PiB7DQogICAgICBjb25zdCBjb250YWluZXIgPSBxcyhgJHtkZXZpY2UuYnV0dG9uX2lkfUNvbnRhaW5lcmApOw0KICAgICAgaWYgKGNvbnRhaW5lcikNCiAgICAgICAgY29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSBkZXZpY2UudmlzaWJsZSA/ICJibG9jayIgOiAibm9uZSI7DQogICAgfSk7DQogIH0NCg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgLy8gQ0FNQklBTUVOVE8gQ09ESUNFDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICBmdW5jdGlvbiBzZXR1cENvZGVDaGFuZ2VMaXN0ZW5lcigpIHsNCiAgICBpZiAoY29kZUNoZWNrSW50ZXJ2YWwpIGNsZWFySW50ZXJ2YWwoY29kZUNoZWNrSW50ZXJ2YWwpOw0KICAgIGlmIChMSU5LX0NIRUNLX0lOVEVSVkFMKSBjbGVhckludGVydmFsKExJTktfQ0hFQ0tfSU5URVJWQUwpOw0KDQogICAgY29kZUNoZWNrSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChjaGVja0NvZGVWZXJzaW9uLCAyMDAwKTsNCiAgICBMSU5LX0NIRUNLX0lOVEVSVkFMID0gc2V0SW50ZXJ2YWwoY2hlY2tTY2FkdXRhTGlua3MsIDYwMDAwKTsNCg0KICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJzdG9yYWdlIiwgKGUpID0+IHsNCiAgICAgIGlmIChlLmtleSA9PT0gImNvZGVfdmVyc2lvbiIgfHwgZS5rZXkgPT09ICJsYXN0X2NvZGVfdXBkYXRlIikgew0KICAgICAgICBjaGVja0NvZGVWZXJzaW9uKCk7DQogICAgICB9DQogICAgfSk7DQogIH0NCg0KICBmdW5jdGlvbiBjaGVja0NvZGVWZXJzaW9uKCkgew0KICAgIGRhdGFiYXNlDQogICAgICAucmVmKCJzZXR0aW5ncy9jb2RlX3ZlcnNpb24iKQ0KICAgICAgLm9uY2UoInZhbHVlIikNCiAgICAgIC50aGVuKChzbmFwKSA9PiB7DQogICAgICAgIGlmIChzbmFwLmV4aXN0cygpKSB7DQogICAgICAgICAgY29uc3QgZmlyZWJhc2VWZXJzaW9uID0gcGFyc2VJbnQoc25hcC52YWwoKSk7DQogICAgICAgICAgY29uc3QgbG9jYWxWZXJzaW9uID0NCiAgICAgICAgICAgIHBhcnNlSW50KGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJjb2RlX3ZlcnNpb24iKSkgfHwgMTsNCiAgICAgICAgICBjb25zdCBzYXZlZFZlcnNpb24gPSBNYXRoLm1heChmaXJlYmFzZVZlcnNpb24sIGxvY2FsVmVyc2lvbik7DQogICAgICAgICAgaWYgKHNhdmVkVmVyc2lvbiA+IGN1cnJlbnRDb2RlVmVyc2lvbikgaGFuZGxlQ29kZUNoYW5nZShzYXZlZFZlcnNpb24pOw0KICAgICAgICB9DQogICAgICB9KQ0KICAgICAgLmNhdGNoKCgpID0+IHsNCiAgICAgICAgY29uc3Qgc2F2ZWRWZXJzaW9uID0NCiAgICAgICAgICBwYXJzZUludChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiY29kZV92ZXJzaW9uIikpIHx8IDE7DQogICAgICAgIGlmIChzYXZlZFZlcnNpb24gPiBjdXJyZW50Q29kZVZlcnNpb24pIGhhbmRsZUNvZGVDaGFuZ2Uoc2F2ZWRWZXJzaW9uKTsNCiAgICAgIH0pOw0KICB9DQoNCiAgZnVuY3Rpb24gaGFuZGxlQ29kZUNoYW5nZShuZXdWZXJzaW9uKSB7DQogICAgY3VycmVudENvZGVWZXJzaW9uID0gbmV3VmVyc2lvbjsNCiAgICBkYXRhYmFzZQ0KICAgICAgLnJlZigic2V0dGluZ3Mvc2VjcmV0X2NvZGUiKQ0KICAgICAgLm9uY2UoInZhbHVlIikNCiAgICAgIC50aGVuKChjb2RlU25hcCkgPT4gew0KICAgICAgICBpZiAoY29kZVNuYXAuZXhpc3RzKCkpIHsNCiAgICAgICAgICBDT1JSRUNUX0NPREUgPSBjb2RlU25hcC52YWwoKTsNCiAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgic2VjcmV0X2NvZGUiLCBDT1JSRUNUX0NPREUpOw0KICAgICAgICAgIGlmIChoYXNUb2tlbkZvb3RwcmludCgpKSB7DQogICAgICAgICAgICBmb3JjZUxvZ291dEZyb21Ub2tlbigiQ29kaWNlIGFnZ2lvcm5hdG86IGlsIGxpbmsgbm9uIGUnIHBpdScgdmFsaWRvIik7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHVuYmxvY2tBY2Nlc3MoKTsNCiAgICAgICAgICAgIHFzKCJTY2FkdXRhT3ZlcmxheSIpPy5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsNCiAgICAgICAgICAgIHFzKCJzZXNzaW9uU2NhZHV0YSIpPy5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsNCiAgICAgICAgICAgIHFzKCJjb250cm9sUGFuZWwiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7DQogICAgICAgICAgICByZXNldFNlc3Npb25Gb3JOZXdDb2RlKCk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlc2V0U2Vzc2lvbkZvck5ld0NvZGUoKSB7DQogICAgY2xlYXJTdG9yYWdlKCJ1c2FnZV9zdGFydF90aW1lIik7DQogICAgY2xlYXJTdG9yYWdlKCJ1c2FnZV9oYXNoIik7DQogICAgREVWSUNFUy5mb3JFYWNoKChkKSA9PiBjbGVhclN0b3JhZ2UoZC5zdG9yYWdlX2tleSkpOw0KDQogICAgcXMoImNvbnRyb2xQYW5lbCIpICYmIChxcygiY29udHJvbFBhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJub25lIik7DQogICAgcXMoImF1dGhDb2RlIikgJiYgKHFzKCJhdXRoQ29kZSIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siKTsNCiAgICBxcygiYXV0aC1mb3JtIikgJiYgKHFzKCJhdXRoLWZvcm0iKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIik7DQogICAgcXMoImJ0bkNoZWNrQ29kZSIpICYmIChxcygiYnRuQ2hlY2tDb2RlIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayIpOw0KICAgIHFzKCJpbXBvcnRhbnQiKSAmJiAocXMoImltcG9ydGFudCIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siKTsNCg0KICAgIHNob3dOb3RpZmljYXRpb24oDQogICAgICAiSWwgY29kaWNlIGRpIGFjY2Vzc28gw4PCqCBzdGF0byBhZ2dpb3JuYXRvLiBJbnNlcmlzY2kgaWwgbnVvdm8gY29kaWNlLiINCiAgICApOw0KICB9DQoNCiAgZnVuY3Rpb24gY2hlY2tTY2FkdXRhTGlua3MoKSB7DQogICAgY29uc3Qgc2VjdXJlTGlua3MgPSBKU09OLnBhcnNlKA0KICAgICAgbG9jYWxTdG9yYWdlLmdldEl0ZW0oInNlY3VyZV9saW5rcyIpIHx8ICJ7fSINCiAgICApOw0KICAgIGxldCB1cGRhdGVkID0gZmFsc2U7DQogICAgT2JqZWN0LmtleXMoc2VjdXJlTGlua3MpLmZvckVhY2goKGxpbmtJZCkgPT4gew0KICAgICAgY29uc3QgbGluayA9IHNlY3VyZUxpbmtzW2xpbmtJZF07DQogICAgICBpZiAobGluay5leHBpcmF0aW9uIDwgRGF0ZS5ub3coKSAmJiBsaW5rLnN0YXR1cyA9PT0gImFjdGl2ZSIpIHsNCiAgICAgICAgc2VjdXJlTGlua3NbbGlua0lkXS5zdGF0dXMgPSAiU2NhZHV0YSI7DQogICAgICAgIHVwZGF0ZWQgPSB0cnVlOw0KICAgICAgfQ0KICAgIH0pOw0KICAgIGlmICh1cGRhdGVkKQ0KICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oInNlY3VyZV9saW5rcyIsIEpTT04uc3RyaW5naWZ5KHNlY3VyZUxpbmtzKSk7DQogIH0NCg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgLy8gUE9QVVANCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIGZ1bmN0aW9uIHNob3dDb25maXJtYXRpb25Qb3B1cChkZXZpY2UpIHsNCiAgICBpZiAoIWlzQ2hlY2tpblRpbWUoKSkgew0KICAgICAgc2hvd0Vhcmx5Q2hlY2tpblBvcHVwKCk7DQogICAgICByZXR1cm47DQogICAgfQ0KICAgIGN1cnJlbnREZXZpY2UgPSBkZXZpY2U7DQogICAgY29uc3QgZG9vck5hbWUgPSBkZXZpY2UuYnV0dG9uX2lkDQogICAgICAucmVwbGFjZSgvKFtBLVpdKS9nLCAiICQxIikNCiAgICAgIC5yZXBsYWNlKC9eLi8sIChzKSA9PiBzLnRvVXBwZXJDYXNlKCkpOw0KICAgIGNvbnN0IG1zZyA9IHFzKCJjb25maXJtYXRpb25NZXNzYWdlIik7DQogICAgaWYgKG1zZykNCiAgICAgIG1zZy50ZXh0Q29udGVudCA9IGBBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gdW5sb2NrIHRoZSAke2Rvb3JOYW1lfT9gOw0KICAgIGNvbnN0IHBvcCA9IHFzKCJjb25maXJtYXRpb25Qb3B1cCIpOw0KICAgIGlmIChwb3ApIHBvcC5zdHlsZS5kaXNwbGF5ID0gImZsZXgiOw0KICB9DQogIGZ1bmN0aW9uIGNsb3NlQ29uZmlybWF0aW9uUG9wdXAoKSB7DQogICAgY29uc3QgcG9wID0gcXMoImNvbmZpcm1hdGlvblBvcHVwIik7DQogICAgaWYgKHBvcCkgcG9wLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogICAgY3VycmVudERldmljZSA9IG51bGw7DQogIH0NCg0KICBmdW5jdGlvbiBzaG93RGV2aWNlUG9wdXAoZGV2aWNlLCBjbGlja3NMZWZ0KSB7DQogICAgY29uc3QgcG9wdXAgPSBxcyhgcG9wdXAtJHtkZXZpY2UuYnV0dG9uX2lkfWApOw0KICAgIGlmICghcG9wdXApIHJldHVybjsNCiAgICBjb25zdCB0ZXh0ID0gcXMoYHBvcHVwLXRleHQtJHtkZXZpY2UuYnV0dG9uX2lkfWApOw0KICAgIGlmICh0ZXh0KSB7DQogICAgICBpZiAoY2xpY2tzTGVmdCA+IDApIHsNCiAgICAgICAgdGV4dC5pbm5lckhUTUwgPSBgDQogICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1jaGVjay1jaXJjbGUiIHN0eWxlPSJjb2xvcjojNENBRjUwO2ZvbnQtc2l6ZToyLjVyZW07bWFyZ2luLWJvdHRvbToxNXB4OyI+PC9pPg0KICAgICAgICAgIDxkaXY+PHN0cm9uZz4ke2NsaWNrc0xlZnR9PC9zdHJvbmc+IENsaWNrIExlZnQ8L2Rpdj4NCiAgICAgICAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOjEwcHg7Zm9udC1zaXplOjFyZW07Ij5Eb29yIFVubG9ja2VkITwvZGl2PmA7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0ZXh0LmlubmVySFRNTCA9IGANCiAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWV4Y2xhbWF0aW9uLXRyaWFuZ2xlIiBzdHlsZT0iY29sb3I6I0ZGQzEwNztmb250LXNpemU6Mi41cmVtO21hcmdpbi1ib3R0b206MTVweDsiPjwvaT4NCiAgICAgICAgICA8ZGl2PjxzdHJvbmc+Tm8gbW9yZSBjbGlja3MgbGVmdCE8L3N0cm9uZz48L2Rpdj4NCiAgICAgICAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOjEwcHg7Zm9udC1zaXplOjFyZW07Ij5Db250YWN0IGZvciBBc3Npc3RhbmNlLjwvZGl2PmA7DQogICAgICB9DQogICAgfQ0KICAgIHBvcHVwLnN0eWxlLmRpc3BsYXkgPSAiZmxleCI7DQogICAgaWYgKGNsaWNrc0xlZnQgPiAwKSBzZXRUaW1lb3V0KCgpID0+IGNsb3NlUG9wdXAoZGV2aWNlLmJ1dHRvbl9pZCksIDMwMDApOw0KICB9DQoNCiAgZnVuY3Rpb24gY2xvc2VQb3B1cChidXR0b25JZCkgew0KICAgIGNvbnN0IHBvcHVwID0gcXMoYHBvcHVwLSR7YnV0dG9uSWR9YCk7DQogICAgaWYgKHBvcHVwKSBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICB9DQoNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIC8vIFNIRUxMWQ0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgYXN5bmMgZnVuY3Rpb24gYWN0aXZhdGVEZXZpY2UoZGV2aWNlKSB7DQogICAgaWYgKCFzZXNzaW9uU3RhcnRUaW1lKSB7DQogICAgICAvLyBMJ3V0ZW50ZSBoYSBjbGljY2F0byBzZW56YSBsb2dpbjsgaW5pemlhbGl6emEgdW5hIHNlc3Npb25lIG1hbnVhbGUNCiAgICAgIHNlc3Npb25TdGFydFRpbWUgPSBEYXRlLm5vdygpOw0KICAgICAgYXdhaXQgc2V0VXNhZ2VTdGFydFRpbWUoKTsNCiAgICB9DQoNCiAgICBpZiAoYXdhaXQgY2hlY2tUaW1lTGltaXQoKSkgcmV0dXJuOw0KICAgIGlmICghaXNDaGVja2luVGltZSgpKSB7DQogICAgICBzaG93RWFybHlDaGVja2luUG9wdXAoKTsNCiAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICBsZXQgY2xpY2tzTGVmdCA9IGdldENsaWNrc0xlZnQoZGV2aWNlLnN0b3JhZ2Vfa2V5KTsNCiAgICBpZiAoY2xpY2tzTGVmdCA8PSAwKSB7DQogICAgICBzaG93RGV2aWNlUG9wdXAoZGV2aWNlLCBjbGlja3NMZWZ0KTsNCiAgICAgIHVwZGF0ZUJ1dHRvblN0YXRlKGRldmljZSk7DQogICAgICByZXR1cm47DQogICAgfQ0KDQogICAgc2V0Q2xpY2tzTGVmdChkZXZpY2Uuc3RvcmFnZV9rZXksIC0tY2xpY2tzTGVmdCk7DQogICAgdXBkYXRlQnV0dG9uU3RhdGUoZGV2aWNlKTsNCg0KICAgIHRyeSB7DQogICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoV2l0aFRpbWVvdXQoDQogICAgICAgIEJBU0VfVVJMX1NFVCwNCiAgICAgICAgew0KICAgICAgICAgIG1ldGhvZDogIlBPU1QiLA0KICAgICAgICAgIGhlYWRlcnM6IHsgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiB9LA0KICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsNCiAgICAgICAgICAgIGlkOiBkZXZpY2UuaWQsDQogICAgICAgICAgICBhdXRoX2tleTogZGV2aWNlLmF1dGhfa2V5LA0KICAgICAgICAgICAgY2hhbm5lbDogMCwNCiAgICAgICAgICAgIG9uOiB0cnVlLA0KICAgICAgICAgICAgdHVybjogIm9uIiwNCiAgICAgICAgICB9KSwNCiAgICAgICAgfSwNCiAgICAgICAgMTIwMDANCiAgICAgICk7DQoNCiAgICAgIGlmIChyZXNwb25zZS5vaykgew0KICAgICAgICBzaG93RGV2aWNlUG9wdXAoZGV2aWNlLCBjbGlja3NMZWZ0KTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHNldENsaWNrc0xlZnQoZGV2aWNlLnN0b3JhZ2Vfa2V5LCBjbGlja3NMZWZ0ICsgMSk7DQogICAgICAgIHVwZGF0ZUJ1dHRvblN0YXRlKGRldmljZSk7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoDQogICAgICAgICAgIkVycm9yZSBuZWxsJ2F0dGl2YXppb25lIGRlbCBkaXNwb3NpdGl2bzoiLA0KICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cywNCiAgICAgICAgICByZXNwb25zZS5zdGF0dXNUZXh0DQogICAgICAgICk7DQogICAgICB9DQogICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgIGNvbnNvbGUuZXJyb3IoIkF0dGl2YXppb25lIGRpc3Bvc2l0aXZvIGZhbGxpdGE6IiwgZXJyb3IpOw0KICAgICAgc2V0Q2xpY2tzTGVmdChkZXZpY2Uuc3RvcmFnZV9rZXksIGNsaWNrc0xlZnQgKyAxKTsNCiAgICAgIHVwZGF0ZUJ1dHRvblN0YXRlKGRldmljZSk7DQogICAgfQ0KICB9DQoNCiAgYXN5bmMgZnVuY3Rpb24gdXBkYXRlR2xvYmFsQ29kZVZlcnNpb24oKSB7DQogICAgY29uc3Qgc2F2ZWRWZXJzaW9uID0gcGFyc2VJbnQobG9jYWxTdG9yYWdlLmdldEl0ZW0oQ09ERV9WRVJTSU9OX0tFWSkpIHx8IDE7DQogICAgaWYgKHNhdmVkVmVyc2lvbiA8IGN1cnJlbnRDb2RlVmVyc2lvbikgew0KICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oQ09ERV9WRVJTSU9OX0tFWSwgU3RyaW5nKGN1cnJlbnRDb2RlVmVyc2lvbikpOw0KICAgICAgcmVzZXRTZXNzaW9uRm9yTmV3Q29kZSgpOw0KICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIHJldHVybiBmYWxzZTsNCiAgfQ0KDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICAvLyBUT0tFTiBTSUNVUkkgKEZpcmViYXNlIHNlY3VyZV9saW5rcy8qKQ0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgZnVuY3Rpb24gbWF5YmVDbGVhblVybCgpIHsNCiAgICBpZiAoIUtFRVBfVE9LRU5fSU5fVVJMKSBjbGVhblVybCgpOw0KICB9DQoNCiAgYXN5bmMgZnVuY3Rpb24gaGFuZGxlU2VjdXJlVG9rZW4oKSB7DQogICAgY29uc3QgdXJsUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh3aW5kb3cubG9jYXRpb24uc2VhcmNoKTsNCiAgICBjb25zdCB0b2tlbiA9IHVybFBhcmFtcy5nZXQoInRva2VuIik7DQogICAgaWYgKCF0b2tlbikgew0KICAgICAgaXNUb2tlblNlc3Npb24gPSBmYWxzZTsNCiAgICAgIHdpbmRvdy5pc1Rva2VuU2Vzc2lvbiA9IGZhbHNlOw0KICAgICAgY3VycmVudFRva2VuQ3VzdG9tQ29kZSA9IG51bGw7DQogICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KDQogICAgdHJ5IHsNCiAgICAgIGNvbnN0IHNuYXBzaG90ID0gYXdhaXQgZGF0YWJhc2UNCiAgICAgICAgLnJlZigic2VjdXJlX2xpbmtzLyIgKyB0b2tlbikNCiAgICAgICAgLm9uY2UoInZhbHVlIik7DQogICAgICBpZiAoIXNuYXBzaG90LmV4aXN0cygpKSB7DQogICAgICAgIHNob3dUb2tlbkVycm9yKCJUb2tlbiBub24gdmFsaWRvIik7DQogICAgICAgIHRyeSB7CiAgICAgICAgICBibG9ja1Rva2VuT25seSgiVG9rZW4gbm9uIHZhbGlkbyIsIHRva2VuKTsKICAgICAgICB9IGNhdGNoIHt9CiAgICAgICAgc2hvd1Nlc3Npb25TY2FkdXRhKCk7DQogICAgICAgIG1heWJlQ2xlYW5VcmwoKTsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgfQ0KDQogICAgICBjb25zdCBsaW5rRGF0YSA9IHNuYXBzaG90LnZhbCgpOw0KICAgICAgLy8gSWYgdGhpcyB0b2tlbiB3YXMgZGV2aWNlLWJsb2NrZWQsIGRvIG5vdCByZS1hY3RpdmF0ZSBvbiByZWZyZXNoCiAgICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbShgdG9rZW5fZGV2aWNlX2Jsb2NrXyR7dG9rZW59YCkgPT09ICIxIikgewogICAgICAgIGNvbnN0IHIgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShgdG9rZW5fZGV2aWNlX01vdGl2b18ke3Rva2VufWApIHx8ICJTZXNzaW9uZSB0b2tlbiBzY2FkdXRhIHN1IHF1ZXN0byBkaXNwb3NpdGl2byI7CiAgICAgICAgc2hvd1Rva2VuRXJyb3Iocik7CiAgICAgICAgdHJ5IHsgYmxvY2tUb2tlbk9ubHkociwgdG9rZW4pOyB9IGNhdGNoIHt9CiAgICAgICAgc2hvd1Nlc3Npb25TY2FkdXRhKCk7CiAgICAgICAgbWF5YmVDbGVhblVybCgpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQ0KICAgICAgXG4gICAgICAvLyBTZSBxdWVzdG8gdG9rZW4gw6ggc3RhdG8gYmxvY2NhdG8gc3UgcXVlc3RvIGRpc3Bvc2l0aXZvIChlcy4gdGVtcG8gc2Vzc2lvbmUgc2NhZHV0byksIG5vbiByaWF0dGl2YXJsbyBzdSByZWZyZXNoXG4gICAgICBpZiAoaXNUb2tlbkRldmljZUJsb2NrZWQodG9rZW4pKSB7XG4gICAgICAgIGNvbnN0IHIgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShgdG9rZW5fZGV2aWNlX01vdGl2b18ke3Rva2VufWApIHx8ICJTZXNzaW9uZSB0b2tlbiBzY2FkdXRhIHN1IHF1ZXN0byBkaXNwb3NpdGl2byI7XG4gICAgICAgIHNob3dUb2tlbkVycm9yKHIpO1xuICAgICAgICB0cnkgeyBibG9ja1Rva2VuT25seShyLCB0b2tlbik7IH0gY2F0Y2gge31cbiAgICAgICAgc2hvd1Nlc3Npb25TY2FkdXRhKCk7XG4gICAgICAgIG1heWJlQ2xlYW5VcmwoKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuY29uc3QgaXNWYWxpZCA9IHZhbGlkYXRlU2VjdXJlVG9rZW4obGlua0RhdGEpOw0KICAgICAgaWYgKCFpc1ZhbGlkLnZhbGlkKSB7DQogICAgICAgIHNob3dUb2tlbkVycm9yKGlzVmFsaWQuTW90aXZvKTsNCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGJsb2NrVG9rZW5Pbmx5KGlzVmFsaWQuTW90aXZvIHx8ICJBY2Nlc3NvIGJsb2NjYXRvIiwgdG9rZW4pOwogICAgICAgIH0gY2F0Y2gge30KICAgICAgICBzaG93U2Vzc2lvblNjYWR1dGEoKTsNCiAgICAgICAgbWF5YmVDbGVhblVybCgpOw0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICB9DQoNCiAgICAgIGlzVG9rZW5TZXNzaW9uID0gdHJ1ZTsNCiAgICAgIHdpbmRvdy5pc1Rva2VuU2Vzc2lvbiA9IHRydWU7IC8vIGNvbXBhdCBsZWdhY3kNCiAgICAgIGN1cnJlbnRUb2tlbklkID0gdG9rZW47DQogICAgICBjdXJyZW50VG9rZW5DdXN0b21Db2RlID0gbGlua0RhdGEuY3VzdG9tQ29kZSB8fCBudWxsOw0KDQogICAgICAvLyBzYmxvY2NhIGJsb2NjaGkgcHJlY2VkZW50aQogICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgiYmxvY2tfbWFudWFsX2xvZ2luIik7CiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJibG9ja2VkX3Rva2VuIik7CiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJibG9ja2VkX01vdGl2byIpOwogICAgICAvLyBBc3NpY3VyYXRpIGNoZSBldmVudHVhbGkgb3ZlcmxheSBkaSBzY2FkZW56YSBub24gcmVzdGlubyB2aXNpYmlsaQogICAgICB0cnkgewogICAgICAgIHVuYmxvY2tBY2Nlc3MoKTsKICAgICAgICBxcygiU2NhZHV0YU92ZXJsYXkiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7CiAgICAgICAgcXMoInNlc3Npb25TY2FkdXRhIik/LmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOwogICAgICB9IGNhdGNoIHt9Cg0KICAgICAgc2hvd1Rva2VuTm90aWZpY2F0aW9uKGlzVmFsaWQucmVtYWluaW5nVXNlcywgISFjdXJyZW50VG9rZW5DdXN0b21Db2RlKTsNCiAgICAgIGF3YWl0IGluY3JlbWVudFRva2VuVXNhZ2UodG9rZW4sIGxpbmtEYXRhKTsNCiAgICAgIG1heWJlQ2xlYW5VcmwoKTsNCiAgICAgIHN0YXJ0VG9rZW5FeHBpcmF0aW9uQ2hlY2sobGlua0RhdGEuZXhwaXJhdGlvbik7DQogICAgICBzdGFydFRva2VuUmVhbHRpbWVMaXN0ZW5lcih0b2tlbik7DQogICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgY29uc29sZS5lcnJvcigiRXJyb3JlIG5lbGxhIHZlcmlmaWNhIGRlbCB0b2tlbjoiLCBlcnJvcik7DQogICAgICBzaG93VG9rZW5FcnJvcigiRXJyb3JlIGRpIHZlcmlmaWNhIik7DQogICAgICB0cnkgewogICAgICAgIGJsb2NrVG9rZW5Pbmx5KCJFcnJvcmUgZGkgdmVyaWZpY2EiLCB0b2tlbik7CiAgICAgIH0gY2F0Y2gge30KICAgICAgc2hvd1Nlc3Npb25TY2FkdXRhKCk7DQogICAgICBtYXliZUNsZWFuVXJsKCk7DQogICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gc3RvcFRva2VuUmVhbHRpbWVMaXN0ZW5lcigpIHsNCiAgICBpZiAodG9rZW5SZWYpIHsNCiAgICAgIHRva2VuUmVmLm9mZigpOw0KICAgICAgdG9rZW5SZWYgPSBudWxsOw0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIGNsZWFyTWFudWFsU2Vzc2lvbigpIHsNCiAgICB0cnkgew0KICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oInVzYWdlX3N0YXJ0X3RpbWUiKTsNCiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJ1c2FnZV9oYXNoIik7DQogICAgICBzZXNzaW9uU3RhcnRUaW1lID0gbnVsbDsNCiAgICB9IGNhdGNoIHt9DQogIH0NCg0KICBmdW5jdGlvbiBibG9ja0FjY2VzcyhNb3Rpdm8gPSAiQWNjZXNzbyBibG9jY2F0byIsIHRva2VuID0gbnVsbCkgewogICAgdHJ5IHsKICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oImJsb2NrX21hbnVhbF9sb2dpbiIsICIxIik7CiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJibG9ja2VkX01vdGl2byIsIE1vdGl2byk7CiAgICAgIGlmICh0b2tlbikgbG9jYWxTdG9yYWdlLnNldEl0ZW0oImJsb2NrZWRfdG9rZW4iLCB0b2tlbik7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yZSBibG9ja0FjY2VzczoiLCBlKTsKICAgIH0KICB9CgogIC8vIEJsb2NjYSBzb2xvIGlsIHRva2VuIGNvcnJlbnRlIHNlbnphIGFwcGxpY2FyZSBpbCBibG9jY28gZ2xvYmFsZSBkZWwgZGlzcG9zaXRpdm8KICBmdW5jdGlvbiBibG9ja1Rva2VuT25seShNb3Rpdm8gPSAiQWNjZXNzbyBibG9jY2F0byIsIHRva2VuID0gbnVsbCkgewogICAgdHJ5IHsKICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oImJsb2NrZWRfTW90aXZvIiwgTW90aXZvKTsKICAgICAgaWYgKHRva2VuKSBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgiYmxvY2tlZF90b2tlbiIsIHRva2VuKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgY29uc29sZS5lcnJvcigiRXJyb3JlIGJsb2NrVG9rZW5Pbmx5OiIsIGUpOwogICAgfQogIH0KDQogIGZ1bmN0aW9uIHVuYmxvY2tBY2Nlc3MoKSB7CiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgiYmxvY2tfbWFudWFsX2xvZ2luIik7CiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgiYmxvY2tlZF9Nb3Rpdm8iKTsKICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJibG9ja2VkX3Rva2VuIik7CiAgfQoKICAvLyBGbGFnIGRpIGJsb2NjbyBwZXIgcXVlc3RvIHRva2VuIHN1IHF1ZXN0byBkaXNwb3NpdGl2bwogIGZ1bmN0aW9uIG1hcmtUb2tlbkRldmljZUJsb2NrZWQodG9rZW4sIE1vdGl2byA9ICIiKSB7CiAgICB0cnkgewogICAgICBpZiAoIXRva2VuKSByZXR1cm47CiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGB0b2tlbl9kZXZpY2VfYmxvY2tfJHt0b2tlbn1gLCAiMSIpOwogICAgICBpZiAoTW90aXZvKSBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShgdG9rZW5fZGV2aWNlX01vdGl2b18ke3Rva2VufWAsIE1vdGl2byk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yZSBtYXJrVG9rZW5EZXZpY2VCbG9ja2VkOiIsIGUpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gaXNUb2tlbkRldmljZUJsb2NrZWQodG9rZW4pIHsKICAgIHRyeSB7CiAgICAgIGlmICghdG9rZW4pIHJldHVybiBmYWxzZTsKICAgICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5nZXRJdGVtKGB0b2tlbl9kZXZpY2VfYmxvY2tfJHt0b2tlbn1gKSA9PT0gIjEiOwogICAgfSBjYXRjaCB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGNsZWFyVG9rZW5EZXZpY2VCbG9jayh0b2tlbikgewogICAgdHJ5IHsKICAgICAgaWYgKCF0b2tlbikgcmV0dXJuOwogICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShgdG9rZW5fZGV2aWNlX2Jsb2NrXyR7dG9rZW59YCk7CiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGB0b2tlbl9kZXZpY2VfTW90aXZvXyR7dG9rZW59YCk7CiAgICB9IGNhdGNoIHt9CiAgfQoKICBmdW5jdGlvbiBoYXNUb2tlbkZvb3RwcmludCgpIHsNCiAgICB0cnkgew0KICAgICAgaWYgKGlzVG9rZW5TZXNzaW9uKSByZXR1cm4gdHJ1ZTsNCiAgICAgIGNvbnN0IHVybFRvayA9IG5ldyBVUkxTZWFyY2hQYXJhbXMod2luZG93LmxvY2F0aW9uLnNlYXJjaCkuZ2V0KCJ0b2tlbiIpOw0KICAgICAgaWYgKHVybFRvaykgcmV0dXJuIHRydWU7DQogICAgICBpZiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oImJsb2NrZWRfdG9rZW4iKSkgcmV0dXJuIHRydWU7DQogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxvY2FsU3RvcmFnZS5sZW5ndGg7IGkrKykgew0KICAgICAgICBjb25zdCBrID0gbG9jYWxTdG9yYWdlLmtleShpKTsNCiAgICAgICAgaWYgKGsgJiYgay5pbmRleE9mKCJ0b2tlbl9va18iKSA9PT0gMCkgcmV0dXJuIHRydWU7DQogICAgICB9DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgY29uc29sZS53YXJuKCJoYXNUb2tlbkZvb3RwcmludCBjaGVjayBmYWlsZWQ6IiwgZSk7DQogICAgfQ0KICAgIHJldHVybiBmYWxzZTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGZvcmNlR2xvYmFsTG9nb3V0KE1vdGl2byA9ICJDb2RpY2UgYWdnaW9ybmF0bzogYWNjZWRpIGRpIG51b3ZvIikgew0KICAgIGlzVG9rZW5TZXNzaW9uID0gZmFsc2U7DQogICAgd2luZG93LmlzVG9rZW5TZXNzaW9uID0gZmFsc2U7DQogICAgY2xlYXJNYW51YWxTZXNzaW9uKCk7DQogICAgY29uc3QgdCA9DQogICAgICBjdXJyZW50VG9rZW5JZCB8fA0KICAgICAgbmV3IFVSTFNlYXJjaFBhcmFtcyhsb2NhdGlvbi5zZWFyY2gpLmdldCgidG9rZW4iKSB8fA0KICAgICAgbnVsbDsNCiAgICBibG9ja1Rva2VuT25seShNb3Rpdm8sIHQpOwogICAgdHJ5IHsNCiAgICAgIGlmICh0KSBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShgdG9rZW5fb2tfJHt0fWApOw0KICAgIH0gY2F0Y2gge30NCiAgICB0cnkgew0KICAgICAgc2hvd1Rva2VuRXJyb3IoTW90aXZvKTsNCiAgICB9IGNhdGNoIHt9DQogICAgc2hvd1Nlc3Npb25TY2FkdXRhKCk7DQogICAgc3RvcFRva2VuUmVhbHRpbWVMaXN0ZW5lcigpOw0KICB9DQoNCiAgZnVuY3Rpb24gZm9yY2VMb2dvdXRGcm9tVG9rZW4oTW90aXZvID0gIkxpbmsgbm9uIHBpw4PCuSB2YWxpZG8iKSB7DQogICAgaXNUb2tlblNlc3Npb24gPSBmYWxzZTsNCiAgICB3aW5kb3cuaXNUb2tlblNlc3Npb24gPSBmYWxzZTsNCiAgICBjbGVhck1hbnVhbFNlc3Npb24oKTsNCiAgICBjb25zdCB0ID0NCiAgICAgIGN1cnJlbnRUb2tlbklkIHx8DQogICAgICBuZXcgVVJMU2VhcmNoUGFyYW1zKGxvY2F0aW9uLnNlYXJjaCkuZ2V0KCJ0b2tlbiIpIHx8DQogICAgICBudWxsOw0KICAgIGJsb2NrVG9rZW5Pbmx5KE1vdGl2bywgdCk7IGlmICh0KSB7IGxvY2FsU3RvcmFnZS5zZXRJdGVtKGB0b2tlbl9kZXZpY2VfYmxvY2tfJHt0fWAsICIxIik7IGxvY2FsU3RvcmFnZS5zZXRJdGVtKGB0b2tlbl9kZXZpY2VfTW90aXZvXyR7dH1gLCBNb3Rpdm8gfHwgIlNlc3Npb25lIHRva2VuIHNjYWR1dGEiKTsgfQ0KICAgIHRyeSB7DQogICAgICBpZiAodCkgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oYHRva2VuX29rXyR7dH1gKTsNCiAgICB9IGNhdGNoIHt9DQogICAgdHJ5IHsNCiAgICAgIHNob3dUb2tlbkVycm9yKE1vdGl2byk7DQogICAgfSBjYXRjaCB7fQ0KICAgIHNob3dTZXNzaW9uU2NhZHV0YSgpOw0KICAgIHN0b3BUb2tlblJlYWx0aW1lTGlzdGVuZXIoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHN0YXJ0VG9rZW5SZWFsdGltZUxpc3RlbmVyKHRva2VuKSB7DQogICAgc3RvcFRva2VuUmVhbHRpbWVMaXN0ZW5lcigpOw0KICAgIHRva2VuUmVmID0gZGF0YWJhc2UucmVmKCJzZWN1cmVfbGlua3MvIiArIHRva2VuKTsNCiAgICB0b2tlblJlZi5vbigidmFsdWUiLCAoc25hcCkgPT4gew0KICAgICAgaWYgKCFzbmFwLmV4aXN0cygpKSB7DQogICAgICAgIGZvcmNlTG9nb3V0RnJvbVRva2VuKCJMaW5rIHJpbW9zc28iKTsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KICAgICAgY29uc3QgZCA9IHNuYXAudmFsKCk7DQogICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpOw0KICAgICAgY29uc3QgZXhoYXVzdGVkID0gKGQudXNlZENvdW50IHx8IDApID49IChkLm1heFVzYWdlIHx8IDApOw0KICAgICAgY29uc3QgU2NhZHV0YSA9IChkLmV4cGlyYXRpb24gfHwgMCkgPD0gbm93Ow0KICAgICAgY29uc3QgcmV2b2tlZCA9IGQuc3RhdHVzICE9PSAiYWN0aXZlIjsNCiAgICAgIGlmIChyZXZva2VkIHx8IFNjYWR1dGEgfHwgZXhoYXVzdGVkKSB7DQogICAgICAgIGNvbnN0IHdoeSA9IHJldm9rZWQNCiAgICAgICAgICA/ICJMaW5rIHJldm9jYXRvIg0KICAgICAgICAgIDogU2NhZHV0YQ0KICAgICAgICAgID8gIkxpbmsgc2NhZHV0byINCiAgICAgICAgICA6ICJVdGlsaXp6aSBlc2F1cml0aSI7DQogICAgICAgIGZvcmNlTG9nb3V0RnJvbVRva2VuKHdoeSk7DQogICAgICB9DQogICAgfSk7DQogIH0NCg0KICBmdW5jdGlvbiB2YWxpZGF0ZVNlY3VyZVRva2VuKGxpbmtEYXRhKSB7DQogICAgdHJ5IHsNCiAgICAgIGlmICghbGlua0RhdGEpIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgTW90aXZvOiAiVG9rZW4gbm9uIHZhbGlkbyIgfTsNCiAgICAgIGlmIChsaW5rRGF0YS5zdGF0dXMgIT09ICJhY3RpdmUiKQ0KICAgICAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIE1vdGl2bzogIkxpbmsgcmV2b2NhdG8iIH07DQogICAgICBpZiAobGlua0RhdGEuZXhwaXJhdGlvbiA8IERhdGUubm93KCkpDQogICAgICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgTW90aXZvOiAiVG9rZW4gc2NhZHV0byIgfTsNCiAgICAgIGlmICgobGlua0RhdGEudXNlZENvdW50IHx8IDApID49IChsaW5rRGF0YS5tYXhVc2FnZSB8fCAwKSkNCiAgICAgICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCBNb3Rpdm86ICJVdGlsaXp6aSBlc2F1cml0aSIgfTsNCiAgICAgIGNvbnN0IHJlbWFpbmluZ1VzZXMgPQ0KICAgICAgICAobGlua0RhdGEubWF4VXNhZ2UgfHwgMCkgLSAobGlua0RhdGEudXNlZENvdW50IHx8IDApOw0KICAgICAgcmV0dXJuIHsgdmFsaWQ6IHRydWUsIHJlbWFpbmluZ1VzZXMgfTsNCiAgICB9IGNhdGNoIHsNCiAgICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgTW90aXZvOiAiRXJyb3JlIGRpIHZlcmlmaWNhIiB9Ow0KICAgIH0NCiAgfQ0KDQogIGFzeW5jIGZ1bmN0aW9uIGluY3JlbWVudFRva2VuVXNhZ2UodG9rZW4sIGxpbmtEYXRhKSB7DQogICAgY29uc3QgbmV3VXNlZENvdW50ID0gKGxpbmtEYXRhLnVzZWRDb3VudCB8fCAwKSArIDE7DQogICAgY29uc3QgbmV3U3RhdHVzID0NCiAgICAgIG5ld1VzZWRDb3VudCA+PSAobGlua0RhdGEubWF4VXNhZ2UgfHwgMCkgPyAidXNlZCIgOiAiYWN0aXZlIjsNCiAgICB0cnkgew0KICAgICAgYXdhaXQgZGF0YWJhc2UNCiAgICAgICAgLnJlZigic2VjdXJlX2xpbmtzLyIgKyB0b2tlbikNCiAgICAgICAgLnVwZGF0ZSh7IHVzZWRDb3VudDogbmV3VXNlZENvdW50LCBzdGF0dXM6IG5ld1N0YXR1cyB9KTsNCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgY29uc29sZS5lcnJvcigiRXJyb3JlIG5lbGwnYWdnaW9ybmFtZW50byBkZWwgdG9rZW46IiwgZXJyb3IpOw0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIHNob3dUb2tlbk5vdGlmaWNhdGlvbihyZW1haW5pbmdVc2VzLCBoYXNDdXN0b21Db2RlKSB7DQogICAgY29uc3QgbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICAgIG4uc3R5bGUuY3NzVGV4dCA9IGANCiAgICAgIHBvc2l0aW9uOmZpeGVkOyB0b3A6MjBweDsgcmlnaHQ6MjBweDsgYmFja2dyb3VuZDp2YXIoLS1zdWNjZXNzKTsgY29sb3I6I2ZmZjsNCiAgICAgIHBhZGRpbmc6MTVweCAyMHB4OyBib3JkZXItcmFkaXVzOjhweDsgYm94LXNoYWRvdzowIDRweCAxMnB4IHJnYmEoMCwwLDAsLjEpOw0KICAgICAgei1pbmRleDoxMDAwMDsgZGlzcGxheTpmbGV4OyBnYXA6MTBweDsgYWxpZ24taXRlbXM6Y2VudGVyOyBtYXgtd2lkdGg6MzUwcHg7YDsNCiAgICBjb25zdCBjdXN0b20gPSBoYXNDdXN0b21Db2RlDQogICAgICA/ICc8ZGl2IHN0eWxlPSJmb250LXNpemU6MTJweDtvcGFjaXR5Oi45OyI+UXVlc3RvIGxpbmsgdXNhIHVuIGNvZGljZSBkZWRpY2F0bzwvZGl2PicNCiAgICAgIDogJzxkaXYgc3R5bGU9ImZvbnQtc2l6ZToxMnB4O29wYWNpdHk6Ljk7Ij5RdWVzdG8gbGluayB1c2EgaWwgY29kaWNlIHByaW5jaXBhbGU8L2Rpdj4nOw0KICAgIG4uaW5uZXJIVE1MID0gYA0KICAgICAgPGkgY2xhc3M9ImZhcyBmYS1jaGVjay1jaXJjbGUiPjwvaT4NCiAgICAgIDxkaXY+DQogICAgICAgIDxkaXY+TGluayBzaWN1cm8gcmljb25vc2NpdXRvPC9kaXY+DQogICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZToxMnB4O29wYWNpdHk6Ljk7Ij5VdGlsaXp6aSByaW1hbmVudGk6ICR7cmVtYWluaW5nVXNlc308L2Rpdj4NCiAgICAgICAgJHtjdXN0b219DQogICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZToxMnB4O29wYWNpdHk6Ljk7bWFyZ2luLXRvcDo1cHg7Ij48aSBjbGFzcz0iZmFzIGZhLWluZm8tY2lyY2xlIj48L2k+IEluc2VyaXNjaSBpbCBjb2RpY2UgcXVpIHNvdHRvPC9kaXY+DQogICAgICA8L2Rpdj4NCiAgICAgIDxidXR0b24gb25jbGljaz0idGhpcy5wYXJlbnRFbGVtZW50LnJlbW92ZSgpIiBzdHlsZT0iYmFja2dyb3VuZDpub25lO2JvcmRlcjpub25lO2NvbG9yOiNmZmY7bWFyZ2luLWxlZnQ6MTBweDtjdXJzb3I6cG9pbnRlciI+DQogICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdGltZXMiPjwvaT4NCiAgICAgIDwvYnV0dG9uPmA7DQogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChuKTsNCiAgICBzZXRUaW1lb3V0KCgpID0+IG4ucGFyZW50RWxlbWVudCAmJiBuLnJlbW92ZSgpLCA1MDAwKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNob3dUb2tlbkVycm9yKE1vdGl2bykgew0KICAgIGNvbnN0IG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICBuLnN0eWxlLmNzc1RleHQgPSBgDQogICAgICBwb3NpdGlvbjpmaXhlZDsgdG9wOjIwcHg7IHJpZ2h0OjIwcHg7IGJhY2tncm91bmQ6dmFyKC0tZXJyb3IpOyBjb2xvcjojZmZmOw0KICAgICAgcGFkZGluZzoxNXB4IDIwcHg7IGJvcmRlci1yYWRpdXM6OHB4OyBib3gtc2hhZG93OjAgNHB4IDEycHggcmdiYSgwLDAsMCwuMSk7DQogICAgICB6LWluZGV4OjEwMDAwOyBkaXNwbGF5OmZsZXg7IGdhcDoxMHB4OyBhbGlnbi1pdGVtczpjZW50ZXI7IG1heC13aWR0aDozMjBweDtgOw0KICAgIG4uaW5uZXJIVE1MID0gYA0KICAgICAgPGkgY2xhc3M9ImZhcyBmYS1leGNsYW1hdGlvbi10cmlhbmdsZSI+PC9pPg0KICAgICAgPGRpdj4NCiAgICAgICAgPGRpdj5MaW5rIG5vbiB2YWxpZG88L2Rpdj4NCiAgICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOjEycHg7b3BhY2l0eTouOTsiPk1vdGl2bzogJHtNb3Rpdm99PC9kaXY+DQogICAgICA8L2Rpdj4NCiAgICAgIDxidXR0b24gb25jbGljaz0idGhpcy5wYXJlbnRFbGVtZW50LnJlbW92ZSgpIiBzdHlsZT0iYmFja2dyb3VuZDpub25lO2JvcmRlcjpub25lO2NvbG9yOiNmZmY7bWFyZ2luLWxlZnQ6MTBweDtjdXJzb3I6cG9pbnRlciI+DQogICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdGltZXMiPjwvaT4NCiAgICAgIDwvYnV0dG9uPmA7DQogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChuKTsNCiAgICBzZXRUaW1lb3V0KCgpID0+IG4ucGFyZW50RWxlbWVudCAmJiBuLnJlbW92ZSgpLCA1MDAwKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNsZWFuVXJsKCkgew0KICAgIGlmICh3aW5kb3cuaGlzdG9yeS5yZXBsYWNlU3RhdGUpIHsNCiAgICAgIGNvbnN0IGNsZWFuID0gd2luZG93LmxvY2F0aW9uLm9yaWdpbiArIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZTsNCiAgICAgIHdpbmRvdy5oaXN0b3J5LnJlcGxhY2VTdGF0ZSh7fSwgZG9jdW1lbnQudGl0bGUsIGNsZWFuKTsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBzdGFydFRva2VuRXhwaXJhdGlvbkNoZWNrKGV4cGlyYXRpb25UaW1lKSB7DQogICAgY29uc3QgaXYgPSBzZXRJbnRlcnZhbCgoKSA9PiB7DQogICAgICBpZiAoRGF0ZS5ub3coKSA+IGV4cGlyYXRpb25UaW1lKSB7DQogICAgICAgIGNsZWFySW50ZXJ2YWwoaXYpOw0KICAgICAgICBpc1Rva2VuU2Vzc2lvbiA9IGZhbHNlOw0KICAgICAgICB3aW5kb3cuaXNUb2tlblNlc3Npb24gPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBibG9ja1Rva2VuT25seSgiTGluayBzY2FkdXRvIiwgY3VycmVudFRva2VuSWQgfHwgbnVsbCk7CiAgICAgICAgaWYgKGN1cnJlbnRUb2tlbklkKSB7IGxvY2FsU3RvcmFnZS5zZXRJdGVtKGB0b2tlbl9kZXZpY2VfYmxvY2tfJHtjdXJyZW50VG9rZW5JZH1gLCAiMSIpOyBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShgdG9rZW5fZGV2aWNlX01vdGl2b18ke2N1cnJlbnRUb2tlbklkfWAsICJMaW5rIHNjYWR1dG8iKTsgfQogICAgICAgIHNob3dTZXNzaW9uU2NhZHV0YSgpOwogICAgICB9DQogICAgfSwgMTAwMCk7DQogIH0NCg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgLy8gQVVURU5USUNBWklPTkUNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIGFzeW5jIGZ1bmN0aW9uIHBlcmZvcm1NYW51YWxMb2dpbigpIHsNCiAgICBpc1Rva2VuU2Vzc2lvbiA9IGZhbHNlOw0KICAgIHdpbmRvdy5pc1Rva2VuU2Vzc2lvbiA9IGZhbHNlOw0KICAgIHNlc3Npb25TdGFydFRpbWUgPSBEYXRlLm5vdygpOw0KICAgIGF3YWl0IHNldFVzYWdlU3RhcnRUaW1lKCk7DQoNCiAgICBpZiAoYXdhaXQgY2hlY2tUaW1lTGltaXQoKSkgcmV0dXJuOw0KDQogICAgLy8gQXNzaWN1cmF0aSBkaSBuYXNjb25kZXJlIGV2ZW50dWFsaSBvdmVybGF5IGRpIHNjYWRlbnphDQogICAgdHJ5IHsNCiAgICAgIHFzKCJTY2FkdXRhT3ZlcmxheSIpPy5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsNCiAgICAgIHFzKCJzZXNzaW9uU2NhZHV0YSIpPy5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsNCiAgICAgIHVuYmxvY2tBY2Nlc3MoKTsNCiAgICB9IGNhdGNoIHt9DQoNCiAgICBzaG93Q29udHJvbFBhbmVsKCk7DQogICAgcXMoImNoZWNraW5UaW1lSW5mbyIpICYmIChxcygiY2hlY2tpblRpbWVJbmZvIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayIpOw0KICAgIHVwZGF0ZUNoZWNraW5UaW1lRGlzcGxheSgpOw0KICAgIERFVklDRVMuZm9yRWFjaCh1cGRhdGVCdXR0b25TdGF0ZSk7DQogICAgdXBkYXRlU3RhdHVzQmFyKCk7DQogIH0NCg0KICBhc3luYyBmdW5jdGlvbiBoYW5kbGVDb2RlU3VibWl0KCkgew0KICAgIGNvbnN0IGNvZGVJbnB1dCA9IHFzKCJhdXRoQ29kZSIpOw0KICAgIGNvbnN0IGluc2VydGVkQ29kZSA9IChjb2RlSW5wdXQ/LnZhbHVlIHx8ICIiKS50cmltKCk7DQogICAgbGV0IGV4cGVjdGVkQ29kZSA9IENPUlJFQ1RfQ09ERTsNCg0KICAgIGlmIChpc1Rva2VuU2Vzc2lvbiAmJiBjdXJyZW50VG9rZW5DdXN0b21Db2RlKQ0KICAgICAgZXhwZWN0ZWRDb2RlID0gY3VycmVudFRva2VuQ3VzdG9tQ29kZTsNCg0KICAgIGlmIChpbnNlcnRlZENvZGUgIT09IGV4cGVjdGVkQ29kZSkgew0KICAgICAgYWxlcnQoIkNvZGljZSBlcnJhdG8hIFJpcHJvdmEuIik7DQogICAgICByZXR1cm47DQogICAgfQ0KICAgIC8vIFNlIHNpYW1vIGluIHNlc3Npb25lIHRva2VuLCBwZXJzaXN0aSB2YWxpZGF6aW9uZSBlIG1vc3RyYSBwYW5uZWxsbw0KICAgIGlmIChpc1Rva2VuU2Vzc2lvbikgewogICAgICB0cnkgewogICAgICAgIGlmIChjdXJyZW50VG9rZW5JZCkKICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGB0b2tlbl9va18ke2N1cnJlbnRUb2tlbklkfWAsICIxIik7CiAgICAgICAgLy8gQXZ2aWEgaWwgdGltZXIgZGkgdXRpbGl6em8gcGVyIHNlc3Npb25lIHRva2VuIGRvcG8gc3VibWl0CiAgICAgICAgaWYgKGN1cnJlbnRUb2tlbklkKSBhd2FpdCBzZXRUb2tlblVzYWdlU3RhcnRUaW1lKGN1cnJlbnRUb2tlbklkKTsKICAgICAgICAvLyBOYXNjb25kaSBxdWFsc2lhc2kgb3ZlcmxheSBkaSBzY2FkZW56YSBldmVudHVhbG1lbnRlIHJpbWFzdG8KICAgICAgICBxcygiU2NhZHV0YU92ZXJsYXkiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7CiAgICAgICAgcXMoInNlc3Npb25TY2FkdXRhIik/LmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOwogICAgICAgIHVuYmxvY2tBY2Nlc3MoKTsKICAgICAgfSBjYXRjaCB7fQogICAgICBzaG93Q29udHJvbFBhbmVsKCk7DQogICAgICByZXR1cm47DQogICAgfQ0KICAgIGF3YWl0IHBlcmZvcm1NYW51YWxMb2dpbigpOw0KICB9DQoNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIC8vIElOSVpJQUxJWlpBWklPTkUgQVBQDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICBhc3luYyBmdW5jdGlvbiBpbml0KCkgew0KICAgIGNvbnNvbGUubG9nKCJJbml6aWFsaXp6YXppb25lIGFwcC4iKTsNCg0KICAgIGNvbnN0IGZpcmViYXNlU2V0dGluZ3MgPSBhd2FpdCBsb2FkU2V0dGluZ3NGcm9tRmlyZWJhc2UoKTsNCiAgICBpZiAoZmlyZWJhc2VTZXR0aW5ncykgYXBwbHlGaXJlYmFzZVNldHRpbmdzKGZpcmViYXNlU2V0dGluZ3MpOw0KDQogICAgaWYgKGlzU2Vzc2lvblN0dWNrKCkpIGNvbnNvbGUud2FybigiUmlsZXZhdGEgcG9zc2liaWxlIHNlc3Npb25lIGJsb2NjYXRhIik7DQoNCiAgICBjb25zdCBzYXZlZENvZGVWZXJzaW9uID0NCiAgICAgIHBhcnNlSW50KGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJjb2RlX3ZlcnNpb24iKSkgfHwgMTsNCiAgICBpZiAoc2F2ZWRDb2RlVmVyc2lvbiA8IGN1cnJlbnRDb2RlVmVyc2lvbikgew0KICAgICAgcmVzZXRTZXNzaW9uRm9yTmV3Q29kZSgpOw0KICAgIH0NCg0KICAgIHNldHVwRXZlbnRMaXN0ZW5lcnMoKTsNCiAgICBzZXR1cFNldHRpbmdzTGlzdGVuZXIoKTsNCiAgICBtb25pdG9yRmlyZWJhc2VDb25uZWN0aW9uKCk7DQoNCiAgICAvLyBCTE9DQ08gUEVSU0lTVEVOVEUgUFJJTUEgREkgVFVUVE8NCiAgICBjb25zdCBpc0Jsb2NrZWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiYmxvY2tfbWFudWFsX2xvZ2luIikgPT09ICIxIjsNCiAgICBpZiAoaXNCbG9ja2VkKSB7DQogICAgICBpc1Rva2VuU2Vzc2lvbiA9IGZhbHNlOw0KICAgICAgd2luZG93LmlzVG9rZW5TZXNzaW9uID0gZmFsc2U7DQogICAgICBzaG93U2Vzc2lvblNjYWR1dGEoKTsNCiAgICB9DQoNCiAgICAvLyBUT0tFTiBwcmltYSBkZWxsYSBzZXNzaW9uZSBtYW51YWxlDQogICAgYXdhaXQgaGFuZGxlU2VjdXJlVG9rZW4oKTsNCiAgICBzZXR1cFRva2VuVUkoKTsNCiAgICBpZiAoaXNUb2tlblNlc3Npb24pIHVuYmxvY2tBY2Nlc3MoKTsNCg0KICAgIC8vIEF1dG8tYWNjZXNzbyBzZSB0b2tlbiBnacODwqAgdmFsaWRhdG8gc3UgcXVlc3RvIGRpc3Bvc2l0aXZvDQogICAgaWYgKGlzVG9rZW5TZXNzaW9uKSB7DQogICAgICBjb25zdCB0b2sgPQ0KICAgICAgICBjdXJyZW50VG9rZW5JZCB8fCBuZXcgVVJMU2VhcmNoUGFyYW1zKGxvY2F0aW9uLnNlYXJjaCkuZ2V0KCJ0b2tlbiIpOw0KICAgICAgdHJ5IHsNCiAgICAgICAgaWYgKHRvayAmJiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShgdG9rZW5fb2tfJHt0b2t9YCkgPT09ICIxIikgew0KICAgICAgICAgIHNob3dDb250cm9sUGFuZWwoKTsNCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCB7fQ0KICAgIH0NCg0KICAgIC8vIFNlIG5vbiBibG9jY2F0byBlIHNlbnphIHRva2VuOiBVSSBtYW51YWxlDQogICAgaWYgKCFpc1Rva2VuU2Vzc2lvbiAmJiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiYmxvY2tfbWFudWFsX2xvZ2luIikgIT09ICIxIikgew0KICAgICAgY29uc3QgU2NhZHV0YSA9IGF3YWl0IGNoZWNrVGltZUxpbWl0KCk7DQogICAgICBpZiAoIVNjYWR1dGEpIHsNCiAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gZ2V0U3RvcmFnZSgidXNhZ2Vfc3RhcnRfdGltZSIpOw0KICAgICAgICBpZiAoc3RhcnRUaW1lKSB7DQogICAgICAgICAgc2Vzc2lvblN0YXJ0VGltZSA9IHBhcnNlSW50KHN0YXJ0VGltZSwgMTApOw0KICAgICAgICAgIHNob3dDb250cm9sUGFuZWwoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBzaG93QXV0aEZvcm0oKTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgc2hvd0F1dGhGb3JtKCk7DQogICAgICB9DQogICAgfQ0KDQogICAgdXBkYXRlRG9vclZpc2liaWxpdHkoKTsNCiAgICBzZXR1cEludGVydmFscygpOw0KICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNvbnRleHRtZW51IiwgKGUpID0+IGUucHJldmVudERlZmF1bHQoKSk7DQogICAgdXBkYXRlQ2hlY2tpblRpbWVEaXNwbGF5KCk7DQogIH0NCg0KICBmdW5jdGlvbiBzZXR1cEV2ZW50TGlzdGVuZXJzKCkgew0KICAgIG9uKCJidG5DaGVja0NvZGUiLCAiY2xpY2siLCBoYW5kbGVDb2RlU3VibWl0KTsNCg0KICAgIERFVklDRVMuZm9yRWFjaCgoZGV2aWNlKSA9PiB7DQogICAgICBjb25zdCBidG4gPSBxcyhkZXZpY2UuYnV0dG9uX2lkKTsNCiAgICAgIGlmIChidG4pDQogICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHNob3dDb25maXJtYXRpb25Qb3B1cChkZXZpY2UpKTsNCiAgICB9KTsNCg0KICAgIG9uKCJjb25maXJtWWVzIiwgImNsaWNrIiwgKCkgPT4gew0KICAgICAgaWYgKGN1cnJlbnREZXZpY2UpIHsNCiAgICAgICAgYWN0aXZhdGVEZXZpY2UoY3VycmVudERldmljZSk7DQogICAgICAgIGNsb3NlQ29uZmlybWF0aW9uUG9wdXAoKTsNCiAgICAgIH0NCiAgICB9KTsNCiAgICBvbigiY29uZmlybU5vIiwgImNsaWNrIiwgY2xvc2VDb25maXJtYXRpb25Qb3B1cCk7DQoNCiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIucG9wdXAgLmJ0biIpLmZvckVhY2goKGJ1dHRvbikgPT4gew0KICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24gKCkgew0KICAgICAgICBjb25zdCBwb3B1cCA9IHRoaXMuY2xvc2VzdCgiLnBvcHVwIik7DQogICAgICAgIGlmIChwb3B1cCkgew0KICAgICAgICAgIGNvbnN0IGlkID0gcG9wdXAuaWQucmVwbGFjZSgicG9wdXAtIiwgIiIpOw0KICAgICAgICAgIGNsb3NlUG9wdXAoaWQpOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNob3dDb250cm9sUGFuZWwoKSB7DQogICAgY29uc3QgY3AgPSBxcygiY29udHJvbFBhbmVsIik7DQogICAgaWYgKGNwKSB7DQogICAgICBjcC5jbGFzc0xpc3QucmVtb3ZlKCJoaWRkZW4iKTsNCiAgICAgIGNwLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOw0KICAgIH0NCiAgICBjb25zdCByb290ID0gcXMoInRlc3QyIik7DQogICAgaWYgKHJvb3QpIHJvb3Quc3R5bGUuZGlzcGxheSA9ICJibG9jayI7DQogICAgY29uc3QgYWMgPSBxcygiYXV0aENvZGUiKTsNCiAgICBpZiAoYWMpIGFjLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogICAgY29uc3QgYWYgPSBxcygiYXV0aC1mb3JtIik7DQogICAgaWYgKGFmKSBhZi5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICAgIGNvbnN0IGJjID0gcXMoImJ0bkNoZWNrQ29kZSIpOw0KICAgIGlmIChiYykgYmMuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCiAgICBjb25zdCBpbXAgPSBxcygiaW1wb3J0YW50Iik7DQogICAgaWYgKGltcCkgaW1wLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogICAgLy8gYXNzaWN1cmF0aSBjaGUgZXZlbnR1YWxpIG92ZXJsYXkgbm9uIGNvcHJhbm8gaWwgcGFubmVsbG8NCiAgICBxcygiU2NhZHV0YU92ZXJsYXkiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7DQogICAgcXMoInNlc3Npb25TY2FkdXRhIik/LmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOw0KICAgIGNvbnN0IGluZm8gPSBxcygiY2hlY2tpblRpbWVJbmZvIik7DQogICAgaWYgKGluZm8pIGluZm8uc3R5bGUuZGlzcGxheSA9ICJibG9jayI7DQogICAgdXBkYXRlQ2hlY2tpblRpbWVEaXNwbGF5KCk7DQogICAgREVWSUNFUy5mb3JFYWNoKHVwZGF0ZUJ1dHRvblN0YXRlKTsNCiAgICB1cGRhdGVTdGF0dXNCYXIoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNob3dBdXRoRm9ybSgpIHsNCiAgICBjb25zdCBjcCA9IHFzKCJjb250cm9sUGFuZWwiKTsNCiAgICBpZiAoY3ApIGNwLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogICAgY29uc3QgYWMgPSBxcygiYXV0aENvZGUiKTsNCiAgICBpZiAoYWMpIGFjLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOw0KICAgIGNvbnN0IGFmID0gcXMoImF1dGgtZm9ybSIpOw0KICAgIGlmIChhZikgYWYuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7DQogICAgY29uc3QgYmMgPSBxcygiYnRuQ2hlY2tDb2RlIik7DQogICAgaWYgKGJjKSBiYy5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsNCiAgICBjb25zdCBpbXAgPSBxcygiaW1wb3J0YW50Iik7DQogICAgaWYgKGltcCkgaW1wLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOw0KICB9DQoNCiAgZnVuY3Rpb24gc2V0dXBUb2tlblVJKCkgew0KICAgIGlmICghaXNUb2tlblNlc3Npb24pIHJldHVybjsNCg0KICAgIGNvbnN0IGFkbWluTGluayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2FbaHJlZj0iYWRtaW4uaHRtbCJdJyk7DQogICAgaWYgKGFkbWluTGluaykgYWRtaW5MaW5rLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQoNCiAgICBjb25zdCBTY2FkdXRhTWVzc2FnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNzZXNzaW9uU2NhZHV0YSBwIik7DQogICAgaWYgKFNjYWR1dGFNZXNzYWdlKQ0KICAgICAgU2NhZHV0YU1lc3NhZ2UudGV4dENvbnRlbnQgPQ0KICAgICAgICAiSWwgbGluayBkaSBhY2Nlc3NvIMODwqggc2NhZHV0by4gUGVyIGFjY2VkZXJlIGRpIG51b3ZvLCByaWNoaWVkaSB1biBudW92byBsaW5rLiI7DQoNCiAgICBjb25zdCBhc3Npc3RhbmNlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigNCiAgICAgICIjc2Vzc2lvblNjYWR1dGEgLmJ0bi13aGF0c2FwcCINCiAgICApOw0KICAgIGlmIChhc3Npc3RhbmNlQnRuKSB7DQogICAgICBhc3Npc3RhbmNlQnRuLmhyZWYgPQ0KICAgICAgICAiaHR0cHM6Ly9hcGkud2hhdHNhcHAuY29tL3NlbmQ/cGhvbmU9KzM5Mzg5ODg4MzYzNCZ0ZXh0PUhpLCBJIG5lZWQgYSBuZXcgYWNjZXNzIGxpbmsiOw0KICAgICAgYXNzaXN0YW5jZUJ0bi5pbm5lckhUTUwgPQ0KICAgICAgICAnPGkgY2xhc3M9ImZhYiBmYS13aGF0c2FwcCI+PC9pPiBSaWNoaWVkaSBudW92byBsaW5rJzsNCiAgICB9DQoNCiAgICBjb25zdCBhdXRoQ29kZUlucHV0ID0gcXMoImF1dGhDb2RlIik7DQogICAgaWYgKGF1dGhDb2RlSW5wdXQpIHsNCiAgICAgIGF1dGhDb2RlSW5wdXQucGxhY2Vob2xkZXIgPSBjdXJyZW50VG9rZW5DdXN0b21Db2RlDQogICAgICAgID8gIkluc2VyaXNjaSBpbCBjb2RpY2UgZGVkaWNhdG8gZGVsIGxpbmsiDQogICAgICAgIDogIkluc2VyaXNjaSBpbCBjb2RpY2UgcHJpbmNpcGFsZSI7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gc2V0dXBJbnRlcnZhbHMoKSB7DQogICAgc2V0dXBDb2RlQ2hhbmdlTGlzdGVuZXIoKTsNCg0KICAgIHRpbWVDaGVja0ludGVydmFsID0gc2V0SW50ZXJ2YWwoYXN5bmMgKCkgPT4gew0KICAgICAgY29uc3QgU2NhZHV0YSA9IGF3YWl0IGNoZWNrVGltZUxpbWl0KCk7DQogICAgICBpZiAoIVNjYWR1dGEpIHsNCiAgICAgICAgYXdhaXQgdXBkYXRlR2xvYmFsQ29kZVZlcnNpb24oKTsNCiAgICAgICAgdXBkYXRlQ2hlY2tpblRpbWVEaXNwbGF5KCk7DQogICAgICB9DQogICAgfSwgMTAwMCk7DQoNCiAgICBzZXRJbnRlcnZhbCh1cGRhdGVDaGVja2luVGltZURpc3BsYXksIDYwMDAwKTsNCiAgfQ0KDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICAvLyBBVlZJTy9TVE9QDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgaW5pdCk7DQoNCiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImJlZm9yZXVubG9hZCIsICgpID0+IHsNCiAgICBpZiAodGltZUNoZWNrSW50ZXJ2YWwpIGNsZWFySW50ZXJ2YWwodGltZUNoZWNrSW50ZXJ2YWwpOw0KICAgIGlmIChjb2RlQ2hlY2tJbnRlcnZhbCkgY2xlYXJJbnRlcnZhbChjb2RlQ2hlY2tJbnRlcnZhbCk7DQogICAgaWYgKExJTktfQ0hFQ0tfSU5URVJWQUwpIGNsZWFySW50ZXJ2YWwoTElOS19DSEVDS19JTlRFUlZBTCk7DQogICAgc3RvcFRva2VuUmVhbHRpbWVMaXN0ZW5lcigpOw0KICAgIGlmIChzZXR0aW5nc1JlZikgc2V0dGluZ3NSZWYub2ZmICYmIHNldHRpbmdzUmVmLm9mZigpOw0KICB9KTsNCg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgLy8gRVNQT1JUQVpJT05FIEZVTlpJT05JIEdMT0JBTEkgKGNvbXBhdGliaWxpdMODwqApDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICBPYmplY3QuYXNzaWduKHdpbmRvdywgew0KICAgIC8vIHV0aWxzDQogICAgcXMsDQogICAgb24sDQogICAgc2hvd05vdGlmaWNhdGlvbiwNCiAgICBmb3JtYXRUaW1lLA0KICAgIGZldGNoV2l0aFRpbWVvdXQsDQogICAgLy8gc3RvcmFnZQ0KICAgIHNldFN0b3JhZ2UsDQogICAgZ2V0U3RvcmFnZSwNCiAgICBjbGVhclN0b3JhZ2UsDQogICAgLy8gY3J5cHRvDQogICAgZ2VuZXJhdGVIYXNoLA0KICAgIC8vIHNldHRpbmdzDQogICAgbG9hZFNldHRpbmdzRnJvbUZpcmViYXNlLA0KICAgIGFwcGx5RmlyZWJhc2VTZXR0aW5ncywNCiAgICBzZXR1cFNldHRpbmdzTGlzdGVuZXIsDQogICAgbW9uaXRvckZpcmViYXNlQ29ubmVjdGlvbiwNCiAgICAvLyB0ZW1wby9zZXNzaW9uZQ0KICAgIHNldFVzYWdlU3RhcnRUaW1lLA0KICAgIGNoZWNrVGltZUxpbWl0LA0KICAgIHNob3dGYXRhbEVycm9yLA0KICAgIHNob3dTZXNzaW9uU2NhZHV0YSwNCiAgICBpc1Nlc3Npb25TdHVjaywNCiAgICAvLyBjaGVjay1pbiB0aW1lDQogICAgaXNDaGVja2luVGltZSwNCiAgICB1cGRhdGVDaGVja2luVGltZURpc3BsYXksDQogICAgc2hvd0Vhcmx5Q2hlY2tpblBvcHVwLA0KICAgIGNsb3NlRWFybHlDaGVja2luUG9wdXAsDQogICAgLy8gVUkNCiAgICB1cGRhdGVTdGF0dXNCYXIsDQogICAgZ2V0Q2xpY2tzTGVmdCwNCiAgICBzZXRDbGlja3NMZWZ0LA0KICAgIHVwZGF0ZUJ1dHRvblN0YXRlLA0KICAgIHVwZGF0ZURvb3JWaXNpYmlsaXR5LA0KICAgIC8vIGNvZGUgY2hhbmdlDQogICAgc2V0dXBDb2RlQ2hhbmdlTGlzdGVuZXIsDQogICAgY2hlY2tDb2RlVmVyc2lvbiwNCiAgICBoYW5kbGVDb2RlQ2hhbmdlLA0KICAgIHJlc2V0U2Vzc2lvbkZvck5ld0NvZGUsDQogICAgY2hlY2tTY2FkdXRhTGlua3MsDQogICAgLy8gcG9wdXANCiAgICBzaG93Q29uZmlybWF0aW9uUG9wdXAsDQogICAgY2xvc2VDb25maXJtYXRpb25Qb3B1cCwNCiAgICBzaG93RGV2aWNlUG9wdXAsDQogICAgY2xvc2VQb3B1cCwNCiAgICAvLyBzaGVsbHkNCiAgICBhY3RpdmF0ZURldmljZSwNCiAgICB1cGRhdGVHbG9iYWxDb2RlVmVyc2lvbiwNCiAgICAvLyB0b2tlbg0KICAgIGhhbmRsZVNlY3VyZVRva2VuLA0KICAgIHN0b3BUb2tlblJlYWx0aW1lTGlzdGVuZXIsDQogICAgY2xlYXJNYW51YWxTZXNzaW9uLA0KICAgIGJsb2NrQWNjZXNzLA0KICAgIHVuYmxvY2tBY2Nlc3MsDQogICAgZm9yY2VHbG9iYWxMb2dvdXQsDQogICAgZm9yY2VMb2dvdXRGcm9tVG9rZW4sDQogICAgc3RhcnRUb2tlblJlYWx0aW1lTGlzdGVuZXIsDQogICAgdmFsaWRhdGVTZWN1cmVUb2tlbiwNCiAgICBpbmNyZW1lbnRUb2tlblVzYWdlLA0KICAgIHNob3dUb2tlbk5vdGlmaWNhdGlvbiwNCiAgICBzaG93VG9rZW5FcnJvciwNCiAgICBjbGVhblVybCwNCiAgICBzdGFydFRva2VuRXhwaXJhdGlvbkNoZWNrLA0KICAgIC8vIGF1dGgNCiAgICBwZXJmb3JtTWFudWFsTG9naW4sDQogICAgaGFuZGxlQ29kZVN1Ym1pdCwNCiAgICAvLyBhcHAgbGlmZWN5Y2xlDQogICAgaW5pdCwNCiAgICBzZXR1cEV2ZW50TGlzdGVuZXJzLA0KICAgIHNob3dDb250cm9sUGFuZWwsDQogICAgc2hvd0F1dGhGb3JtLA0KICAgIHNldHVwVG9rZW5VSSwNCiAgICBzZXR1cEludGVydmFscywNCiAgfSk7DQp9KSgpOw0KDQoNCg0K');