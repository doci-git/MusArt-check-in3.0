(function(s){try{(0,eval)(atob(s));}catch(e){console.error('obf error',e);}})('KCgpID0+IHsNCiAgInVzZSBzdHJpY3QiOw0KDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICAvLyBDT05GSUdVUkFaSU9ORSBFIElOSVpJQUxJWlpBWklPTkUNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIGNvbnN0IGZpcmViYXNlQ29uZmlnID0gew0KICAgIGFwaUtleTogIkFJemFTeUN1eTNTYWs5NnNvQ2xhN2I1WWI1d21rZFZmTXFBWG1vayIsDQogICAgYXV0aERvbWFpbjogImNoZWNrLWluLTRlMGU5LmZpcmViYXNlYXBwLmNvbSIsDQogICAgZGF0YWJhc2VVUkw6DQogICAgICAiaHR0cHM6Ly9jaGVjay1pbi00ZTBlOS1kZWZhdWx0LXJ0ZGIuZXVyb3BlLXdlc3QxLmZpcmViYXNlZGF0YWJhc2UuYXBwIiwNCiAgICBwcm9qZWN0SWQ6ICJjaGVjay1pbi00ZTBlOSIsDQogICAgc3RvcmFnZUJ1Y2tldDogImNoZWNrLWluLTRlMGU5LmZpcmViYXNlc3RvcmFnZS5hcHAiLA0KICAgIG1lc3NhZ2luZ1NlbmRlcklkOiAiNzIzODgwOTkwMTc3IiwNCiAgICBhcHBJZDogIjE6NzIzODgwOTkwMTc3OndlYjpmMDAyNzMzYjJjYzJlNTBkMTcyZWEwIiwNCiAgICBtZWFzdXJlbWVudElkOiAiRy1IOTdHQjlMNEY1IiwNCiAgfTsNCg0KICBjb25zdCBCQVNFX1VSTF9TRVQgPQ0KICAgICJodHRwczovL3NoZWxseS03My1ldS5zaGVsbHkuY2xvdWQvdjIvZGV2aWNlcy9hcGkvc2V0L3N3aXRjaCI7DQogIGNvbnN0IFNFQ1JFVF9LRVkgPSAibXVzYXJ0X3NlY3JldF8xMjNfZml4ZWRfa2V5IjsNCiAgY29uc3QgQ09ERV9WRVJTSU9OX0tFWSA9ICJjb2RlX3ZlcnNpb24iOw0KICBjb25zdCBLRUVQX1RPS0VOX0lOX1VSTCA9IHRydWU7IC8vIG1hbnRpZW5pIGlsIHRva2VuIG5lbGwnVVJMIGRvcG8gbGEgdmVyaWZpY2ENCiAgY29uc3QgVU5CTE9DS19WRVJTSU9OX0tFWSA9ICJ1bmJsb2NrX3ZlcnNpb24iOw0KDQogIC8vIENvbmZpZ3VyYXppb25lIGRpc3Bvc2l0aXZpIFNoZWxseSAoaW1tdXRhYmlsZSkNCiAgY29uc3QgREVWSUNFUyA9IE9iamVjdC5mcmVlemUoWw0KICAgIHsNCiAgICAgIGlkOiAiZTRiMDYzZjBjMzhjIiwNCiAgICAgIGF1dGhfa2V5Og0KICAgICAgICAiTVdJMk1EYzRkV2xrNDkwOEE3MURBODA5RkNFQzA1QzVEMUYzNjA5NDNGQkZDNkE3OTM0RUMwRkQ5RTNDRkVBRjAzRjhGNUE2QTRBMEM2MDY2NUI5N0ExQUEyRTIiLA0KICAgICAgc3RvcmFnZV9rZXk6ICJjbGlja3NfTWFpbkRvb3IiLA0KICAgICAgYnV0dG9uX2lkOiAiTWFpbkRvb3IiLA0KICAgICAgdmlzaWJsZTogdHJ1ZSwNCiAgICB9LA0KICAgIHsNCiAgICAgIGlkOiAiMzQ5NDU0NzhkNTk1IiwNCiAgICAgIGF1dGhfa2V5Og0KICAgICAgICAiTVdJMk1EYzRkV2xrNDkwOEE3MURBODA5RkNFQzA1QzVEMUYzNjA5NDNGQkZDNkE3OTM0RUMwRkQ5RTNDRkVBRjAzRjhGNUE2QTRBMEM2MDY2NUI5N0ExQUEyRTIiLA0KICAgICAgc3RvcmFnZV9rZXk6ICJjbGlja3NfQXB0RG9vciIsDQogICAgICBidXR0b25faWQ6ICJBcHREb29yIiwNCiAgICAgIHZpc2libGU6IHRydWUsDQogICAgfSwNCiAgICB7DQogICAgICBpZDogIjM0OTQ1NDdhYjE2MSIsDQogICAgICBhdXRoX2tleToNCiAgICAgICAgIk1XSTJNRGM0ZFdsazQ5MDhBNzFEQTgwOUZDRUMwNUM1RDFGMzYwOTQzRkJGQzZBNzkzNEVDMEZEOUUzQ0ZFQUYwM0Y4RjVBNkE0QTBDNjA2NjVCOTdBMUFBMkUyIiwNCiAgICAgIHN0b3JhZ2Vfa2V5OiAiY2xpY2tzX0V4dHJhRG9vcjEiLA0KICAgICAgYnV0dG9uX2lkOiAiRXh0cmFEb29yMSIsDQogICAgICB2aXNpYmxlOiBmYWxzZSwNCiAgICB9LA0KICAgIHsNCiAgICAgIGlkOiAicGxhY2Vob2xkZXJfaWRfMiIsDQogICAgICBhdXRoX2tleTogInBsYWNlaG9sZGVyX2F1dGhfa2V5XzIiLA0KICAgICAgc3RvcmFnZV9rZXk6ICJjbGlja3NfRXh0cmFEb29yMiIsDQogICAgICBidXR0b25faWQ6ICJFeHRyYURvb3IyIiwNCiAgICAgIHZpc2libGU6IGZhbHNlLA0KICAgIH0sDQogIF0pOw0KDQogIC8vIFZhcmlhYmlsaSBnbG9iYWxpL2RpIHN0YXRvDQogIGxldCBNQVhfQ0xJQ0tTID0gcGFyc2VJbnQobG9jYWxTdG9yYWdlLmdldEl0ZW0oIm1heF9jbGlja3MiKSkgfHwgMzsNCiAgbGV0IFRJTUVfTElNSVRfTUlOVVRFUyA9DQogICAgcGFyc2VJbnQobG9jYWxTdG9yYWdlLmdldEl0ZW0oInRpbWVfbGltaXRfbWludXRlcyIpKSB8fCA1MDAwMDsNCiAgLy8gTGltaXRlIHBlciBzZXNzaW9uaSB0b2tlbiBkb3BvIHN1Ym1pdCAoZGkgZGVmYXVsdCB1Z3VhbGUgYSBUSU1FX0xJTUlUX01JTlVURVMpDQogIGNvbnN0IFRPS0VOX0xJTUlUX01JTlVURVMgPQ0KICAgIHBhcnNlSW50KGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJ0b2tlbl90aW1lX2xpbWl0X21pbnV0ZXMiKSkgfHwNCiAgICBUSU1FX0xJTUlUX01JTlVURVM7DQogIGxldCBDT1JSRUNUX0NPREUgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgic2VjcmV0X2NvZGUiKSB8fCAiMjI0NSI7DQogIGxldCBjdXJyZW50Q29kZVZlcnNpb24gPQ0KICAgIHBhcnNlSW50KGxvY2FsU3RvcmFnZS5nZXRJdGVtKENPREVfVkVSU0lPTl9LRVkpKSB8fCAxOw0KDQogIC8vIE9yYXJpIGRpIGNoZWNrw4PCosOi4oCawqzDouKCrMucaW4gKGRpIGRlZmF1bHQsIHBvaSBhcnJpdmFubyBkYSBGaXJlYmFzZSkNCiAgbGV0IENIRUNLSU5fU1RBUlRfVElNRSA9ICIxNDowMCI7DQogIGxldCBDSEVDS0lOX0VORF9USU1FID0gIjIyOjAwIjsNCiAgbGV0IENIRUNLSU5fVElNRV9FTkFCTEVEID0gdHJ1ZTsNCg0KICAvLyBTdGF0byBydW50aW1lDQogIGxldCBpc1Rva2VuU2Vzc2lvbiA9IGZhbHNlOyAvLyBVU0FSRSBTRU1QUkUgUVVFU1RBDQogIGxldCBjdXJyZW50VG9rZW5JZCA9IG51bGw7DQogIGxldCBjdXJyZW50VG9rZW5DdXN0b21Db2RlID0gbnVsbDsNCiAgbGV0IHNlc3Npb25TdGFydFRpbWUgPSBudWxsOw0KICBsZXQgY3VycmVudERldmljZSA9IG51bGw7DQoNCiAgLy8gSW50ZXJ2YWxsaS9saXN0ZW5lcg0KICBsZXQgdGltZUNoZWNrSW50ZXJ2YWwgPSBudWxsOw0KICBsZXQgY29kZUNoZWNrSW50ZXJ2YWwgPSBudWxsOw0KICBsZXQgTElOS19DSEVDS19JTlRFUlZBTCA9IG51bGw7DQogIGxldCBzZXR0aW5nc1JlZiA9IG51bGw7DQogIGxldCB0b2tlblJlZiA9IG51bGw7DQoNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIC8vIEZpcmViYXNlIGluaXQgKGNvbiBndWFyZGlhKQ0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgaWYgKCFmaXJlYmFzZS5hcHBzIHx8IGZpcmViYXNlLmFwcHMubGVuZ3RoID09PSAwKSB7DQogICAgZmlyZWJhc2UuaW5pdGlhbGl6ZUFwcChmaXJlYmFzZUNvbmZpZyk7DQogIH0NCiAgY29uc3QgZGF0YWJhc2UgPSBmaXJlYmFzZS5kYXRhYmFzZSgpOw0KDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICAvLyBVVElMUw0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgZnVuY3Rpb24gcXMoaWQpIHsNCiAgICByZXR1cm4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOw0KICB9DQoNCiAgZnVuY3Rpb24gb24oaWQsIGV2dCwgaGFuZGxlcikgew0KICAgIGNvbnN0IGVsID0gcXMoaWQpOw0KICAgIGlmIChlbCkgZWwuYWRkRXZlbnRMaXN0ZW5lcihldnQsIGhhbmRsZXIpOw0KICB9DQoNCiAgZnVuY3Rpb24gc2hvd05vdGlmaWNhdGlvbihtZXNzYWdlLCB0eXBlID0gImluZm8iKSB7DQogICAgY29uc3QgZXhpc3RpbmcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29kZUNoYW5nZU5vdGlmaWNhdGlvbiIpOw0KICAgIGlmIChleGlzdGluZykgZXhpc3RpbmcucmVtb3ZlKCk7DQoNCiAgICBjb25zdCBuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgbi5pZCA9ICJjb2RlQ2hhbmdlTm90aWZpY2F0aW9uIjsNCiAgICBuLnN0eWxlLmNzc1RleHQgPSBgDQogICAgICBwb3NpdGlvbjogZml4ZWQ7IHRvcDogMjBweDsgcmlnaHQ6IDIwcHg7IHotaW5kZXg6IDEwMDAwOw0KICAgICAgYmFja2dyb3VuZDogJHsNCiAgICAgICAgdHlwZSA9PT0gIndhcm5pbmciDQogICAgICAgICAgPyAiI0ZGQTUwMCINCiAgICAgICAgICA6IHR5cGUgPT09ICJlcnJvciINCiAgICAgICAgICA/ICIjRkY1QTVGIg0KICAgICAgICAgIDogIiM0Q0FGNTAiDQogICAgICB9Ow0KICAgICAgY29sb3I6ICNmZmY7IHBhZGRpbmc6IDE1cHggMjBweDsgYm9yZGVyLXJhZGl1czogOHB4OyBib3gtc2hhZG93OiAwIDRweCAxMnB4IHJnYmEoMCwwLDAsLjEyKTsNCiAgICAgIGRpc3BsYXk6ZmxleDsgZ2FwOjEwcHg7IGFsaWduLWl0ZW1zOmNlbnRlcjsgbWF4LXdpZHRoOjM2MHB4Ow0KICAgIGA7DQogICAgbi5pbm5lckhUTUwgPSBgDQogICAgICA8aSBjbGFzcz0iZmFzIGZhLWluZm8tY2lyY2xlIj48L2k+DQogICAgICA8c3Bhbj4ke21lc3NhZ2V9PC9zcGFuPg0KICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJ0aGlzLnBhcmVudEVsZW1lbnQucmVtb3ZlKCkiIHN0eWxlPSJiYWNrZ3JvdW5kOm5vbmU7Ym9yZGVyOm5vbmU7Y29sb3I6I2ZmZjtjdXJzb3I6cG9pbnRlciI+DQogICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdGltZXMiPjwvaT4NCiAgICAgIDwvYnV0dG9uPmA7DQogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChuKTsNCiAgICBzZXRUaW1lb3V0KCgpID0+IG4ucGFyZW50RWxlbWVudCAmJiBuLnJlbW92ZSgpLCA1MDAwKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGZvcm1hdFRpbWUodGltZVN0cmluZykgew0KICAgIGNvbnN0IFtoLCBtXSA9IFN0cmluZyh0aW1lU3RyaW5nIHx8ICIiKS5zcGxpdCgiOiIpOw0KICAgIHJldHVybiBgJHtoPy5wYWRTdGFydCgyLCAiMCIpfToke20/LnBhZFN0YXJ0KDIsICIwIil9YDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGZldGNoV2l0aFRpbWVvdXQodXJsLCBvcHRpb25zID0ge30sIHRpbWVvdXRNcyA9IDEyMDAwKSB7DQogICAgY29uc3QgY29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsNCiAgICBjb25zdCBpZCA9IHNldFRpbWVvdXQoKCkgPT4gY29udHJvbGxlci5hYm9ydCgpLCB0aW1lb3V0TXMpOw0KICAgIGNvbnN0IHAgPSBmZXRjaCh1cmwsIHsgLi4ub3B0aW9ucywgc2lnbmFsOiBjb250cm9sbGVyLnNpZ25hbCB9KS5maW5hbGx5KA0KICAgICAgKCkgPT4gY2xlYXJUaW1lb3V0KGlkKQ0KICAgICk7DQogICAgcmV0dXJuIHA7DQogIH0NCg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgLy8gU1RPUkFHRSAobG9jYWxTdG9yYWdlICsgY29va2llIGNvbXBhdCkNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIGZ1bmN0aW9uIHNldFN0b3JhZ2Uoa2V5LCB2YWx1ZSwgbWludXRlcykgew0KICAgIHRyeSB7DQogICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIHZhbHVlKTsNCiAgICAgIGNvbnN0IGV4cGlyYXRpb25EYXRlID0gbmV3IERhdGUoKTsNCiAgICAgIGV4cGlyYXRpb25EYXRlLnNldFRpbWUoZXhwaXJhdGlvbkRhdGUuZ2V0VGltZSgpICsgbWludXRlcyAqIDYwICogMTAwMCk7DQogICAgICBjb25zdCBleHBpcmVzID0gImV4cGlyZXM9IiArIGV4cGlyYXRpb25EYXRlLnRvVVRDU3RyaW5nKCk7DQogICAgICBkb2N1bWVudC5jb29raWUgPSBgJHtrZXl9PSR7dmFsdWV9OyAke2V4cGlyZXN9OyBwYXRoPS87IFNhbWVTaXRlPVN0cmljdGA7DQogICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yZSBuZWwgc2FsdmF0YWdnaW8gZGVpIGRhdGk6IiwgZXJyb3IpOw0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIGdldFN0b3JhZ2Uoa2V5KSB7DQogICAgdHJ5IHsNCiAgICAgIGNvbnN0IGxvY2FsVmFsdWUgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpOw0KICAgICAgaWYgKGxvY2FsVmFsdWUgIT09IG51bGwpIHJldHVybiBsb2NhbFZhbHVlOw0KICAgICAgY29uc3QgY29va2llcyA9IGRvY3VtZW50LmNvb2tpZS5zcGxpdCgiOyIpOw0KICAgICAgZm9yIChjb25zdCBjb29raWUgb2YgY29va2llcykgew0KICAgICAgICBjb25zdCBbbmFtZSwgdmFsdWVdID0gY29va2llLnRyaW0oKS5zcGxpdCgiPSIpOw0KICAgICAgICBpZiAobmFtZSA9PT0ga2V5KSByZXR1cm4gdmFsdWU7DQogICAgICB9DQogICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yZSBuZWwgcmVjdXBlcm8gZGVpIGRhdGk6IiwgZXJyb3IpOw0KICAgIH0NCiAgICByZXR1cm4gbnVsbDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNsZWFyU3RvcmFnZShrZXkpIHsNCiAgICB0cnkgew0KICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTsNCiAgICAgIGRvY3VtZW50LmNvb2tpZSA9IGAke2tleX09OyBleHBpcmVzPVRodSwgMDEgSmFuIDE5NzAgMDA6MDA6MDAgVVRDOyBwYXRoPS87YDsNCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgY29uc29sZS5lcnJvcigiRXJyb3JlIG5lbGxhIHJpbW96aW9uZSBkZWkgZGF0aToiLCBlcnJvcik7DQogICAgfQ0KICB9DQoNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIC8vIENSSVRUT0dSQUZJQQ0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVIYXNoKHN0cikgew0KICAgIGNvbnN0IGVuY29kZXIgPSBuZXcgVGV4dEVuY29kZXIoKTsNCiAgICBjb25zdCBkYXRhID0gZW5jb2Rlci5lbmNvZGUoc3RyKTsNCiAgICBjb25zdCBoYXNoQnVmZmVyID0gYXdhaXQgY3J5cHRvLnN1YnRsZS5kaWdlc3QoIlNIQS0yNTYiLCBkYXRhKTsNCiAgICBjb25zdCBoYXNoQXJyYXkgPSBBcnJheS5mcm9tKG5ldyBVaW50OEFycmF5KGhhc2hCdWZmZXIpKTsNCiAgICByZXR1cm4gaGFzaEFycmF5Lm1hcCgoYikgPT4gYi50b1N0cmluZygxNikucGFkU3RhcnQoMiwgIjAiKSkuam9pbigiIik7DQogIH0NCg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgLy8gSU1QT1NUQVpJT05JIChGaXJlYmFzZSkNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIGFzeW5jIGZ1bmN0aW9uIGxvYWRTZXR0aW5nc0Zyb21GaXJlYmFzZSgpIHsNCiAgICB0cnkgew0KICAgICAgY29uc3Qgc25hcHNob3QgPSBhd2FpdCBkYXRhYmFzZS5yZWYoInNldHRpbmdzIikub25jZSgidmFsdWUiKTsNCiAgICAgIHJldHVybiBzbmFwc2hvdC5leGlzdHMoKSA/IHNuYXBzaG90LnZhbCgpIDogbnVsbDsNCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgY29uc29sZS5lcnJvcigNCiAgICAgICAgIkVycm9yZSBuZWwgY2FyaWNhbWVudG8gZGVsbGUgaW1wb3N0YXppb25pIGRhIEZpcmViYXNlOiIsDQogICAgICAgIGVycm9yDQogICAgICApOw0KICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gYXBwbHlGaXJlYmFzZVNldHRpbmdzKHNldHRpbmdzKSB7DQogICAgaWYgKHNldHRpbmdzPy5zZWNyZXRfY29kZSkgew0KICAgICAgQ09SUkVDVF9DT0RFID0gc2V0dGluZ3Muc2VjcmV0X2NvZGU7DQogICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgic2VjcmV0X2NvZGUiLCBzZXR0aW5ncy5zZWNyZXRfY29kZSk7DQogICAgfQ0KICAgIGlmIChzZXR0aW5ncz8ubWF4X2NsaWNrcykgew0KICAgICAgTUFYX0NMSUNLUyA9IHBhcnNlSW50KHNldHRpbmdzLm1heF9jbGlja3MsIDEwKTsNCiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJtYXhfY2xpY2tzIiwgc2V0dGluZ3MubWF4X2NsaWNrcyk7DQogICAgfQ0KICAgIGlmIChzZXR0aW5ncz8udGltZV9saW1pdF9taW51dGVzKSB7DQogICAgICBUSU1FX0xJTUlUX01JTlVURVMgPSBwYXJzZUludChzZXR0aW5ncy50aW1lX2xpbWl0X21pbnV0ZXMsIDEwKTsNCiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJ0aW1lX2xpbWl0X21pbnV0ZXMiLCBzZXR0aW5ncy50aW1lX2xpbWl0X21pbnV0ZXMpOw0KICAgIH0NCiAgICBpZiAodHlwZW9mIHNldHRpbmdzPy5jaGVja2luX3N0YXJ0X3RpbWUgPT09ICJzdHJpbmciKQ0KICAgICAgQ0hFQ0tJTl9TVEFSVF9USU1FID0gc2V0dGluZ3MuY2hlY2tpbl9zdGFydF90aW1lOw0KICAgIGlmICh0eXBlb2Ygc2V0dGluZ3M/LmNoZWNraW5fZW5kX3RpbWUgPT09ICJzdHJpbmciKQ0KICAgICAgQ0hFQ0tJTl9FTkRfVElNRSA9IHNldHRpbmdzLmNoZWNraW5fZW5kX3RpbWU7DQogICAgaWYgKHR5cGVvZiBzZXR0aW5ncz8uY2hlY2tpbl90aW1lX2VuYWJsZWQgIT09ICJ1bmRlZmluZWQiKQ0KICAgICAgQ0hFQ0tJTl9USU1FX0VOQUJMRUQgPSBTdHJpbmcoc2V0dGluZ3MuY2hlY2tpbl90aW1lX2VuYWJsZWQpICE9PSAiZmFsc2UiOw0KDQogICAgdXBkYXRlQ2hlY2tpblRpbWVEaXNwbGF5KCk7DQogICAgREVWSUNFUy5mb3JFYWNoKHVwZGF0ZUJ1dHRvblN0YXRlKTsNCiAgICB1cGRhdGVTdGF0dXNCYXIoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNldHVwU2V0dGluZ3NMaXN0ZW5lcigpIHsNCiAgICBpZiAoc2V0dGluZ3NSZWYpIHJldHVybjsgLy8gZXZpdGEgZG9wcGlvIGxpc3RlbmVyDQogICAgc2V0dGluZ3NSZWYgPSBkYXRhYmFzZS5yZWYoInNldHRpbmdzIik7DQogICAgc2V0dGluZ3NSZWYub24oInZhbHVlIiwgKHNuYXApID0+IHsNCiAgICAgIGNvbnN0IHMgPSBzbmFwLnZhbCgpIHx8IHt9Ow0KICAgICAgYXBwbHlGaXJlYmFzZVNldHRpbmdzKHMpOw0KDQogICAgICAvLyBLaWxsLXN3aXRjaDogY2FtYmlvIGNvZGljZSBnbG9iYWxlID0+IGJsb2NjYSBlIGZvcnphIGxvZ291dA0KICAgICAgY29uc3Qgc2VydmVyQ29kZVZlciA9IHBhcnNlSW50KHMuY29kZV92ZXJzaW9uIHx8IDEsIDEwKTsNCiAgICAgIGNvbnN0IGxvY2FsQ29kZVZlciA9IHBhcnNlSW50KA0KICAgICAgICBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShDT0RFX1ZFUlNJT05fS0VZKSB8fCAiMSIsDQogICAgICAgIDEwDQogICAgICApOw0KICAgICAgaWYgKHNlcnZlckNvZGVWZXIgPiBsb2NhbENvZGVWZXIpIHsNCiAgICAgICAgY29uc3QgaGFkTG9jYWxWZXJzaW9uID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oQ09ERV9WRVJTSU9OX0tFWSkgIT09IG51bGw7DQogICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKENPREVfVkVSU0lPTl9LRVksIFN0cmluZyhzZXJ2ZXJDb2RlVmVyKSk7DQogICAgICAgIGNvbnN0IG1zZyA9IHMuZ2xvYmFsX2Jsb2NrX21lc3NhZ2UgfHwgJ0NvZGUgdXBkYXRlZDogdGhlIGxpbmsgaXMgbm8gbG9uZ2VyIHZhbGlkJzsNCiAgICAgICAgaWYgKGhhZExvY2FsVmVyc2lvbikgeyAvLyBvbGQgZGV2aWNlOiBrZWVwIG92ZXJsYXkgb24gbWFpbiBwYWdlDQogICAgICAgICAgYmxvY2tBY2Nlc3MobXNnKTsNCiAgICAgICAgICBzaG93U2Vzc2lvblNjYWR1dGEoKTsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgaWYgKGhhc1Rva2VuRm9vdHByaW50KCkpIHsgLy8gdG9rZW4gZm9vdHByaW50OiBsb2dvdXQgdG9rZW4gc2Vzc2lvbg0KICAgICAgICAgIGZvcmNlTG9nb3V0RnJvbVRva2VuKG1zZyk7DQogICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIC8vIG5ldyBkZXZpY2U6IG5vIGJsb2NrDQogICAgICAgIHVuYmxvY2tBY2Nlc3MoKTsNCiAgICAgICAgcXMoJ2V4cGlyZWRPdmVybGF5Jyk/LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOw0KICAgICAgICBxcygnc2Vzc2lvbkV4cGlyZWQnKT8uY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7DQogICAgICAgIHFzKCdjb250cm9sUGFuZWwnKT8uY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7DQogICAgICAgIHJlc2V0U2Vzc2lvbkZvck5ld0NvZGUoKTsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KDQogICAgICAvLyBSaXByaXN0aW5vIGdsb2JhbGU6IHNibG9jY2EgZSB0b3JuYSBhbCBsb2dpbg0KICAgICAgY29uc3Qgc2VydmVyVW5ibG9ja1ZlciA9IHBhcnNlSW50KHMuc2Vzc2lvbl9yZXNldF92ZXJzaW9uIHx8IDAsIDEwKTsNCiAgICAgIGNvbnN0IGxvY2FsVW5ibG9ja1ZlciA9IHBhcnNlSW50KA0KICAgICAgICBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShVTkJMT0NLX1ZFUlNJT05fS0VZKSB8fCAiMCIsDQogICAgICAgIDEwDQogICAgICApOw0KICAgICAgaWYgKHNlcnZlclVuYmxvY2tWZXIgPiBsb2NhbFVuYmxvY2tWZXIpIHsNCiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oVU5CTE9DS19WRVJTSU9OX0tFWSwgU3RyaW5nKHNlcnZlclVuYmxvY2tWZXIpKTsNCiAgICAgICAgdW5ibG9ja0FjY2VzcygpOw0KICAgICAgICBxcygiU2NhZHV0YU92ZXJsYXkiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7DQogICAgICAgIHFzKCJzZXNzaW9uU2NhZHV0YSIpPy5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsNCiAgICAgICAgcXMoImNvbnRyb2xQYW5lbCIpPy5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsNCiAgICAgICAgc2hvd0F1dGhGb3JtKCk7DQogICAgICAgIHVwZGF0ZURvb3JWaXNpYmlsaXR5KCk7DQogICAgICAgIHNob3dOb3RpZmljYXRpb24oDQogICAgICAgICAgcy5nbG9iYWxfdW5ibG9ja19tZXNzYWdlIHx8DQogICAgICAgICAgICAiU2Vzc2lvbmUgcmlwcmlzdGluYXRhLiBJbnNlcmlzY2kgaWwgY29kaWNlIHBlciBhY2NlZGVyZS4iDQogICAgICAgICk7DQogICAgICB9DQogICAgfSk7DQogIH0NCg0KICBmdW5jdGlvbiBtb25pdG9yRmlyZWJhc2VDb25uZWN0aW9uKCkgew0KICAgIGNvbnN0IGNvbm5lY3RlZFJlZiA9IGRhdGFiYXNlLnJlZigiLmluZm8vY29ubmVjdGVkIik7DQogICAgY29ubmVjdGVkUmVmLm9uKCJ2YWx1ZSIsIChzbmFwKSA9PiB7DQogICAgICBpZiAoc25hcC52YWwoKSA9PT0gdHJ1ZSkgew0KICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoImZpcmViYXNlLW9mZmxpbmUiKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgiZmlyZWJhc2Utb2ZmbGluZSIpOw0KICAgICAgICBzaG93Tm90aWZpY2F0aW9uKA0KICAgICAgICAgICJDb25uZXNzaW9uZSBhIEZpcmViYXNlIHBlcnNhLiBMZSBtb2RpZmljaGUgcG90cmViYmVybyBub24gZXNzZXJlIHNpbmNyb25penphdGUuIiwNCiAgICAgICAgICAid2FybmluZyINCiAgICAgICAgKTsNCiAgICAgIH0NCiAgICB9KTsNCiAgfQ0KDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICAvLyBURU1QTy9TRVNTSU9ORQ0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgYXN5bmMgZnVuY3Rpb24gc2V0VXNhZ2VTdGFydFRpbWUoKSB7DQogICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKS50b1N0cmluZygpOw0KICAgIGNvbnN0IGhhc2ggPSBhd2FpdCBnZW5lcmF0ZUhhc2gobm93ICsgU0VDUkVUX0tFWSk7DQogICAgc2V0U3RvcmFnZSgidXNhZ2Vfc3RhcnRfdGltZSIsIG5vdywgVElNRV9MSU1JVF9NSU5VVEVTKTsNCiAgICBzZXRTdG9yYWdlKCJ1c2FnZV9oYXNoIiwgaGFzaCwgVElNRV9MSU1JVF9NSU5VVEVTKTsNCiAgICB1cGRhdGVTdGF0dXNCYXIoKTsNCiAgfQ0KDQogIGFzeW5jIGZ1bmN0aW9uIHNldExvZ2luU3RhcnRUaW1lKCkgew0KICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCkudG9TdHJpbmcoKTsNCiAgICBjb25zdCBoYXNoID0gYXdhaXQgZ2VuZXJhdGVIYXNoKG5vdyArIFNFQ1JFVF9LRVkpOw0KICAgIHNldFN0b3JhZ2UoImxvZ2luX3N0YXJ0X3RpbWUiLCBub3csIFBSRV9VU0VfTElNSVRfTUlOVVRFUyk7DQogICAgc2V0U3RvcmFnZSgibG9naW5faGFzaCIsIGhhc2gsIFBSRV9VU0VfTElNSVRfTUlOVVRFUyk7DQogICAgdXBkYXRlU3RhdHVzQmFyKCk7DQogIH0NCg0KICBhc3luYyBmdW5jdGlvbiBzZXRUb2tlblVzYWdlU3RhcnRUaW1lKHRva2VuSWQpIHsNCiAgICBpZiAoIXRva2VuSWQpIHJldHVybjsNCiAgICBjb25zdCBrZXlUID0gYHRva2VuX3RzXyR7dG9rZW5JZH1gOw0KICAgIGNvbnN0IGtleUggPSBgdG9rZW5fdGhfJHt0b2tlbklkfWA7DQogICAgdHJ5IHsNCiAgICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXlUKSkgcmV0dXJuOyAvLyBub24gc292cmFzY3JpdmVyZSBzZSBnacODxpLDgsKgIGF2dmlhdG8NCiAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCkudG9TdHJpbmcoKTsNCiAgICAgIGNvbnN0IGhhc2ggPSBhd2FpdCBnZW5lcmF0ZUhhc2gobm93ICsgU0VDUkVUX0tFWSArIHRva2VuSWQpOw0KICAgICAgc2V0U3RvcmFnZShrZXlULCBub3csIFRPS0VOX0xJTUlUX01JTlVURVMpOw0KICAgICAgc2V0U3RvcmFnZShrZXlILCBoYXNoLCBUT0tFTl9MSU1JVF9NSU5VVEVTKTsNCiAgICB9IGNhdGNoIHt9DQogIH0NCg0KICBmdW5jdGlvbiBjbGVhclRva2VuVXNhZ2VTdGFydCh0b2tlbklkKSB7DQogICAgaWYgKCF0b2tlbklkKSByZXR1cm47DQogICAgdHJ5IHsNCiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGB0b2tlbl90c18ke3Rva2VuSWR9YCk7DQogICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShgdG9rZW5fdGhfJHt0b2tlbklkfWApOw0KICAgIH0gY2F0Y2gge30NCiAgfQ0KDQogIGFzeW5jIGZ1bmN0aW9uIGNoZWNrVGltZUxpbWl0KCkgew0KICAgIC8vIFRpbWVyIGFuY2hlIHBlciBzZXNzaW9uaSB0b2tlbiBkb3BvIHN1Ym1pdA0KICAgIGlmIChpc1Rva2VuU2Vzc2lvbikgew0KICAgICAgY29uc3QgdCA9DQogICAgICAgIGN1cnJlbnRUb2tlbklkIHx8IG5ldyBVUkxTZWFyY2hQYXJhbXMobG9jYXRpb24uc2VhcmNoKS5nZXQoInRva2VuIik7DQogICAgICBpZiAoIXQpIHJldHVybiBmYWxzZTsNCiAgICAgIGNvbnN0IGtleVQgPSBgdG9rZW5fdHNfJHt0fWA7DQogICAgICBjb25zdCBrZXlIID0gYHRva2VuX3RoXyR7dH1gOw0KICAgICAgY29uc3QgdHMgPSBnZXRTdG9yYWdlKGtleVQpOw0KICAgICAgY29uc3QgaHMgPSBnZXRTdG9yYWdlKGtleUgpOw0KICAgICAgaWYgKHRzICYmIGhzKSB7DQogICAgICAgIGNvbnN0IGNhbGMgPSBhd2FpdCBnZW5lcmF0ZUhhc2godHMgKyBTRUNSRVRfS0VZICsgdCk7DQogICAgICAgIGlmIChjYWxjICE9PSBocykgew0KICAgICAgICAgIC8vIGhhc2ggbWlzbWF0Y2ggPT4gY29uc2lkZXJhIHNjYWR1dGENCiAgICAgICAgICBjbGVhclRva2VuVXNhZ2VTdGFydCh0KTsNCiAgICAgICAgICB0cnkgeyBmb3JjZUxvZ291dEZyb21Ub2tlbigiU2Vzc2lvbmUgdG9rZW4gbm9uIHZhbGlkYSIpOyB9IGNhdGNoIHt9DQogICAgICAgICAgLy8gTmFzY29uZGkgcGFubmVsbG8gZSBtb3N0cmEgb3ZlcmxheQ0KICAgICAgICAgIHFzKCJjb250cm9sUGFuZWwiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7DQogICAgICAgICAgcXMoIlNjYWR1dGFPdmVybGF5Iik/LmNsYXNzTGlzdC5yZW1vdmUoImhpZGRlbiIpOw0KICAgICAgICAgIHFzKCJzZXNzaW9uU2NhZHV0YSIpPy5jbGFzc0xpc3QucmVtb3ZlKCJoaWRkZW4iKTsNCiAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBtaW5zID0gKERhdGUubm93KCkgLSBwYXJzZUludCh0cywgMTApKSAvICgxMDAwICogNjApOw0KICAgICAgICBpZiAobWlucyA+PSBUT0tFTl9MSU1JVF9NSU5VVEVTKSB7DQogICAgICAgICAgY2xlYXJUb2tlblVzYWdlU3RhcnQodCk7DQogICAgICAgICAgdHJ5IHsgZm9yY2VMb2dvdXRGcm9tVG9rZW4oIlNlc3Npb25lIHRva2VuIHNjYWR1dGEiKTsgfSBjYXRjaCB7fQ0KICAgICAgICAgIHFzKCJjb250cm9sUGFuZWwiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7DQogICAgICAgICAgcXMoIlNjYWR1dGFPdmVybGF5Iik/LmNsYXNzTGlzdC5yZW1vdmUoImhpZGRlbiIpOw0KICAgICAgICAgIHFzKCJzZXNzaW9uU2NhZHV0YSIpPy5jbGFzc0xpc3QucmVtb3ZlKCJoaWRkZW4iKTsNCiAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIGlmICghc2Vzc2lvblN0YXJ0VGltZSkgcmV0dXJuIGZhbHNlOw0KDQogICAgY29uc3Qgc3RhcnRUaW1lID0gZ2V0U3RvcmFnZSgidXNhZ2Vfc3RhcnRfdGltZSIpOw0KICAgIGNvbnN0IHN0b3JlZEhhc2ggPSBnZXRTdG9yYWdlKCJ1c2FnZV9oYXNoIik7DQogICAgaWYgKCFzdGFydFRpbWUgfHwgIXN0b3JlZEhhc2gpIHJldHVybiBmYWxzZTsNCg0KICAgIGNvbnN0IGNhbGNIYXNoID0gYXdhaXQgZ2VuZXJhdGVIYXNoKHN0YXJ0VGltZSArIFNFQ1JFVF9LRVkpOw0KICAgIGlmIChjYWxjSGFzaCAhPT0gc3RvcmVkSGFzaCkgew0KICAgICAgc2hvd0ZhdGFsRXJyb3IoIlZpb2xhemlvbmUgZGkgc2ljdXJlenphIHJpbGV2YXRhISIpOw0KICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTsNCiAgICBjb25zdCBtaW51dGVzUGFzc2VkID0gKG5vdyAtIHBhcnNlSW50KHN0YXJ0VGltZSwgMTApKSAvICgxMDAwICogNjApOw0KICAgIGlmIChtaW51dGVzUGFzc2VkID49IFRJTUVfTElNSVRfTUlOVVRFUykgew0KICAgICAgc2hvd1Nlc3Npb25TY2FkdXRhKCk7DQogICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICB1cGRhdGVTdGF0dXNCYXIoKTsNCiAgICByZXR1cm4gZmFsc2U7DQogIH0NCg0KICBmdW5jdGlvbiBzaG93RmF0YWxFcnJvcihtZXNzYWdlKSB7DQogICAgaWYgKHRpbWVDaGVja0ludGVydmFsKSBjbGVhckludGVydmFsKHRpbWVDaGVja0ludGVydmFsKTsNCiAgICBpZiAoY29kZUNoZWNrSW50ZXJ2YWwpIGNsZWFySW50ZXJ2YWwoY29kZUNoZWNrSW50ZXJ2YWwpOw0KICAgIGRvY3VtZW50LmJvZHkuaW5uZXJIVE1MID0gYA0KICAgICAgPGRpdiBzdHlsZT0icG9zaXRpb246Zml4ZWQ7aW5zZXQ6MDtkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OmNlbnRlcjthbGlnbi1pdGVtczpjZW50ZXI7YmFja2dyb3VuZDojMTIxMTExO2NvbG9yOiNmZjZiNmI7Zm9udC1zaXplOjI0cHg7dGV4dC1hbGlnbjpjZW50ZXI7cGFkZGluZzoyMHB4O3otaW5kZXg6OTk5OTsiPg0KICAgICAgICAke21lc3NhZ2V9DQogICAgICA8L2Rpdj5gOw0KICB9DQoNCiAgZnVuY3Rpb24gc2hvd1Nlc3Npb25TY2FkdXRhKCkgew0KICAgIGlmIChpc1Rva2VuU2Vzc2lvbikgcmV0dXJuOyAvLyBvdmVybGF5IHNvbG8gcGVyIHNlc3Npb25pIG1hbnVhbGkNCiAgICBpZiAodGltZUNoZWNrSW50ZXJ2YWwpIGNsZWFySW50ZXJ2YWwodGltZUNoZWNrSW50ZXJ2YWwpOw0KICAgIGlmIChjb2RlQ2hlY2tJbnRlcnZhbCkgY2xlYXJJbnRlcnZhbChjb2RlQ2hlY2tJbnRlcnZhbCk7DQoNCiAgICBxcygiU2NhZHV0YU92ZXJsYXkiKT8uY2xhc3NMaXN0LnJlbW92ZSgiaGlkZGVuIik7DQogICAgcXMoImNvbnRyb2xQYW5lbCIpPy5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsNCiAgICBxcygic2Vzc2lvblNjYWR1dGEiKT8uY2xhc3NMaXN0LnJlbW92ZSgiaGlkZGVuIik7DQogICAgcXMoInRlc3QyIikgJiYgKHFzKCJ0ZXN0MiIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSIpOw0KDQogICAgREVWSUNFUy5mb3JFYWNoKChkZXZpY2UpID0+IHsNCiAgICAgIGNvbnN0IGJ0biA9IHFzKGRldmljZS5idXR0b25faWQpOw0KICAgICAgaWYgKGJ0bikgew0KICAgICAgICBidG4uZGlzYWJsZWQgPSB0cnVlOw0KICAgICAgICBidG4uY2xhc3NMaXN0LmFkZCgiYnRuLWVycm9yIik7DQogICAgICB9DQogICAgfSk7DQoNCiAgICBjb25zdCBzZWN1cml0eVN0YXR1cyA9IHFzKCJzZWN1cml0eVN0YXR1cyIpOw0KICAgIGlmIChzZWN1cml0eVN0YXR1cykgew0KICAgICAgc2VjdXJpdHlTdGF0dXMudGV4dENvbnRlbnQgPSAiU2NhZHV0YSI7DQogICAgICBzZWN1cml0eVN0YXR1cy5zdHlsZS5jb2xvciA9ICJ2YXIoLS1lcnJvcikiOw0KICAgIH0NCg0KICAgIHNlc3Npb25TdGFydFRpbWUgPSBudWxsOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNTZXNzaW9uU3R1Y2soKSB7DQogICAgdHJ5IHsNCiAgICAgIGNvbnN0IGF1dGhWZXJpZmllZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJhdXRoX3ZlcmlmaWVkIik7DQogICAgICBjb25zdCBhdXRoVGltZXN0YW1wID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oImF1dGhfdGltZXN0YW1wIik7DQogICAgICBjb25zdCB1c2FnZVN0YXJ0VGltZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJ1c2FnZV9zdGFydF90aW1lIik7DQoNCiAgICAgIGlmIChhdXRoVmVyaWZpZWQgPT09ICJ0cnVlIiAmJiBhdXRoVGltZXN0YW1wKSB7DQogICAgICAgIGNvbnN0IGF1dGhUaW1lID0gcGFyc2VJbnQoYXV0aFRpbWVzdGFtcCwgMTApOw0KICAgICAgICBpZiAoRGF0ZS5ub3coKSAtIGF1dGhUaW1lID4gMjQgKiA2MCAqIDYwICogMTAwMCkgcmV0dXJuIHRydWU7DQogICAgICB9DQogICAgICBpZiAodXNhZ2VTdGFydFRpbWUpIHsNCiAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcGFyc2VJbnQodXNhZ2VTdGFydFRpbWUsIDEwKTsNCiAgICAgICAgY29uc3QgbWludXRlc1Bhc3NlZCA9IChEYXRlLm5vdygpIC0gc3RhcnRUaW1lKSAvICgxMDAwICogNjApOw0KICAgICAgICBpZiAobWludXRlc1Bhc3NlZCA+IFRJTUVfTElNSVRfTUlOVVRFUyArIDYwKSByZXR1cm4gdHJ1ZTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9IGNhdGNoIChlKSB7DQogICAgICBjb25zb2xlLmVycm9yKCJFcnJvcmUgbmVsIGNvbnRyb2xsbyBzZXNzaW9uZSBibG9jY2F0YToiLCBlKTsNCiAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogIH0NCg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgLy8gQ0hFQ0vDg8Kiw6LigJrCrMOi4oKsy5xJTiBUSU1FDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICBmdW5jdGlvbiBpc0NoZWNraW5UaW1lKCkgew0KICAgIGlmICghQ0hFQ0tJTl9USU1FX0VOQUJMRUQpIHJldHVybiB0cnVlOw0KDQogICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTsNCiAgICBjb25zdCBjdXJyZW50ID0gbm93LmdldEhvdXJzKCkgKiA2MCArIG5vdy5nZXRNaW51dGVzKCk7DQogICAgY29uc3QgW3NoLCBzbV0gPSBDSEVDS0lOX1NUQVJUX1RJTUUuc3BsaXQoIjoiKS5tYXAoTnVtYmVyKTsNCiAgICBjb25zdCBbZWgsIGVtXSA9IENIRUNLSU5fRU5EX1RJTUUuc3BsaXQoIjoiKS5tYXAoTnVtYmVyKTsNCiAgICBjb25zdCBzdGFydCA9IHNoICogNjAgKyBzbTsNCiAgICBjb25zdCBlbmQgPSBlaCAqIDYwICsgZW07DQogICAgcmV0dXJuIGN1cnJlbnQgPj0gc3RhcnQgJiYgY3VycmVudCA8PSBlbmQ7DQogIH0NCg0KICBmdW5jdGlvbiB1cGRhdGVDaGVja2luVGltZURpc3BsYXkoKSB7DQogICAgY29uc3Qgc3RhcnRFbCA9IHFzKCJjaGVja2luU3RhcnREaXNwbGF5Iik7DQogICAgY29uc3QgZW5kRWwgPSBxcygiY2hlY2tpbkVuZERpc3BsYXkiKTsNCiAgICBjb25zdCBzdGFydFBvcHVwID0gcXMoImNoZWNraW5TdGFydFBvcHVwIik7DQogICAgY29uc3QgZW5kUG9wdXAgPSBxcygiY2hlY2tpbkVuZFBvcHVwIik7DQogICAgY29uc3QgY3VycmVudFN0YXJ0ID0gcXMoImN1cnJlbnRDaGVja2luU3RhcnRUaW1lIik7DQogICAgY29uc3QgY3VycmVudEVuZCA9IHFzKCJjdXJyZW50Q2hlY2tpbkVuZFRpbWUiKTsNCiAgICBpZiAoc3RhcnRFbCkgc3RhcnRFbC50ZXh0Q29udGVudCA9IGZvcm1hdFRpbWUoQ0hFQ0tJTl9TVEFSVF9USU1FKTsNCiAgICBpZiAoZW5kRWwpIGVuZEVsLnRleHRDb250ZW50ID0gZm9ybWF0VGltZShDSEVDS0lOX0VORF9USU1FKTsNCiAgICBpZiAoc3RhcnRQb3B1cCkgc3RhcnRQb3B1cC50ZXh0Q29udGVudCA9IGZvcm1hdFRpbWUoQ0hFQ0tJTl9TVEFSVF9USU1FKTsNCiAgICBpZiAoZW5kUG9wdXApIGVuZFBvcHVwLnRleHRDb250ZW50ID0gZm9ybWF0VGltZShDSEVDS0lOX0VORF9USU1FKTsNCiAgICBpZiAoY3VycmVudFN0YXJ0KSBjdXJyZW50U3RhcnQudGV4dENvbnRlbnQgPSBmb3JtYXRUaW1lKENIRUNLSU5fU1RBUlRfVElNRSk7DQogICAgaWYgKGN1cnJlbnRFbmQpIGN1cnJlbnRFbmQudGV4dENvbnRlbnQgPSBmb3JtYXRUaW1lKENIRUNLSU5fRU5EX1RJTUUpOw0KDQogICAgY29uc3Qgc3RhdHVzRWxlbWVudCA9IHFzKCJjdXJyZW50VGltZVN0YXR1cyIpOw0KICAgIGlmICghc3RhdHVzRWxlbWVudCkgcmV0dXJuOw0KDQogICAgaWYgKCFDSEVDS0lOX1RJTUVfRU5BQkxFRCkgew0KICAgICAgc3RhdHVzRWxlbWVudC5pbm5lckhUTUwgPQ0KICAgICAgICAnPGkgY2xhc3M9ImZhcyBmYS1wb3dlci1vZmYiIHN0eWxlPSJjb2xvcjpvcmFuZ2U7Ij48L2k+IFRpbWUgY29udHJvbCBkaXNhYmxlZDogY2hlY2staW4gYWxsb3dlZCBhdCBhbnkgdGltZSc7DQogICAgICByZXR1cm47DQogICAgfQ0KDQogICAgaWYgKGlzQ2hlY2tpblRpbWUoKSkgew0KICAgICAgc3RhdHVzRWxlbWVudC5pbm5lckhUTUwgPQ0KICAgICAgICAnPGkgY2xhc3M9ImZhcyBmYS1jaGVjay1jaXJjbGUiIHN0eWxlPSJjb2xvcjpncmVlbjsiPjwvaT4gQ2hlY2staW4gbm93IGF2YWlsYWJsZSc7DQogICAgICByZXR1cm47DQogICAgfQ0KDQogICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTsNCiAgICBjb25zdCBjdXJyZW50ID0gbm93LmdldEhvdXJzKCkgKiA2MCArIG5vdy5nZXRNaW51dGVzKCk7DQogICAgY29uc3QgW3NoLCBzbV0gPSBDSEVDS0lOX1NUQVJUX1RJTUUuc3BsaXQoIjoiKS5tYXAoTnVtYmVyKTsNCiAgICBjb25zdCBbZWgsIGVtXSA9IENIRUNLSU5fRU5EX1RJTUUuc3BsaXQoIjoiKS5tYXAoTnVtYmVyKTsNCiAgICBjb25zdCBzdGFydCA9IHNoICogNjAgKyBzbTsNCiAgICBjb25zdCBlbmQgPSBlaCAqIDYwICsgZW07DQoNCiAgICBpZiAoY3VycmVudCA8IHN0YXJ0KSB7DQogICAgICBjb25zdCBkaWZmID0gc3RhcnQgLSBjdXJyZW50Ow0KICAgICAgY29uc3QgaCA9IE1hdGguZmxvb3IoZGlmZiAvIDYwKTsNCiAgICAgIGNvbnN0IG0gPSBkaWZmICUgNjA7DQogICAgICBzdGF0dXNFbGVtZW50LmlubmVySFRNTCA9IGA8aSBjbGFzcz0iZmFzIGZhLWNsb2NrIiBzdHlsZT0iY29sb3I6b3JhbmdlOyI+PC9pPiBDaGVjay1pbiB3aWxsIGJlIGF2YWlsYWJsZSBpbiAke2h9aCAke219bWA7DQogICAgfSBlbHNlIHsNCiAgICAgIGNvbnN0IHRvbW9ycm93ID0gbmV3IERhdGUobm93KTsNCiAgICAgIHRvbW9ycm93LnNldERhdGUodG9tb3Jyb3cuZ2V0RGF0ZSgpICsgMSk7DQogICAgICB0b21vcnJvdy5zZXRIb3VycyhzaCwgc20sIDAsIDApOw0KICAgICAgY29uc3QgZGlmZiA9IHRvbW9ycm93IC0gbm93Ow0KICAgICAgY29uc3QgaCA9IE1hdGguZmxvb3IoZGlmZiAvICgxMDAwICogNjAgKiA2MCkpOw0KICAgICAgY29uc3QgbSA9IE1hdGguZmxvb3IoKGRpZmYgJSAoMTAwMCAqIDYwICogNjApKSAvICgxMDAwICogNjApKTsNCiAgICAgIHN0YXR1c0VsZW1lbnQuaW5uZXJIVE1MID0gYDxpIGNsYXNzPSJmYXMgZmEtY2xvY2siIHN0eWxlPSJjb2xvcjpvcmFuZ2U7Ij48L2k+IENoZWNrLWluIHdpbGwgYmUgYXZhaWxhYmxlIHRvbW9ycm93IGluICR7aH1oICR7bX1tYDsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBzaG93RWFybHlDaGVja2luUG9wdXAoKSB7DQogICAgY29uc3QgZWwgPSBxcygiZWFybHlDaGVja2luUG9wdXAiKTsNCiAgICBpZiAoZWwpIGVsLnN0eWxlLmRpc3BsYXkgPSAiZmxleCI7DQogIH0NCiAgZnVuY3Rpb24gY2xvc2VFYXJseUNoZWNraW5Qb3B1cCgpIHsNCiAgICBjb25zdCBlbCA9IHFzKCJlYXJseUNoZWNraW5Qb3B1cCIpOw0KICAgIGlmIChlbCkgZWwuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCiAgfQ0KDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICAvLyBJTlRFUkZBQ0NJQS9TVEFUTw0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgZnVuY3Rpb24gdXBkYXRlU3RhdHVzQmFyKCkgew0KICAgIGNvbnN0IG1haW5Eb29yQ291bnRlciA9IHFzKCJtYWluRG9vckNvdW50ZXIiKTsNCiAgICBjb25zdCBhcHREb29yQ291bnRlciA9IHFzKCJhcHREb29yQ291bnRlciIpOw0KICAgIGNvbnN0IHRpbWVSZW1haW5pbmcgPSBxcygidGltZVJlbWFpbmluZyIpOw0KDQogICAgaWYgKG1haW5Eb29yQ291bnRlcikgew0KICAgICAgbWFpbkRvb3JDb3VudGVyLnRleHRDb250ZW50ID0gYCR7Z2V0Q2xpY2tzTGVmdCgNCiAgICAgICAgREVWSUNFU1swXS5zdG9yYWdlX2tleQ0KICAgICAgKX0gY2xpY2sgbGVmdGA7DQogICAgfQ0KICAgIGlmIChhcHREb29yQ291bnRlcikgew0KICAgICAgYXB0RG9vckNvdW50ZXIudGV4dENvbnRlbnQgPSBgJHtnZXRDbGlja3NMZWZ0KA0KICAgICAgICBERVZJQ0VTWzFdLnN0b3JhZ2Vfa2V5DQogICAgICApfSBjbGljayBsZWZ0YDsNCiAgICB9DQoNCiAgICBpZiAoIXNlc3Npb25TdGFydFRpbWUgfHwgIXRpbWVSZW1haW5pbmcpIHsNCiAgICAgIGlmICh0aW1lUmVtYWluaW5nKSB7DQogICAgICAgIGNvbnN0IG1pbnV0ZXMgPSBNYXRoLmZsb29yKFRJTUVfTElNSVRfTUlOVVRFUyk7DQogICAgICAgIGNvbnN0IHNlY29uZHMgPSBNYXRoLmZsb29yKChUSU1FX0xJTUlUX01JTlVURVMgJSAxKSAqIDYwKTsNCiAgICAgICAgdGltZVJlbWFpbmluZy50ZXh0Q29udGVudCA9IGAke1N0cmluZyhtaW51dGVzKS5wYWRTdGFydCgNCiAgICAgICAgICAyLA0KICAgICAgICAgICIwIg0KICAgICAgICApfToke1N0cmluZyhzZWNvbmRzKS5wYWRTdGFydCgyLCAiMCIpfWA7DQogICAgICAgIHRpbWVSZW1haW5pbmcuc3R5bGUuY29sb3IgPSAidmFyKC0tcHJpbWFyeSkiOw0KICAgICAgfQ0KICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIGNvbnN0IHN0YXJ0VGltZSA9IGdldFN0b3JhZ2UoInVzYWdlX3N0YXJ0X3RpbWUiKTsNCiAgICBpZiAoIXN0YXJ0VGltZSkgcmV0dXJuOw0KDQogICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTsNCiAgICBjb25zdCBtaW51dGVzUGFzc2VkID0gKG5vdyAtIHBhcnNlSW50KHN0YXJ0VGltZSwgMTApKSAvICgxMDAwICogNjApOw0KICAgIGNvbnN0IG1pbnV0ZXNMZWZ0ID0gTWF0aC5tYXgoDQogICAgICAwLA0KICAgICAgTWF0aC5mbG9vcihUSU1FX0xJTUlUX01JTlVURVMgLSBtaW51dGVzUGFzc2VkKQ0KICAgICk7DQogICAgY29uc3Qgc2Vjb25kc0xlZnQgPSBNYXRoLm1heCgwLCBNYXRoLmZsb29yKDYwIC0gKG1pbnV0ZXNQYXNzZWQgJSAxKSAqIDYwKSk7DQoNCiAgICB0aW1lUmVtYWluaW5nLnRleHRDb250ZW50ID0gYCR7U3RyaW5nKG1pbnV0ZXNMZWZ0KS5wYWRTdGFydCgNCiAgICAgIDIsDQogICAgICAiMCINCiAgICApfToke1N0cmluZyhzZWNvbmRzTGVmdCkucGFkU3RhcnQoMiwgIjAiKX1gOw0KICAgIGlmIChtaW51dGVzTGVmdCA8IDEpIHRpbWVSZW1haW5pbmcuc3R5bGUuY29sb3IgPSAidmFyKC0tZXJyb3IpIjsNCiAgICBlbHNlIGlmIChtaW51dGVzTGVmdCA8IDUpIHRpbWVSZW1haW5pbmcuc3R5bGUuY29sb3IgPSAidmFyKC0td2FybmluZykiOw0KICAgIGVsc2UgdGltZVJlbWFpbmluZy5zdHlsZS5jb2xvciA9ICJ2YXIoLS1wcmltYXJ5KSI7DQogIH0NCg0KICBmdW5jdGlvbiBnZXRDbGlja3NMZWZ0KGtleSkgew0KICAgIGNvbnN0IHN0b3JlZCA9IGdldFN0b3JhZ2Uoa2V5KTsNCiAgICByZXR1cm4gc3RvcmVkID09PSBudWxsID8gTUFYX0NMSUNLUyA6IHBhcnNlSW50KHN0b3JlZCwgMTApOw0KICB9DQoNCiAgZnVuY3Rpb24gc2V0Q2xpY2tzTGVmdChrZXksIGNvdW50KSB7DQogICAgc2V0U3RvcmFnZShrZXksIFN0cmluZyhjb3VudCksIFRJTUVfTElNSVRfTUlOVVRFUyk7DQogICAgdXBkYXRlU3RhdHVzQmFyKCk7DQogIH0NCg0KICBmdW5jdGlvbiB1cGRhdGVCdXR0b25TdGF0ZShkZXZpY2UpIHsNCiAgICBjb25zdCBidG4gPSBxcyhkZXZpY2UuYnV0dG9uX2lkKTsNCiAgICBpZiAoIWJ0bikgcmV0dXJuOw0KICAgIGNvbnN0IGNsaWNrc0xlZnQgPSBnZXRDbGlja3NMZWZ0KGRldmljZS5zdG9yYWdlX2tleSk7DQogICAgYnRuLmRpc2FibGVkID0gY2xpY2tzTGVmdCA8PSAwIHx8ICFpc0NoZWNraW5UaW1lKCk7DQogICAgaWYgKGNsaWNrc0xlZnQgPD0gMCkgew0KICAgICAgYnRuLmNsYXNzTGlzdC5hZGQoImJ0bi1lcnJvciIpOw0KICAgICAgYnRuLmNsYXNzTGlzdC5yZW1vdmUoImJ0bi1zdWNjZXNzIik7DQogICAgfSBlbHNlIGlmICghaXNDaGVja2luVGltZSgpKSB7DQogICAgICBidG4uY2xhc3NMaXN0LnJlbW92ZSgiYnRuLWVycm9yIiwgImJ0bi1zdWNjZXNzIik7DQogICAgfSBlbHNlIHsNCiAgICAgIGJ0bi5jbGFzc0xpc3QuYWRkKCJidG4tc3VjY2VzcyIpOw0KICAgICAgYnRuLmNsYXNzTGlzdC5yZW1vdmUoImJ0bi1lcnJvciIpOw0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIHVwZGF0ZURvb3JWaXNpYmlsaXR5KCkgew0KICAgIERFVklDRVMuZm9yRWFjaCgoZGV2aWNlKSA9PiB7DQogICAgICBjb25zdCBjb250YWluZXIgPSBxcyhgJHtkZXZpY2UuYnV0dG9uX2lkfUNvbnRhaW5lcmApOw0KICAgICAgaWYgKGNvbnRhaW5lcikNCiAgICAgICAgY29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSBkZXZpY2UudmlzaWJsZSA/ICJibG9jayIgOiAibm9uZSI7DQogICAgfSk7DQogIH0NCg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgLy8gQ0FNQklBTUVOVE8gQ09ESUNFDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICBmdW5jdGlvbiBzZXR1cENvZGVDaGFuZ2VMaXN0ZW5lcigpIHsNCiAgICBpZiAoY29kZUNoZWNrSW50ZXJ2YWwpIGNsZWFySW50ZXJ2YWwoY29kZUNoZWNrSW50ZXJ2YWwpOw0KICAgIGlmIChMSU5LX0NIRUNLX0lOVEVSVkFMKSBjbGVhckludGVydmFsKExJTktfQ0hFQ0tfSU5URVJWQUwpOw0KDQogICAgY29kZUNoZWNrSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChjaGVja0NvZGVWZXJzaW9uLCAyMDAwKTsNCiAgICBMSU5LX0NIRUNLX0lOVEVSVkFMID0gc2V0SW50ZXJ2YWwoY2hlY2tTY2FkdXRhTGlua3MsIDYwMDAwKTsNCg0KICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJzdG9yYWdlIiwgKGUpID0+IHsNCiAgICAgIGlmIChlLmtleSA9PT0gImNvZGVfdmVyc2lvbiIgfHwgZS5rZXkgPT09ICJsYXN0X2NvZGVfdXBkYXRlIikgew0KICAgICAgICBjaGVja0NvZGVWZXJzaW9uKCk7DQogICAgICB9DQogICAgfSk7DQogIH0NCg0KICBmdW5jdGlvbiBjaGVja0NvZGVWZXJzaW9uKCkgew0KICAgIGRhdGFiYXNlDQogICAgICAucmVmKCJzZXR0aW5ncy9jb2RlX3ZlcnNpb24iKQ0KICAgICAgLm9uY2UoInZhbHVlIikNCiAgICAgIC50aGVuKChzbmFwKSA9PiB7DQogICAgICAgIGlmIChzbmFwLmV4aXN0cygpKSB7DQogICAgICAgICAgY29uc3QgZmlyZWJhc2VWZXJzaW9uID0gcGFyc2VJbnQoc25hcC52YWwoKSk7DQogICAgICAgICAgY29uc3QgbG9jYWxWZXJzaW9uID0NCiAgICAgICAgICAgIHBhcnNlSW50KGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJjb2RlX3ZlcnNpb24iKSkgfHwgMTsNCiAgICAgICAgICBjb25zdCBzYXZlZFZlcnNpb24gPSBNYXRoLm1heChmaXJlYmFzZVZlcnNpb24sIGxvY2FsVmVyc2lvbik7DQogICAgICAgICAgaWYgKHNhdmVkVmVyc2lvbiA+IGN1cnJlbnRDb2RlVmVyc2lvbikgaGFuZGxlQ29kZUNoYW5nZShzYXZlZFZlcnNpb24pOw0KICAgICAgICB9DQogICAgICB9KQ0KICAgICAgLmNhdGNoKCgpID0+IHsNCiAgICAgICAgY29uc3Qgc2F2ZWRWZXJzaW9uID0NCiAgICAgICAgICBwYXJzZUludChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiY29kZV92ZXJzaW9uIikpIHx8IDE7DQogICAgICAgIGlmIChzYXZlZFZlcnNpb24gPiBjdXJyZW50Q29kZVZlcnNpb24pIGhhbmRsZUNvZGVDaGFuZ2Uoc2F2ZWRWZXJzaW9uKTsNCiAgICAgIH0pOw0KICB9DQoNCiAgZnVuY3Rpb24gaGFuZGxlQ29kZUNoYW5nZShuZXdWZXJzaW9uKSB7DQogICAgY3VycmVudENvZGVWZXJzaW9uID0gbmV3VmVyc2lvbjsNCiAgICBkYXRhYmFzZQ0KICAgICAgLnJlZigic2V0dGluZ3Mvc2VjcmV0X2NvZGUiKQ0KICAgICAgLm9uY2UoInZhbHVlIikNCiAgICAgIC50aGVuKChjb2RlU25hcCkgPT4gew0KICAgICAgICBpZiAoY29kZVNuYXAuZXhpc3RzKCkpIHsNCiAgICAgICAgICBDT1JSRUNUX0NPREUgPSBjb2RlU25hcC52YWwoKTsNCiAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgic2VjcmV0X2NvZGUiLCBDT1JSRUNUX0NPREUpOw0KICAgICAgICAgIGNvbnN0IGhhZExvY2FsVmVyc2lvbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKENPREVfVkVSU0lPTl9LRVkpICE9PSBudWxsOyBjb25zdCBtc2cgPSAnQ29kZSB1cGRhdGVkOiB0aGUgbGluayBpcyBubyBsb25nZXIgdmFsaWQnOyBpZiAoaGFkTG9jYWxWZXJzaW9uKSB7IGJsb2NrQWNjZXNzKG1zZyk7IHNob3dTZXNzaW9uU2NhZHV0YSgpOyB9IGVsc2UgaWYgKGhhc1Rva2VuRm9vdHByaW50KCkpIHsgZm9yY2VMb2dvdXRGcm9tVG9rZW4obXNnKTsgfSBlbHNlIHsNCiAgICAgICAgICAgIHVuYmxvY2tBY2Nlc3MoKTsNCiAgICAgICAgICAgIHFzKCJTY2FkdXRhT3ZlcmxheSIpPy5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsNCiAgICAgICAgICAgIHFzKCJzZXNzaW9uU2NhZHV0YSIpPy5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsNCiAgICAgICAgICAgIHFzKCJjb250cm9sUGFuZWwiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7DQogICAgICAgICAgICByZXNldFNlc3Npb25Gb3JOZXdDb2RlKCk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlc2V0U2Vzc2lvbkZvck5ld0NvZGUoKSB7DQogICAgY2xlYXJTdG9yYWdlKCJ1c2FnZV9zdGFydF90aW1lIik7DQogICAgY2xlYXJTdG9yYWdlKCJ1c2FnZV9oYXNoIik7DQogICAgREVWSUNFUy5mb3JFYWNoKChkKSA9PiBjbGVhclN0b3JhZ2UoZC5zdG9yYWdlX2tleSkpOw0KDQogICAgcXMoImNvbnRyb2xQYW5lbCIpICYmIChxcygiY29udHJvbFBhbmVsIikuc3R5bGUuZGlzcGxheSA9ICJub25lIik7DQogICAgcXMoImF1dGhDb2RlIikgJiYgKHFzKCJhdXRoQ29kZSIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siKTsNCiAgICBxcygiYXV0aC1mb3JtIikgJiYgKHFzKCJhdXRoLWZvcm0iKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIik7DQogICAgcXMoImJ0bkNoZWNrQ29kZSIpICYmIChxcygiYnRuQ2hlY2tDb2RlIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayIpOw0KICAgIHFzKCJpbXBvcnRhbnQiKSAmJiAocXMoImltcG9ydGFudCIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siKTsNCg0KICAgIHNob3dOb3RpZmljYXRpb24oDQogICAgICAiSWwgY29kaWNlIGRpIGFjY2Vzc28gc3RhdG8gYWdnaW9ybmF0by4gSW5zZXJpc2NpIGlsIG51b3ZvIGNvZGljZS4iDQogICAgKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNoZWNrU2NhZHV0YUxpbmtzKCkgew0KICAgIGNvbnN0IHNlY3VyZUxpbmtzID0gSlNPTi5wYXJzZSgNCiAgICAgIGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJzZWN1cmVfbGlua3MiKSB8fCAie30iDQogICAgKTsNCiAgICBsZXQgdXBkYXRlZCA9IGZhbHNlOw0KICAgIE9iamVjdC5rZXlzKHNlY3VyZUxpbmtzKS5mb3JFYWNoKChsaW5rSWQpID0+IHsNCiAgICAgIGNvbnN0IGxpbmsgPSBzZWN1cmVMaW5rc1tsaW5rSWRdOw0KICAgICAgaWYgKGxpbmsuZXhwaXJhdGlvbiA8IERhdGUubm93KCkgJiYgbGluay5zdGF0dXMgPT09ICJhY3RpdmUiKSB7DQogICAgICAgIHNlY3VyZUxpbmtzW2xpbmtJZF0uc3RhdHVzID0gIlNjYWR1dGEiOw0KICAgICAgICB1cGRhdGVkID0gdHJ1ZTsNCiAgICAgIH0NCiAgICB9KTsNCiAgICBpZiAodXBkYXRlZCkNCiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJzZWN1cmVfbGlua3MiLCBKU09OLnN0cmluZ2lmeShzZWN1cmVMaW5rcykpOw0KICB9DQoNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIC8vIFBPUFVQDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICBmdW5jdGlvbiBzaG93Q29uZmlybWF0aW9uUG9wdXAoZGV2aWNlKSB7DQogICAgaWYgKCFpc0NoZWNraW5UaW1lKCkpIHsNCiAgICAgIHNob3dFYXJseUNoZWNraW5Qb3B1cCgpOw0KICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICBjdXJyZW50RGV2aWNlID0gZGV2aWNlOw0KICAgIGNvbnN0IGRvb3JOYW1lID0gZGV2aWNlLmJ1dHRvbl9pZA0KICAgICAgLnJlcGxhY2UoLyhbQS1aXSkvZywgIiAkMSIpDQogICAgICAucmVwbGFjZSgvXi4vLCAocykgPT4gcy50b1VwcGVyQ2FzZSgpKTsNCiAgICBjb25zdCBtc2cgPSBxcygiY29uZmlybWF0aW9uTWVzc2FnZSIpOw0KICAgIGlmIChtc2cpDQogICAgICBtc2cudGV4dENvbnRlbnQgPSBgQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIHVubG9jayB0aGUgJHtkb29yTmFtZX0/YDsNCiAgICBjb25zdCBwb3AgPSBxcygiY29uZmlybWF0aW9uUG9wdXAiKTsNCiAgICBpZiAocG9wKSBwb3Auc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsNCiAgfQ0KICBmdW5jdGlvbiBjbG9zZUNvbmZpcm1hdGlvblBvcHVwKCkgew0KICAgIGNvbnN0IHBvcCA9IHFzKCJjb25maXJtYXRpb25Qb3B1cCIpOw0KICAgIGlmIChwb3ApIHBvcC5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICAgIGN1cnJlbnREZXZpY2UgPSBudWxsOw0KICB9DQoNCiAgZnVuY3Rpb24gc2hvd0RldmljZVBvcHVwKGRldmljZSwgY2xpY2tzTGVmdCkgew0KICAgIGNvbnN0IHBvcHVwID0gcXMoYHBvcHVwLSR7ZGV2aWNlLmJ1dHRvbl9pZH1gKTsNCiAgICBpZiAoIXBvcHVwKSByZXR1cm47DQogICAgY29uc3QgdGV4dCA9IHFzKGBwb3B1cC10ZXh0LSR7ZGV2aWNlLmJ1dHRvbl9pZH1gKTsNCiAgICBpZiAodGV4dCkgew0KICAgICAgaWYgKGNsaWNrc0xlZnQgPiAwKSB7DQogICAgICAgIHRleHQuaW5uZXJIVE1MID0gYA0KICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtY2hlY2stY2lyY2xlIiBzdHlsZT0iY29sb3I6IzRDQUY1MDtmb250LXNpemU6Mi41cmVtO21hcmdpbi1ib3R0b206MTVweDsiPjwvaT4NCiAgICAgICAgICA8ZGl2PjxzdHJvbmc+JHtjbGlja3NMZWZ0fTwvc3Ryb25nPiBDbGljayBMZWZ0PC9kaXY+DQogICAgICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luLXRvcDoxMHB4O2ZvbnQtc2l6ZToxcmVtOyI+RG9vciBVbmxvY2tlZCE8L2Rpdj5gOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGV4dC5pbm5lckhUTUwgPSBgDQogICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1leGNsYW1hdGlvbi10cmlhbmdsZSIgc3R5bGU9ImNvbG9yOiNGRkMxMDc7Zm9udC1zaXplOjIuNXJlbTttYXJnaW4tYm90dG9tOjE1cHg7Ij48L2k+DQogICAgICAgICAgPGRpdj48c3Ryb25nPk5vIG1vcmUgY2xpY2tzIGxlZnQhPC9zdHJvbmc+PC9kaXY+DQogICAgICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luLXRvcDoxMHB4O2ZvbnQtc2l6ZToxcmVtOyI+Q29udGFjdCBmb3IgQXNzaXN0YW5jZS48L2Rpdj5gOw0KICAgICAgfQ0KICAgIH0NCiAgICBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gImZsZXgiOw0KICAgIGlmIChjbGlja3NMZWZ0ID4gMCkgc2V0VGltZW91dCgoKSA9PiBjbG9zZVBvcHVwKGRldmljZS5idXR0b25faWQpLCAzMDAwKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNsb3NlUG9wdXAoYnV0dG9uSWQpIHsNCiAgICBjb25zdCBwb3B1cCA9IHFzKGBwb3B1cC0ke2J1dHRvbklkfWApOw0KICAgIGlmIChwb3B1cCkgcG9wdXAuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCiAgfQ0KDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICAvLyBTSEVMTFkNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIGFzeW5jIGZ1bmN0aW9uIGFjdGl2YXRlRGV2aWNlKGRldmljZSkgew0KICAgIGlmICghc2Vzc2lvblN0YXJ0VGltZSkgew0KICAgICAgLy8gTCd1dGVudGUgaGEgY2xpY2NhdG8gc2VuemEgbG9naW47IGluaXppYWxpenphIHVuYSBzZXNzaW9uZSBtYW51YWxlDQogICAgICBzZXNzaW9uU3RhcnRUaW1lID0gRGF0ZS5ub3coKTsNCiAgICAgIGF3YWl0IHNldFVzYWdlU3RhcnRUaW1lKCk7DQogICAgfQ0KDQogICAgaWYgKGF3YWl0IGNoZWNrVGltZUxpbWl0KCkpIHJldHVybjsNCiAgICBpZiAoIWlzQ2hlY2tpblRpbWUoKSkgew0KICAgICAgc2hvd0Vhcmx5Q2hlY2tpblBvcHVwKCk7DQogICAgICByZXR1cm47DQogICAgfQ0KDQogICAgbGV0IGNsaWNrc0xlZnQgPSBnZXRDbGlja3NMZWZ0KGRldmljZS5zdG9yYWdlX2tleSk7DQogICAgaWYgKGNsaWNrc0xlZnQgPD0gMCkgew0KICAgICAgc2hvd0RldmljZVBvcHVwKGRldmljZSwgY2xpY2tzTGVmdCk7DQogICAgICB1cGRhdGVCdXR0b25TdGF0ZShkZXZpY2UpOw0KICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIHNldENsaWNrc0xlZnQoZGV2aWNlLnN0b3JhZ2Vfa2V5LCAtLWNsaWNrc0xlZnQpOw0KICAgIHVwZGF0ZUJ1dHRvblN0YXRlKGRldmljZSk7DQoNCiAgICB0cnkgew0KICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaFdpdGhUaW1lb3V0KA0KICAgICAgICBCQVNFX1VSTF9TRVQsDQogICAgICAgIHsNCiAgICAgICAgICBtZXRob2Q6ICJQT1NUIiwNCiAgICAgICAgICBoZWFkZXJzOiB7ICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIgfSwNCiAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7DQogICAgICAgICAgICBpZDogZGV2aWNlLmlkLA0KICAgICAgICAgICAgYXV0aF9rZXk6IGRldmljZS5hdXRoX2tleSwNCiAgICAgICAgICAgIGNoYW5uZWw6IDAsDQogICAgICAgICAgICBvbjogdHJ1ZSwNCiAgICAgICAgICAgIHR1cm46ICJvbiIsDQogICAgICAgICAgfSksDQogICAgICAgIH0sDQogICAgICAgIDEyMDAwDQogICAgICApOw0KDQogICAgICBpZiAocmVzcG9uc2Uub2spIHsNCiAgICAgICAgc2hvd0RldmljZVBvcHVwKGRldmljZSwgY2xpY2tzTGVmdCk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBzZXRDbGlja3NMZWZ0KGRldmljZS5zdG9yYWdlX2tleSwgY2xpY2tzTGVmdCArIDEpOw0KICAgICAgICB1cGRhdGVCdXR0b25TdGF0ZShkZXZpY2UpOw0KICAgICAgICBjb25zb2xlLmVycm9yKA0KICAgICAgICAgICJFcnJvcmUgbmVsbCdhdHRpdmF6aW9uZSBkZWwgZGlzcG9zaXRpdm86IiwNCiAgICAgICAgICByZXNwb25zZS5zdGF0dXMsDQogICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzVGV4dA0KICAgICAgICApOw0KICAgICAgfQ0KICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICBjb25zb2xlLmVycm9yKCJBdHRpdmF6aW9uZSBkaXNwb3NpdGl2byBmYWxsaXRhOiIsIGVycm9yKTsNCiAgICAgIHNldENsaWNrc0xlZnQoZGV2aWNlLnN0b3JhZ2Vfa2V5LCBjbGlja3NMZWZ0ICsgMSk7DQogICAgICB1cGRhdGVCdXR0b25TdGF0ZShkZXZpY2UpOw0KICAgIH0NCiAgfQ0KDQogIGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUdsb2JhbENvZGVWZXJzaW9uKCkgew0KICAgIGNvbnN0IHNhdmVkVmVyc2lvbiA9IHBhcnNlSW50KGxvY2FsU3RvcmFnZS5nZXRJdGVtKENPREVfVkVSU0lPTl9LRVkpKSB8fCAxOw0KICAgIGlmIChzYXZlZFZlcnNpb24gPCBjdXJyZW50Q29kZVZlcnNpb24pIHsNCiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKENPREVfVkVSU0lPTl9LRVksIFN0cmluZyhjdXJyZW50Q29kZVZlcnNpb24pKTsNCiAgICAgIHJlc2V0U2Vzc2lvbkZvck5ld0NvZGUoKTsNCiAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICByZXR1cm4gZmFsc2U7DQogIH0NCg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgLy8gVE9LRU4gU0lDVVJJIChGaXJlYmFzZSBzZWN1cmVfbGlua3MvKikNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIGZ1bmN0aW9uIG1heWJlQ2xlYW5VcmwoKSB7DQogICAgaWYgKCFLRUVQX1RPS0VOX0lOX1VSTCkgY2xlYW5VcmwoKTsNCiAgfQ0KDQogIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZVNlY3VyZVRva2VuKCkgew0KICAgIGNvbnN0IHVybFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMod2luZG93LmxvY2F0aW9uLnNlYXJjaCk7DQogICAgY29uc3QgdG9rZW4gPSB1cmxQYXJhbXMuZ2V0KCJ0b2tlbiIpOw0KICAgIGlmICghdG9rZW4pIHsNCiAgICAgIGlzVG9rZW5TZXNzaW9uID0gZmFsc2U7DQogICAgICB3aW5kb3cuaXNUb2tlblNlc3Npb24gPSBmYWxzZTsNCiAgICAgIGN1cnJlbnRUb2tlbkN1c3RvbUNvZGUgPSBudWxsOw0KICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIHRyeSB7DQogICAgICBjb25zdCBzbmFwc2hvdCA9IGF3YWl0IGRhdGFiYXNlDQogICAgICAgIC5yZWYoInNlY3VyZV9saW5rcy8iICsgdG9rZW4pDQogICAgICAgIC5vbmNlKCJ2YWx1ZSIpOw0KICAgICAgaWYgKCFzbmFwc2hvdC5leGlzdHMoKSkgew0KICAgICAgICBzaG93VG9rZW5FcnJvcigiVG9rZW4gbm9uIHZhbGlkbyIpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgIGJsb2NrVG9rZW5Pbmx5KCJUb2tlbiBub24gdmFsaWRvIiwgdG9rZW4pOw0KICAgICAgICB9IGNhdGNoIHt9DQogICAgICAgIHNob3dTZXNzaW9uU2NhZHV0YSgpOw0KICAgICAgICBtYXliZUNsZWFuVXJsKCk7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCg0KICAgICAgY29uc3QgbGlua0RhdGEgPSBzbmFwc2hvdC52YWwoKTsNCiAgICAgIC8vIElmIHRoaXMgdG9rZW4gd2FzIGRldmljZS1ibG9ja2VkLCBkbyBub3QgcmUtYWN0aXZhdGUgb24gcmVmcmVzaA0KICAgICAgaWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKGB0b2tlbl9kZXZpY2VfYmxvY2tfJHt0b2tlbn1gKSA9PT0gIjEiKSB7DQogICAgICAgIGNvbnN0IHIgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShgdG9rZW5fZGV2aWNlX01vdGl2b18ke3Rva2VufWApIHx8ICJTZXNzaW9uZSB0b2tlbiBzY2FkdXRhIHN1IHF1ZXN0byBkaXNwb3NpdGl2byI7DQogICAgICAgIHNob3dUb2tlbkVycm9yKHIpOw0KICAgICAgICB0cnkgeyBibG9ja1Rva2VuT25seShyLCB0b2tlbik7IH0gY2F0Y2gge30NCiAgICAgICAgc2hvd1Nlc3Npb25TY2FkdXRhKCk7DQogICAgICAgIG1heWJlQ2xlYW5VcmwoKTsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgfQ0KICAgICAgICAgIC8vIFNlIHF1ZXN0byB0b2tlbiDDg8KoIHN0YXRvIGJsb2NjYXRvIHN1IHF1ZXN0byBkaXNwb3NpdGl2byAoZXMuIHRlbXBvIHNlc3Npb25lIHNjYWR1dG8pLCBub24gcmlhdHRpdmFybG8gc3UgcmVmcmVzaFxuICAgICAgaWYgKGlzVG9rZW5EZXZpY2VCbG9ja2VkKHRva2VuKSkge1xuICAgICAgICBjb25zdCByID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oYHRva2VuX2RldmljZV9Nb3Rpdm9fJHt0b2tlbn1gKSB8fCAiU2Vzc2lvbmUgdG9rZW4gc2NhZHV0YSBzdSBxdWVzdG8gZGlzcG9zaXRpdm8iO1xuICAgICAgICBzaG93VG9rZW5FcnJvcihyKTtcbiAgICAgICAgdHJ5IHsgYmxvY2tUb2tlbk9ubHkociwgdG9rZW4pOyB9IGNhdGNoIHt9XG4gICAgICAgIHNob3dTZXNzaW9uU2NhZHV0YSgpO1xuICAgICAgICBtYXliZUNsZWFuVXJsKCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbmNvbnN0IGlzVmFsaWQgPSB2YWxpZGF0ZVNlY3VyZVRva2VuKGxpbmtEYXRhKTsNCiAgICAgIGlmICghaXNWYWxpZC52YWxpZCkgew0KICAgICAgICBzaG93VG9rZW5FcnJvcihpc1ZhbGlkLk1vdGl2byk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgYmxvY2tUb2tlbk9ubHkoaXNWYWxpZC5Nb3Rpdm8gfHwgIkFjY2Vzc28gYmxvY2NhdG8iLCB0b2tlbik7DQogICAgICAgIH0gY2F0Y2gge30NCiAgICAgICAgc2hvd1Nlc3Npb25TY2FkdXRhKCk7DQogICAgICAgIG1heWJlQ2xlYW5VcmwoKTsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgfQ0KDQogICAgICBpc1Rva2VuU2Vzc2lvbiA9IHRydWU7DQogICAgICB3aW5kb3cuaXNUb2tlblNlc3Npb24gPSB0cnVlOyAvLyBjb21wYXQgbGVnYWN5DQogICAgICBjdXJyZW50VG9rZW5JZCA9IHRva2VuOw0KICAgICAgY3VycmVudFRva2VuQ3VzdG9tQ29kZSA9IGxpbmtEYXRhLmN1c3RvbUNvZGUgfHwgbnVsbDsNCg0KICAgICAgLy8gc2Jsb2NjYSBibG9jY2hpIHByZWNlZGVudGkNCiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJibG9ja19tYW51YWxfbG9naW4iKTsNCiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJibG9ja2VkX3Rva2VuIik7DQogICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgiYmxvY2tlZF9Nb3Rpdm8iKTsNCiAgICAgIC8vIEFzc2ljdXJhdGkgY2hlIGV2ZW50dWFsaSBvdmVybGF5IGRpIHNjYWRlbnphIG5vbiByZXN0aW5vIHZpc2liaWxpDQogICAgICB0cnkgew0KICAgICAgICB1bmJsb2NrQWNjZXNzKCk7DQogICAgICAgIHFzKCJTY2FkdXRhT3ZlcmxheSIpPy5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsNCiAgICAgICAgcXMoInNlc3Npb25TY2FkdXRhIik/LmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOw0KICAgICAgfSBjYXRjaCB7fQ0KDQogICAgICBzaG93VG9rZW5Ob3RpZmljYXRpb24oaXNWYWxpZC5yZW1haW5pbmdVc2VzLCAhIWN1cnJlbnRUb2tlbkN1c3RvbUNvZGUpOw0KICAgICAgYXdhaXQgaW5jcmVtZW50VG9rZW5Vc2FnZSh0b2tlbiwgbGlua0RhdGEpOw0KICAgICAgbWF5YmVDbGVhblVybCgpOw0KICAgICAgc3RhcnRUb2tlbkV4cGlyYXRpb25DaGVjayhsaW5rRGF0YS5leHBpcmF0aW9uKTsNCiAgICAgIHN0YXJ0VG9rZW5SZWFsdGltZUxpc3RlbmVyKHRva2VuKTsNCiAgICAgIHJldHVybiB0cnVlOw0KICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICBjb25zb2xlLmVycm9yKCJFcnJvcmUgbmVsbGEgdmVyaWZpY2EgZGVsIHRva2VuOiIsIGVycm9yKTsNCiAgICAgIHNob3dUb2tlbkVycm9yKCJFcnJvcmUgZGkgdmVyaWZpY2EiKTsNCiAgICAgIHRyeSB7DQogICAgICAgIGJsb2NrVG9rZW5Pbmx5KCJFcnJvcmUgZGkgdmVyaWZpY2EiLCB0b2tlbik7DQogICAgICB9IGNhdGNoIHt9DQogICAgICBzaG93U2Vzc2lvblNjYWR1dGEoKTsNCiAgICAgIG1heWJlQ2xlYW5VcmwoKTsNCiAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBzdG9wVG9rZW5SZWFsdGltZUxpc3RlbmVyKCkgew0KICAgIGlmICh0b2tlblJlZikgew0KICAgICAgdG9rZW5SZWYub2ZmKCk7DQogICAgICB0b2tlblJlZiA9IG51bGw7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gY2xlYXJNYW51YWxTZXNzaW9uKCkgew0KICAgIHRyeSB7DQogICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgidXNhZ2Vfc3RhcnRfdGltZSIpOw0KICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oInVzYWdlX2hhc2giKTsNCiAgICAgIHNlc3Npb25TdGFydFRpbWUgPSBudWxsOw0KICAgIH0gY2F0Y2gge30NCiAgfQ0KDQogIGZ1bmN0aW9uIGJsb2NrQWNjZXNzKE1vdGl2byA9ICJBY2Nlc3NvIGJsb2NjYXRvIiwgdG9rZW4gPSBudWxsKSB7DQogICAgdHJ5IHsNCiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJibG9ja19tYW51YWxfbG9naW4iLCAiMSIpOw0KICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oImJsb2NrZWRfTW90aXZvIiwgTW90aXZvKTsNCiAgICAgIGlmICh0b2tlbikgbG9jYWxTdG9yYWdlLnNldEl0ZW0oImJsb2NrZWRfdG9rZW4iLCB0b2tlbik7DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgY29uc29sZS5lcnJvcigiRXJyb3JlIGJsb2NrQWNjZXNzOiIsIGUpOw0KICAgIH0NCiAgfQ0KDQogIC8vIEJsb2NjYSBzb2xvIGlsIHRva2VuIGNvcnJlbnRlIHNlbnphIGFwcGxpY2FyZSBpbCBibG9jY28gZ2xvYmFsZSBkZWwgZGlzcG9zaXRpdm8NCiAgZnVuY3Rpb24gYmxvY2tUb2tlbk9ubHkoTW90aXZvID0gIkFjY2Vzc28gYmxvY2NhdG8iLCB0b2tlbiA9IG51bGwpIHsNCiAgICB0cnkgew0KICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oImJsb2NrZWRfTW90aXZvIiwgTW90aXZvKTsNCiAgICAgIGlmICh0b2tlbikgbG9jYWxTdG9yYWdlLnNldEl0ZW0oImJsb2NrZWRfdG9rZW4iLCB0b2tlbik7DQogICAgfSBjYXRjaCAoZSkgew0KICAgICAgY29uc29sZS5lcnJvcigiRXJyb3JlIGJsb2NrVG9rZW5Pbmx5OiIsIGUpOw0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIHVuYmxvY2tBY2Nlc3MoKSB7DQogICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oImJsb2NrX21hbnVhbF9sb2dpbiIpOw0KICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJibG9ja2VkX01vdGl2byIpOw0KICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJibG9ja2VkX3Rva2VuIik7DQogIH0NCg0KICAvLyBGbGFnIGRpIGJsb2NjbyBwZXIgcXVlc3RvIHRva2VuIHN1IHF1ZXN0byBkaXNwb3NpdGl2bw0KICBmdW5jdGlvbiBtYXJrVG9rZW5EZXZpY2VCbG9ja2VkKHRva2VuLCBNb3Rpdm8gPSAiIikgew0KICAgIHRyeSB7DQogICAgICBpZiAoIXRva2VuKSByZXR1cm47DQogICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShgdG9rZW5fZGV2aWNlX2Jsb2NrXyR7dG9rZW59YCwgIjEiKTsNCiAgICAgIGlmIChNb3Rpdm8pIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGB0b2tlbl9kZXZpY2VfTW90aXZvXyR7dG9rZW59YCwgTW90aXZvKTsNCiAgICB9IGNhdGNoIChlKSB7DQogICAgICBjb25zb2xlLmVycm9yKCJFcnJvcmUgbWFya1Rva2VuRGV2aWNlQmxvY2tlZDoiLCBlKTsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBpc1Rva2VuRGV2aWNlQmxvY2tlZCh0b2tlbikgew0KICAgIHRyeSB7DQogICAgICBpZiAoIXRva2VuKSByZXR1cm4gZmFsc2U7DQogICAgICByZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0oYHRva2VuX2RldmljZV9ibG9ja18ke3Rva2VufWApID09PSAiMSI7DQogICAgfSBjYXRjaCB7DQogICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gY2xlYXJUb2tlbkRldmljZUJsb2NrKHRva2VuKSB7DQogICAgdHJ5IHsNCiAgICAgIGlmICghdG9rZW4pIHJldHVybjsNCiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGB0b2tlbl9kZXZpY2VfYmxvY2tfJHt0b2tlbn1gKTsNCiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGB0b2tlbl9kZXZpY2VfTW90aXZvXyR7dG9rZW59YCk7DQogICAgfSBjYXRjaCB7fQ0KICB9DQoNCiAgZnVuY3Rpb24gaGFzVG9rZW5Gb290cHJpbnQoKSB7DQogICAgdHJ5IHsNCiAgICAgIGlmIChpc1Rva2VuU2Vzc2lvbikgcmV0dXJuIHRydWU7DQogICAgICBjb25zdCB1cmxUb2sgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gpLmdldCgidG9rZW4iKTsNCiAgICAgIGlmICh1cmxUb2spIHJldHVybiB0cnVlOw0KICAgICAgaWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJibG9ja2VkX3Rva2VuIikpIHJldHVybiB0cnVlOw0KICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsb2NhbFN0b3JhZ2UubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgY29uc3QgayA9IGxvY2FsU3RvcmFnZS5rZXkoaSk7DQogICAgICAgIGlmIChrICYmIGsuaW5kZXhPZigidG9rZW5fb2tfIikgPT09IDApIHJldHVybiB0cnVlOw0KICAgICAgfQ0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgIGNvbnNvbGUud2FybigiaGFzVG9rZW5Gb290cHJpbnQgY2hlY2sgZmFpbGVkOiIsIGUpOw0KICAgIH0NCiAgICByZXR1cm4gZmFsc2U7DQogIH0NCg0KICBmdW5jdGlvbiBmb3JjZUdsb2JhbExvZ291dChNb3Rpdm8gPSAiQ29kaWNlIGFnZ2lvcm5hdG86IGFjY2VkaSBkaSBudW92byIpIHsNCiAgICBpc1Rva2VuU2Vzc2lvbiA9IGZhbHNlOw0KICAgIHdpbmRvdy5pc1Rva2VuU2Vzc2lvbiA9IGZhbHNlOw0KICAgIGNsZWFyTWFudWFsU2Vzc2lvbigpOw0KICAgIGNvbnN0IHQgPQ0KICAgICAgY3VycmVudFRva2VuSWQgfHwNCiAgICAgIG5ldyBVUkxTZWFyY2hQYXJhbXMobG9jYXRpb24uc2VhcmNoKS5nZXQoInRva2VuIikgfHwNCiAgICAgIG51bGw7DQogICAgYmxvY2tUb2tlbk9ubHkoTW90aXZvLCB0KTsNCiAgICB0cnkgew0KICAgICAgaWYgKHQpIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGB0b2tlbl9va18ke3R9YCk7DQogICAgfSBjYXRjaCB7fQ0KICAgIHRyeSB7DQogICAgICBzaG93VG9rZW5FcnJvcihNb3Rpdm8pOw0KICAgIH0gY2F0Y2gge30NCiAgICBzaG93U2Vzc2lvblNjYWR1dGEoKTsNCiAgICBzdG9wVG9rZW5SZWFsdGltZUxpc3RlbmVyKCk7DQogIH0NCg0KICBmdW5jdGlvbiBmb3JjZUxvZ291dEZyb21Ub2tlbihNb3Rpdm8gPSAiTGluayBub24gdmFsaWRvIikgew0KICAgIGlzVG9rZW5TZXNzaW9uID0gZmFsc2U7DQogICAgd2luZG93LmlzVG9rZW5TZXNzaW9uID0gZmFsc2U7DQogICAgY2xlYXJNYW51YWxTZXNzaW9uKCk7DQogICAgY29uc3QgdCA9DQogICAgICBjdXJyZW50VG9rZW5JZCB8fA0KICAgICAgbmV3IFVSTFNlYXJjaFBhcmFtcyhsb2NhdGlvbi5zZWFyY2gpLmdldCgidG9rZW4iKSB8fA0KICAgICAgbnVsbDsNCiAgICBibG9ja1Rva2VuT25seShNb3Rpdm8sIHQpOyBpZiAodCkgeyBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShgdG9rZW5fZGV2aWNlX2Jsb2NrXyR7dH1gLCAiMSIpOyBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShgdG9rZW5fZGV2aWNlX01vdGl2b18ke3R9YCwgTW90aXZvIHx8ICJTZXNzaW9uZSB0b2tlbiBzY2FkdXRhIik7IH0NCiAgICB0cnkgew0KICAgICAgaWYgKHQpIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGB0b2tlbl9va18ke3R9YCk7DQogICAgfSBjYXRjaCB7fQ0KICAgIHRyeSB7DQogICAgICBzaG93VG9rZW5FcnJvcihNb3Rpdm8pOw0KICAgIH0gY2F0Y2gge30NCiAgICBzaG93U2Vzc2lvblNjYWR1dGEoKTsNCiAgICBzdG9wVG9rZW5SZWFsdGltZUxpc3RlbmVyKCk7DQogIH0NCg0KICBmdW5jdGlvbiBzdGFydFRva2VuUmVhbHRpbWVMaXN0ZW5lcih0b2tlbikgew0KICAgIHN0b3BUb2tlblJlYWx0aW1lTGlzdGVuZXIoKTsNCiAgICB0b2tlblJlZiA9IGRhdGFiYXNlLnJlZigic2VjdXJlX2xpbmtzLyIgKyB0b2tlbik7DQogICAgdG9rZW5SZWYub24oInZhbHVlIiwgKHNuYXApID0+IHsNCiAgICAgIGlmICghc25hcC5leGlzdHMoKSkgew0KICAgICAgICBmb3JjZUxvZ291dEZyb21Ub2tlbigiTGluayByaW1vc3NvIik7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCiAgICAgIGNvbnN0IGQgPSBzbmFwLnZhbCgpOw0KICAgICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTsNCiAgICAgIGNvbnN0IGV4aGF1c3RlZCA9IChkLnVzZWRDb3VudCB8fCAwKSA+PSAoZC5tYXhVc2FnZSB8fCAwKTsNCiAgICAgIGNvbnN0IFNjYWR1dGEgPSAoZC5leHBpcmF0aW9uIHx8IDApIDw9IG5vdzsNCiAgICAgIGNvbnN0IHJldm9rZWQgPSBkLnN0YXR1cyAhPT0gImFjdGl2ZSI7DQogICAgICBpZiAocmV2b2tlZCB8fCBTY2FkdXRhIHx8IGV4aGF1c3RlZCkgew0KICAgICAgICBjb25zdCB3aHkgPSByZXZva2VkDQogICAgICAgICAgPyAiTGluayByZXZvY2F0byINCiAgICAgICAgICA6IFNjYWR1dGENCiAgICAgICAgICA/ICJMaW5rIHNjYWR1dG8iDQogICAgICAgICAgOiAiVXRpbGl6emkgZXNhdXJpdGkiOw0KICAgICAgICBmb3JjZUxvZ291dEZyb21Ub2tlbih3aHkpOw0KICAgICAgfQ0KICAgIH0pOw0KICB9DQoNCiAgZnVuY3Rpb24gdmFsaWRhdGVTZWN1cmVUb2tlbihsaW5rRGF0YSkgew0KICAgIHRyeSB7DQogICAgICBpZiAoIWxpbmtEYXRhKSByZXR1cm4geyB2YWxpZDogZmFsc2UsIE1vdGl2bzogIlRva2VuIG5vbiB2YWxpZG8iIH07DQogICAgICBpZiAobGlua0RhdGEuc3RhdHVzICE9PSAiYWN0aXZlIikNCiAgICAgICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCBNb3Rpdm86ICJMaW5rIHJldm9jYXRvIiB9Ow0KICAgICAgaWYgKGxpbmtEYXRhLmV4cGlyYXRpb24gPCBEYXRlLm5vdygpKQ0KICAgICAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIE1vdGl2bzogIlRva2VuIHNjYWR1dG8iIH07DQogICAgICBpZiAoKGxpbmtEYXRhLnVzZWRDb3VudCB8fCAwKSA+PSAobGlua0RhdGEubWF4VXNhZ2UgfHwgMCkpDQogICAgICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgTW90aXZvOiAiVXRpbGl6emkgZXNhdXJpdGkiIH07DQogICAgICBjb25zdCByZW1haW5pbmdVc2VzID0NCiAgICAgICAgKGxpbmtEYXRhLm1heFVzYWdlIHx8IDApIC0gKGxpbmtEYXRhLnVzZWRDb3VudCB8fCAwKTsNCiAgICAgIHJldHVybiB7IHZhbGlkOiB0cnVlLCByZW1haW5pbmdVc2VzIH07DQogICAgfSBjYXRjaCB7DQogICAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIE1vdGl2bzogIkVycm9yZSBkaSB2ZXJpZmljYSIgfTsNCiAgICB9DQogIH0NCg0KICBhc3luYyBmdW5jdGlvbiBpbmNyZW1lbnRUb2tlblVzYWdlKHRva2VuLCBsaW5rRGF0YSkgew0KICAgIGNvbnN0IG5ld1VzZWRDb3VudCA9IChsaW5rRGF0YS51c2VkQ291bnQgfHwgMCkgKyAxOw0KICAgIGNvbnN0IG5ld1N0YXR1cyA9DQogICAgICBuZXdVc2VkQ291bnQgPj0gKGxpbmtEYXRhLm1heFVzYWdlIHx8IDApID8gInVzZWQiIDogImFjdGl2ZSI7DQogICAgdHJ5IHsNCiAgICAgIGF3YWl0IGRhdGFiYXNlDQogICAgICAgIC5yZWYoInNlY3VyZV9saW5rcy8iICsgdG9rZW4pDQogICAgICAgIC51cGRhdGUoeyB1c2VkQ291bnQ6IG5ld1VzZWRDb3VudCwgc3RhdHVzOiBuZXdTdGF0dXMgfSk7DQogICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yZSBuZWxsJ2FnZ2lvcm5hbWVudG8gZGVsIHRva2VuOiIsIGVycm9yKTsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBzaG93VG9rZW5Ob3RpZmljYXRpb24ocmVtYWluaW5nVXNlcywgaGFzQ3VzdG9tQ29kZSkgew0KICAgIGNvbnN0IG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICBuLnN0eWxlLmNzc1RleHQgPSBgDQogICAgICBwb3NpdGlvbjpmaXhlZDsgdG9wOjIwcHg7IHJpZ2h0OjIwcHg7IGJhY2tncm91bmQ6dmFyKC0tc3VjY2Vzcyk7IGNvbG9yOiNmZmY7DQogICAgICBwYWRkaW5nOjE1cHggMjBweDsgYm9yZGVyLXJhZGl1czo4cHg7IGJveC1zaGFkb3c6MCA0cHggMTJweCByZ2JhKDAsMCwwLC4xKTsNCiAgICAgIHotaW5kZXg6MTAwMDA7IGRpc3BsYXk6ZmxleDsgZ2FwOjEwcHg7IGFsaWduLWl0ZW1zOmNlbnRlcjsgbWF4LXdpZHRoOjM1MHB4O2A7DQogICAgY29uc3QgY3VzdG9tID0gaGFzQ3VzdG9tQ29kZQ0KICAgICAgPyAnPGRpdiBzdHlsZT0iZm9udC1zaXplOjEycHg7b3BhY2l0eTouOTsiPlF1ZXN0byBsaW5rIHVzYSB1biBjb2RpY2UgZGVkaWNhdG88L2Rpdj4nDQogICAgICA6ICc8ZGl2IHN0eWxlPSJmb250LXNpemU6MTJweDtvcGFjaXR5Oi45OyI+UXVlc3RvIGxpbmsgdXNhIGlsIGNvZGljZSBwcmluY2lwYWxlPC9kaXY+JzsNCiAgICBuLmlubmVySFRNTCA9IGANCiAgICAgIDxpIGNsYXNzPSJmYXMgZmEtY2hlY2stY2lyY2xlIj48L2k+DQogICAgICA8ZGl2Pg0KICAgICAgICA8ZGl2Pkxpbmsgc2ljdXJvIHJpY29ub3NjaXV0bzwvZGl2Pg0KICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MTJweDtvcGFjaXR5Oi45OyI+VXRpbGl6emkgcmltYW5lbnRpOiAke3JlbWFpbmluZ1VzZXN9PC9kaXY+DQogICAgICAgICR7Y3VzdG9tfQ0KICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MTJweDtvcGFjaXR5Oi45O21hcmdpbi10b3A6NXB4OyI+PGkgY2xhc3M9ImZhcyBmYS1pbmZvLWNpcmNsZSI+PC9pPiBJbnNlcmlzY2kgaWwgY29kaWNlIHF1aSBzb3R0bzwvZGl2Pg0KICAgICAgPC9kaXY+DQogICAgICA8YnV0dG9uIG9uY2xpY2s9InRoaXMucGFyZW50RWxlbWVudC5yZW1vdmUoKSIgc3R5bGU9ImJhY2tncm91bmQ6bm9uZTtib3JkZXI6bm9uZTtjb2xvcjojZmZmO21hcmdpbi1sZWZ0OjEwcHg7Y3Vyc29yOnBvaW50ZXIiPg0KICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXRpbWVzIj48L2k+DQogICAgICA8L2J1dHRvbj5gOw0KICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobik7DQogICAgc2V0VGltZW91dCgoKSA9PiBuLnBhcmVudEVsZW1lbnQgJiYgbi5yZW1vdmUoKSwgNTAwMCk7DQogIH0NCg0KICBmdW5jdGlvbiBzaG93VG9rZW5FcnJvcihNb3Rpdm8pIHsNCiAgICBjb25zdCBuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgbi5zdHlsZS5jc3NUZXh0ID0gYA0KICAgICAgcG9zaXRpb246Zml4ZWQ7IHRvcDoyMHB4OyByaWdodDoyMHB4OyBiYWNrZ3JvdW5kOnZhcigtLWVycm9yKTsgY29sb3I6I2ZmZjsNCiAgICAgIHBhZGRpbmc6MTVweCAyMHB4OyBib3JkZXItcmFkaXVzOjhweDsgYm94LXNoYWRvdzowIDRweCAxMnB4IHJnYmEoMCwwLDAsLjEpOw0KICAgICAgei1pbmRleDoxMDAwMDsgZGlzcGxheTpmbGV4OyBnYXA6MTBweDsgYWxpZ24taXRlbXM6Y2VudGVyOyBtYXgtd2lkdGg6MzIwcHg7YDsNCiAgICBuLmlubmVySFRNTCA9IGANCiAgICAgIDxpIGNsYXNzPSJmYXMgZmEtZXhjbGFtYXRpb24tdHJpYW5nbGUiPjwvaT4NCiAgICAgIDxkaXY+DQogICAgICAgIDxkaXY+TGluayBub24gdmFsaWRvPC9kaXY+DQogICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZToxMnB4O29wYWNpdHk6Ljk7Ij5Nb3Rpdm86ICR7TW90aXZvfTwvZGl2Pg0KICAgICAgPC9kaXY+DQogICAgICA8YnV0dG9uIG9uY2xpY2s9InRoaXMucGFyZW50RWxlbWVudC5yZW1vdmUoKSIgc3R5bGU9ImJhY2tncm91bmQ6bm9uZTtib3JkZXI6bm9uZTtjb2xvcjojZmZmO21hcmdpbi1sZWZ0OjEwcHg7Y3Vyc29yOnBvaW50ZXIiPg0KICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXRpbWVzIj48L2k+DQogICAgICA8L2J1dHRvbj5gOw0KICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobik7DQogICAgc2V0VGltZW91dCgoKSA9PiBuLnBhcmVudEVsZW1lbnQgJiYgbi5yZW1vdmUoKSwgNTAwMCk7DQogIH0NCg0KICBmdW5jdGlvbiBjbGVhblVybCgpIHsNCiAgICBpZiAod2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlKSB7DQogICAgICBjb25zdCBjbGVhbiA9IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4gKyB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWU7DQogICAgICB3aW5kb3cuaGlzdG9yeS5yZXBsYWNlU3RhdGUoe30sIGRvY3VtZW50LnRpdGxlLCBjbGVhbik7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gc3RhcnRUb2tlbkV4cGlyYXRpb25DaGVjayhleHBpcmF0aW9uVGltZSkgew0KICAgIGNvbnN0IGl2ID0gc2V0SW50ZXJ2YWwoKCkgPT4gew0KICAgICAgaWYgKERhdGUubm93KCkgPiBleHBpcmF0aW9uVGltZSkgew0KICAgICAgICBjbGVhckludGVydmFsKGl2KTsNCiAgICAgICAgaXNUb2tlblNlc3Npb24gPSBmYWxzZTsNCiAgICAgICAgd2luZG93LmlzVG9rZW5TZXNzaW9uID0gZmFsc2U7DQogICAgICAgICAgICAgICAgYmxvY2tUb2tlbk9ubHkoIkxpbmsgc2NhZHV0byIsIGN1cnJlbnRUb2tlbklkIHx8IG51bGwpOw0KICAgICAgICBpZiAoY3VycmVudFRva2VuSWQpIHsgbG9jYWxTdG9yYWdlLnNldEl0ZW0oYHRva2VuX2RldmljZV9ibG9ja18ke2N1cnJlbnRUb2tlbklkfWAsICIxIik7IGxvY2FsU3RvcmFnZS5zZXRJdGVtKGB0b2tlbl9kZXZpY2VfTW90aXZvXyR7Y3VycmVudFRva2VuSWR9YCwgIkxpbmsgc2NhZHV0byIpOyB9DQogICAgICAgIHNob3dTZXNzaW9uU2NhZHV0YSgpOw0KICAgICAgfQ0KICAgIH0sIDEwMDApOw0KICB9DQoNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIC8vIEFVVEVOVElDQVpJT05FDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICBhc3luYyBmdW5jdGlvbiBwZXJmb3JtTWFudWFsTG9naW4oKSB7DQogICAgaXNUb2tlblNlc3Npb24gPSBmYWxzZTsNCiAgICB3aW5kb3cuaXNUb2tlblNlc3Npb24gPSBmYWxzZTsNCiAgICBzZXNzaW9uU3RhcnRUaW1lID0gRGF0ZS5ub3coKTsNCiAgICBhd2FpdCBzZXRVc2FnZVN0YXJ0VGltZSgpOw0KDQogICAgaWYgKGF3YWl0IGNoZWNrVGltZUxpbWl0KCkpIHJldHVybjsNCg0KICAgIC8vIEFzc2ljdXJhdGkgZGkgbmFzY29uZGVyZSBldmVudHVhbGkgb3ZlcmxheSBkaSBzY2FkZW56YQ0KICAgIHRyeSB7DQogICAgICBxcygiU2NhZHV0YU92ZXJsYXkiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7DQogICAgICBxcygic2Vzc2lvblNjYWR1dGEiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7DQogICAgICB1bmJsb2NrQWNjZXNzKCk7DQogICAgfSBjYXRjaCB7fQ0KDQogICAgc2hvd0NvbnRyb2xQYW5lbCgpOw0KICAgIHFzKCJjaGVja2luVGltZUluZm8iKSAmJiAocXMoImNoZWNraW5UaW1lSW5mbyIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siKTsNCiAgICB1cGRhdGVDaGVja2luVGltZURpc3BsYXkoKTsNCiAgICBERVZJQ0VTLmZvckVhY2godXBkYXRlQnV0dG9uU3RhdGUpOw0KICAgIHVwZGF0ZVN0YXR1c0JhcigpOw0KICB9DQoNCiAgYXN5bmMgZnVuY3Rpb24gaGFuZGxlQ29kZVN1Ym1pdCgpIHsNCiAgICBjb25zdCBjb2RlSW5wdXQgPSBxcygiYXV0aENvZGUiKTsNCiAgICBjb25zdCBpbnNlcnRlZENvZGUgPSAoY29kZUlucHV0Py52YWx1ZSB8fCAiIikudHJpbSgpOw0KICAgIGxldCBleHBlY3RlZENvZGUgPSBDT1JSRUNUX0NPREU7DQoNCiAgICBpZiAoaXNUb2tlblNlc3Npb24gJiYgY3VycmVudFRva2VuQ3VzdG9tQ29kZSkNCiAgICAgIGV4cGVjdGVkQ29kZSA9IGN1cnJlbnRUb2tlbkN1c3RvbUNvZGU7DQoNCiAgICBpZiAoaW5zZXJ0ZWRDb2RlICE9PSBleHBlY3RlZENvZGUpIHsNCiAgICAgIGFsZXJ0KCJDb2RpY2UgZXJyYXRvISBSaXByb3ZhLiIpOw0KICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICAvLyBTZSBzaWFtbyBpbiBzZXNzaW9uZSB0b2tlbiwgcGVyc2lzdGkgdmFsaWRhemlvbmUgZSBtb3N0cmEgcGFubmVsbG8NCiAgICBpZiAoaXNUb2tlblNlc3Npb24pIHsNCiAgICAgIHRyeSB7DQogICAgICAgIGlmIChjdXJyZW50VG9rZW5JZCkNCiAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShgdG9rZW5fb2tfJHtjdXJyZW50VG9rZW5JZH1gLCAiMSIpOw0KICAgICAgICAvLyBBdnZpYSBpbCB0aW1lciBkaSB1dGlsaXp6byBwZXIgc2Vzc2lvbmUgdG9rZW4gZG9wbyBzdWJtaXQNCiAgICAgICAgaWYgKGN1cnJlbnRUb2tlbklkKSBhd2FpdCBzZXRUb2tlblVzYWdlU3RhcnRUaW1lKGN1cnJlbnRUb2tlbklkKTsNCiAgICAgICAgLy8gTmFzY29uZGkgcXVhbHNpYXNpIG92ZXJsYXkgZGkgc2NhZGVuemEgZXZlbnR1YWxtZW50ZSByaW1hc3RvDQogICAgICAgIHFzKCJTY2FkdXRhT3ZlcmxheSIpPy5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsNCiAgICAgICAgcXMoInNlc3Npb25TY2FkdXRhIik/LmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOw0KICAgICAgICB1bmJsb2NrQWNjZXNzKCk7DQogICAgICB9IGNhdGNoIHt9DQogICAgICBzaG93Q29udHJvbFBhbmVsKCk7DQogICAgICByZXR1cm47DQogICAgfQ0KICAgIGF3YWl0IHBlcmZvcm1NYW51YWxMb2dpbigpOw0KICB9DQoNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIC8vIElOSVpJQUxJWlpBWklPTkUgQVBQDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICBhc3luYyBmdW5jdGlvbiBpbml0KCkgew0KICAgIGNvbnNvbGUubG9nKCJJbml6aWFsaXp6YXppb25lIGFwcC4iKTsNCg0KICAgIGNvbnN0IGZpcmViYXNlU2V0dGluZ3MgPSBhd2FpdCBsb2FkU2V0dGluZ3NGcm9tRmlyZWJhc2UoKTsNCiAgICBpZiAoZmlyZWJhc2VTZXR0aW5ncykgYXBwbHlGaXJlYmFzZVNldHRpbmdzKGZpcmViYXNlU2V0dGluZ3MpOw0KDQogICAgaWYgKGlzU2Vzc2lvblN0dWNrKCkpIGNvbnNvbGUud2FybigiUmlsZXZhdGEgcG9zc2liaWxlIHNlc3Npb25lIGJsb2NjYXRhIik7DQoNCiAgICBjb25zdCBzYXZlZENvZGVWZXJzaW9uID0NCiAgICAgIHBhcnNlSW50KGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJjb2RlX3ZlcnNpb24iKSkgfHwgMTsNCiAgICBpZiAoc2F2ZWRDb2RlVmVyc2lvbiA8IGN1cnJlbnRDb2RlVmVyc2lvbikgew0KICAgICAgcmVzZXRTZXNzaW9uRm9yTmV3Q29kZSgpOw0KICAgIH0NCg0KICAgIHNldHVwRXZlbnRMaXN0ZW5lcnMoKTsNCiAgICBzZXR1cFNldHRpbmdzTGlzdGVuZXIoKTsNCiAgICBtb25pdG9yRmlyZWJhc2VDb25uZWN0aW9uKCk7DQoNCiAgICAvLyBCTE9DQ08gUEVSU0lTVEVOVEUgUFJJTUEgREkgVFVUVE8NCiAgICBjb25zdCBpc0Jsb2NrZWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiYmxvY2tfbWFudWFsX2xvZ2luIikgPT09ICIxIjsNCiAgICBpZiAoaXNCbG9ja2VkKSB7DQogICAgICBpc1Rva2VuU2Vzc2lvbiA9IGZhbHNlOw0KICAgICAgd2luZG93LmlzVG9rZW5TZXNzaW9uID0gZmFsc2U7DQogICAgICBzaG93U2Vzc2lvblNjYWR1dGEoKTsNCiAgICB9DQoNCiAgICAvLyBUT0tFTiBwcmltYSBkZWxsYSBzZXNzaW9uZSBtYW51YWxlDQogICAgYXdhaXQgaGFuZGxlU2VjdXJlVG9rZW4oKTsNCiAgICBzZXR1cFRva2VuVUkoKTsNCiAgICBpZiAoaXNUb2tlblNlc3Npb24pIHVuYmxvY2tBY2Nlc3MoKTsNCiAgICBpZiAoaXNCbG9ja2VkICYmICFpc1Rva2VuU2Vzc2lvbikgew0KICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIC8vIEF1dG8tYWNjZXNzbyBzZSB0b2tlbiBnacODxpLDgsKgIHZhbGlkYXRvIHN1IHF1ZXN0byBkaXNwb3NpdGl2bw0KICAgIGlmIChpc1Rva2VuU2Vzc2lvbikgew0KICAgICAgY29uc3QgdG9rID0NCiAgICAgICAgY3VycmVudFRva2VuSWQgfHwgbmV3IFVSTFNlYXJjaFBhcmFtcyhsb2NhdGlvbi5zZWFyY2gpLmdldCgidG9rZW4iKTsNCiAgICAgIHRyeSB7DQogICAgICAgIGlmICh0b2sgJiYgbG9jYWxTdG9yYWdlLmdldEl0ZW0oYHRva2VuX29rXyR7dG9rfWApID09PSAiMSIpIHsNCiAgICAgICAgICBzaG93Q29udHJvbFBhbmVsKCk7DQogICAgICAgIH0NCiAgICAgIH0gY2F0Y2gge30NCiAgICB9DQoNCiAgICAvLyBTZSBub24gYmxvY2NhdG8gZSBzZW56YSB0b2tlbjogVUkgbWFudWFsZQ0KICAgIGlmICghaXNUb2tlblNlc3Npb24gJiYgbG9jYWxTdG9yYWdlLmdldEl0ZW0oImJsb2NrX21hbnVhbF9sb2dpbiIpICE9PSAiMSIpIHsNCiAgICAgIGNvbnN0IFNjYWR1dGEgPSBhd2FpdCBjaGVja1RpbWVMaW1pdCgpOw0KICAgICAgaWYgKCFTY2FkdXRhKSB7DQogICAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IGdldFN0b3JhZ2UoInVzYWdlX3N0YXJ0X3RpbWUiKTsNCiAgICAgICAgaWYgKHN0YXJ0VGltZSkgew0KICAgICAgICAgIHNlc3Npb25TdGFydFRpbWUgPSBwYXJzZUludChzdGFydFRpbWUsIDEwKTsNCiAgICAgICAgICBzaG93Q29udHJvbFBhbmVsKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgc2hvd0F1dGhGb3JtKCk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHNob3dBdXRoRm9ybSgpOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHVwZGF0ZURvb3JWaXNpYmlsaXR5KCk7DQogICAgc2V0dXBJbnRlcnZhbHMoKTsNCiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjb250ZXh0bWVudSIsIChlKSA9PiBlLnByZXZlbnREZWZhdWx0KCkpOw0KICAgIHVwZGF0ZUNoZWNraW5UaW1lRGlzcGxheSgpOw0KICB9DQoNCiAgZnVuY3Rpb24gc2V0dXBFdmVudExpc3RlbmVycygpIHsNCiAgICBvbigiYnRuQ2hlY2tDb2RlIiwgImNsaWNrIiwgaGFuZGxlQ29kZVN1Ym1pdCk7DQoNCiAgICBERVZJQ0VTLmZvckVhY2goKGRldmljZSkgPT4gew0KICAgICAgY29uc3QgYnRuID0gcXMoZGV2aWNlLmJ1dHRvbl9pZCk7DQogICAgICBpZiAoYnRuKQ0KICAgICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiBzaG93Q29uZmlybWF0aW9uUG9wdXAoZGV2aWNlKSk7DQogICAgfSk7DQoNCiAgICBvbigiY29uZmlybVllcyIsICJjbGljayIsICgpID0+IHsNCiAgICAgIGlmIChjdXJyZW50RGV2aWNlKSB7DQogICAgICAgIGFjdGl2YXRlRGV2aWNlKGN1cnJlbnREZXZpY2UpOw0KICAgICAgICBjbG9zZUNvbmZpcm1hdGlvblBvcHVwKCk7DQogICAgICB9DQogICAgfSk7DQogICAgb24oImNvbmZpcm1ObyIsICJjbGljayIsIGNsb3NlQ29uZmlybWF0aW9uUG9wdXApOw0KDQogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLnBvcHVwIC5idG4iKS5mb3JFYWNoKChidXR0b24pID0+IHsNCiAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgY29uc3QgcG9wdXAgPSB0aGlzLmNsb3Nlc3QoIi5wb3B1cCIpOw0KICAgICAgICBpZiAocG9wdXApIHsNCiAgICAgICAgICBjb25zdCBpZCA9IHBvcHVwLmlkLnJlcGxhY2UoInBvcHVwLSIsICIiKTsNCiAgICAgICAgICBjbG9zZVBvcHVwKGlkKTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfSk7DQogIH0NCg0KICBmdW5jdGlvbiBzaG93Q29udHJvbFBhbmVsKCkgew0KICAgIGNvbnN0IGNwID0gcXMoImNvbnRyb2xQYW5lbCIpOw0KICAgIGlmIChjcCkgew0KICAgICAgY3AuY2xhc3NMaXN0LnJlbW92ZSgiaGlkZGVuIik7DQogICAgICBjcC5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsNCiAgICB9DQogICAgY29uc3Qgcm9vdCA9IHFzKCJ0ZXN0MiIpOw0KICAgIGlmIChyb290KSByb290LnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOw0KICAgIGNvbnN0IGFjID0gcXMoImF1dGhDb2RlIik7DQogICAgaWYgKGFjKSBhYy5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICAgIGNvbnN0IGFmID0gcXMoImF1dGgtZm9ybSIpOw0KICAgIGlmIChhZikgYWYuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCiAgICBjb25zdCBiYyA9IHFzKCJidG5DaGVja0NvZGUiKTsNCiAgICBpZiAoYmMpIGJjLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogICAgY29uc3QgaW1wID0gcXMoImltcG9ydGFudCIpOw0KICAgIGlmIChpbXApIGltcC5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICAgIC8vIGFzc2ljdXJhdGkgY2hlIGV2ZW50dWFsaSBvdmVybGF5IG5vbiBjb3ByYW5vIGlsIHBhbm5lbGxvDQogICAgcXMoIlNjYWR1dGFPdmVybGF5Iik/LmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOw0KICAgIHFzKCJzZXNzaW9uU2NhZHV0YSIpPy5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsNCiAgICBjb25zdCBpbmZvID0gcXMoImNoZWNraW5UaW1lSW5mbyIpOw0KICAgIGlmIChpbmZvKSBpbmZvLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOw0KICAgIHVwZGF0ZUNoZWNraW5UaW1lRGlzcGxheSgpOw0KICAgIERFVklDRVMuZm9yRWFjaCh1cGRhdGVCdXR0b25TdGF0ZSk7DQogICAgdXBkYXRlU3RhdHVzQmFyKCk7DQogIH0NCg0KICBmdW5jdGlvbiBzaG93QXV0aEZvcm0oKSB7DQogICAgY29uc3QgY3AgPSBxcygiY29udHJvbFBhbmVsIik7DQogICAgaWYgKGNwKSBjcC5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICAgIGNvbnN0IGFjID0gcXMoImF1dGhDb2RlIik7DQogICAgaWYgKGFjKSBhYy5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsNCiAgICBjb25zdCBhZiA9IHFzKCJhdXRoLWZvcm0iKTsNCiAgICBpZiAoYWYpIGFmLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOw0KICAgIGNvbnN0IGJjID0gcXMoImJ0bkNoZWNrQ29kZSIpOw0KICAgIGlmIChiYykgYmMuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7DQogICAgY29uc3QgaW1wID0gcXMoImltcG9ydGFudCIpOw0KICAgIGlmIChpbXApIGltcC5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNldHVwVG9rZW5VSSgpIHsNCiAgICBpZiAoIWlzVG9rZW5TZXNzaW9uKSByZXR1cm47DQoNCiAgICBjb25zdCBhZG1pbkxpbmsgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdhW2hyZWY9ImFkbWluLmh0bWwiXScpOw0KICAgIGlmIChhZG1pbkxpbmspIGFkbWluTGluay5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KDQogICAgY29uc3QgU2NhZHV0YU1lc3NhZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjc2Vzc2lvblNjYWR1dGEgcCIpOw0KICAgIGlmIChTY2FkdXRhTWVzc2FnZSkNCiAgICAgIFNjYWR1dGFNZXNzYWdlLnRleHRDb250ZW50ID0NCiAgICAgICAgIklsIGxpbmsgZGkgYWNjZXNzbyBzY2FkdXRvLiBQZXIgYWNjZWRlcmUgZGkgbnVvdm8sIHJpY2hpZWRpIHVuIG51b3ZvIGxpbmsuIjsNCg0KICAgIGNvbnN0IGFzc2lzdGFuY2VCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKA0KICAgICAgIiNzZXNzaW9uU2NhZHV0YSAuYnRuLXdoYXRzYXBwIg0KICAgICk7DQogICAgaWYgKGFzc2lzdGFuY2VCdG4pIHsNCiAgICAgIGFzc2lzdGFuY2VCdG4uaHJlZiA9DQogICAgICAgICJodHRwczovL2FwaS53aGF0c2FwcC5jb20vc2VuZD9waG9uZT0rMzkzODk4ODgzNjM0JnRleHQ9SGksIEkgbmVlZCBhIG5ldyBhY2Nlc3MgbGluayI7DQogICAgICBhc3Npc3RhbmNlQnRuLmlubmVySFRNTCA9DQogICAgICAgICc8aSBjbGFzcz0iZmFiIGZhLXdoYXRzYXBwIj48L2k+IFJpY2hpZWRpIG51b3ZvIGxpbmsnOw0KICAgIH0NCg0KICAgIGNvbnN0IGF1dGhDb2RlSW5wdXQgPSBxcygiYXV0aENvZGUiKTsNCiAgICBpZiAoYXV0aENvZGVJbnB1dCkgew0KICAgICAgYXV0aENvZGVJbnB1dC5wbGFjZWhvbGRlciA9IGN1cnJlbnRUb2tlbkN1c3RvbUNvZGUNCiAgICAgICAgPyAiSW5zZXJpc2NpIGlsIGNvZGljZSBkZWRpY2F0byBkZWwgbGluayINCiAgICAgICAgOiAiSW5zZXJpc2NpIGlsIGNvZGljZSBwcmluY2lwYWxlIjsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBzZXR1cEludGVydmFscygpIHsNCiAgICBzZXR1cENvZGVDaGFuZ2VMaXN0ZW5lcigpOw0KDQogICAgdGltZUNoZWNrSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChhc3luYyAoKSA9PiB7DQogICAgICBjb25zdCBTY2FkdXRhID0gYXdhaXQgY2hlY2tUaW1lTGltaXQoKTsNCiAgICAgIGlmICghU2NhZHV0YSkgew0KICAgICAgICBhd2FpdCB1cGRhdGVHbG9iYWxDb2RlVmVyc2lvbigpOw0KICAgICAgICB1cGRhdGVDaGVja2luVGltZURpc3BsYXkoKTsNCiAgICAgIH0NCiAgICB9LCAxMDAwKTsNCg0KICAgIHNldEludGVydmFsKHVwZGF0ZUNoZWNraW5UaW1lRGlzcGxheSwgNjAwMDApOw0KICB9DQoNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIC8vIEFWVklPL1NUT1ANCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCBpbml0KTsNCg0KICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigiYmVmb3JldW5sb2FkIiwgKCkgPT4gew0KICAgIGlmICh0aW1lQ2hlY2tJbnRlcnZhbCkgY2xlYXJJbnRlcnZhbCh0aW1lQ2hlY2tJbnRlcnZhbCk7DQogICAgaWYgKGNvZGVDaGVja0ludGVydmFsKSBjbGVhckludGVydmFsKGNvZGVDaGVja0ludGVydmFsKTsNCiAgICBpZiAoTElOS19DSEVDS19JTlRFUlZBTCkgY2xlYXJJbnRlcnZhbChMSU5LX0NIRUNLX0lOVEVSVkFMKTsNCiAgICBzdG9wVG9rZW5SZWFsdGltZUxpc3RlbmVyKCk7DQogICAgaWYgKHNldHRpbmdzUmVmKSBzZXR0aW5nc1JlZi5vZmYgJiYgc2V0dGluZ3NSZWYub2ZmKCk7DQogIH0pOw0KDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICAvLyBFU1BPUlRBWklPTkUgRlVOWklPTkkgR0xPQkFMSSAoY29tcGF0aWJpbGl0w4PGksOCwqApDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICBPYmplY3QuYXNzaWduKHdpbmRvdywgew0KICAgIC8vIHV0aWxzDQogICAgcXMsDQogICAgb24sDQogICAgc2hvd05vdGlmaWNhdGlvbiwNCiAgICBmb3JtYXRUaW1lLA0KICAgIGZldGNoV2l0aFRpbWVvdXQsDQogICAgLy8gc3RvcmFnZQ0KICAgIHNldFN0b3JhZ2UsDQogICAgZ2V0U3RvcmFnZSwNCiAgICBjbGVhclN0b3JhZ2UsDQogICAgLy8gY3J5cHRvDQogICAgZ2VuZXJhdGVIYXNoLA0KICAgIC8vIHNldHRpbmdzDQogICAgbG9hZFNldHRpbmdzRnJvbUZpcmViYXNlLA0KICAgIGFwcGx5RmlyZWJhc2VTZXR0aW5ncywNCiAgICBzZXR1cFNldHRpbmdzTGlzdGVuZXIsDQogICAgbW9uaXRvckZpcmViYXNlQ29ubmVjdGlvbiwNCiAgICAvLyB0ZW1wby9zZXNzaW9uZQ0KICAgIHNldFVzYWdlU3RhcnRUaW1lLA0KICAgIGNoZWNrVGltZUxpbWl0LA0KICAgIHNob3dGYXRhbEVycm9yLA0KICAgIHNob3dTZXNzaW9uU2NhZHV0YSwNCiAgICBpc1Nlc3Npb25TdHVjaywNCiAgICAvLyBjaGVjay1pbiB0aW1lDQogICAgaXNDaGVja2luVGltZSwNCiAgICB1cGRhdGVDaGVja2luVGltZURpc3BsYXksDQogICAgc2hvd0Vhcmx5Q2hlY2tpblBvcHVwLA0KICAgIGNsb3NlRWFybHlDaGVja2luUG9wdXAsDQogICAgLy8gVUkNCiAgICB1cGRhdGVTdGF0dXNCYXIsDQogICAgZ2V0Q2xpY2tzTGVmdCwNCiAgICBzZXRDbGlja3NMZWZ0LA0KICAgIHVwZGF0ZUJ1dHRvblN0YXRlLA0KICAgIHVwZGF0ZURvb3JWaXNpYmlsaXR5LA0KICAgIC8vIGNvZGUgY2hhbmdlDQogICAgc2V0dXBDb2RlQ2hhbmdlTGlzdGVuZXIsDQogICAgY2hlY2tDb2RlVmVyc2lvbiwNCiAgICBoYW5kbGVDb2RlQ2hhbmdlLA0KICAgIHJlc2V0U2Vzc2lvbkZvck5ld0NvZGUsDQogICAgY2hlY2tTY2FkdXRhTGlua3MsDQogICAgLy8gcG9wdXANCiAgICBzaG93Q29uZmlybWF0aW9uUG9wdXAsDQogICAgY2xvc2VDb25maXJtYXRpb25Qb3B1cCwNCiAgICBzaG93RGV2aWNlUG9wdXAsDQogICAgY2xvc2VQb3B1cCwNCiAgICAvLyBzaGVsbHkNCiAgICBhY3RpdmF0ZURldmljZSwNCiAgICB1cGRhdGVHbG9iYWxDb2RlVmVyc2lvbiwNCiAgICAvLyB0b2tlbg0KICAgIGhhbmRsZVNlY3VyZVRva2VuLA0KICAgIHN0b3BUb2tlblJlYWx0aW1lTGlzdGVuZXIsDQogICAgY2xlYXJNYW51YWxTZXNzaW9uLA0KICAgIGJsb2NrQWNjZXNzLA0KICAgIHVuYmxvY2tBY2Nlc3MsDQogICAgZm9yY2VHbG9iYWxMb2dvdXQsDQogICAgZm9yY2VMb2dvdXRGcm9tVG9rZW4sDQogICAgc3RhcnRUb2tlblJlYWx0aW1lTGlzdGVuZXIsDQogICAgdmFsaWRhdGVTZWN1cmVUb2tlbiwNCiAgICBpbmNyZW1lbnRUb2tlblVzYWdlLA0KICAgIHNob3dUb2tlbk5vdGlmaWNhdGlvbiwNCiAgICBzaG93VG9rZW5FcnJvciwNCiAgICBjbGVhblVybCwNCiAgICBzdGFydFRva2VuRXhwaXJhdGlvbkNoZWNrLA0KICAgIC8vIGF1dGgNCiAgICBwZXJmb3JtTWFudWFsTG9naW4sDQogICAgaGFuZGxlQ29kZVN1Ym1pdCwNCiAgICAvLyBhcHAgbGlmZWN5Y2xlDQogICAgaW5pdCwNCiAgICBzZXR1cEV2ZW50TGlzdGVuZXJzLA0KICAgIHNob3dDb250cm9sUGFuZWwsDQogICAgc2hvd0F1dGhGb3JtLA0KICAgIHNldHVwVG9rZW5VSSwNCiAgICBzZXR1cEludGVydmFscywNCiAgfSk7DQp9KSgpOw0KDQoNCg0K');