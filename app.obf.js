(function(s){try{(0,eval)(atob(s));}catch(e){console.error('obf error',e);}})('KCgpID0+IHsNCiAgInVzZSBzdHJpY3QiOw0KDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICAvLyBDT05GSUdVUkFaSU9ORSBFIElOSVpJQUxJWlpBWklPTkUNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIGNvbnN0IGZpcmViYXNlQ29uZmlnID0gew0KICAgIGFwaUtleTogIkFJemFTeUN1eTNTYWs5NnNvQ2xhN2I1WWI1d21rZFZmTXFBWG1vayIsDQogICAgYXV0aERvbWFpbjogImNoZWNrLWluLTRlMGU5LmZpcmViYXNlYXBwLmNvbSIsDQogICAgZGF0YWJhc2VVUkw6DQogICAgICAiaHR0cHM6Ly9jaGVjay1pbi00ZTBlOS1kZWZhdWx0LXJ0ZGIuZXVyb3BlLXdlc3QxLmZpcmViYXNlZGF0YWJhc2UuYXBwIiwNCiAgICBwcm9qZWN0SWQ6ICJjaGVjay1pbi00ZTBlOSIsDQogICAgc3RvcmFnZUJ1Y2tldDogImNoZWNrLWluLTRlMGU5LmZpcmViYXNlc3RvcmFnZS5hcHAiLA0KICAgIG1lc3NhZ2luZ1NlbmRlcklkOiAiNzIzODgwOTkwMTc3IiwNCiAgICBhcHBJZDogIjE6NzIzODgwOTkwMTc3OndlYjpmMDAyNzMzYjJjYzJlNTBkMTcyZWEwIiwNCiAgICBtZWFzdXJlbWVudElkOiAiRy1IOTdHQjlMNEY1IiwNCiAgfTsNCg0KICBjb25zdCBCQVNFX1VSTF9TRVQgPQ0KICAgICJodHRwczovL3NoZWxseS03My1ldS5zaGVsbHkuY2xvdWQvdjIvZGV2aWNlcy9hcGkvc2V0L3N3aXRjaCI7DQogIGNvbnN0IFNFQ1JFVF9LRVkgPSAibXVzYXJ0X3NlY3JldF8xMjNfZml4ZWRfa2V5IjsNCiAgY29uc3QgQ09ERV9WRVJTSU9OX0tFWSA9ICJjb2RlX3ZlcnNpb24iOw0KICBjb25zdCBLRUVQX1RPS0VOX0lOX1VSTCA9IHRydWU7IC8vIG1hbnRpZW5pIGlsIHRva2VuIG5lbGwnVVJMIGRvcG8gbGEgdmVyaWZpY2ENCiAgY29uc3QgVU5CTE9DS19WRVJTSU9OX0tFWSA9ICJ1bmJsb2NrX3ZlcnNpb24iOw0KDQogIC8vIENvbmZpZ3VyYXppb25lIGRpc3Bvc2l0aXZpIFNoZWxseSAoaW1tdXRhYmlsZSkNCiAgY29uc3QgREVWSUNFUyA9IE9iamVjdC5mcmVlemUoWw0KICAgIHsNCiAgICAgIGlkOiAiZTRiMDYzZjBjMzhjIiwNCiAgICAgIGF1dGhfa2V5Og0KICAgICAgICAiTVdJMk1EYzRkV2xrNDkwOEE3MURBODA5RkNFQzA1QzVEMUYzNjA5NDNGQkZDNkE3OTM0RUMwRkQ5RTNDRkVBRjAzRjhGNUE2QTRBMEM2MDY2NUI5N0ExQUEyRTIiLA0KICAgICAgc3RvcmFnZV9rZXk6ICJjbGlja3NfTWFpbkRvb3IiLA0KICAgICAgYnV0dG9uX2lkOiAiTWFpbkRvb3IiLA0KICAgICAgdmlzaWJsZTogdHJ1ZSwNCiAgICB9LA0KICAgIHsNCiAgICAgIGlkOiAiMzQ5NDU0NzhkNTk1IiwNCiAgICAgIGF1dGhfa2V5Og0KICAgICAgICAiTVdJMk1EYzRkV2xrNDkwOEE3MURBODA5RkNFQzA1QzVEMUYzNjA5NDNGQkZDNkE3OTM0RUMwRkQ5RTNDRkVBRjAzRjhGNUE2QTRBMEM2MDY2NUI5N0ExQUEyRTIiLA0KICAgICAgc3RvcmFnZV9rZXk6ICJjbGlja3NfQXB0RG9vciIsDQogICAgICBidXR0b25faWQ6ICJBcHREb29yIiwNCiAgICAgIHZpc2libGU6IHRydWUsDQogICAgfSwNCiAgICB7DQogICAgICBpZDogIjM0OTQ1NDdhYjE2MSIsDQogICAgICBhdXRoX2tleToNCiAgICAgICAgIk1XSTJNRGM0ZFdsazQ5MDhBNzFEQTgwOUZDRUMwNUM1RDFGMzYwOTQzRkJGQzZBNzkzNEVDMEZEOUUzQ0ZFQUYwM0Y4RjVBNkE0QTBDNjA2NjVCOTdBMUFBMkUyIiwNCiAgICAgIHN0b3JhZ2Vfa2V5OiAiY2xpY2tzX0V4dHJhRG9vcjEiLA0KICAgICAgYnV0dG9uX2lkOiAiRXh0cmFEb29yMSIsDQogICAgICB2aXNpYmxlOiBmYWxzZSwNCiAgICB9LA0KICAgIHsNCiAgICAgIGlkOiAicGxhY2Vob2xkZXJfaWRfMiIsDQogICAgICBhdXRoX2tleTogInBsYWNlaG9sZGVyX2F1dGhfa2V5XzIiLA0KICAgICAgc3RvcmFnZV9rZXk6ICJjbGlja3NfRXh0cmFEb29yMiIsDQogICAgICBidXR0b25faWQ6ICJFeHRyYURvb3IyIiwNCiAgICAgIHZpc2libGU6IGZhbHNlLA0KICAgIH0sDQogIF0pOw0KDQogIC8vIFZhcmlhYmlsaSBnbG9iYWxpL2RpIHN0YXRvDQogIGxldCBNQVhfQ0xJQ0tTID0gcGFyc2VJbnQobG9jYWxTdG9yYWdlLmdldEl0ZW0oIm1heF9jbGlja3MiKSkgfHwgMzsNCiAgbGV0IFRJTUVfTElNSVRfTUlOVVRFUyA9CiAgICBwYXJzZUludChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgidGltZV9saW1pdF9taW51dGVzIikpIHx8IDUwMDAwOwogIC8vIExpbWl0ZSBwZXIgc2Vzc2lvbmkgdG9rZW4gZG9wbyBzdWJtaXQgKGRpIGRlZmF1bHQgdWd1YWxlIGEgVElNRV9MSU1JVF9NSU5VVEVTKQogIGNvbnN0IFRPS0VOX0xJTUlUX01JTlVURVMgPQogICAgcGFyc2VJbnQobG9jYWxTdG9yYWdlLmdldEl0ZW0oInRva2VuX3RpbWVfbGltaXRfbWludXRlcyIpKSB8fAogICAgVElNRV9MSU1JVF9NSU5VVEVTOwogIGxldCBDT1JSRUNUX0NPREUgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgic2VjcmV0X2NvZGUiKSB8fCAiMjI0NSI7DQogIGxldCBjdXJyZW50Q29kZVZlcnNpb24gPQ0KICAgIHBhcnNlSW50KGxvY2FsU3RvcmFnZS5nZXRJdGVtKENPREVfVkVSU0lPTl9LRVkpKSB8fCAxOw0KDQogIC8vIE9yYXJpIGRpIGNoZWNrw4PCosOi4oCawqzDouKCrMucaW4gKGRpIGRlZmF1bHQsIHBvaSBhcnJpdmFubyBkYSBGaXJlYmFzZSkNCiAgbGV0IENIRUNLSU5fU1RBUlRfVElNRSA9ICIxNDowMCI7DQogIGxldCBDSEVDS0lOX0VORF9USU1FID0gIjIyOjAwIjsNCiAgbGV0IENIRUNLSU5fVElNRV9FTkFCTEVEID0gdHJ1ZTsNCg0KICAvLyBTdGF0byBydW50aW1lDQogIGxldCBpc1Rva2VuU2Vzc2lvbiA9IGZhbHNlOyAvLyBVU0FSRSBTRU1QUkUgUVVFU1RBDQogIGxldCBjdXJyZW50VG9rZW5JZCA9IG51bGw7DQogIGxldCBjdXJyZW50VG9rZW5DdXN0b21Db2RlID0gbnVsbDsNCiAgbGV0IHNlc3Npb25TdGFydFRpbWUgPSBudWxsOw0KICBsZXQgY3VycmVudERldmljZSA9IG51bGw7DQoNCiAgLy8gSW50ZXJ2YWxsaS9saXN0ZW5lcg0KICBsZXQgdGltZUNoZWNrSW50ZXJ2YWwgPSBudWxsOw0KICBsZXQgY29kZUNoZWNrSW50ZXJ2YWwgPSBudWxsOw0KICBsZXQgTElOS19DSEVDS19JTlRFUlZBTCA9IG51bGw7DQogIGxldCBzZXR0aW5nc1JlZiA9IG51bGw7DQogIGxldCB0b2tlblJlZiA9IG51bGw7DQoNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIC8vIEZpcmViYXNlIGluaXQgKGNvbiBndWFyZGlhKQ0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgaWYgKCFmaXJlYmFzZS5hcHBzIHx8IGZpcmViYXNlLmFwcHMubGVuZ3RoID09PSAwKSB7DQogICAgZmlyZWJhc2UuaW5pdGlhbGl6ZUFwcChmaXJlYmFzZUNvbmZpZyk7DQogIH0NCiAgY29uc3QgZGF0YWJhc2UgPSBmaXJlYmFzZS5kYXRhYmFzZSgpOw0KDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICAvLyBVVElMUw0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgZnVuY3Rpb24gcXMoaWQpIHsNCiAgICByZXR1cm4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOw0KICB9DQoNCiAgZnVuY3Rpb24gb24oaWQsIGV2dCwgaGFuZGxlcikgew0KICAgIGNvbnN0IGVsID0gcXMoaWQpOw0KICAgIGlmIChlbCkgZWwuYWRkRXZlbnRMaXN0ZW5lcihldnQsIGhhbmRsZXIpOw0KICB9DQoNCiAgZnVuY3Rpb24gc2hvd05vdGlmaWNhdGlvbihtZXNzYWdlLCB0eXBlID0gImluZm8iKSB7DQogICAgY29uc3QgZXhpc3RpbmcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29kZUNoYW5nZU5vdGlmaWNhdGlvbiIpOw0KICAgIGlmIChleGlzdGluZykgZXhpc3RpbmcucmVtb3ZlKCk7DQoNCiAgICBjb25zdCBuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgbi5pZCA9ICJjb2RlQ2hhbmdlTm90aWZpY2F0aW9uIjsNCiAgICBuLnN0eWxlLmNzc1RleHQgPSBgDQogICAgICBwb3NpdGlvbjogZml4ZWQ7IHRvcDogMjBweDsgcmlnaHQ6IDIwcHg7IHotaW5kZXg6IDEwMDAwOw0KICAgICAgYmFja2dyb3VuZDogJHsNCiAgICAgICAgdHlwZSA9PT0gIndhcm5pbmciDQogICAgICAgICAgPyAiI0ZGQTUwMCINCiAgICAgICAgICA6IHR5cGUgPT09ICJlcnJvciINCiAgICAgICAgICA/ICIjRkY1QTVGIg0KICAgICAgICAgIDogIiM0Q0FGNTAiDQogICAgICB9Ow0KICAgICAgY29sb3I6ICNmZmY7IHBhZGRpbmc6IDE1cHggMjBweDsgYm9yZGVyLXJhZGl1czogOHB4OyBib3gtc2hhZG93OiAwIDRweCAxMnB4IHJnYmEoMCwwLDAsLjEyKTsNCiAgICAgIGRpc3BsYXk6ZmxleDsgZ2FwOjEwcHg7IGFsaWduLWl0ZW1zOmNlbnRlcjsgbWF4LXdpZHRoOjM2MHB4Ow0KICAgIGA7DQogICAgbi5pbm5lckhUTUwgPSBgDQogICAgICA8aSBjbGFzcz0iZmFzIGZhLWluZm8tY2lyY2xlIj48L2k+DQogICAgICA8c3Bhbj4ke21lc3NhZ2V9PC9zcGFuPg0KICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJ0aGlzLnBhcmVudEVsZW1lbnQucmVtb3ZlKCkiIHN0eWxlPSJiYWNrZ3JvdW5kOm5vbmU7Ym9yZGVyOm5vbmU7Y29sb3I6I2ZmZjtjdXJzb3I6cG9pbnRlciI+DQogICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdGltZXMiPjwvaT4NCiAgICAgIDwvYnV0dG9uPmA7DQogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChuKTsNCiAgICBzZXRUaW1lb3V0KCgpID0+IG4ucGFyZW50RWxlbWVudCAmJiBuLnJlbW92ZSgpLCA1MDAwKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGZvcm1hdFRpbWUodGltZVN0cmluZykgew0KICAgIGNvbnN0IFtoLCBtXSA9IFN0cmluZyh0aW1lU3RyaW5nIHx8ICIiKS5zcGxpdCgiOiIpOw0KICAgIHJldHVybiBgJHtoPy5wYWRTdGFydCgyLCAiMCIpfToke20/LnBhZFN0YXJ0KDIsICIwIil9YDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGZldGNoV2l0aFRpbWVvdXQodXJsLCBvcHRpb25zID0ge30sIHRpbWVvdXRNcyA9IDEyMDAwKSB7DQogICAgY29uc3QgY29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsNCiAgICBjb25zdCBpZCA9IHNldFRpbWVvdXQoKCkgPT4gY29udHJvbGxlci5hYm9ydCgpLCB0aW1lb3V0TXMpOw0KICAgIGNvbnN0IHAgPSBmZXRjaCh1cmwsIHsgLi4ub3B0aW9ucywgc2lnbmFsOiBjb250cm9sbGVyLnNpZ25hbCB9KS5maW5hbGx5KA0KICAgICAgKCkgPT4gY2xlYXJUaW1lb3V0KGlkKQ0KICAgICk7DQogICAgcmV0dXJuIHA7DQogIH0NCg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgLy8gU1RPUkFHRSAobG9jYWxTdG9yYWdlICsgY29va2llIGNvbXBhdCkNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIGZ1bmN0aW9uIHNldFN0b3JhZ2Uoa2V5LCB2YWx1ZSwgbWludXRlcykgew0KICAgIHRyeSB7DQogICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIHZhbHVlKTsNCiAgICAgIGNvbnN0IGV4cGlyYXRpb25EYXRlID0gbmV3IERhdGUoKTsNCiAgICAgIGV4cGlyYXRpb25EYXRlLnNldFRpbWUoZXhwaXJhdGlvbkRhdGUuZ2V0VGltZSgpICsgbWludXRlcyAqIDYwICogMTAwMCk7DQogICAgICBjb25zdCBleHBpcmVzID0gImV4cGlyZXM9IiArIGV4cGlyYXRpb25EYXRlLnRvVVRDU3RyaW5nKCk7DQogICAgICBkb2N1bWVudC5jb29raWUgPSBgJHtrZXl9PSR7dmFsdWV9OyAke2V4cGlyZXN9OyBwYXRoPS87IFNhbWVTaXRlPVN0cmljdGA7DQogICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yZSBuZWwgc2FsdmF0YWdnaW8gZGVpIGRhdGk6IiwgZXJyb3IpOw0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIGdldFN0b3JhZ2Uoa2V5KSB7DQogICAgdHJ5IHsNCiAgICAgIGNvbnN0IGxvY2FsVmFsdWUgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpOw0KICAgICAgaWYgKGxvY2FsVmFsdWUgIT09IG51bGwpIHJldHVybiBsb2NhbFZhbHVlOw0KICAgICAgY29uc3QgY29va2llcyA9IGRvY3VtZW50LmNvb2tpZS5zcGxpdCgiOyIpOw0KICAgICAgZm9yIChjb25zdCBjb29raWUgb2YgY29va2llcykgew0KICAgICAgICBjb25zdCBbbmFtZSwgdmFsdWVdID0gY29va2llLnRyaW0oKS5zcGxpdCgiPSIpOw0KICAgICAgICBpZiAobmFtZSA9PT0ga2V5KSByZXR1cm4gdmFsdWU7DQogICAgICB9DQogICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yZSBuZWwgcmVjdXBlcm8gZGVpIGRhdGk6IiwgZXJyb3IpOw0KICAgIH0NCiAgICByZXR1cm4gbnVsbDsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNsZWFyU3RvcmFnZShrZXkpIHsNCiAgICB0cnkgew0KICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTsNCiAgICAgIGRvY3VtZW50LmNvb2tpZSA9IGAke2tleX09OyBleHBpcmVzPVRodSwgMDEgSmFuIDE5NzAgMDA6MDA6MDAgVVRDOyBwYXRoPS87YDsNCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgY29uc29sZS5lcnJvcigiRXJyb3JlIG5lbGxhIHJpbW96aW9uZSBkZWkgZGF0aToiLCBlcnJvcik7DQogICAgfQ0KICB9DQoNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIC8vIENSSVRUT0dSQUZJQQ0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVIYXNoKHN0cikgew0KICAgIGNvbnN0IGVuY29kZXIgPSBuZXcgVGV4dEVuY29kZXIoKTsNCiAgICBjb25zdCBkYXRhID0gZW5jb2Rlci5lbmNvZGUoc3RyKTsNCiAgICBjb25zdCBoYXNoQnVmZmVyID0gYXdhaXQgY3J5cHRvLnN1YnRsZS5kaWdlc3QoIlNIQS0yNTYiLCBkYXRhKTsNCiAgICBjb25zdCBoYXNoQXJyYXkgPSBBcnJheS5mcm9tKG5ldyBVaW50OEFycmF5KGhhc2hCdWZmZXIpKTsNCiAgICByZXR1cm4gaGFzaEFycmF5Lm1hcCgoYikgPT4gYi50b1N0cmluZygxNikucGFkU3RhcnQoMiwgIjAiKSkuam9pbigiIik7DQogIH0NCg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgLy8gSU1QT1NUQVpJT05JIChGaXJlYmFzZSkNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIGFzeW5jIGZ1bmN0aW9uIGxvYWRTZXR0aW5nc0Zyb21GaXJlYmFzZSgpIHsNCiAgICB0cnkgew0KICAgICAgY29uc3Qgc25hcHNob3QgPSBhd2FpdCBkYXRhYmFzZS5yZWYoInNldHRpbmdzIikub25jZSgidmFsdWUiKTsNCiAgICAgIHJldHVybiBzbmFwc2hvdC5leGlzdHMoKSA/IHNuYXBzaG90LnZhbCgpIDogbnVsbDsNCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgY29uc29sZS5lcnJvcigNCiAgICAgICAgIkVycm9yZSBuZWwgY2FyaWNhbWVudG8gZGVsbGUgaW1wb3N0YXppb25pIGRhIEZpcmViYXNlOiIsDQogICAgICAgIGVycm9yDQogICAgICApOw0KICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gYXBwbHlGaXJlYmFzZVNldHRpbmdzKHNldHRpbmdzKSB7DQogICAgaWYgKHNldHRpbmdzPy5zZWNyZXRfY29kZSkgew0KICAgICAgQ09SUkVDVF9DT0RFID0gc2V0dGluZ3Muc2VjcmV0X2NvZGU7DQogICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgic2VjcmV0X2NvZGUiLCBzZXR0aW5ncy5zZWNyZXRfY29kZSk7DQogICAgfQ0KICAgIGlmIChzZXR0aW5ncz8ubWF4X2NsaWNrcykgew0KICAgICAgTUFYX0NMSUNLUyA9IHBhcnNlSW50KHNldHRpbmdzLm1heF9jbGlja3MsIDEwKTsNCiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJtYXhfY2xpY2tzIiwgc2V0dGluZ3MubWF4X2NsaWNrcyk7DQogICAgfQ0KICAgIGlmIChzZXR0aW5ncz8udGltZV9saW1pdF9taW51dGVzKSB7DQogICAgICBUSU1FX0xJTUlUX01JTlVURVMgPSBwYXJzZUludChzZXR0aW5ncy50aW1lX2xpbWl0X21pbnV0ZXMsIDEwKTsNCiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJ0aW1lX2xpbWl0X21pbnV0ZXMiLCBzZXR0aW5ncy50aW1lX2xpbWl0X21pbnV0ZXMpOw0KICAgIH0NCiAgICBpZiAodHlwZW9mIHNldHRpbmdzPy5jaGVja2luX3N0YXJ0X3RpbWUgPT09ICJzdHJpbmciKQ0KICAgICAgQ0hFQ0tJTl9TVEFSVF9USU1FID0gc2V0dGluZ3MuY2hlY2tpbl9zdGFydF90aW1lOw0KICAgIGlmICh0eXBlb2Ygc2V0dGluZ3M/LmNoZWNraW5fZW5kX3RpbWUgPT09ICJzdHJpbmciKQ0KICAgICAgQ0hFQ0tJTl9FTkRfVElNRSA9IHNldHRpbmdzLmNoZWNraW5fZW5kX3RpbWU7DQogICAgaWYgKHR5cGVvZiBzZXR0aW5ncz8uY2hlY2tpbl90aW1lX2VuYWJsZWQgIT09ICJ1bmRlZmluZWQiKQ0KICAgICAgQ0hFQ0tJTl9USU1FX0VOQUJMRUQgPSBTdHJpbmcoc2V0dGluZ3MuY2hlY2tpbl90aW1lX2VuYWJsZWQpICE9PSAiZmFsc2UiOw0KDQogICAgdXBkYXRlQ2hlY2tpblRpbWVEaXNwbGF5KCk7DQogICAgREVWSUNFUy5mb3JFYWNoKHVwZGF0ZUJ1dHRvblN0YXRlKTsNCiAgICB1cGRhdGVTdGF0dXNCYXIoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNldHVwU2V0dGluZ3NMaXN0ZW5lcigpIHsNCiAgICBpZiAoc2V0dGluZ3NSZWYpIHJldHVybjsgLy8gZXZpdGEgZG9wcGlvIGxpc3RlbmVyDQogICAgc2V0dGluZ3NSZWYgPSBkYXRhYmFzZS5yZWYoInNldHRpbmdzIik7DQogICAgc2V0dGluZ3NSZWYub24oInZhbHVlIiwgKHNuYXApID0+IHsNCiAgICAgIGNvbnN0IHMgPSBzbmFwLnZhbCgpIHx8IHt9Ow0KICAgICAgYXBwbHlGaXJlYmFzZVNldHRpbmdzKHMpOw0KDQogICAgICAvLyBLaWxsLXN3aXRjaDogY2FtYmlvIGNvZGljZSBnbG9iYWxlID0+IGJsb2NjYSBlIGZvcnphIGxvZ291dA0KICAgICAgY29uc3Qgc2VydmVyQ29kZVZlciA9IHBhcnNlSW50KHMuY29kZV92ZXJzaW9uIHx8IDEsIDEwKTsNCiAgICAgIGNvbnN0IGxvY2FsQ29kZVZlciA9IHBhcnNlSW50KA0KICAgICAgICBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShDT0RFX1ZFUlNJT05fS0VZKSB8fCAiMSIsDQogICAgICAgIDEwDQogICAgICApOw0KICAgICAgaWYgKHNlcnZlckNvZGVWZXIgPiBsb2NhbENvZGVWZXIpIHsgY29uc3QgaGFkTG9jYWxWZXJzaW9uID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oQ09ERV9WRVJTSU9OX0tFWSkgIT09IG51bGw7IGxvY2FsU3RvcmFnZS5zZXRJdGVtKENPREVfVkVSU0lPTl9LRVksIFN0cmluZyhzZXJ2ZXJDb2RlVmVyKSk7IGlmIChoYXNUb2tlbkZvb3RwcmludCgpIHx8IGhhZExvY2FsVmVyc2lvbikgeyBjb25zdCBtc2cgPSBzLmdsb2JhbF9ibG9ja19tZXNzYWdlIHx8ICdDb2RlIHVwZGF0ZWQ6IHRoZSBsaW5rIGlzIG5vIGxvbmdlciB2YWxpZCc7IGZvcmNlTG9nb3V0RnJvbVRva2VuKG1zZyk7IH0gZWxzZSB7IHVuYmxvY2tBY2Nlc3MoKTsgcXMoJ2V4cGlyZWRPdmVybGF5Jyk/LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyBxcygnc2Vzc2lvbkV4cGlyZWQnKT8uY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IHFzKCdjb250cm9sUGFuZWwnKT8uY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IHJlc2V0U2Vzc2lvbkZvck5ld0NvZGUoKTsgfSByZXR1cm47IH0NCg0KICAgICAgLy8gUmlwcmlzdGlubyBnbG9iYWxlOiBzYmxvY2NhIGUgdG9ybmEgYWwgbG9naW4NCiAgICAgIGNvbnN0IHNlcnZlclVuYmxvY2tWZXIgPSBwYXJzZUludChzLnNlc3Npb25fcmVzZXRfdmVyc2lvbiB8fCAwLCAxMCk7DQogICAgICBjb25zdCBsb2NhbFVuYmxvY2tWZXIgPSBwYXJzZUludCgNCiAgICAgICAgbG9jYWxTdG9yYWdlLmdldEl0ZW0oVU5CTE9DS19WRVJTSU9OX0tFWSkgfHwgIjAiLA0KICAgICAgICAxMA0KICAgICAgKTsNCiAgICAgIGlmIChzZXJ2ZXJVbmJsb2NrVmVyID4gbG9jYWxVbmJsb2NrVmVyKSB7DQogICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFVOQkxPQ0tfVkVSU0lPTl9LRVksIFN0cmluZyhzZXJ2ZXJVbmJsb2NrVmVyKSk7DQogICAgICAgIHVuYmxvY2tBY2Nlc3MoKTsNCiAgICAgICAgcXMoIlNjYWR1dGFPdmVybGF5Iik/LmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOw0KICAgICAgICBxcygic2Vzc2lvblNjYWR1dGEiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7DQogICAgICAgIHFzKCJjb250cm9sUGFuZWwiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7DQogICAgICAgIHNob3dBdXRoRm9ybSgpOw0KICAgICAgICB1cGRhdGVEb29yVmlzaWJpbGl0eSgpOw0KICAgICAgICBzaG93Tm90aWZpY2F0aW9uKA0KICAgICAgICAgIHMuZ2xvYmFsX3VuYmxvY2tfbWVzc2FnZSB8fA0KICAgICAgICAgICAgIlNlc3Npb25lIHJpcHJpc3RpbmF0YS4gSW5zZXJpc2NpIGlsIGNvZGljZSBwZXIgYWNjZWRlcmUuIg0KICAgICAgICApOw0KICAgICAgfQ0KICAgIH0pOw0KICB9DQoNCiAgZnVuY3Rpb24gbW9uaXRvckZpcmViYXNlQ29ubmVjdGlvbigpIHsNCiAgICBjb25zdCBjb25uZWN0ZWRSZWYgPSBkYXRhYmFzZS5yZWYoIi5pbmZvL2Nvbm5lY3RlZCIpOw0KICAgIGNvbm5lY3RlZFJlZi5vbigidmFsdWUiLCAoc25hcCkgPT4gew0KICAgICAgaWYgKHNuYXAudmFsKCkgPT09IHRydWUpIHsNCiAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCJmaXJlYmFzZS1vZmZsaW5lIik7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoImZpcmViYXNlLW9mZmxpbmUiKTsNCiAgICAgICAgc2hvd05vdGlmaWNhdGlvbigNCiAgICAgICAgICAiQ29ubmVzc2lvbmUgYSBGaXJlYmFzZSBwZXJzYS4gTGUgbW9kaWZpY2hlIHBvdHJlYmJlcm8gbm9uIGVzc2VyZSBzaW5jcm9uaXp6YXRlLiIsDQogICAgICAgICAgIndhcm5pbmciDQogICAgICAgICk7DQogICAgICB9DQogICAgfSk7DQogIH0NCg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAvLyBURU1QTy9TRVNTSU9ORQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogIGFzeW5jIGZ1bmN0aW9uIHNldFVzYWdlU3RhcnRUaW1lKCkgewogICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKS50b1N0cmluZygpOw0KICAgIGNvbnN0IGhhc2ggPSBhd2FpdCBnZW5lcmF0ZUhhc2gobm93ICsgU0VDUkVUX0tFWSk7DQogICAgc2V0U3RvcmFnZSgidXNhZ2Vfc3RhcnRfdGltZSIsIG5vdywgVElNRV9MSU1JVF9NSU5VVEVTKTsNCiAgICBzZXRTdG9yYWdlKCJ1c2FnZV9oYXNoIiwgaGFzaCwgVElNRV9MSU1JVF9NSU5VVEVTKTsNCiAgICB1cGRhdGVTdGF0dXNCYXIoKTsNCiAgfQoKICBhc3luYyBmdW5jdGlvbiBzZXRMb2dpblN0YXJ0VGltZSgpIHsKICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCkudG9TdHJpbmcoKTsKICAgIGNvbnN0IGhhc2ggPSBhd2FpdCBnZW5lcmF0ZUhhc2gobm93ICsgU0VDUkVUX0tFWSk7CiAgICBzZXRTdG9yYWdlKCJsb2dpbl9zdGFydF90aW1lIiwgbm93LCBQUkVfVVNFX0xJTUlUX01JTlVURVMpOwogICAgc2V0U3RvcmFnZSgibG9naW5faGFzaCIsIGhhc2gsIFBSRV9VU0VfTElNSVRfTUlOVVRFUyk7CiAgICB1cGRhdGVTdGF0dXNCYXIoKTsKICB9CgogIGFzeW5jIGZ1bmN0aW9uIHNldFRva2VuVXNhZ2VTdGFydFRpbWUodG9rZW5JZCkgewogICAgaWYgKCF0b2tlbklkKSByZXR1cm47CiAgICBjb25zdCBrZXlUID0gYHRva2VuX3RzXyR7dG9rZW5JZH1gOwogICAgY29uc3Qga2V5SCA9IGB0b2tlbl90aF8ke3Rva2VuSWR9YDsKICAgIHRyeSB7CiAgICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXlUKSkgcmV0dXJuOyAvLyBub24gc292cmFzY3JpdmVyZSBzZSBnacODxpLDgsKgIGF2dmlhdG8KICAgICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKS50b1N0cmluZygpOwogICAgICBjb25zdCBoYXNoID0gYXdhaXQgZ2VuZXJhdGVIYXNoKG5vdyArIFNFQ1JFVF9LRVkgKyB0b2tlbklkKTsKICAgICAgc2V0U3RvcmFnZShrZXlULCBub3csIFRPS0VOX0xJTUlUX01JTlVURVMpOwogICAgICBzZXRTdG9yYWdlKGtleUgsIGhhc2gsIFRPS0VOX0xJTUlUX01JTlVURVMpOwogICAgfSBjYXRjaCB7fQogIH0KCiAgZnVuY3Rpb24gY2xlYXJUb2tlblVzYWdlU3RhcnQodG9rZW5JZCkgewogICAgaWYgKCF0b2tlbklkKSByZXR1cm47CiAgICB0cnkgewogICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShgdG9rZW5fdHNfJHt0b2tlbklkfWApOwogICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShgdG9rZW5fdGhfJHt0b2tlbklkfWApOwogICAgfSBjYXRjaCB7fQogIH0KCiAgYXN5bmMgZnVuY3Rpb24gY2hlY2tUaW1lTGltaXQoKSB7CiAgICAvLyBUaW1lciBhbmNoZSBwZXIgc2Vzc2lvbmkgdG9rZW4gZG9wbyBzdWJtaXQKICAgIGlmIChpc1Rva2VuU2Vzc2lvbikgewogICAgICBjb25zdCB0ID0KICAgICAgICBjdXJyZW50VG9rZW5JZCB8fCBuZXcgVVJMU2VhcmNoUGFyYW1zKGxvY2F0aW9uLnNlYXJjaCkuZ2V0KCJ0b2tlbiIpOwogICAgICBpZiAoIXQpIHJldHVybiBmYWxzZTsKICAgICAgY29uc3Qga2V5VCA9IGB0b2tlbl90c18ke3R9YDsKICAgICAgY29uc3Qga2V5SCA9IGB0b2tlbl90aF8ke3R9YDsKICAgICAgY29uc3QgdHMgPSBnZXRTdG9yYWdlKGtleVQpOwogICAgICBjb25zdCBocyA9IGdldFN0b3JhZ2Uoa2V5SCk7CiAgICAgIGlmICh0cyAmJiBocykgewogICAgICAgIGNvbnN0IGNhbGMgPSBhd2FpdCBnZW5lcmF0ZUhhc2godHMgKyBTRUNSRVRfS0VZICsgdCk7CiAgICAgICAgaWYgKGNhbGMgIT09IGhzKSB7CiAgICAgICAgICAvLyBoYXNoIG1pc21hdGNoID0+IGNvbnNpZGVyYSBzY2FkdXRhCiAgICAgICAgICBjbGVhclRva2VuVXNhZ2VTdGFydCh0KTsKICAgICAgICAgIHRyeSB7IGZvcmNlTG9nb3V0RnJvbVRva2VuKCJTZXNzaW9uZSB0b2tlbiBub24gdmFsaWRhIik7IH0gY2F0Y2gge30KICAgICAgICAgIC8vIE5hc2NvbmRpIHBhbm5lbGxvIGUgbW9zdHJhIG92ZXJsYXkKICAgICAgICAgIHFzKCJjb250cm9sUGFuZWwiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7CiAgICAgICAgICBxcygiU2NhZHV0YU92ZXJsYXkiKT8uY2xhc3NMaXN0LnJlbW92ZSgiaGlkZGVuIik7CiAgICAgICAgICBxcygic2Vzc2lvblNjYWR1dGEiKT8uY2xhc3NMaXN0LnJlbW92ZSgiaGlkZGVuIik7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgbWlucyA9IChEYXRlLm5vdygpIC0gcGFyc2VJbnQodHMsIDEwKSkgLyAoMTAwMCAqIDYwKTsKICAgICAgICBpZiAobWlucyA+PSBUT0tFTl9MSU1JVF9NSU5VVEVTKSB7CiAgICAgICAgICBjbGVhclRva2VuVXNhZ2VTdGFydCh0KTsKICAgICAgICAgIHRyeSB7IGZvcmNlTG9nb3V0RnJvbVRva2VuKCJTZXNzaW9uZSB0b2tlbiBzY2FkdXRhIik7IH0gY2F0Y2gge30KICAgICAgICAgIHFzKCJjb250cm9sUGFuZWwiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7CiAgICAgICAgICBxcygiU2NhZHV0YU92ZXJsYXkiKT8uY2xhc3NMaXN0LnJlbW92ZSgiaGlkZGVuIik7CiAgICAgICAgICBxcygic2Vzc2lvblNjYWR1dGEiKT8uY2xhc3NMaXN0LnJlbW92ZSgiaGlkZGVuIik7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGlmICghc2Vzc2lvblN0YXJ0VGltZSkgcmV0dXJuIGZhbHNlOwoNCiAgICBjb25zdCBzdGFydFRpbWUgPSBnZXRTdG9yYWdlKCJ1c2FnZV9zdGFydF90aW1lIik7DQogICAgY29uc3Qgc3RvcmVkSGFzaCA9IGdldFN0b3JhZ2UoInVzYWdlX2hhc2giKTsNCiAgICBpZiAoIXN0YXJ0VGltZSB8fCAhc3RvcmVkSGFzaCkgcmV0dXJuIGZhbHNlOw0KDQogICAgY29uc3QgY2FsY0hhc2ggPSBhd2FpdCBnZW5lcmF0ZUhhc2goc3RhcnRUaW1lICsgU0VDUkVUX0tFWSk7DQogICAgaWYgKGNhbGNIYXNoICE9PSBzdG9yZWRIYXNoKSB7DQogICAgICBzaG93RmF0YWxFcnJvcigiw4PCosOFwqHDgsKgw4PCr8OCwrjDgsKPIFZpb2xhemlvbmUgZGkgc2ljdXJlenphIHJpbGV2YXRhISIpOw0KICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTsNCiAgICBjb25zdCBtaW51dGVzUGFzc2VkID0gKG5vdyAtIHBhcnNlSW50KHN0YXJ0VGltZSwgMTApKSAvICgxMDAwICogNjApOw0KICAgIGlmIChtaW51dGVzUGFzc2VkID49IFRJTUVfTElNSVRfTUlOVVRFUykgew0KICAgICAgc2hvd1Nlc3Npb25TY2FkdXRhKCk7DQogICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICB1cGRhdGVTdGF0dXNCYXIoKTsNCiAgICByZXR1cm4gZmFsc2U7DQogIH0NCg0KICBmdW5jdGlvbiBzaG93RmF0YWxFcnJvcihtZXNzYWdlKSB7DQogICAgaWYgKHRpbWVDaGVja0ludGVydmFsKSBjbGVhckludGVydmFsKHRpbWVDaGVja0ludGVydmFsKTsNCiAgICBpZiAoY29kZUNoZWNrSW50ZXJ2YWwpIGNsZWFySW50ZXJ2YWwoY29kZUNoZWNrSW50ZXJ2YWwpOw0KICAgIGRvY3VtZW50LmJvZHkuaW5uZXJIVE1MID0gYA0KICAgICAgPGRpdiBzdHlsZT0icG9zaXRpb246Zml4ZWQ7aW5zZXQ6MDtkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OmNlbnRlcjthbGlnbi1pdGVtczpjZW50ZXI7YmFja2dyb3VuZDojMTIxMTExO2NvbG9yOiNmZjZiNmI7Zm9udC1zaXplOjI0cHg7dGV4dC1hbGlnbjpjZW50ZXI7cGFkZGluZzoyMHB4O3otaW5kZXg6OTk5OTsiPg0KICAgICAgICAke21lc3NhZ2V9DQogICAgICA8L2Rpdj5gOw0KICB9DQoNCiAgZnVuY3Rpb24gc2hvd1Nlc3Npb25TY2FkdXRhKCkgew0KICAgIGlmIChpc1Rva2VuU2Vzc2lvbikgcmV0dXJuOyAvLyBvdmVybGF5IHNvbG8gcGVyIHNlc3Npb25pIG1hbnVhbGkNCiAgICBpZiAodGltZUNoZWNrSW50ZXJ2YWwpIGNsZWFySW50ZXJ2YWwodGltZUNoZWNrSW50ZXJ2YWwpOw0KICAgIGlmIChjb2RlQ2hlY2tJbnRlcnZhbCkgY2xlYXJJbnRlcnZhbChjb2RlQ2hlY2tJbnRlcnZhbCk7DQoNCiAgICBxcygiU2NhZHV0YU92ZXJsYXkiKT8uY2xhc3NMaXN0LnJlbW92ZSgiaGlkZGVuIik7DQogICAgcXMoImNvbnRyb2xQYW5lbCIpPy5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsNCiAgICBxcygic2Vzc2lvblNjYWR1dGEiKT8uY2xhc3NMaXN0LnJlbW92ZSgiaGlkZGVuIik7DQogICAgcXMoInRlc3QyIikgJiYgKHFzKCJ0ZXN0MiIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSIpOw0KDQogICAgREVWSUNFUy5mb3JFYWNoKChkZXZpY2UpID0+IHsNCiAgICAgIGNvbnN0IGJ0biA9IHFzKGRldmljZS5idXR0b25faWQpOw0KICAgICAgaWYgKGJ0bikgew0KICAgICAgICBidG4uZGlzYWJsZWQgPSB0cnVlOw0KICAgICAgICBidG4uY2xhc3NMaXN0LmFkZCgiYnRuLWVycm9yIik7DQogICAgICB9DQogICAgfSk7DQoNCiAgICBjb25zdCBzZWN1cml0eVN0YXR1cyA9IHFzKCJzZWN1cml0eVN0YXR1cyIpOw0KICAgIGlmIChzZWN1cml0eVN0YXR1cykgew0KICAgICAgc2VjdXJpdHlTdGF0dXMudGV4dENvbnRlbnQgPSAiU2NhZHV0YSI7DQogICAgICBzZWN1cml0eVN0YXR1cy5zdHlsZS5jb2xvciA9ICJ2YXIoLS1lcnJvcikiOw0KICAgIH0NCg0KICAgIHNlc3Npb25TdGFydFRpbWUgPSBudWxsOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNTZXNzaW9uU3R1Y2soKSB7DQogICAgdHJ5IHsNCiAgICAgIGNvbnN0IGF1dGhWZXJpZmllZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJhdXRoX3ZlcmlmaWVkIik7DQogICAgICBjb25zdCBhdXRoVGltZXN0YW1wID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oImF1dGhfdGltZXN0YW1wIik7DQogICAgICBjb25zdCB1c2FnZVN0YXJ0VGltZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJ1c2FnZV9zdGFydF90aW1lIik7DQoNCiAgICAgIGlmIChhdXRoVmVyaWZpZWQgPT09ICJ0cnVlIiAmJiBhdXRoVGltZXN0YW1wKSB7DQogICAgICAgIGNvbnN0IGF1dGhUaW1lID0gcGFyc2VJbnQoYXV0aFRpbWVzdGFtcCwgMTApOw0KICAgICAgICBpZiAoRGF0ZS5ub3coKSAtIGF1dGhUaW1lID4gMjQgKiA2MCAqIDYwICogMTAwMCkgcmV0dXJuIHRydWU7DQogICAgICB9DQogICAgICBpZiAodXNhZ2VTdGFydFRpbWUpIHsNCiAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcGFyc2VJbnQodXNhZ2VTdGFydFRpbWUsIDEwKTsNCiAgICAgICAgY29uc3QgbWludXRlc1Bhc3NlZCA9IChEYXRlLm5vdygpIC0gc3RhcnRUaW1lKSAvICgxMDAwICogNjApOw0KICAgICAgICBpZiAobWludXRlc1Bhc3NlZCA+IFRJTUVfTElNSVRfTUlOVVRFUyArIDYwKSByZXR1cm4gdHJ1ZTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9IGNhdGNoIChlKSB7DQogICAgICBjb25zb2xlLmVycm9yKCJFcnJvcmUgbmVsIGNvbnRyb2xsbyBzZXNzaW9uZSBibG9jY2F0YToiLCBlKTsNCiAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogIH0NCg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgLy8gQ0hFQ0vDg8Kiw6LigJrCrMOi4oKsy5xJTiBUSU1FDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICBmdW5jdGlvbiBpc0NoZWNraW5UaW1lKCkgew0KICAgIGlmICghQ0hFQ0tJTl9USU1FX0VOQUJMRUQpIHJldHVybiB0cnVlOw0KDQogICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTsNCiAgICBjb25zdCBjdXJyZW50ID0gbm93LmdldEhvdXJzKCkgKiA2MCArIG5vdy5nZXRNaW51dGVzKCk7DQogICAgY29uc3QgW3NoLCBzbV0gPSBDSEVDS0lOX1NUQVJUX1RJTUUuc3BsaXQoIjoiKS5tYXAoTnVtYmVyKTsNCiAgICBjb25zdCBbZWgsIGVtXSA9IENIRUNLSU5fRU5EX1RJTUUuc3BsaXQoIjoiKS5tYXAoTnVtYmVyKTsNCiAgICBjb25zdCBzdGFydCA9IHNoICogNjAgKyBzbTsNCiAgICBjb25zdCBlbmQgPSBlaCAqIDYwICsgZW07DQogICAgcmV0dXJuIGN1cnJlbnQgPj0gc3RhcnQgJiYgY3VycmVudCA8PSBlbmQ7DQogIH0NCg0KICBmdW5jdGlvbiB1cGRhdGVDaGVja2luVGltZURpc3BsYXkoKSB7DQogICAgY29uc3Qgc3RhcnRFbCA9IHFzKCJjaGVja2luU3RhcnREaXNwbGF5Iik7DQogICAgY29uc3QgZW5kRWwgPSBxcygiY2hlY2tpbkVuZERpc3BsYXkiKTsNCiAgICBjb25zdCBzdGFydFBvcHVwID0gcXMoImNoZWNraW5TdGFydFBvcHVwIik7DQogICAgY29uc3QgZW5kUG9wdXAgPSBxcygiY2hlY2tpbkVuZFBvcHVwIik7DQogICAgY29uc3QgY3VycmVudFN0YXJ0ID0gcXMoImN1cnJlbnRDaGVja2luU3RhcnRUaW1lIik7DQogICAgY29uc3QgY3VycmVudEVuZCA9IHFzKCJjdXJyZW50Q2hlY2tpbkVuZFRpbWUiKTsNCiAgICBpZiAoc3RhcnRFbCkgc3RhcnRFbC50ZXh0Q29udGVudCA9IGZvcm1hdFRpbWUoQ0hFQ0tJTl9TVEFSVF9USU1FKTsNCiAgICBpZiAoZW5kRWwpIGVuZEVsLnRleHRDb250ZW50ID0gZm9ybWF0VGltZShDSEVDS0lOX0VORF9USU1FKTsNCiAgICBpZiAoc3RhcnRQb3B1cCkgc3RhcnRQb3B1cC50ZXh0Q29udGVudCA9IGZvcm1hdFRpbWUoQ0hFQ0tJTl9TVEFSVF9USU1FKTsNCiAgICBpZiAoZW5kUG9wdXApIGVuZFBvcHVwLnRleHRDb250ZW50ID0gZm9ybWF0VGltZShDSEVDS0lOX0VORF9USU1FKTsNCiAgICBpZiAoY3VycmVudFN0YXJ0KSBjdXJyZW50U3RhcnQudGV4dENvbnRlbnQgPSBmb3JtYXRUaW1lKENIRUNLSU5fU1RBUlRfVElNRSk7DQogICAgaWYgKGN1cnJlbnRFbmQpIGN1cnJlbnRFbmQudGV4dENvbnRlbnQgPSBmb3JtYXRUaW1lKENIRUNLSU5fRU5EX1RJTUUpOw0KDQogICAgY29uc3Qgc3RhdHVzRWxlbWVudCA9IHFzKCJjdXJyZW50VGltZVN0YXR1cyIpOw0KICAgIGlmICghc3RhdHVzRWxlbWVudCkgcmV0dXJuOw0KDQogICAgaWYgKCFDSEVDS0lOX1RJTUVfRU5BQkxFRCkgew0KICAgICAgc3RhdHVzRWxlbWVudC5pbm5lckhUTUwgPQ0KICAgICAgICAnPGkgY2xhc3M9ImZhcyBmYS1wb3dlci1vZmYiIHN0eWxlPSJjb2xvcjpvcmFuZ2U7Ij48L2k+IFRpbWUgY29udHJvbCBkaXNhYmxlZCDDg8Kiw6LigJrCrMOi4oKswp0gY2hlY2staW4gYWxsb3dlZCBhdCBhbnkgdGltZSc7DQogICAgICByZXR1cm47DQogICAgfQ0KDQogICAgaWYgKGlzQ2hlY2tpblRpbWUoKSkgew0KICAgICAgc3RhdHVzRWxlbWVudC5pbm5lckhUTUwgPQ0KICAgICAgICAnPGkgY2xhc3M9ImZhcyBmYS1jaGVjay1jaXJjbGUiIHN0eWxlPSJjb2xvcjpncmVlbjsiPjwvaT4gQ2hlY2staW4gbm93IGF2YWlsYWJsZSc7DQogICAgICByZXR1cm47DQogICAgfQ0KDQogICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTsNCiAgICBjb25zdCBjdXJyZW50ID0gbm93LmdldEhvdXJzKCkgKiA2MCArIG5vdy5nZXRNaW51dGVzKCk7DQogICAgY29uc3QgW3NoLCBzbV0gPSBDSEVDS0lOX1NUQVJUX1RJTUUuc3BsaXQoIjoiKS5tYXAoTnVtYmVyKTsNCiAgICBjb25zdCBbZWgsIGVtXSA9IENIRUNLSU5fRU5EX1RJTUUuc3BsaXQoIjoiKS5tYXAoTnVtYmVyKTsNCiAgICBjb25zdCBzdGFydCA9IHNoICogNjAgKyBzbTsNCiAgICBjb25zdCBlbmQgPSBlaCAqIDYwICsgZW07DQoNCiAgICBpZiAoY3VycmVudCA8IHN0YXJ0KSB7DQogICAgICBjb25zdCBkaWZmID0gc3RhcnQgLSBjdXJyZW50Ow0KICAgICAgY29uc3QgaCA9IE1hdGguZmxvb3IoZGlmZiAvIDYwKTsNCiAgICAgIGNvbnN0IG0gPSBkaWZmICUgNjA7DQogICAgICBzdGF0dXNFbGVtZW50LmlubmVySFRNTCA9IGA8aSBjbGFzcz0iZmFzIGZhLWNsb2NrIiBzdHlsZT0iY29sb3I6b3JhbmdlOyI+PC9pPiBDaGVjay1pbiB3aWxsIGJlIGF2YWlsYWJsZSBpbiAke2h9aCAke219bWA7DQogICAgfSBlbHNlIHsNCiAgICAgIGNvbnN0IHRvbW9ycm93ID0gbmV3IERhdGUobm93KTsNCiAgICAgIHRvbW9ycm93LnNldERhdGUodG9tb3Jyb3cuZ2V0RGF0ZSgpICsgMSk7DQogICAgICB0b21vcnJvdy5zZXRIb3VycyhzaCwgc20sIDAsIDApOw0KICAgICAgY29uc3QgZGlmZiA9IHRvbW9ycm93IC0gbm93Ow0KICAgICAgY29uc3QgaCA9IE1hdGguZmxvb3IoZGlmZiAvICgxMDAwICogNjAgKiA2MCkpOw0KICAgICAgY29uc3QgbSA9IE1hdGguZmxvb3IoKGRpZmYgJSAoMTAwMCAqIDYwICogNjApKSAvICgxMDAwICogNjApKTsNCiAgICAgIHN0YXR1c0VsZW1lbnQuaW5uZXJIVE1MID0gYDxpIGNsYXNzPSJmYXMgZmEtY2xvY2siIHN0eWxlPSJjb2xvcjpvcmFuZ2U7Ij48L2k+IENoZWNrLWluIHdpbGwgYmUgYXZhaWxhYmxlIHRvbW9ycm93IGluICR7aH1oICR7bX1tYDsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBzaG93RWFybHlDaGVja2luUG9wdXAoKSB7DQogICAgY29uc3QgZWwgPSBxcygiZWFybHlDaGVja2luUG9wdXAiKTsNCiAgICBpZiAoZWwpIGVsLnN0eWxlLmRpc3BsYXkgPSAiZmxleCI7DQogIH0NCiAgZnVuY3Rpb24gY2xvc2VFYXJseUNoZWNraW5Qb3B1cCgpIHsNCiAgICBjb25zdCBlbCA9IHFzKCJlYXJseUNoZWNraW5Qb3B1cCIpOw0KICAgIGlmIChlbCkgZWwuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCiAgfQ0KDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICAvLyBJTlRFUkZBQ0NJQS9TVEFUTw0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgZnVuY3Rpb24gdXBkYXRlU3RhdHVzQmFyKCkgew0KICAgIGNvbnN0IG1haW5Eb29yQ291bnRlciA9IHFzKCJtYWluRG9vckNvdW50ZXIiKTsNCiAgICBjb25zdCBhcHREb29yQ291bnRlciA9IHFzKCJhcHREb29yQ291bnRlciIpOw0KICAgIGNvbnN0IHRpbWVSZW1haW5pbmcgPSBxcygidGltZVJlbWFpbmluZyIpOw0KDQogICAgaWYgKG1haW5Eb29yQ291bnRlcikgew0KICAgICAgbWFpbkRvb3JDb3VudGVyLnRleHRDb250ZW50ID0gYCR7Z2V0Q2xpY2tzTGVmdCgNCiAgICAgICAgREVWSUNFU1swXS5zdG9yYWdlX2tleQ0KICAgICAgKX0gY2xpY2sgbGVmdGA7DQogICAgfQ0KICAgIGlmIChhcHREb29yQ291bnRlcikgew0KICAgICAgYXB0RG9vckNvdW50ZXIudGV4dENvbnRlbnQgPSBgJHtnZXRDbGlja3NMZWZ0KA0KICAgICAgICBERVZJQ0VTWzFdLnN0b3JhZ2Vfa2V5DQogICAgICApfSBjbGljayBsZWZ0YDsNCiAgICB9DQoNCiAgICBpZiAoIXNlc3Npb25TdGFydFRpbWUgfHwgIXRpbWVSZW1haW5pbmcpIHsNCiAgICAgIGlmICh0aW1lUmVtYWluaW5nKSB7DQogICAgICAgIGNvbnN0IG1pbnV0ZXMgPSBNYXRoLmZsb29yKFRJTUVfTElNSVRfTUlOVVRFUyk7DQogICAgICAgIGNvbnN0IHNlY29uZHMgPSBNYXRoLmZsb29yKChUSU1FX0xJTUlUX01JTlVURVMgJSAxKSAqIDYwKTsNCiAgICAgICAgdGltZVJlbWFpbmluZy50ZXh0Q29udGVudCA9IGAke1N0cmluZyhtaW51dGVzKS5wYWRTdGFydCgNCiAgICAgICAgICAyLA0KICAgICAgICAgICIwIg0KICAgICAgICApfToke1N0cmluZyhzZWNvbmRzKS5wYWRTdGFydCgyLCAiMCIpfWA7DQogICAgICAgIHRpbWVSZW1haW5pbmcuc3R5bGUuY29sb3IgPSAidmFyKC0tcHJpbWFyeSkiOw0KICAgICAgfQ0KICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIGNvbnN0IHN0YXJ0VGltZSA9IGdldFN0b3JhZ2UoInVzYWdlX3N0YXJ0X3RpbWUiKTsNCiAgICBpZiAoIXN0YXJ0VGltZSkgcmV0dXJuOw0KDQogICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTsNCiAgICBjb25zdCBtaW51dGVzUGFzc2VkID0gKG5vdyAtIHBhcnNlSW50KHN0YXJ0VGltZSwgMTApKSAvICgxMDAwICogNjApOw0KICAgIGNvbnN0IG1pbnV0ZXNMZWZ0ID0gTWF0aC5tYXgoDQogICAgICAwLA0KICAgICAgTWF0aC5mbG9vcihUSU1FX0xJTUlUX01JTlVURVMgLSBtaW51dGVzUGFzc2VkKQ0KICAgICk7DQogICAgY29uc3Qgc2Vjb25kc0xlZnQgPSBNYXRoLm1heCgwLCBNYXRoLmZsb29yKDYwIC0gKG1pbnV0ZXNQYXNzZWQgJSAxKSAqIDYwKSk7DQoNCiAgICB0aW1lUmVtYWluaW5nLnRleHRDb250ZW50ID0gYCR7U3RyaW5nKG1pbnV0ZXNMZWZ0KS5wYWRTdGFydCgNCiAgICAgIDIsDQogICAgICAiMCINCiAgICApfToke1N0cmluZyhzZWNvbmRzTGVmdCkucGFkU3RhcnQoMiwgIjAiKX1gOw0KICAgIGlmIChtaW51dGVzTGVmdCA8IDEpIHRpbWVSZW1haW5pbmcuc3R5bGUuY29sb3IgPSAidmFyKC0tZXJyb3IpIjsNCiAgICBlbHNlIGlmIChtaW51dGVzTGVmdCA8IDUpIHRpbWVSZW1haW5pbmcuc3R5bGUuY29sb3IgPSAidmFyKC0td2FybmluZykiOw0KICAgIGVsc2UgdGltZVJlbWFpbmluZy5zdHlsZS5jb2xvciA9ICJ2YXIoLS1wcmltYXJ5KSI7DQogIH0NCg0KICBmdW5jdGlvbiBnZXRDbGlja3NMZWZ0KGtleSkgew0KICAgIGNvbnN0IHN0b3JlZCA9IGdldFN0b3JhZ2Uoa2V5KTsNCiAgICByZXR1cm4gc3RvcmVkID09PSBudWxsID8gTUFYX0NMSUNLUyA6IHBhcnNlSW50KHN0b3JlZCwgMTApOw0KICB9DQoNCiAgZnVuY3Rpb24gc2V0Q2xpY2tzTGVmdChrZXksIGNvdW50KSB7DQogICAgc2V0U3RvcmFnZShrZXksIFN0cmluZyhjb3VudCksIFRJTUVfTElNSVRfTUlOVVRFUyk7DQogICAgdXBkYXRlU3RhdHVzQmFyKCk7DQogIH0NCg0KICBmdW5jdGlvbiB1cGRhdGVCdXR0b25TdGF0ZShkZXZpY2UpIHsNCiAgICBjb25zdCBidG4gPSBxcyhkZXZpY2UuYnV0dG9uX2lkKTsNCiAgICBpZiAoIWJ0bikgcmV0dXJuOw0KICAgIGNvbnN0IGNsaWNrc0xlZnQgPSBnZXRDbGlja3NMZWZ0KGRldmljZS5zdG9yYWdlX2tleSk7DQogICAgYnRuLmRpc2FibGVkID0gY2xpY2tzTGVmdCA8PSAwIHx8ICFpc0NoZWNraW5UaW1lKCk7DQogICAgaWYgKGNsaWNrc0xlZnQgPD0gMCkgew0KICAgICAgYnRuLmNsYXNzTGlzdC5hZGQoImJ0bi1lcnJvciIpOw0KICAgICAgYnRuLmNsYXNzTGlzdC5yZW1vdmUoImJ0bi1zdWNjZXNzIik7DQogICAgfSBlbHNlIGlmICghaXNDaGVja2luVGltZSgpKSB7DQogICAgICBidG4uY2xhc3NMaXN0LnJlbW92ZSgiYnRuLWVycm9yIiwgImJ0bi1zdWNjZXNzIik7DQogICAgfSBlbHNlIHsNCiAgICAgIGJ0bi5jbGFzc0xpc3QuYWRkKCJidG4tc3VjY2VzcyIpOw0KICAgICAgYnRuLmNsYXNzTGlzdC5yZW1vdmUoImJ0bi1lcnJvciIpOw0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIHVwZGF0ZURvb3JWaXNpYmlsaXR5KCkgew0KICAgIERFVklDRVMuZm9yRWFjaCgoZGV2aWNlKSA9PiB7DQogICAgICBjb25zdCBjb250YWluZXIgPSBxcyhgJHtkZXZpY2UuYnV0dG9uX2lkfUNvbnRhaW5lcmApOw0KICAgICAgaWYgKGNvbnRhaW5lcikNCiAgICAgICAgY29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSBkZXZpY2UudmlzaWJsZSA/ICJibG9jayIgOiAibm9uZSI7DQogICAgfSk7DQogIH0NCg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgLy8gQ0FNQklBTUVOVE8gQ09ESUNFDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICBmdW5jdGlvbiBzZXR1cENvZGVDaGFuZ2VMaXN0ZW5lcigpIHsNCiAgICBpZiAoY29kZUNoZWNrSW50ZXJ2YWwpIGNsZWFySW50ZXJ2YWwoY29kZUNoZWNrSW50ZXJ2YWwpOw0KICAgIGlmIChMSU5LX0NIRUNLX0lOVEVSVkFMKSBjbGVhckludGVydmFsKExJTktfQ0hFQ0tfSU5URVJWQUwpOw0KDQogICAgY29kZUNoZWNrSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChjaGVja0NvZGVWZXJzaW9uLCAyMDAwKTsNCiAgICBMSU5LX0NIRUNLX0lOVEVSVkFMID0gc2V0SW50ZXJ2YWwoY2hlY2tTY2FkdXRhTGlua3MsIDYwMDAwKTsNCg0KICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJzdG9yYWdlIiwgKGUpID0+IHsNCiAgICAgIGlmIChlLmtleSA9PT0gImNvZGVfdmVyc2lvbiIgfHwgZS5rZXkgPT09ICJsYXN0X2NvZGVfdXBkYXRlIikgew0KICAgICAgICBjaGVja0NvZGVWZXJzaW9uKCk7DQogICAgICB9DQogICAgfSk7DQogIH0NCg0KICBmdW5jdGlvbiBjaGVja0NvZGVWZXJzaW9uKCkgew0KICAgIGRhdGFiYXNlDQogICAgICAucmVmKCJzZXR0aW5ncy9jb2RlX3ZlcnNpb24iKQ0KICAgICAgLm9uY2UoInZhbHVlIikNCiAgICAgIC50aGVuKChzbmFwKSA9PiB7DQogICAgICAgIGlmIChzbmFwLmV4aXN0cygpKSB7DQogICAgICAgICAgY29uc3QgZmlyZWJhc2VWZXJzaW9uID0gcGFyc2VJbnQoc25hcC52YWwoKSk7DQogICAgICAgICAgY29uc3QgbG9jYWxWZXJzaW9uID0NCiAgICAgICAgICAgIHBhcnNlSW50KGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJjb2RlX3ZlcnNpb24iKSkgfHwgMTsNCiAgICAgICAgICBjb25zdCBzYXZlZFZlcnNpb24gPSBNYXRoLm1heChmaXJlYmFzZVZlcnNpb24sIGxvY2FsVmVyc2lvbik7DQogICAgICAgICAgaWYgKHNhdmVkVmVyc2lvbiA+IGN1cnJlbnRDb2RlVmVyc2lvbikgaGFuZGxlQ29kZUNoYW5nZShzYXZlZFZlcnNpb24pOw0KICAgICAgICB9DQogICAgICB9KQ0KICAgICAgLmNhdGNoKCgpID0+IHsNCiAgICAgICAgY29uc3Qgc2F2ZWRWZXJzaW9uID0NCiAgICAgICAgICBwYXJzZUludChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiY29kZV92ZXJzaW9uIikpIHx8IDE7DQogICAgICAgIGlmIChzYXZlZFZlcnNpb24gPiBjdXJyZW50Q29kZVZlcnNpb24pIGhhbmRsZUNvZGVDaGFuZ2Uoc2F2ZWRWZXJzaW9uKTsNCiAgICAgIH0pOw0KICB9DQoNCiAgZnVuY3Rpb24gaGFuZGxlQ29kZUNoYW5nZShuZXdWZXJzaW9uKSB7DQogICAgY3VycmVudENvZGVWZXJzaW9uID0gbmV3VmVyc2lvbjsNCiAgICBkYXRhYmFzZQ0KICAgICAgLnJlZigic2V0dGluZ3Mvc2VjcmV0X2NvZGUiKQ0KICAgICAgLm9uY2UoInZhbHVlIikNCiAgICAgIC50aGVuKChjb2RlU25hcCkgPT4gew0KICAgICAgICBpZiAoY29kZVNuYXAuZXhpc3RzKCkpIHsNCiAgICAgICAgICBDT1JSRUNUX0NPREUgPSBjb2RlU25hcC52YWwoKTsNCiAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgic2VjcmV0X2NvZGUiLCBDT1JSRUNUX0NPREUpOw0KICAgICAgICAgIGNvbnN0IGhhZExvY2FsVmVyc2lvbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKENPREVfVkVSU0lPTl9LRVkpICE9PSBudWxsOyBpZiAoaGFzVG9rZW5Gb290cHJpbnQoKSB8fCBoYWRMb2NhbFZlcnNpb24pIHsgZm9yY2VMb2dvdXRGcm9tVG9rZW4oJ0NvZGUgdXBkYXRlZDogdGhlIGxpbmsgaXMgbm8gbG9uZ2VyIHZhbGlkJyk7IH0gZWxzZSB7DQogICAgICAgICAgICB1bmJsb2NrQWNjZXNzKCk7DQogICAgICAgICAgICBxcygiU2NhZHV0YU92ZXJsYXkiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7DQogICAgICAgICAgICBxcygic2Vzc2lvblNjYWR1dGEiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7DQogICAgICAgICAgICBxcygiY29udHJvbFBhbmVsIik/LmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOw0KICAgICAgICAgICAgcmVzZXRTZXNzaW9uRm9yTmV3Q29kZSgpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSk7DQogIH0NCg0KICBmdW5jdGlvbiByZXNldFNlc3Npb25Gb3JOZXdDb2RlKCkgew0KICAgIGNsZWFyU3RvcmFnZSgidXNhZ2Vfc3RhcnRfdGltZSIpOw0KICAgIGNsZWFyU3RvcmFnZSgidXNhZ2VfaGFzaCIpOw0KICAgIERFVklDRVMuZm9yRWFjaCgoZCkgPT4gY2xlYXJTdG9yYWdlKGQuc3RvcmFnZV9rZXkpKTsNCg0KICAgIHFzKCJjb250cm9sUGFuZWwiKSAmJiAocXMoImNvbnRyb2xQYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSIpOw0KICAgIHFzKCJhdXRoQ29kZSIpICYmIChxcygiYXV0aENvZGUiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIik7DQogICAgcXMoImF1dGgtZm9ybSIpICYmIChxcygiYXV0aC1mb3JtIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayIpOw0KICAgIHFzKCJidG5DaGVja0NvZGUiKSAmJiAocXMoImJ0bkNoZWNrQ29kZSIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siKTsNCiAgICBxcygiaW1wb3J0YW50IikgJiYgKHFzKCJpbXBvcnRhbnQiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIik7DQoNCiAgICBzaG93Tm90aWZpY2F0aW9uKA0KICAgICAgIklsIGNvZGljZSBkaSBhY2Nlc3NvIMODxpLDgsKoIHN0YXRvIGFnZ2lvcm5hdG8uIEluc2VyaXNjaSBpbCBudW92byBjb2RpY2UuIg0KICAgICk7DQogIH0NCg0KICBmdW5jdGlvbiBjaGVja1NjYWR1dGFMaW5rcygpIHsNCiAgICBjb25zdCBzZWN1cmVMaW5rcyA9IEpTT04ucGFyc2UoDQogICAgICBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgic2VjdXJlX2xpbmtzIikgfHwgInt9Ig0KICAgICk7DQogICAgbGV0IHVwZGF0ZWQgPSBmYWxzZTsNCiAgICBPYmplY3Qua2V5cyhzZWN1cmVMaW5rcykuZm9yRWFjaCgobGlua0lkKSA9PiB7DQogICAgICBjb25zdCBsaW5rID0gc2VjdXJlTGlua3NbbGlua0lkXTsNCiAgICAgIGlmIChsaW5rLmV4cGlyYXRpb24gPCBEYXRlLm5vdygpICYmIGxpbmsuc3RhdHVzID09PSAiYWN0aXZlIikgew0KICAgICAgICBzZWN1cmVMaW5rc1tsaW5rSWRdLnN0YXR1cyA9ICJTY2FkdXRhIjsNCiAgICAgICAgdXBkYXRlZCA9IHRydWU7DQogICAgICB9DQogICAgfSk7DQogICAgaWYgKHVwZGF0ZWQpDQogICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgic2VjdXJlX2xpbmtzIiwgSlNPTi5zdHJpbmdpZnkoc2VjdXJlTGlua3MpKTsNCiAgfQ0KDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICAvLyBQT1BVUA0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgZnVuY3Rpb24gc2hvd0NvbmZpcm1hdGlvblBvcHVwKGRldmljZSkgew0KICAgIGlmICghaXNDaGVja2luVGltZSgpKSB7DQogICAgICBzaG93RWFybHlDaGVja2luUG9wdXAoKTsNCiAgICAgIHJldHVybjsNCiAgICB9DQogICAgY3VycmVudERldmljZSA9IGRldmljZTsNCiAgICBjb25zdCBkb29yTmFtZSA9IGRldmljZS5idXR0b25faWQNCiAgICAgIC5yZXBsYWNlKC8oW0EtWl0pL2csICIgJDEiKQ0KICAgICAgLnJlcGxhY2UoL14uLywgKHMpID0+IHMudG9VcHBlckNhc2UoKSk7DQogICAgY29uc3QgbXNnID0gcXMoImNvbmZpcm1hdGlvbk1lc3NhZ2UiKTsNCiAgICBpZiAobXNnKQ0KICAgICAgbXNnLnRleHRDb250ZW50ID0gYEFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byB1bmxvY2sgdGhlICR7ZG9vck5hbWV9P2A7DQogICAgY29uc3QgcG9wID0gcXMoImNvbmZpcm1hdGlvblBvcHVwIik7DQogICAgaWYgKHBvcCkgcG9wLnN0eWxlLmRpc3BsYXkgPSAiZmxleCI7DQogIH0NCiAgZnVuY3Rpb24gY2xvc2VDb25maXJtYXRpb25Qb3B1cCgpIHsNCiAgICBjb25zdCBwb3AgPSBxcygiY29uZmlybWF0aW9uUG9wdXAiKTsNCiAgICBpZiAocG9wKSBwb3Auc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCiAgICBjdXJyZW50RGV2aWNlID0gbnVsbDsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNob3dEZXZpY2VQb3B1cChkZXZpY2UsIGNsaWNrc0xlZnQpIHsNCiAgICBjb25zdCBwb3B1cCA9IHFzKGBwb3B1cC0ke2RldmljZS5idXR0b25faWR9YCk7DQogICAgaWYgKCFwb3B1cCkgcmV0dXJuOw0KICAgIGNvbnN0IHRleHQgPSBxcyhgcG9wdXAtdGV4dC0ke2RldmljZS5idXR0b25faWR9YCk7DQogICAgaWYgKHRleHQpIHsNCiAgICAgIGlmIChjbGlja3NMZWZ0ID4gMCkgew0KICAgICAgICB0ZXh0LmlubmVySFRNTCA9IGANCiAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWNoZWNrLWNpcmNsZSIgc3R5bGU9ImNvbG9yOiM0Q0FGNTA7Zm9udC1zaXplOjIuNXJlbTttYXJnaW4tYm90dG9tOjE1cHg7Ij48L2k+DQogICAgICAgICAgPGRpdj48c3Ryb25nPiR7Y2xpY2tzTGVmdH08L3N0cm9uZz4gQ2xpY2sgTGVmdDwvZGl2Pg0KICAgICAgICAgIDxkaXYgc3R5bGU9Im1hcmdpbi10b3A6MTBweDtmb250LXNpemU6MXJlbTsiPkRvb3IgVW5sb2NrZWQhPC9kaXY+YDsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRleHQuaW5uZXJIVE1MID0gYA0KICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtZXhjbGFtYXRpb24tdHJpYW5nbGUiIHN0eWxlPSJjb2xvcjojRkZDMTA3O2ZvbnQtc2l6ZToyLjVyZW07bWFyZ2luLWJvdHRvbToxNXB4OyI+PC9pPg0KICAgICAgICAgIDxkaXY+PHN0cm9uZz5ObyBtb3JlIGNsaWNrcyBsZWZ0ITwvc3Ryb25nPjwvZGl2Pg0KICAgICAgICAgIDxkaXYgc3R5bGU9Im1hcmdpbi10b3A6MTBweDtmb250LXNpemU6MXJlbTsiPkNvbnRhY3QgZm9yIEFzc2lzdGFuY2UuPC9kaXY+YDsNCiAgICAgIH0NCiAgICB9DQogICAgcG9wdXAuc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsNCiAgICBpZiAoY2xpY2tzTGVmdCA+IDApIHNldFRpbWVvdXQoKCkgPT4gY2xvc2VQb3B1cChkZXZpY2UuYnV0dG9uX2lkKSwgMzAwMCk7DQogIH0NCg0KICBmdW5jdGlvbiBjbG9zZVBvcHVwKGJ1dHRvbklkKSB7DQogICAgY29uc3QgcG9wdXAgPSBxcyhgcG9wdXAtJHtidXR0b25JZH1gKTsNCiAgICBpZiAocG9wdXApIHBvcHVwLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogIH0NCg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgLy8gU0hFTExZDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICBhc3luYyBmdW5jdGlvbiBhY3RpdmF0ZURldmljZShkZXZpY2UpIHsNCiAgICBpZiAoIXNlc3Npb25TdGFydFRpbWUpIHsNCiAgICAgIC8vIEwndXRlbnRlIGhhIGNsaWNjYXRvIHNlbnphIGxvZ2luOyBpbml6aWFsaXp6YSB1bmEgc2Vzc2lvbmUgbWFudWFsZQ0KICAgICAgc2Vzc2lvblN0YXJ0VGltZSA9IERhdGUubm93KCk7DQogICAgICBhd2FpdCBzZXRVc2FnZVN0YXJ0VGltZSgpOw0KICAgIH0NCg0KICAgIGlmIChhd2FpdCBjaGVja1RpbWVMaW1pdCgpKSByZXR1cm47DQogICAgaWYgKCFpc0NoZWNraW5UaW1lKCkpIHsNCiAgICAgIHNob3dFYXJseUNoZWNraW5Qb3B1cCgpOw0KICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIGxldCBjbGlja3NMZWZ0ID0gZ2V0Q2xpY2tzTGVmdChkZXZpY2Uuc3RvcmFnZV9rZXkpOw0KICAgIGlmIChjbGlja3NMZWZ0IDw9IDApIHsNCiAgICAgIHNob3dEZXZpY2VQb3B1cChkZXZpY2UsIGNsaWNrc0xlZnQpOw0KICAgICAgdXBkYXRlQnV0dG9uU3RhdGUoZGV2aWNlKTsNCiAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICBzZXRDbGlja3NMZWZ0KGRldmljZS5zdG9yYWdlX2tleSwgLS1jbGlja3NMZWZ0KTsNCiAgICB1cGRhdGVCdXR0b25TdGF0ZShkZXZpY2UpOw0KDQogICAgdHJ5IHsNCiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2hXaXRoVGltZW91dCgNCiAgICAgICAgQkFTRV9VUkxfU0VULA0KICAgICAgICB7DQogICAgICAgICAgbWV0aG9kOiAiUE9TVCIsDQogICAgICAgICAgaGVhZGVyczogeyAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iIH0sDQogICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoew0KICAgICAgICAgICAgaWQ6IGRldmljZS5pZCwNCiAgICAgICAgICAgIGF1dGhfa2V5OiBkZXZpY2UuYXV0aF9rZXksDQogICAgICAgICAgICBjaGFubmVsOiAwLA0KICAgICAgICAgICAgb246IHRydWUsDQogICAgICAgICAgICB0dXJuOiAib24iLA0KICAgICAgICAgIH0pLA0KICAgICAgICB9LA0KICAgICAgICAxMjAwMA0KICAgICAgKTsNCg0KICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7DQogICAgICAgIHNob3dEZXZpY2VQb3B1cChkZXZpY2UsIGNsaWNrc0xlZnQpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgc2V0Q2xpY2tzTGVmdChkZXZpY2Uuc3RvcmFnZV9rZXksIGNsaWNrc0xlZnQgKyAxKTsNCiAgICAgICAgdXBkYXRlQnV0dG9uU3RhdGUoZGV2aWNlKTsNCiAgICAgICAgY29uc29sZS5lcnJvcigNCiAgICAgICAgICAiRXJyb3JlIG5lbGwnYXR0aXZhemlvbmUgZGVsIGRpc3Bvc2l0aXZvOiIsDQogICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzLA0KICAgICAgICAgIHJlc3BvbnNlLnN0YXR1c1RleHQNCiAgICAgICAgKTsNCiAgICAgIH0NCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgY29uc29sZS5lcnJvcigiQXR0aXZhemlvbmUgZGlzcG9zaXRpdm8gZmFsbGl0YToiLCBlcnJvcik7DQogICAgICBzZXRDbGlja3NMZWZ0KGRldmljZS5zdG9yYWdlX2tleSwgY2xpY2tzTGVmdCArIDEpOw0KICAgICAgdXBkYXRlQnV0dG9uU3RhdGUoZGV2aWNlKTsNCiAgICB9DQogIH0NCg0KICBhc3luYyBmdW5jdGlvbiB1cGRhdGVHbG9iYWxDb2RlVmVyc2lvbigpIHsNCiAgICBjb25zdCBzYXZlZFZlcnNpb24gPSBwYXJzZUludChsb2NhbFN0b3JhZ2UuZ2V0SXRlbShDT0RFX1ZFUlNJT05fS0VZKSkgfHwgMTsNCiAgICBpZiAoc2F2ZWRWZXJzaW9uIDwgY3VycmVudENvZGVWZXJzaW9uKSB7DQogICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShDT0RFX1ZFUlNJT05fS0VZLCBTdHJpbmcoY3VycmVudENvZGVWZXJzaW9uKSk7DQogICAgICByZXNldFNlc3Npb25Gb3JOZXdDb2RlKCk7DQogICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgcmV0dXJuIGZhbHNlOw0KICB9DQoNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIC8vIFRPS0VOIFNJQ1VSSSAoRmlyZWJhc2Ugc2VjdXJlX2xpbmtzLyopDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICBmdW5jdGlvbiBtYXliZUNsZWFuVXJsKCkgew0KICAgIGlmICghS0VFUF9UT0tFTl9JTl9VUkwpIGNsZWFuVXJsKCk7DQogIH0NCg0KICBhc3luYyBmdW5jdGlvbiBoYW5kbGVTZWN1cmVUb2tlbigpIHsNCiAgICBjb25zdCB1cmxQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gpOw0KICAgIGNvbnN0IHRva2VuID0gdXJsUGFyYW1zLmdldCgidG9rZW4iKTsNCiAgICBpZiAoIXRva2VuKSB7DQogICAgICBpc1Rva2VuU2Vzc2lvbiA9IGZhbHNlOw0KICAgICAgd2luZG93LmlzVG9rZW5TZXNzaW9uID0gZmFsc2U7DQogICAgICBjdXJyZW50VG9rZW5DdXN0b21Db2RlID0gbnVsbDsNCiAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQoNCiAgICB0cnkgew0KICAgICAgY29uc3Qgc25hcHNob3QgPSBhd2FpdCBkYXRhYmFzZQ0KICAgICAgICAucmVmKCJzZWN1cmVfbGlua3MvIiArIHRva2VuKQ0KICAgICAgICAub25jZSgidmFsdWUiKTsNCiAgICAgIGlmICghc25hcHNob3QuZXhpc3RzKCkpIHsNCiAgICAgICAgc2hvd1Rva2VuRXJyb3IoIlRva2VuIG5vbiB2YWxpZG8iKTsNCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGJsb2NrVG9rZW5Pbmx5KCJUb2tlbiBub24gdmFsaWRvIiwgdG9rZW4pOwogICAgICAgIH0gY2F0Y2gge30KICAgICAgICBzaG93U2Vzc2lvblNjYWR1dGEoKTsNCiAgICAgICAgbWF5YmVDbGVhblVybCgpOw0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICB9DQoNCiAgICAgIGNvbnN0IGxpbmtEYXRhID0gc25hcHNob3QudmFsKCk7DQogICAgICAvLyBJZiB0aGlzIHRva2VuIHdhcyBkZXZpY2UtYmxvY2tlZCwgZG8gbm90IHJlLWFjdGl2YXRlIG9uIHJlZnJlc2gKICAgICAgaWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKGB0b2tlbl9kZXZpY2VfYmxvY2tfJHt0b2tlbn1gKSA9PT0gIjEiKSB7CiAgICAgICAgY29uc3QgciA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGB0b2tlbl9kZXZpY2VfTW90aXZvXyR7dG9rZW59YCkgfHwgIlNlc3Npb25lIHRva2VuIHNjYWR1dGEgc3UgcXVlc3RvIGRpc3Bvc2l0aXZvIjsKICAgICAgICBzaG93VG9rZW5FcnJvcihyKTsKICAgICAgICB0cnkgeyBibG9ja1Rva2VuT25seShyLCB0b2tlbik7IH0gY2F0Y2gge30KICAgICAgICBzaG93U2Vzc2lvblNjYWR1dGEoKTsKICAgICAgICBtYXliZUNsZWFuVXJsKCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9DQogICAgICBcbiAgICAgIC8vIFNlIHF1ZXN0byB0b2tlbiDDg8KoIHN0YXRvIGJsb2NjYXRvIHN1IHF1ZXN0byBkaXNwb3NpdGl2byAoZXMuIHRlbXBvIHNlc3Npb25lIHNjYWR1dG8pLCBub24gcmlhdHRpdmFybG8gc3UgcmVmcmVzaFxuICAgICAgaWYgKGlzVG9rZW5EZXZpY2VCbG9ja2VkKHRva2VuKSkge1xuICAgICAgICBjb25zdCByID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oYHRva2VuX2RldmljZV9Nb3Rpdm9fJHt0b2tlbn1gKSB8fCAiU2Vzc2lvbmUgdG9rZW4gc2NhZHV0YSBzdSBxdWVzdG8gZGlzcG9zaXRpdm8iO1xuICAgICAgICBzaG93VG9rZW5FcnJvcihyKTtcbiAgICAgICAgdHJ5IHsgYmxvY2tUb2tlbk9ubHkociwgdG9rZW4pOyB9IGNhdGNoIHt9XG4gICAgICAgIHNob3dTZXNzaW9uU2NhZHV0YSgpO1xuICAgICAgICBtYXliZUNsZWFuVXJsKCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbmNvbnN0IGlzVmFsaWQgPSB2YWxpZGF0ZVNlY3VyZVRva2VuKGxpbmtEYXRhKTsNCiAgICAgIGlmICghaXNWYWxpZC52YWxpZCkgew0KICAgICAgICBzaG93VG9rZW5FcnJvcihpc1ZhbGlkLk1vdGl2byk7DQogICAgICAgIHRyeSB7CiAgICAgICAgICBibG9ja1Rva2VuT25seShpc1ZhbGlkLk1vdGl2byB8fCAiQWNjZXNzbyBibG9jY2F0byIsIHRva2VuKTsKICAgICAgICB9IGNhdGNoIHt9CiAgICAgICAgc2hvd1Nlc3Npb25TY2FkdXRhKCk7DQogICAgICAgIG1heWJlQ2xlYW5VcmwoKTsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgfQ0KDQogICAgICBpc1Rva2VuU2Vzc2lvbiA9IHRydWU7DQogICAgICB3aW5kb3cuaXNUb2tlblNlc3Npb24gPSB0cnVlOyAvLyBjb21wYXQgbGVnYWN5DQogICAgICBjdXJyZW50VG9rZW5JZCA9IHRva2VuOw0KICAgICAgY3VycmVudFRva2VuQ3VzdG9tQ29kZSA9IGxpbmtEYXRhLmN1c3RvbUNvZGUgfHwgbnVsbDsNCg0KICAgICAgLy8gc2Jsb2NjYSBibG9jY2hpIHByZWNlZGVudGkKICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oImJsb2NrX21hbnVhbF9sb2dpbiIpOwogICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgiYmxvY2tlZF90b2tlbiIpOwogICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgiYmxvY2tlZF9Nb3Rpdm8iKTsKICAgICAgLy8gQXNzaWN1cmF0aSBjaGUgZXZlbnR1YWxpIG92ZXJsYXkgZGkgc2NhZGVuemEgbm9uIHJlc3Rpbm8gdmlzaWJpbGkKICAgICAgdHJ5IHsKICAgICAgICB1bmJsb2NrQWNjZXNzKCk7CiAgICAgICAgcXMoIlNjYWR1dGFPdmVybGF5Iik/LmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOwogICAgICAgIHFzKCJzZXNzaW9uU2NhZHV0YSIpPy5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsKICAgICAgfSBjYXRjaCB7fQoNCiAgICAgIHNob3dUb2tlbk5vdGlmaWNhdGlvbihpc1ZhbGlkLnJlbWFpbmluZ1VzZXMsICEhY3VycmVudFRva2VuQ3VzdG9tQ29kZSk7DQogICAgICBhd2FpdCBpbmNyZW1lbnRUb2tlblVzYWdlKHRva2VuLCBsaW5rRGF0YSk7DQogICAgICBtYXliZUNsZWFuVXJsKCk7DQogICAgICBzdGFydFRva2VuRXhwaXJhdGlvbkNoZWNrKGxpbmtEYXRhLmV4cGlyYXRpb24pOw0KICAgICAgc3RhcnRUb2tlblJlYWx0aW1lTGlzdGVuZXIodG9rZW4pOw0KICAgICAgcmV0dXJuIHRydWU7DQogICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yZSBuZWxsYSB2ZXJpZmljYSBkZWwgdG9rZW46IiwgZXJyb3IpOw0KICAgICAgc2hvd1Rva2VuRXJyb3IoIkVycm9yZSBkaSB2ZXJpZmljYSIpOw0KICAgICAgdHJ5IHsKICAgICAgICBibG9ja1Rva2VuT25seSgiRXJyb3JlIGRpIHZlcmlmaWNhIiwgdG9rZW4pOwogICAgICB9IGNhdGNoIHt9CiAgICAgIHNob3dTZXNzaW9uU2NhZHV0YSgpOw0KICAgICAgbWF5YmVDbGVhblVybCgpOw0KICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIHN0b3BUb2tlblJlYWx0aW1lTGlzdGVuZXIoKSB7DQogICAgaWYgKHRva2VuUmVmKSB7DQogICAgICB0b2tlblJlZi5vZmYoKTsNCiAgICAgIHRva2VuUmVmID0gbnVsbDsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBjbGVhck1hbnVhbFNlc3Npb24oKSB7DQogICAgdHJ5IHsNCiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJ1c2FnZV9zdGFydF90aW1lIik7DQogICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgidXNhZ2VfaGFzaCIpOw0KICAgICAgc2Vzc2lvblN0YXJ0VGltZSA9IG51bGw7DQogICAgfSBjYXRjaCB7fQ0KICB9DQoNCiAgZnVuY3Rpb24gYmxvY2tBY2Nlc3MoTW90aXZvID0gIkFjY2Vzc28gYmxvY2NhdG8iLCB0b2tlbiA9IG51bGwpIHsKICAgIHRyeSB7CiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJibG9ja19tYW51YWxfbG9naW4iLCAiMSIpOwogICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgiYmxvY2tlZF9Nb3Rpdm8iLCBNb3Rpdm8pOwogICAgICBpZiAodG9rZW4pIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJibG9ja2VkX3Rva2VuIiwgdG9rZW4pOwogICAgfSBjYXRjaCAoZSkgewogICAgICBjb25zb2xlLmVycm9yKCJFcnJvcmUgYmxvY2tBY2Nlc3M6IiwgZSk7CiAgICB9CiAgfQoKICAvLyBCbG9jY2Egc29sbyBpbCB0b2tlbiBjb3JyZW50ZSBzZW56YSBhcHBsaWNhcmUgaWwgYmxvY2NvIGdsb2JhbGUgZGVsIGRpc3Bvc2l0aXZvCiAgZnVuY3Rpb24gYmxvY2tUb2tlbk9ubHkoTW90aXZvID0gIkFjY2Vzc28gYmxvY2NhdG8iLCB0b2tlbiA9IG51bGwpIHsKICAgIHRyeSB7CiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJibG9ja2VkX01vdGl2byIsIE1vdGl2byk7CiAgICAgIGlmICh0b2tlbikgbG9jYWxTdG9yYWdlLnNldEl0ZW0oImJsb2NrZWRfdG9rZW4iLCB0b2tlbik7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yZSBibG9ja1Rva2VuT25seToiLCBlKTsKICAgIH0KICB9Cg0KICBmdW5jdGlvbiB1bmJsb2NrQWNjZXNzKCkgewogICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oImJsb2NrX21hbnVhbF9sb2dpbiIpOwogICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oImJsb2NrZWRfTW90aXZvIik7CiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgiYmxvY2tlZF90b2tlbiIpOwogIH0KCiAgLy8gRmxhZyBkaSBibG9jY28gcGVyIHF1ZXN0byB0b2tlbiBzdSBxdWVzdG8gZGlzcG9zaXRpdm8KICBmdW5jdGlvbiBtYXJrVG9rZW5EZXZpY2VCbG9ja2VkKHRva2VuLCBNb3Rpdm8gPSAiIikgewogICAgdHJ5IHsKICAgICAgaWYgKCF0b2tlbikgcmV0dXJuOwogICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShgdG9rZW5fZGV2aWNlX2Jsb2NrXyR7dG9rZW59YCwgIjEiKTsKICAgICAgaWYgKE1vdGl2bykgbG9jYWxTdG9yYWdlLnNldEl0ZW0oYHRva2VuX2RldmljZV9Nb3Rpdm9fJHt0b2tlbn1gLCBNb3Rpdm8pOwogICAgfSBjYXRjaCAoZSkgewogICAgICBjb25zb2xlLmVycm9yKCJFcnJvcmUgbWFya1Rva2VuRGV2aWNlQmxvY2tlZDoiLCBlKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGlzVG9rZW5EZXZpY2VCbG9ja2VkKHRva2VuKSB7CiAgICB0cnkgewogICAgICBpZiAoIXRva2VuKSByZXR1cm4gZmFsc2U7CiAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShgdG9rZW5fZGV2aWNlX2Jsb2NrXyR7dG9rZW59YCkgPT09ICIxIjsKICAgIH0gY2F0Y2ggewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBjbGVhclRva2VuRGV2aWNlQmxvY2sodG9rZW4pIHsKICAgIHRyeSB7CiAgICAgIGlmICghdG9rZW4pIHJldHVybjsKICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oYHRva2VuX2RldmljZV9ibG9ja18ke3Rva2VufWApOwogICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShgdG9rZW5fZGV2aWNlX01vdGl2b18ke3Rva2VufWApOwogICAgfSBjYXRjaCB7fQogIH0KCiAgZnVuY3Rpb24gaGFzVG9rZW5Gb290cHJpbnQoKSB7DQogICAgdHJ5IHsNCiAgICAgIGlmIChpc1Rva2VuU2Vzc2lvbikgcmV0dXJuIHRydWU7DQogICAgICBjb25zdCB1cmxUb2sgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gpLmdldCgidG9rZW4iKTsNCiAgICAgIGlmICh1cmxUb2spIHJldHVybiB0cnVlOw0KICAgICAgaWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJibG9ja2VkX3Rva2VuIikpIHJldHVybiB0cnVlOw0KICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsb2NhbFN0b3JhZ2UubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgY29uc3QgayA9IGxvY2FsU3RvcmFnZS5rZXkoaSk7DQogICAgICAgIGlmIChrICYmIGsuaW5kZXhPZigidG9rZW5fb2tfIikgPT09IDApIHJldHVybiB0cnVlOw0KICAgICAgfQ0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgIGNvbnNvbGUud2FybigiaGFzVG9rZW5Gb290cHJpbnQgY2hlY2sgZmFpbGVkOiIsIGUpOw0KICAgIH0NCiAgICByZXR1cm4gZmFsc2U7DQogIH0NCg0KICBmdW5jdGlvbiBmb3JjZUdsb2JhbExvZ291dChNb3Rpdm8gPSAiQ29kaWNlIGFnZ2lvcm5hdG86IGFjY2VkaSBkaSBudW92byIpIHsNCiAgICBpc1Rva2VuU2Vzc2lvbiA9IGZhbHNlOw0KICAgIHdpbmRvdy5pc1Rva2VuU2Vzc2lvbiA9IGZhbHNlOw0KICAgIGNsZWFyTWFudWFsU2Vzc2lvbigpOw0KICAgIGNvbnN0IHQgPQ0KICAgICAgY3VycmVudFRva2VuSWQgfHwNCiAgICAgIG5ldyBVUkxTZWFyY2hQYXJhbXMobG9jYXRpb24uc2VhcmNoKS5nZXQoInRva2VuIikgfHwNCiAgICAgIG51bGw7DQogICAgYmxvY2tUb2tlbk9ubHkoTW90aXZvLCB0KTsKICAgIHRyeSB7DQogICAgICBpZiAodCkgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oYHRva2VuX29rXyR7dH1gKTsNCiAgICB9IGNhdGNoIHt9DQogICAgdHJ5IHsNCiAgICAgIHNob3dUb2tlbkVycm9yKE1vdGl2byk7DQogICAgfSBjYXRjaCB7fQ0KICAgIHNob3dTZXNzaW9uU2NhZHV0YSgpOw0KICAgIHN0b3BUb2tlblJlYWx0aW1lTGlzdGVuZXIoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGZvcmNlTG9nb3V0RnJvbVRva2VuKE1vdGl2byA9ICJMaW5rIG5vbiBwacODxpLDgsK5IHZhbGlkbyIpIHsNCiAgICBpc1Rva2VuU2Vzc2lvbiA9IGZhbHNlOw0KICAgIHdpbmRvdy5pc1Rva2VuU2Vzc2lvbiA9IGZhbHNlOw0KICAgIGNsZWFyTWFudWFsU2Vzc2lvbigpOw0KICAgIGNvbnN0IHQgPQ0KICAgICAgY3VycmVudFRva2VuSWQgfHwNCiAgICAgIG5ldyBVUkxTZWFyY2hQYXJhbXMobG9jYXRpb24uc2VhcmNoKS5nZXQoInRva2VuIikgfHwNCiAgICAgIG51bGw7DQogICAgYmxvY2tUb2tlbk9ubHkoTW90aXZvLCB0KTsgaWYgKHQpIHsgbG9jYWxTdG9yYWdlLnNldEl0ZW0oYHRva2VuX2RldmljZV9ibG9ja18ke3R9YCwgIjEiKTsgbG9jYWxTdG9yYWdlLnNldEl0ZW0oYHRva2VuX2RldmljZV9Nb3Rpdm9fJHt0fWAsIE1vdGl2byB8fCAiU2Vzc2lvbmUgdG9rZW4gc2NhZHV0YSIpOyB9DQogICAgdHJ5IHsNCiAgICAgIGlmICh0KSBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShgdG9rZW5fb2tfJHt0fWApOw0KICAgIH0gY2F0Y2gge30NCiAgICB0cnkgew0KICAgICAgc2hvd1Rva2VuRXJyb3IoTW90aXZvKTsNCiAgICB9IGNhdGNoIHt9DQogICAgc2hvd1Nlc3Npb25TY2FkdXRhKCk7DQogICAgc3RvcFRva2VuUmVhbHRpbWVMaXN0ZW5lcigpOw0KICB9DQoNCiAgZnVuY3Rpb24gc3RhcnRUb2tlblJlYWx0aW1lTGlzdGVuZXIodG9rZW4pIHsNCiAgICBzdG9wVG9rZW5SZWFsdGltZUxpc3RlbmVyKCk7DQogICAgdG9rZW5SZWYgPSBkYXRhYmFzZS5yZWYoInNlY3VyZV9saW5rcy8iICsgdG9rZW4pOw0KICAgIHRva2VuUmVmLm9uKCJ2YWx1ZSIsIChzbmFwKSA9PiB7DQogICAgICBpZiAoIXNuYXAuZXhpc3RzKCkpIHsNCiAgICAgICAgZm9yY2VMb2dvdXRGcm9tVG9rZW4oIkxpbmsgcmltb3NzbyIpOw0KICAgICAgICByZXR1cm47DQogICAgICB9DQogICAgICBjb25zdCBkID0gc25hcC52YWwoKTsNCiAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7DQogICAgICBjb25zdCBleGhhdXN0ZWQgPSAoZC51c2VkQ291bnQgfHwgMCkgPj0gKGQubWF4VXNhZ2UgfHwgMCk7DQogICAgICBjb25zdCBTY2FkdXRhID0gKGQuZXhwaXJhdGlvbiB8fCAwKSA8PSBub3c7DQogICAgICBjb25zdCByZXZva2VkID0gZC5zdGF0dXMgIT09ICJhY3RpdmUiOw0KICAgICAgaWYgKHJldm9rZWQgfHwgU2NhZHV0YSB8fCBleGhhdXN0ZWQpIHsNCiAgICAgICAgY29uc3Qgd2h5ID0gcmV2b2tlZA0KICAgICAgICAgID8gIkxpbmsgcmV2b2NhdG8iDQogICAgICAgICAgOiBTY2FkdXRhDQogICAgICAgICAgPyAiTGluayBzY2FkdXRvIg0KICAgICAgICAgIDogIlV0aWxpenppIGVzYXVyaXRpIjsNCiAgICAgICAgZm9yY2VMb2dvdXRGcm9tVG9rZW4od2h5KTsNCiAgICAgIH0NCiAgICB9KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHZhbGlkYXRlU2VjdXJlVG9rZW4obGlua0RhdGEpIHsNCiAgICB0cnkgew0KICAgICAgaWYgKCFsaW5rRGF0YSkgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCBNb3Rpdm86ICJUb2tlbiBub24gdmFsaWRvIiB9Ow0KICAgICAgaWYgKGxpbmtEYXRhLnN0YXR1cyAhPT0gImFjdGl2ZSIpDQogICAgICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgTW90aXZvOiAiTGluayByZXZvY2F0byIgfTsNCiAgICAgIGlmIChsaW5rRGF0YS5leHBpcmF0aW9uIDwgRGF0ZS5ub3coKSkNCiAgICAgICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCBNb3Rpdm86ICJUb2tlbiBzY2FkdXRvIiB9Ow0KICAgICAgaWYgKChsaW5rRGF0YS51c2VkQ291bnQgfHwgMCkgPj0gKGxpbmtEYXRhLm1heFVzYWdlIHx8IDApKQ0KICAgICAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIE1vdGl2bzogIlV0aWxpenppIGVzYXVyaXRpIiB9Ow0KICAgICAgY29uc3QgcmVtYWluaW5nVXNlcyA9DQogICAgICAgIChsaW5rRGF0YS5tYXhVc2FnZSB8fCAwKSAtIChsaW5rRGF0YS51c2VkQ291bnQgfHwgMCk7DQogICAgICByZXR1cm4geyB2YWxpZDogdHJ1ZSwgcmVtYWluaW5nVXNlcyB9Ow0KICAgIH0gY2F0Y2ggew0KICAgICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCBNb3Rpdm86ICJFcnJvcmUgZGkgdmVyaWZpY2EiIH07DQogICAgfQ0KICB9DQoNCiAgYXN5bmMgZnVuY3Rpb24gaW5jcmVtZW50VG9rZW5Vc2FnZSh0b2tlbiwgbGlua0RhdGEpIHsNCiAgICBjb25zdCBuZXdVc2VkQ291bnQgPSAobGlua0RhdGEudXNlZENvdW50IHx8IDApICsgMTsNCiAgICBjb25zdCBuZXdTdGF0dXMgPQ0KICAgICAgbmV3VXNlZENvdW50ID49IChsaW5rRGF0YS5tYXhVc2FnZSB8fCAwKSA/ICJ1c2VkIiA6ICJhY3RpdmUiOw0KICAgIHRyeSB7DQogICAgICBhd2FpdCBkYXRhYmFzZQ0KICAgICAgICAucmVmKCJzZWN1cmVfbGlua3MvIiArIHRva2VuKQ0KICAgICAgICAudXBkYXRlKHsgdXNlZENvdW50OiBuZXdVc2VkQ291bnQsIHN0YXR1czogbmV3U3RhdHVzIH0pOw0KICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICBjb25zb2xlLmVycm9yKCJFcnJvcmUgbmVsbCdhZ2dpb3JuYW1lbnRvIGRlbCB0b2tlbjoiLCBlcnJvcik7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gc2hvd1Rva2VuTm90aWZpY2F0aW9uKHJlbWFpbmluZ1VzZXMsIGhhc0N1c3RvbUNvZGUpIHsNCiAgICBjb25zdCBuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgbi5zdHlsZS5jc3NUZXh0ID0gYA0KICAgICAgcG9zaXRpb246Zml4ZWQ7IHRvcDoyMHB4OyByaWdodDoyMHB4OyBiYWNrZ3JvdW5kOnZhcigtLXN1Y2Nlc3MpOyBjb2xvcjojZmZmOw0KICAgICAgcGFkZGluZzoxNXB4IDIwcHg7IGJvcmRlci1yYWRpdXM6OHB4OyBib3gtc2hhZG93OjAgNHB4IDEycHggcmdiYSgwLDAsMCwuMSk7DQogICAgICB6LWluZGV4OjEwMDAwOyBkaXNwbGF5OmZsZXg7IGdhcDoxMHB4OyBhbGlnbi1pdGVtczpjZW50ZXI7IG1heC13aWR0aDozNTBweDtgOw0KICAgIGNvbnN0IGN1c3RvbSA9IGhhc0N1c3RvbUNvZGUNCiAgICAgID8gJzxkaXYgc3R5bGU9ImZvbnQtc2l6ZToxMnB4O29wYWNpdHk6Ljk7Ij5RdWVzdG8gbGluayB1c2EgdW4gY29kaWNlIGRlZGljYXRvPC9kaXY+Jw0KICAgICAgOiAnPGRpdiBzdHlsZT0iZm9udC1zaXplOjEycHg7b3BhY2l0eTouOTsiPlF1ZXN0byBsaW5rIHVzYSBpbCBjb2RpY2UgcHJpbmNpcGFsZTwvZGl2Pic7DQogICAgbi5pbm5lckhUTUwgPSBgDQogICAgICA8aSBjbGFzcz0iZmFzIGZhLWNoZWNrLWNpcmNsZSI+PC9pPg0KICAgICAgPGRpdj4NCiAgICAgICAgPGRpdj5MaW5rIHNpY3VybyByaWNvbm9zY2l1dG88L2Rpdj4NCiAgICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOjEycHg7b3BhY2l0eTouOTsiPlV0aWxpenppIHJpbWFuZW50aTogJHtyZW1haW5pbmdVc2VzfTwvZGl2Pg0KICAgICAgICAke2N1c3RvbX0NCiAgICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOjEycHg7b3BhY2l0eTouOTttYXJnaW4tdG9wOjVweDsiPjxpIGNsYXNzPSJmYXMgZmEtaW5mby1jaXJjbGUiPjwvaT4gSW5zZXJpc2NpIGlsIGNvZGljZSBxdWkgc290dG88L2Rpdj4NCiAgICAgIDwvZGl2Pg0KICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJ0aGlzLnBhcmVudEVsZW1lbnQucmVtb3ZlKCkiIHN0eWxlPSJiYWNrZ3JvdW5kOm5vbmU7Ym9yZGVyOm5vbmU7Y29sb3I6I2ZmZjttYXJnaW4tbGVmdDoxMHB4O2N1cnNvcjpwb2ludGVyIj4NCiAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS10aW1lcyI+PC9pPg0KICAgICAgPC9idXR0b24+YDsNCiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG4pOw0KICAgIHNldFRpbWVvdXQoKCkgPT4gbi5wYXJlbnRFbGVtZW50ICYmIG4ucmVtb3ZlKCksIDUwMDApOw0KICB9DQoNCiAgZnVuY3Rpb24gc2hvd1Rva2VuRXJyb3IoTW90aXZvKSB7DQogICAgY29uc3QgbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICAgIG4uc3R5bGUuY3NzVGV4dCA9IGANCiAgICAgIHBvc2l0aW9uOmZpeGVkOyB0b3A6MjBweDsgcmlnaHQ6MjBweDsgYmFja2dyb3VuZDp2YXIoLS1lcnJvcik7IGNvbG9yOiNmZmY7DQogICAgICBwYWRkaW5nOjE1cHggMjBweDsgYm9yZGVyLXJhZGl1czo4cHg7IGJveC1zaGFkb3c6MCA0cHggMTJweCByZ2JhKDAsMCwwLC4xKTsNCiAgICAgIHotaW5kZXg6MTAwMDA7IGRpc3BsYXk6ZmxleDsgZ2FwOjEwcHg7IGFsaWduLWl0ZW1zOmNlbnRlcjsgbWF4LXdpZHRoOjMyMHB4O2A7DQogICAgbi5pbm5lckhUTUwgPSBgDQogICAgICA8aSBjbGFzcz0iZmFzIGZhLWV4Y2xhbWF0aW9uLXRyaWFuZ2xlIj48L2k+DQogICAgICA8ZGl2Pg0KICAgICAgICA8ZGl2Pkxpbmsgbm9uIHZhbGlkbzwvZGl2Pg0KICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MTJweDtvcGFjaXR5Oi45OyI+TW90aXZvOiAke01vdGl2b308L2Rpdj4NCiAgICAgIDwvZGl2Pg0KICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJ0aGlzLnBhcmVudEVsZW1lbnQucmVtb3ZlKCkiIHN0eWxlPSJiYWNrZ3JvdW5kOm5vbmU7Ym9yZGVyOm5vbmU7Y29sb3I6I2ZmZjttYXJnaW4tbGVmdDoxMHB4O2N1cnNvcjpwb2ludGVyIj4NCiAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS10aW1lcyI+PC9pPg0KICAgICAgPC9idXR0b24+YDsNCiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG4pOw0KICAgIHNldFRpbWVvdXQoKCkgPT4gbi5wYXJlbnRFbGVtZW50ICYmIG4ucmVtb3ZlKCksIDUwMDApOw0KICB9DQoNCiAgZnVuY3Rpb24gY2xlYW5VcmwoKSB7DQogICAgaWYgKHdpbmRvdy5oaXN0b3J5LnJlcGxhY2VTdGF0ZSkgew0KICAgICAgY29uc3QgY2xlYW4gPSB3aW5kb3cubG9jYXRpb24ub3JpZ2luICsgd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lOw0KICAgICAgd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlKHt9LCBkb2N1bWVudC50aXRsZSwgY2xlYW4pOw0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIHN0YXJ0VG9rZW5FeHBpcmF0aW9uQ2hlY2soZXhwaXJhdGlvblRpbWUpIHsNCiAgICBjb25zdCBpdiA9IHNldEludGVydmFsKCgpID0+IHsNCiAgICAgIGlmIChEYXRlLm5vdygpID4gZXhwaXJhdGlvblRpbWUpIHsNCiAgICAgICAgY2xlYXJJbnRlcnZhbChpdik7DQogICAgICAgIGlzVG9rZW5TZXNzaW9uID0gZmFsc2U7DQogICAgICAgIHdpbmRvdy5pc1Rva2VuU2Vzc2lvbiA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIGJsb2NrVG9rZW5Pbmx5KCJMaW5rIHNjYWR1dG8iLCBjdXJyZW50VG9rZW5JZCB8fCBudWxsKTsKICAgICAgICBpZiAoY3VycmVudFRva2VuSWQpIHsgbG9jYWxTdG9yYWdlLnNldEl0ZW0oYHRva2VuX2RldmljZV9ibG9ja18ke2N1cnJlbnRUb2tlbklkfWAsICIxIik7IGxvY2FsU3RvcmFnZS5zZXRJdGVtKGB0b2tlbl9kZXZpY2VfTW90aXZvXyR7Y3VycmVudFRva2VuSWR9YCwgIkxpbmsgc2NhZHV0byIpOyB9CiAgICAgICAgc2hvd1Nlc3Npb25TY2FkdXRhKCk7CiAgICAgIH0NCiAgICB9LCAxMDAwKTsNCiAgfQ0KDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICAvLyBBVVRFTlRJQ0FaSU9ORQ0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgYXN5bmMgZnVuY3Rpb24gcGVyZm9ybU1hbnVhbExvZ2luKCkgew0KICAgIGlzVG9rZW5TZXNzaW9uID0gZmFsc2U7DQogICAgd2luZG93LmlzVG9rZW5TZXNzaW9uID0gZmFsc2U7DQogICAgc2Vzc2lvblN0YXJ0VGltZSA9IERhdGUubm93KCk7DQogICAgYXdhaXQgc2V0VXNhZ2VTdGFydFRpbWUoKTsNCg0KICAgIGlmIChhd2FpdCBjaGVja1RpbWVMaW1pdCgpKSByZXR1cm47DQoNCiAgICAvLyBBc3NpY3VyYXRpIGRpIG5hc2NvbmRlcmUgZXZlbnR1YWxpIG92ZXJsYXkgZGkgc2NhZGVuemENCiAgICB0cnkgew0KICAgICAgcXMoIlNjYWR1dGFPdmVybGF5Iik/LmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOw0KICAgICAgcXMoInNlc3Npb25TY2FkdXRhIik/LmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOw0KICAgICAgdW5ibG9ja0FjY2VzcygpOw0KICAgIH0gY2F0Y2gge30NCg0KICAgIHNob3dDb250cm9sUGFuZWwoKTsNCiAgICBxcygiY2hlY2tpblRpbWVJbmZvIikgJiYgKHFzKCJjaGVja2luVGltZUluZm8iKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIik7DQogICAgdXBkYXRlQ2hlY2tpblRpbWVEaXNwbGF5KCk7DQogICAgREVWSUNFUy5mb3JFYWNoKHVwZGF0ZUJ1dHRvblN0YXRlKTsNCiAgICB1cGRhdGVTdGF0dXNCYXIoKTsNCiAgfQ0KDQogIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZUNvZGVTdWJtaXQoKSB7DQogICAgY29uc3QgY29kZUlucHV0ID0gcXMoImF1dGhDb2RlIik7DQogICAgY29uc3QgaW5zZXJ0ZWRDb2RlID0gKGNvZGVJbnB1dD8udmFsdWUgfHwgIiIpLnRyaW0oKTsNCiAgICBsZXQgZXhwZWN0ZWRDb2RlID0gQ09SUkVDVF9DT0RFOw0KDQogICAgaWYgKGlzVG9rZW5TZXNzaW9uICYmIGN1cnJlbnRUb2tlbkN1c3RvbUNvZGUpDQogICAgICBleHBlY3RlZENvZGUgPSBjdXJyZW50VG9rZW5DdXN0b21Db2RlOw0KDQogICAgaWYgKGluc2VydGVkQ29kZSAhPT0gZXhwZWN0ZWRDb2RlKSB7DQogICAgICBhbGVydCgiQ29kaWNlIGVycmF0byEgUmlwcm92YS4iKTsNCiAgICAgIHJldHVybjsNCiAgICB9DQogICAgLy8gU2Ugc2lhbW8gaW4gc2Vzc2lvbmUgdG9rZW4sIHBlcnNpc3RpIHZhbGlkYXppb25lIGUgbW9zdHJhIHBhbm5lbGxvDQogICAgaWYgKGlzVG9rZW5TZXNzaW9uKSB7CiAgICAgIHRyeSB7CiAgICAgICAgaWYgKGN1cnJlbnRUb2tlbklkKQogICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oYHRva2VuX29rXyR7Y3VycmVudFRva2VuSWR9YCwgIjEiKTsKICAgICAgICAvLyBBdnZpYSBpbCB0aW1lciBkaSB1dGlsaXp6byBwZXIgc2Vzc2lvbmUgdG9rZW4gZG9wbyBzdWJtaXQKICAgICAgICBpZiAoY3VycmVudFRva2VuSWQpIGF3YWl0IHNldFRva2VuVXNhZ2VTdGFydFRpbWUoY3VycmVudFRva2VuSWQpOwogICAgICAgIC8vIE5hc2NvbmRpIHF1YWxzaWFzaSBvdmVybGF5IGRpIHNjYWRlbnphIGV2ZW50dWFsbWVudGUgcmltYXN0bwogICAgICAgIHFzKCJTY2FkdXRhT3ZlcmxheSIpPy5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsKICAgICAgICBxcygic2Vzc2lvblNjYWR1dGEiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7CiAgICAgICAgdW5ibG9ja0FjY2VzcygpOwogICAgICB9IGNhdGNoIHt9CiAgICAgIHNob3dDb250cm9sUGFuZWwoKTsNCiAgICAgIHJldHVybjsNCiAgICB9DQogICAgYXdhaXQgcGVyZm9ybU1hbnVhbExvZ2luKCk7DQogIH0NCg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgLy8gSU5JWklBTElaWkFaSU9ORSBBUFANCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIGFzeW5jIGZ1bmN0aW9uIGluaXQoKSB7DQogICAgY29uc29sZS5sb2coIkluaXppYWxpenphemlvbmUgYXBwLiIpOw0KDQogICAgY29uc3QgZmlyZWJhc2VTZXR0aW5ncyA9IGF3YWl0IGxvYWRTZXR0aW5nc0Zyb21GaXJlYmFzZSgpOw0KICAgIGlmIChmaXJlYmFzZVNldHRpbmdzKSBhcHBseUZpcmViYXNlU2V0dGluZ3MoZmlyZWJhc2VTZXR0aW5ncyk7DQoNCiAgICBpZiAoaXNTZXNzaW9uU3R1Y2soKSkgY29uc29sZS53YXJuKCJSaWxldmF0YSBwb3NzaWJpbGUgc2Vzc2lvbmUgYmxvY2NhdGEiKTsNCg0KICAgIGNvbnN0IHNhdmVkQ29kZVZlcnNpb24gPQ0KICAgICAgcGFyc2VJbnQobG9jYWxTdG9yYWdlLmdldEl0ZW0oImNvZGVfdmVyc2lvbiIpKSB8fCAxOw0KICAgIGlmIChzYXZlZENvZGVWZXJzaW9uIDwgY3VycmVudENvZGVWZXJzaW9uKSB7DQogICAgICByZXNldFNlc3Npb25Gb3JOZXdDb2RlKCk7DQogICAgfQ0KDQogICAgc2V0dXBFdmVudExpc3RlbmVycygpOw0KICAgIHNldHVwU2V0dGluZ3NMaXN0ZW5lcigpOw0KICAgIG1vbml0b3JGaXJlYmFzZUNvbm5lY3Rpb24oKTsNCg0KICAgIC8vIEJMT0NDTyBQRVJTSVNURU5URSBQUklNQSBESSBUVVRUTw0KICAgIGNvbnN0IGlzQmxvY2tlZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJibG9ja19tYW51YWxfbG9naW4iKSA9PT0gIjEiOw0KICAgIGlmIChpc0Jsb2NrZWQpIHsNCiAgICAgIGlzVG9rZW5TZXNzaW9uID0gZmFsc2U7DQogICAgICB3aW5kb3cuaXNUb2tlblNlc3Npb24gPSBmYWxzZTsNCiAgICAgIHNob3dTZXNzaW9uU2NhZHV0YSgpOw0KICAgIH0NCg0KICAgIC8vIFRPS0VOIHByaW1hIGRlbGxhIHNlc3Npb25lIG1hbnVhbGUNCiAgICBhd2FpdCBoYW5kbGVTZWN1cmVUb2tlbigpOw0KICAgIHNldHVwVG9rZW5VSSgpOw0KICAgIGlmIChpc1Rva2VuU2Vzc2lvbikgdW5ibG9ja0FjY2VzcygpOw0KDQogICAgLy8gQXV0by1hY2Nlc3NvIHNlIHRva2VuIGdpw4PGksOCwqAgdmFsaWRhdG8gc3UgcXVlc3RvIGRpc3Bvc2l0aXZvDQogICAgaWYgKGlzVG9rZW5TZXNzaW9uKSB7DQogICAgICBjb25zdCB0b2sgPQ0KICAgICAgICBjdXJyZW50VG9rZW5JZCB8fCBuZXcgVVJMU2VhcmNoUGFyYW1zKGxvY2F0aW9uLnNlYXJjaCkuZ2V0KCJ0b2tlbiIpOw0KICAgICAgdHJ5IHsNCiAgICAgICAgaWYgKHRvayAmJiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShgdG9rZW5fb2tfJHt0b2t9YCkgPT09ICIxIikgew0KICAgICAgICAgIHNob3dDb250cm9sUGFuZWwoKTsNCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCB7fQ0KICAgIH0NCg0KICAgIC8vIFNlIG5vbiBibG9jY2F0byBlIHNlbnphIHRva2VuOiBVSSBtYW51YWxlDQogICAgaWYgKCFpc1Rva2VuU2Vzc2lvbiAmJiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiYmxvY2tfbWFudWFsX2xvZ2luIikgIT09ICIxIikgew0KICAgICAgY29uc3QgU2NhZHV0YSA9IGF3YWl0IGNoZWNrVGltZUxpbWl0KCk7DQogICAgICBpZiAoIVNjYWR1dGEpIHsNCiAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gZ2V0U3RvcmFnZSgidXNhZ2Vfc3RhcnRfdGltZSIpOw0KICAgICAgICBpZiAoc3RhcnRUaW1lKSB7DQogICAgICAgICAgc2Vzc2lvblN0YXJ0VGltZSA9IHBhcnNlSW50KHN0YXJ0VGltZSwgMTApOw0KICAgICAgICAgIHNob3dDb250cm9sUGFuZWwoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBzaG93QXV0aEZvcm0oKTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgc2hvd0F1dGhGb3JtKCk7DQogICAgICB9DQogICAgfQ0KDQogICAgdXBkYXRlRG9vclZpc2liaWxpdHkoKTsNCiAgICBzZXR1cEludGVydmFscygpOw0KICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNvbnRleHRtZW51IiwgKGUpID0+IGUucHJldmVudERlZmF1bHQoKSk7DQogICAgdXBkYXRlQ2hlY2tpblRpbWVEaXNwbGF5KCk7DQogIH0NCg0KICBmdW5jdGlvbiBzZXR1cEV2ZW50TGlzdGVuZXJzKCkgew0KICAgIG9uKCJidG5DaGVja0NvZGUiLCAiY2xpY2siLCBoYW5kbGVDb2RlU3VibWl0KTsNCg0KICAgIERFVklDRVMuZm9yRWFjaCgoZGV2aWNlKSA9PiB7DQogICAgICBjb25zdCBidG4gPSBxcyhkZXZpY2UuYnV0dG9uX2lkKTsNCiAgICAgIGlmIChidG4pDQogICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHNob3dDb25maXJtYXRpb25Qb3B1cChkZXZpY2UpKTsNCiAgICB9KTsNCg0KICAgIG9uKCJjb25maXJtWWVzIiwgImNsaWNrIiwgKCkgPT4gew0KICAgICAgaWYgKGN1cnJlbnREZXZpY2UpIHsNCiAgICAgICAgYWN0aXZhdGVEZXZpY2UoY3VycmVudERldmljZSk7DQogICAgICAgIGNsb3NlQ29uZmlybWF0aW9uUG9wdXAoKTsNCiAgICAgIH0NCiAgICB9KTsNCiAgICBvbigiY29uZmlybU5vIiwgImNsaWNrIiwgY2xvc2VDb25maXJtYXRpb25Qb3B1cCk7DQoNCiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIucG9wdXAgLmJ0biIpLmZvckVhY2goKGJ1dHRvbikgPT4gew0KICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24gKCkgew0KICAgICAgICBjb25zdCBwb3B1cCA9IHRoaXMuY2xvc2VzdCgiLnBvcHVwIik7DQogICAgICAgIGlmIChwb3B1cCkgew0KICAgICAgICAgIGNvbnN0IGlkID0gcG9wdXAuaWQucmVwbGFjZSgicG9wdXAtIiwgIiIpOw0KICAgICAgICAgIGNsb3NlUG9wdXAoaWQpOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNob3dDb250cm9sUGFuZWwoKSB7DQogICAgY29uc3QgY3AgPSBxcygiY29udHJvbFBhbmVsIik7DQogICAgaWYgKGNwKSB7DQogICAgICBjcC5jbGFzc0xpc3QucmVtb3ZlKCJoaWRkZW4iKTsNCiAgICAgIGNwLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOw0KICAgIH0NCiAgICBjb25zdCByb290ID0gcXMoInRlc3QyIik7DQogICAgaWYgKHJvb3QpIHJvb3Quc3R5bGUuZGlzcGxheSA9ICJibG9jayI7DQogICAgY29uc3QgYWMgPSBxcygiYXV0aENvZGUiKTsNCiAgICBpZiAoYWMpIGFjLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogICAgY29uc3QgYWYgPSBxcygiYXV0aC1mb3JtIik7DQogICAgaWYgKGFmKSBhZi5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICAgIGNvbnN0IGJjID0gcXMoImJ0bkNoZWNrQ29kZSIpOw0KICAgIGlmIChiYykgYmMuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCiAgICBjb25zdCBpbXAgPSBxcygiaW1wb3J0YW50Iik7DQogICAgaWYgKGltcCkgaW1wLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogICAgLy8gYXNzaWN1cmF0aSBjaGUgZXZlbnR1YWxpIG92ZXJsYXkgbm9uIGNvcHJhbm8gaWwgcGFubmVsbG8NCiAgICBxcygiU2NhZHV0YU92ZXJsYXkiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7DQogICAgcXMoInNlc3Npb25TY2FkdXRhIik/LmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOw0KICAgIGNvbnN0IGluZm8gPSBxcygiY2hlY2tpblRpbWVJbmZvIik7DQogICAgaWYgKGluZm8pIGluZm8uc3R5bGUuZGlzcGxheSA9ICJibG9jayI7DQogICAgdXBkYXRlQ2hlY2tpblRpbWVEaXNwbGF5KCk7DQogICAgREVWSUNFUy5mb3JFYWNoKHVwZGF0ZUJ1dHRvblN0YXRlKTsNCiAgICB1cGRhdGVTdGF0dXNCYXIoKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNob3dBdXRoRm9ybSgpIHsNCiAgICBjb25zdCBjcCA9IHFzKCJjb250cm9sUGFuZWwiKTsNCiAgICBpZiAoY3ApIGNwLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogICAgY29uc3QgYWMgPSBxcygiYXV0aENvZGUiKTsNCiAgICBpZiAoYWMpIGFjLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOw0KICAgIGNvbnN0IGFmID0gcXMoImF1dGgtZm9ybSIpOw0KICAgIGlmIChhZikgYWYuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7DQogICAgY29uc3QgYmMgPSBxcygiYnRuQ2hlY2tDb2RlIik7DQogICAgaWYgKGJjKSBiYy5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsNCiAgICBjb25zdCBpbXAgPSBxcygiaW1wb3J0YW50Iik7DQogICAgaWYgKGltcCkgaW1wLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOw0KICB9DQoNCiAgZnVuY3Rpb24gc2V0dXBUb2tlblVJKCkgew0KICAgIGlmICghaXNUb2tlblNlc3Npb24pIHJldHVybjsNCg0KICAgIGNvbnN0IGFkbWluTGluayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2FbaHJlZj0iYWRtaW4uaHRtbCJdJyk7DQogICAgaWYgKGFkbWluTGluaykgYWRtaW5MaW5rLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQoNCiAgICBjb25zdCBTY2FkdXRhTWVzc2FnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNzZXNzaW9uU2NhZHV0YSBwIik7DQogICAgaWYgKFNjYWR1dGFNZXNzYWdlKQ0KICAgICAgU2NhZHV0YU1lc3NhZ2UudGV4dENvbnRlbnQgPQ0KICAgICAgICAiSWwgbGluayBkaSBhY2Nlc3NvIMODxpLDgsKoIHNjYWR1dG8uIFBlciBhY2NlZGVyZSBkaSBudW92bywgcmljaGllZGkgdW4gbnVvdm8gbGluay4iOw0KDQogICAgY29uc3QgYXNzaXN0YW5jZUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoDQogICAgICAiI3Nlc3Npb25TY2FkdXRhIC5idG4td2hhdHNhcHAiDQogICAgKTsNCiAgICBpZiAoYXNzaXN0YW5jZUJ0bikgew0KICAgICAgYXNzaXN0YW5jZUJ0bi5ocmVmID0NCiAgICAgICAgImh0dHBzOi8vYXBpLndoYXRzYXBwLmNvbS9zZW5kP3Bob25lPSszOTM4OTg4ODM2MzQmdGV4dD1IaSwgSSBuZWVkIGEgbmV3IGFjY2VzcyBsaW5rIjsNCiAgICAgIGFzc2lzdGFuY2VCdG4uaW5uZXJIVE1MID0NCiAgICAgICAgJzxpIGNsYXNzPSJmYWIgZmEtd2hhdHNhcHAiPjwvaT4gUmljaGllZGkgbnVvdm8gbGluayc7DQogICAgfQ0KDQogICAgY29uc3QgYXV0aENvZGVJbnB1dCA9IHFzKCJhdXRoQ29kZSIpOw0KICAgIGlmIChhdXRoQ29kZUlucHV0KSB7DQogICAgICBhdXRoQ29kZUlucHV0LnBsYWNlaG9sZGVyID0gY3VycmVudFRva2VuQ3VzdG9tQ29kZQ0KICAgICAgICA/ICJJbnNlcmlzY2kgaWwgY29kaWNlIGRlZGljYXRvIGRlbCBsaW5rIg0KICAgICAgICA6ICJJbnNlcmlzY2kgaWwgY29kaWNlIHByaW5jaXBhbGUiOw0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIHNldHVwSW50ZXJ2YWxzKCkgew0KICAgIHNldHVwQ29kZUNoYW5nZUxpc3RlbmVyKCk7DQoNCiAgICB0aW1lQ2hlY2tJbnRlcnZhbCA9IHNldEludGVydmFsKGFzeW5jICgpID0+IHsNCiAgICAgIGNvbnN0IFNjYWR1dGEgPSBhd2FpdCBjaGVja1RpbWVMaW1pdCgpOw0KICAgICAgaWYgKCFTY2FkdXRhKSB7DQogICAgICAgIGF3YWl0IHVwZGF0ZUdsb2JhbENvZGVWZXJzaW9uKCk7DQogICAgICAgIHVwZGF0ZUNoZWNraW5UaW1lRGlzcGxheSgpOw0KICAgICAgfQ0KICAgIH0sIDEwMDApOw0KDQogICAgc2V0SW50ZXJ2YWwodXBkYXRlQ2hlY2tpblRpbWVEaXNwbGF5LCA2MDAwMCk7DQogIH0NCg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgLy8gQVZWSU8vU1RPUA0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsIGluaXQpOw0KDQogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJiZWZvcmV1bmxvYWQiLCAoKSA9PiB7DQogICAgaWYgKHRpbWVDaGVja0ludGVydmFsKSBjbGVhckludGVydmFsKHRpbWVDaGVja0ludGVydmFsKTsNCiAgICBpZiAoY29kZUNoZWNrSW50ZXJ2YWwpIGNsZWFySW50ZXJ2YWwoY29kZUNoZWNrSW50ZXJ2YWwpOw0KICAgIGlmIChMSU5LX0NIRUNLX0lOVEVSVkFMKSBjbGVhckludGVydmFsKExJTktfQ0hFQ0tfSU5URVJWQUwpOw0KICAgIHN0b3BUb2tlblJlYWx0aW1lTGlzdGVuZXIoKTsNCiAgICBpZiAoc2V0dGluZ3NSZWYpIHNldHRpbmdzUmVmLm9mZiAmJiBzZXR0aW5nc1JlZi5vZmYoKTsNCiAgfSk7DQoNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIC8vIEVTUE9SVEFaSU9ORSBGVU5aSU9OSSBHTE9CQUxJIChjb21wYXRpYmlsaXTDg8aSw4LCoCkNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIE9iamVjdC5hc3NpZ24od2luZG93LCB7DQogICAgLy8gdXRpbHMNCiAgICBxcywNCiAgICBvbiwNCiAgICBzaG93Tm90aWZpY2F0aW9uLA0KICAgIGZvcm1hdFRpbWUsDQogICAgZmV0Y2hXaXRoVGltZW91dCwNCiAgICAvLyBzdG9yYWdlDQogICAgc2V0U3RvcmFnZSwNCiAgICBnZXRTdG9yYWdlLA0KICAgIGNsZWFyU3RvcmFnZSwNCiAgICAvLyBjcnlwdG8NCiAgICBnZW5lcmF0ZUhhc2gsDQogICAgLy8gc2V0dGluZ3MNCiAgICBsb2FkU2V0dGluZ3NGcm9tRmlyZWJhc2UsDQogICAgYXBwbHlGaXJlYmFzZVNldHRpbmdzLA0KICAgIHNldHVwU2V0dGluZ3NMaXN0ZW5lciwNCiAgICBtb25pdG9yRmlyZWJhc2VDb25uZWN0aW9uLA0KICAgIC8vIHRlbXBvL3Nlc3Npb25lDQogICAgc2V0VXNhZ2VTdGFydFRpbWUsDQogICAgY2hlY2tUaW1lTGltaXQsDQogICAgc2hvd0ZhdGFsRXJyb3IsDQogICAgc2hvd1Nlc3Npb25TY2FkdXRhLA0KICAgIGlzU2Vzc2lvblN0dWNrLA0KICAgIC8vIGNoZWNrLWluIHRpbWUNCiAgICBpc0NoZWNraW5UaW1lLA0KICAgIHVwZGF0ZUNoZWNraW5UaW1lRGlzcGxheSwNCiAgICBzaG93RWFybHlDaGVja2luUG9wdXAsDQogICAgY2xvc2VFYXJseUNoZWNraW5Qb3B1cCwNCiAgICAvLyBVSQ0KICAgIHVwZGF0ZVN0YXR1c0JhciwNCiAgICBnZXRDbGlja3NMZWZ0LA0KICAgIHNldENsaWNrc0xlZnQsDQogICAgdXBkYXRlQnV0dG9uU3RhdGUsDQogICAgdXBkYXRlRG9vclZpc2liaWxpdHksDQogICAgLy8gY29kZSBjaGFuZ2UNCiAgICBzZXR1cENvZGVDaGFuZ2VMaXN0ZW5lciwNCiAgICBjaGVja0NvZGVWZXJzaW9uLA0KICAgIGhhbmRsZUNvZGVDaGFuZ2UsDQogICAgcmVzZXRTZXNzaW9uRm9yTmV3Q29kZSwNCiAgICBjaGVja1NjYWR1dGFMaW5rcywNCiAgICAvLyBwb3B1cA0KICAgIHNob3dDb25maXJtYXRpb25Qb3B1cCwNCiAgICBjbG9zZUNvbmZpcm1hdGlvblBvcHVwLA0KICAgIHNob3dEZXZpY2VQb3B1cCwNCiAgICBjbG9zZVBvcHVwLA0KICAgIC8vIHNoZWxseQ0KICAgIGFjdGl2YXRlRGV2aWNlLA0KICAgIHVwZGF0ZUdsb2JhbENvZGVWZXJzaW9uLA0KICAgIC8vIHRva2VuDQogICAgaGFuZGxlU2VjdXJlVG9rZW4sDQogICAgc3RvcFRva2VuUmVhbHRpbWVMaXN0ZW5lciwNCiAgICBjbGVhck1hbnVhbFNlc3Npb24sDQogICAgYmxvY2tBY2Nlc3MsDQogICAgdW5ibG9ja0FjY2VzcywNCiAgICBmb3JjZUdsb2JhbExvZ291dCwNCiAgICBmb3JjZUxvZ291dEZyb21Ub2tlbiwNCiAgICBzdGFydFRva2VuUmVhbHRpbWVMaXN0ZW5lciwNCiAgICB2YWxpZGF0ZVNlY3VyZVRva2VuLA0KICAgIGluY3JlbWVudFRva2VuVXNhZ2UsDQogICAgc2hvd1Rva2VuTm90aWZpY2F0aW9uLA0KICAgIHNob3dUb2tlbkVycm9yLA0KICAgIGNsZWFuVXJsLA0KICAgIHN0YXJ0VG9rZW5FeHBpcmF0aW9uQ2hlY2ssDQogICAgLy8gYXV0aA0KICAgIHBlcmZvcm1NYW51YWxMb2dpbiwNCiAgICBoYW5kbGVDb2RlU3VibWl0LA0KICAgIC8vIGFwcCBsaWZlY3ljbGUNCiAgICBpbml0LA0KICAgIHNldHVwRXZlbnRMaXN0ZW5lcnMsDQogICAgc2hvd0NvbnRyb2xQYW5lbCwNCiAgICBzaG93QXV0aEZvcm0sDQogICAgc2V0dXBUb2tlblVJLA0KICAgIHNldHVwSW50ZXJ2YWxzLA0KICB9KTsNCn0pKCk7DQoNCg0KDQo=');