(function(s){try{(0,eval)(atob(s));}catch(e){console.error('obf error',e);}})('KCgpID0+IHsNCiAgInVzZSBzdHJpY3QiOw0KDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICAvLyBDT05GSUdVUkFaSU9ORSBFIElOSVpJQUxJWlpBWklPTkUNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIGNvbnN0IGZpcmViYXNlQ29uZmlnID0gew0KICAgIGFwaUtleTogIkFJemFTeUN1eTNTYWs5NnNvQ2xhN2I1WWI1d21rZFZmTXFBWG1vayIsDQogICAgYXV0aERvbWFpbjogImNoZWNrLWluLTRlMGU5LmZpcmViYXNlYXBwLmNvbSIsDQogICAgZGF0YWJhc2VVUkw6DQogICAgICAiaHR0cHM6Ly9jaGVjay1pbi00ZTBlOS1kZWZhdWx0LXJ0ZGIuZXVyb3BlLXdlc3QxLmZpcmViYXNlZGF0YWJhc2UuYXBwIiwNCiAgICBwcm9qZWN0SWQ6ICJjaGVjay1pbi00ZTBlOSIsDQogICAgc3RvcmFnZUJ1Y2tldDogImNoZWNrLWluLTRlMGU5LmZpcmViYXNlc3RvcmFnZS5hcHAiLA0KICAgIG1lc3NhZ2luZ1NlbmRlcklkOiAiNzIzODgwOTkwMTc3IiwNCiAgICBhcHBJZDogIjE6NzIzODgwOTkwMTc3OndlYjpmMDAyNzMzYjJjYzJlNTBkMTcyZWEwIiwNCiAgICBtZWFzdXJlbWVudElkOiAiRy1IOTdHQjlMNEY1IiwNCiAgfTsNCg0KICBjb25zdCBCQVNFX1VSTF9TRVQgPQ0KICAgICJodHRwczovL3NoZWxseS03My1ldS5zaGVsbHkuY2xvdWQvdjIvZGV2aWNlcy9hcGkvc2V0L3N3aXRjaCI7DQogIGNvbnN0IFNFQ1JFVF9LRVkgPSAibXVzYXJ0X3NlY3JldF8xMjNfZml4ZWRfa2V5IjsNCiAgY29uc3QgQ09ERV9WRVJTSU9OX0tFWSA9ICJjb2RlX3ZlcnNpb24iOw0KICBjb25zdCBLRUVQX1RPS0VOX0lOX1VSTCA9IHRydWU7IC8vIG1hbnRpZW5pIGlsIHRva2VuIG5lbGwnVVJMIGRvcG8gbGEgdmVyaWZpY2ENCiAgY29uc3QgVU5CTE9DS19WRVJTSU9OX0tFWSA9ICJ1bmJsb2NrX3ZlcnNpb24iOw0KDQogIC8vIENvbmZpZ3VyYXppb25lIGRpc3Bvc2l0aXZpIFNoZWxseSAoaW1tdXRhYmlsZSkNCiAgY29uc3QgREVWSUNFUyA9IE9iamVjdC5mcmVlemUoWw0KICAgIHsNCiAgICAgIGlkOiAiZTRiMDYzZjBjMzhjIiwNCiAgICAgIGF1dGhfa2V5Og0KICAgICAgICAiTVdJMk1EYzRkV2xrNDkwOEE3MURBODA5RkNFQzA1QzVEMUYzNjA5NDNGQkZDNkE3OTM0RUMwRkQ5RTNDRkVBRjAzRjhGNUE2QTRBMEM2MDY2NUI5N0ExQUEyRTIiLA0KICAgICAgc3RvcmFnZV9rZXk6ICJjbGlja3NfTWFpbkRvb3IiLA0KICAgICAgYnV0dG9uX2lkOiAiTWFpbkRvb3IiLA0KICAgICAgdmlzaWJsZTogdHJ1ZSwNCiAgICB9LA0KICAgIHsNCiAgICAgIGlkOiAiMzQ5NDU0NzhkNTk1IiwNCiAgICAgIGF1dGhfa2V5Og0KICAgICAgICAiTVdJMk1EYzRkV2xrNDkwOEE3MURBODA5RkNFQzA1QzVEMUYzNjA5NDNGQkZDNkE3OTM0RUMwRkQ5RTNDRkVBRjAzRjhGNUE2QTRBMEM2MDY2NUI5N0ExQUEyRTIiLA0KICAgICAgc3RvcmFnZV9rZXk6ICJjbGlja3NfQXB0RG9vciIsDQogICAgICBidXR0b25faWQ6ICJBcHREb29yIiwNCiAgICAgIHZpc2libGU6IHRydWUsDQogICAgfSwNCiAgICB7DQogICAgICBpZDogIjM0OTQ1NDdhYjE2MSIsDQogICAgICBhdXRoX2tleToNCiAgICAgICAgIk1XSTJNRGM0ZFdsazQ5MDhBNzFEQTgwOUZDRUMwNUM1RDFGMzYwOTQzRkJGQzZBNzkzNEVDMEZEOUUzQ0ZFQUYwM0Y4RjVBNkE0QTBDNjA2NjVCOTdBMUFBMkUyIiwNCiAgICAgIHN0b3JhZ2Vfa2V5OiAiY2xpY2tzX0V4dHJhRG9vcjEiLA0KICAgICAgYnV0dG9uX2lkOiAiRXh0cmFEb29yMSIsDQogICAgICB2aXNpYmxlOiBmYWxzZSwNCiAgICB9LA0KICAgIHsNCiAgICAgIGlkOiAicGxhY2Vob2xkZXJfaWRfMiIsDQogICAgICBhdXRoX2tleTogInBsYWNlaG9sZGVyX2F1dGhfa2V5XzIiLA0KICAgICAgc3RvcmFnZV9rZXk6ICJjbGlja3NfRXh0cmFEb29yMiIsDQogICAgICBidXR0b25faWQ6ICJFeHRyYURvb3IyIiwNCiAgICAgIHZpc2libGU6IGZhbHNlLA0KICAgIH0sDQogIF0pOw0KDQogIC8vIFZhcmlhYmlsaSBnbG9iYWxpL2RpIHN0YXRvDQogIGxldCBNQVhfQ0xJQ0tTID0gcGFyc2VJbnQobG9jYWxTdG9yYWdlLmdldEl0ZW0oIm1heF9jbGlja3MiKSkgfHwgMzsNCiAgbGV0IFRJTUVfTElNSVRfTUlOVVRFUyA9CiAgICBwYXJzZUludChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgidGltZV9saW1pdF9taW51dGVzIikpIHx8IDUwMDAwOwogIC8vIExpbWl0ZSBwZXIgc2Vzc2lvbmkgdG9rZW4gZG9wbyBzdWJtaXQgKGRpIGRlZmF1bHQgdWd1YWxlIGEgVElNRV9MSU1JVF9NSU5VVEVTKQogIGNvbnN0IFRPS0VOX0xJTUlUX01JTlVURVMgPQogICAgcGFyc2VJbnQobG9jYWxTdG9yYWdlLmdldEl0ZW0oInRva2VuX3RpbWVfbGltaXRfbWludXRlcyIpKSB8fAogICAgVElNRV9MSU1JVF9NSU5VVEVTOwogIGxldCBDT1JSRUNUX0NPREUgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgic2VjcmV0X2NvZGUiKSB8fCAiMjI0NSI7DQogIGxldCBjdXJyZW50Q29kZVZlcnNpb24gPQ0KICAgIHBhcnNlSW50KGxvY2FsU3RvcmFnZS5nZXRJdGVtKENPREVfVkVSU0lPTl9LRVkpKSB8fCAxOw0KDQogIC8vIE9yYXJpIGRpIGNoZWNrw6LigqzigJhpbiAoZGkgZGVmYXVsdCwgcG9pIGFycml2YW5vIGRhIEZpcmViYXNlKQ0KICBsZXQgQ0hFQ0tJTl9TVEFSVF9USU1FID0gIjE0OjAwIjsNCiAgbGV0IENIRUNLSU5fRU5EX1RJTUUgPSAiMjI6MDAiOw0KICBsZXQgQ0hFQ0tJTl9USU1FX0VOQUJMRUQgPSB0cnVlOw0KDQogIC8vIFN0YXRvIHJ1bnRpbWUNCiAgbGV0IGlzVG9rZW5TZXNzaW9uID0gZmFsc2U7IC8vIFVTQVJFIFNFTVBSRSBRVUVTVEENCiAgbGV0IGN1cnJlbnRUb2tlbklkID0gbnVsbDsNCiAgbGV0IGN1cnJlbnRUb2tlbkN1c3RvbUNvZGUgPSBudWxsOw0KICBsZXQgc2Vzc2lvblN0YXJ0VGltZSA9IG51bGw7DQogIGxldCBjdXJyZW50RGV2aWNlID0gbnVsbDsNCg0KICAvLyBJbnRlcnZhbGxpL2xpc3RlbmVyDQogIGxldCB0aW1lQ2hlY2tJbnRlcnZhbCA9IG51bGw7DQogIGxldCBjb2RlQ2hlY2tJbnRlcnZhbCA9IG51bGw7DQogIGxldCBMSU5LX0NIRUNLX0lOVEVSVkFMID0gbnVsbDsNCiAgbGV0IHNldHRpbmdzUmVmID0gbnVsbDsNCiAgbGV0IHRva2VuUmVmID0gbnVsbDsNCg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgLy8gRmlyZWJhc2UgaW5pdCAoY29uIGd1YXJkaWEpDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICBpZiAoIWZpcmViYXNlLmFwcHMgfHwgZmlyZWJhc2UuYXBwcy5sZW5ndGggPT09IDApIHsNCiAgICBmaXJlYmFzZS5pbml0aWFsaXplQXBwKGZpcmViYXNlQ29uZmlnKTsNCiAgfQ0KICBjb25zdCBkYXRhYmFzZSA9IGZpcmViYXNlLmRhdGFiYXNlKCk7DQoNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIC8vIFVUSUxTDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICBmdW5jdGlvbiBxcyhpZCkgew0KICAgIHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7DQogIH0NCg0KICBmdW5jdGlvbiBvbihpZCwgZXZ0LCBoYW5kbGVyKSB7DQogICAgY29uc3QgZWwgPSBxcyhpZCk7DQogICAgaWYgKGVsKSBlbC5hZGRFdmVudExpc3RlbmVyKGV2dCwgaGFuZGxlcik7DQogIH0NCg0KICBmdW5jdGlvbiBzaG93Tm90aWZpY2F0aW9uKG1lc3NhZ2UsIHR5cGUgPSAiaW5mbyIpIHsNCiAgICBjb25zdCBleGlzdGluZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb2RlQ2hhbmdlTm90aWZpY2F0aW9uIik7DQogICAgaWYgKGV4aXN0aW5nKSBleGlzdGluZy5yZW1vdmUoKTsNCg0KICAgIGNvbnN0IG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICBuLmlkID0gImNvZGVDaGFuZ2VOb3RpZmljYXRpb24iOw0KICAgIG4uc3R5bGUuY3NzVGV4dCA9IGANCiAgICAgIHBvc2l0aW9uOiBmaXhlZDsgdG9wOiAyMHB4OyByaWdodDogMjBweDsgei1pbmRleDogMTAwMDA7DQogICAgICBiYWNrZ3JvdW5kOiAkew0KICAgICAgICB0eXBlID09PSAid2FybmluZyINCiAgICAgICAgICA/ICIjRkZBNTAwIg0KICAgICAgICAgIDogdHlwZSA9PT0gImVycm9yIg0KICAgICAgICAgID8gIiNGRjVBNUYiDQogICAgICAgICAgOiAiIzRDQUY1MCINCiAgICAgIH07DQogICAgICBjb2xvcjogI2ZmZjsgcGFkZGluZzogMTVweCAyMHB4OyBib3JkZXItcmFkaXVzOiA4cHg7IGJveC1zaGFkb3c6IDAgNHB4IDEycHggcmdiYSgwLDAsMCwuMTIpOw0KICAgICAgZGlzcGxheTpmbGV4OyBnYXA6MTBweDsgYWxpZ24taXRlbXM6Y2VudGVyOyBtYXgtd2lkdGg6MzYwcHg7DQogICAgYDsNCiAgICBuLmlubmVySFRNTCA9IGANCiAgICAgIDxpIGNsYXNzPSJmYXMgZmEtaW5mby1jaXJjbGUiPjwvaT4NCiAgICAgIDxzcGFuPiR7bWVzc2FnZX08L3NwYW4+DQogICAgICA8YnV0dG9uIG9uY2xpY2s9InRoaXMucGFyZW50RWxlbWVudC5yZW1vdmUoKSIgc3R5bGU9ImJhY2tncm91bmQ6bm9uZTtib3JkZXI6bm9uZTtjb2xvcjojZmZmO2N1cnNvcjpwb2ludGVyIj4NCiAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS10aW1lcyI+PC9pPg0KICAgICAgPC9idXR0b24+YDsNCiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG4pOw0KICAgIHNldFRpbWVvdXQoKCkgPT4gbi5wYXJlbnRFbGVtZW50ICYmIG4ucmVtb3ZlKCksIDUwMDApOw0KICB9DQoNCiAgZnVuY3Rpb24gZm9ybWF0VGltZSh0aW1lU3RyaW5nKSB7DQogICAgY29uc3QgW2gsIG1dID0gU3RyaW5nKHRpbWVTdHJpbmcgfHwgIiIpLnNwbGl0KCI6Iik7DQogICAgcmV0dXJuIGAke2g/LnBhZFN0YXJ0KDIsICIwIil9OiR7bT8ucGFkU3RhcnQoMiwgIjAiKX1gOw0KICB9DQoNCiAgZnVuY3Rpb24gZmV0Y2hXaXRoVGltZW91dCh1cmwsIG9wdGlvbnMgPSB7fSwgdGltZW91dE1zID0gMTIwMDApIHsNCiAgICBjb25zdCBjb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpOw0KICAgIGNvbnN0IGlkID0gc2V0VGltZW91dCgoKSA9PiBjb250cm9sbGVyLmFib3J0KCksIHRpbWVvdXRNcyk7DQogICAgY29uc3QgcCA9IGZldGNoKHVybCwgeyAuLi5vcHRpb25zLCBzaWduYWw6IGNvbnRyb2xsZXIuc2lnbmFsIH0pLmZpbmFsbHkoDQogICAgICAoKSA9PiBjbGVhclRpbWVvdXQoaWQpDQogICAgKTsNCiAgICByZXR1cm4gcDsNCiAgfQ0KDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICAvLyBTVE9SQUdFIChsb2NhbFN0b3JhZ2UgKyBjb29raWUgY29tcGF0KQ0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgZnVuY3Rpb24gc2V0U3RvcmFnZShrZXksIHZhbHVlLCBtaW51dGVzKSB7DQogICAgdHJ5IHsNCiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgdmFsdWUpOw0KICAgICAgY29uc3QgZXhwaXJhdGlvbkRhdGUgPSBuZXcgRGF0ZSgpOw0KICAgICAgZXhwaXJhdGlvbkRhdGUuc2V0VGltZShleHBpcmF0aW9uRGF0ZS5nZXRUaW1lKCkgKyBtaW51dGVzICogNjAgKiAxMDAwKTsNCiAgICAgIGNvbnN0IGV4cGlyZXMgPSAiZXhwaXJlcz0iICsgZXhwaXJhdGlvbkRhdGUudG9VVENTdHJpbmcoKTsNCiAgICAgIGRvY3VtZW50LmNvb2tpZSA9IGAke2tleX09JHt2YWx1ZX07ICR7ZXhwaXJlc307IHBhdGg9LzsgU2FtZVNpdGU9U3RyaWN0YDsNCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgY29uc29sZS5lcnJvcigiRXJyb3JlIG5lbCBzYWx2YXRhZ2dpbyBkZWkgZGF0aToiLCBlcnJvcik7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gZ2V0U3RvcmFnZShrZXkpIHsNCiAgICB0cnkgew0KICAgICAgY29uc3QgbG9jYWxWYWx1ZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSk7DQogICAgICBpZiAobG9jYWxWYWx1ZSAhPT0gbnVsbCkgcmV0dXJuIGxvY2FsVmFsdWU7DQogICAgICBjb25zdCBjb29raWVzID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCI7Iik7DQogICAgICBmb3IgKGNvbnN0IGNvb2tpZSBvZiBjb29raWVzKSB7DQogICAgICAgIGNvbnN0IFtuYW1lLCB2YWx1ZV0gPSBjb29raWUudHJpbSgpLnNwbGl0KCI9Iik7DQogICAgICAgIGlmIChuYW1lID09PSBrZXkpIHJldHVybiB2YWx1ZTsNCiAgICAgIH0NCiAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgY29uc29sZS5lcnJvcigiRXJyb3JlIG5lbCByZWN1cGVybyBkZWkgZGF0aToiLCBlcnJvcik7DQogICAgfQ0KICAgIHJldHVybiBudWxsOw0KICB9DQoNCiAgZnVuY3Rpb24gY2xlYXJTdG9yYWdlKGtleSkgew0KICAgIHRyeSB7DQogICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpOw0KICAgICAgZG9jdW1lbnQuY29va2llID0gYCR7a2V5fT07IGV4cGlyZXM9VGh1LCAwMSBKYW4gMTk3MCAwMDowMDowMCBVVEM7IHBhdGg9LztgOw0KICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICBjb25zb2xlLmVycm9yKCJFcnJvcmUgbmVsbGEgcmltb3ppb25lIGRlaSBkYXRpOiIsIGVycm9yKTsNCiAgICB9DQogIH0NCg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgLy8gQ1JJVFRPR1JBRklBDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICBhc3luYyBmdW5jdGlvbiBnZW5lcmF0ZUhhc2goc3RyKSB7DQogICAgY29uc3QgZW5jb2RlciA9IG5ldyBUZXh0RW5jb2RlcigpOw0KICAgIGNvbnN0IGRhdGEgPSBlbmNvZGVyLmVuY29kZShzdHIpOw0KICAgIGNvbnN0IGhhc2hCdWZmZXIgPSBhd2FpdCBjcnlwdG8uc3VidGxlLmRpZ2VzdCgiU0hBLTI1NiIsIGRhdGEpOw0KICAgIGNvbnN0IGhhc2hBcnJheSA9IEFycmF5LmZyb20obmV3IFVpbnQ4QXJyYXkoaGFzaEJ1ZmZlcikpOw0KICAgIHJldHVybiBoYXNoQXJyYXkubWFwKChiKSA9PiBiLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCAiMCIpKS5qb2luKCIiKTsNCiAgfQ0KDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICAvLyBJTVBPU1RBWklPTkkgKEZpcmViYXNlKQ0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgYXN5bmMgZnVuY3Rpb24gbG9hZFNldHRpbmdzRnJvbUZpcmViYXNlKCkgew0KICAgIHRyeSB7DQogICAgICBjb25zdCBzbmFwc2hvdCA9IGF3YWl0IGRhdGFiYXNlLnJlZigic2V0dGluZ3MiKS5vbmNlKCJ2YWx1ZSIpOw0KICAgICAgcmV0dXJuIHNuYXBzaG90LmV4aXN0cygpID8gc25hcHNob3QudmFsKCkgOiBudWxsOw0KICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICBjb25zb2xlLmVycm9yKA0KICAgICAgICAiRXJyb3JlIG5lbCBjYXJpY2FtZW50byBkZWxsZSBpbXBvc3RhemlvbmkgZGEgRmlyZWJhc2U6IiwNCiAgICAgICAgZXJyb3INCiAgICAgICk7DQogICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBhcHBseUZpcmViYXNlU2V0dGluZ3Moc2V0dGluZ3MpIHsNCiAgICBpZiAoc2V0dGluZ3M/LnNlY3JldF9jb2RlKSB7DQogICAgICBDT1JSRUNUX0NPREUgPSBzZXR0aW5ncy5zZWNyZXRfY29kZTsNCiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJzZWNyZXRfY29kZSIsIHNldHRpbmdzLnNlY3JldF9jb2RlKTsNCiAgICB9DQogICAgaWYgKHNldHRpbmdzPy5tYXhfY2xpY2tzKSB7DQogICAgICBNQVhfQ0xJQ0tTID0gcGFyc2VJbnQoc2V0dGluZ3MubWF4X2NsaWNrcywgMTApOw0KICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oIm1heF9jbGlja3MiLCBzZXR0aW5ncy5tYXhfY2xpY2tzKTsNCiAgICB9DQogICAgaWYgKHNldHRpbmdzPy50aW1lX2xpbWl0X21pbnV0ZXMpIHsNCiAgICAgIFRJTUVfTElNSVRfTUlOVVRFUyA9IHBhcnNlSW50KHNldHRpbmdzLnRpbWVfbGltaXRfbWludXRlcywgMTApOw0KICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oInRpbWVfbGltaXRfbWludXRlcyIsIHNldHRpbmdzLnRpbWVfbGltaXRfbWludXRlcyk7DQogICAgfQ0KICAgIGlmICh0eXBlb2Ygc2V0dGluZ3M/LmNoZWNraW5fc3RhcnRfdGltZSA9PT0gInN0cmluZyIpDQogICAgICBDSEVDS0lOX1NUQVJUX1RJTUUgPSBzZXR0aW5ncy5jaGVja2luX3N0YXJ0X3RpbWU7DQogICAgaWYgKHR5cGVvZiBzZXR0aW5ncz8uY2hlY2tpbl9lbmRfdGltZSA9PT0gInN0cmluZyIpDQogICAgICBDSEVDS0lOX0VORF9USU1FID0gc2V0dGluZ3MuY2hlY2tpbl9lbmRfdGltZTsNCiAgICBpZiAodHlwZW9mIHNldHRpbmdzPy5jaGVja2luX3RpbWVfZW5hYmxlZCAhPT0gInVuZGVmaW5lZCIpDQogICAgICBDSEVDS0lOX1RJTUVfRU5BQkxFRCA9IFN0cmluZyhzZXR0aW5ncy5jaGVja2luX3RpbWVfZW5hYmxlZCkgIT09ICJmYWxzZSI7DQoNCiAgICB1cGRhdGVDaGVja2luVGltZURpc3BsYXkoKTsNCiAgICBERVZJQ0VTLmZvckVhY2godXBkYXRlQnV0dG9uU3RhdGUpOw0KICAgIHVwZGF0ZVN0YXR1c0JhcigpOw0KICB9DQoNCiAgZnVuY3Rpb24gc2V0dXBTZXR0aW5nc0xpc3RlbmVyKCkgew0KICAgIGlmIChzZXR0aW5nc1JlZikgcmV0dXJuOyAvLyBldml0YSBkb3BwaW8gbGlzdGVuZXINCiAgICBzZXR0aW5nc1JlZiA9IGRhdGFiYXNlLnJlZigic2V0dGluZ3MiKTsNCiAgICBzZXR0aW5nc1JlZi5vbigidmFsdWUiLCAoc25hcCkgPT4gew0KICAgICAgY29uc3QgcyA9IHNuYXAudmFsKCkgfHwge307CiAgICAgIGFwcGx5RmlyZWJhc2VTZXR0aW5ncyhzKTsKDQogICAgICAvLyBLaWxsLXN3aXRjaDogY2FtYmlvIGNvZGljZSBnbG9iYWxlID0+IGJsb2NjYSBlIGZvcnphIGxvZ291dA0KICAgICAgY29uc3Qgc2VydmVyQ29kZVZlciA9IHBhcnNlSW50KHMuY29kZV92ZXJzaW9uIHx8IDEsIDEwKTsKICAgICAgY29uc3QgbG9jYWxDb2RlVmVyID0gcGFyc2VJbnQoCiAgICAgICAgbG9jYWxTdG9yYWdlLmdldEl0ZW0oQ09ERV9WRVJTSU9OX0tFWSkgfHwgIjEiLAogICAgICAgIDEwCiAgICAgICk7CiAgICAgIGlmIChzZXJ2ZXJDb2RlVmVyID4gbG9jYWxDb2RlVmVyKSB7CiAgICAgICAgLy8gRGV0ZXJtaW5hIHNlIHF1ZXN0byBkaXNwb3NpdGl2byBoYSBnacODwqAgdmlzdG8gdW5hIHZlcnNpb25lIHByZWNlZGVudGUKICAgICAgICBjb25zdCBoYWRMb2NhbFZlcnNpb24gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShDT0RFX1ZFUlNJT05fS0VZKSAhPT0gbnVsbDsKICAgICAgICAvLyBBZ2dpb3JuYSB2ZXJzaW9uZSBsb2NhbGUKICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShDT0RFX1ZFUlNJT05fS0VZLCBTdHJpbmcoc2VydmVyQ29kZVZlcikpOwogICAgICAgIGNvbnN0IG1zZyA9IHMuZ2xvYmFsX2Jsb2NrX21lc3NhZ2UgfHwgIkNvZGljZSBhZ2dpb3JuYXRvOiBpbCBsaW5rIG5vbiBlJyBwaXUnIHZhbGlkbyI7CiAgICAgICAgLy8gVmVjY2hpIGRpc3Bvc2l0aXZpOiBibG9jY28gZ2xvYmFsZSAobWFpbiBwYWdlKSBjb24gb3ZlcmxheSBwZXJzaXN0ZW50ZQogICAgICAgIGlmIChoYWRMb2NhbFZlcnNpb24pIHsKICAgICAgICAgIGJsb2NrQWNjZXNzKG1zZyk7CiAgICAgICAgICBzaG93U2Vzc2lvbkV4cGlyZWQoKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgLy8gVG9rZW4gYXBlcnRvOiBsb2dvdXQgZGFsIHRva2VuCiAgICAgICAgaWYgKGhhc1Rva2VuRm9vdHByaW50KCkpIHsKICAgICAgICAgIGZvcmNlTG9nb3V0RnJvbVRva2VuKG1zZyk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8vIE51b3ZvIGRpc3Bvc2l0aXZvOiBuaWVudGUgYmxvY2NvLCB0b3JuYSBhbCBsb2dpbgogICAgICAgIHVuYmxvY2tBY2Nlc3MoKTsKICAgICAgICBxcygiZXhwaXJlZE92ZXJsYXkiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7CiAgICAgICAgcXMoInNlc3Npb25FeHBpcmVkIik/LmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOwogICAgICAgIHFzKCJjb250cm9sUGFuZWwiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7CiAgICAgICAgcmVzZXRTZXNzaW9uRm9yTmV3Q29kZSgpOwogICAgICAgIHJldHVybjsKICAgICAgfQoNCiAgICAgIC8vIFJpcHJpc3Rpbm8gZ2xvYmFsZTogc2Jsb2NjYSBlIHRvcm5hIGFsIGxvZ2luDQogICAgICBjb25zdCBzZXJ2ZXJVbmJsb2NrVmVyID0gcGFyc2VJbnQocy5zZXNzaW9uX3Jlc2V0X3ZlcnNpb24gfHwgMCwgMTApOw0KICAgICAgY29uc3QgbG9jYWxVbmJsb2NrVmVyID0gcGFyc2VJbnQoDQogICAgICAgIGxvY2FsU3RvcmFnZS5nZXRJdGVtKFVOQkxPQ0tfVkVSU0lPTl9LRVkpIHx8ICIwIiwNCiAgICAgICAgMTANCiAgICAgICk7DQogICAgICBpZiAoc2VydmVyVW5ibG9ja1ZlciA+IGxvY2FsVW5ibG9ja1Zlcikgew0KICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShVTkJMT0NLX1ZFUlNJT05fS0VZLCBTdHJpbmcoc2VydmVyVW5ibG9ja1ZlcikpOw0KICAgICAgICB1bmJsb2NrQWNjZXNzKCk7DQogICAgICAgIHFzKCJleHBpcmVkT3ZlcmxheSIpPy5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsNCiAgICAgICAgcXMoInNlc3Npb25FeHBpcmVkIik/LmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOw0KICAgICAgICBxcygiY29udHJvbFBhbmVsIik/LmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOw0KICAgICAgICBzaG93QXV0aEZvcm0oKTsNCiAgICAgICAgdXBkYXRlRG9vclZpc2liaWxpdHkoKTsNCiAgICAgICAgc2hvd05vdGlmaWNhdGlvbigNCiAgICAgICAgICBzLmdsb2JhbF91bmJsb2NrX21lc3NhZ2UgfHwKICAgICAgICAgICAgIlNlc3Npb25lIHJpcHJpc3RpbmF0YS4gSW5zZXJpc2NpIGlsIGNvZGljZSBwZXIgYWNjZWRlcmUuIgogICAgICAgICk7DQogICAgICB9DQogICAgfSk7DQogIH0NCg0KICBmdW5jdGlvbiBtb25pdG9yRmlyZWJhc2VDb25uZWN0aW9uKCkgew0KICAgIGNvbnN0IGNvbm5lY3RlZFJlZiA9IGRhdGFiYXNlLnJlZigiLmluZm8vY29ubmVjdGVkIik7DQogICAgY29ubmVjdGVkUmVmLm9uKCJ2YWx1ZSIsIChzbmFwKSA9PiB7DQogICAgICBpZiAoc25hcC52YWwoKSA9PT0gdHJ1ZSkgew0KICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoImZpcmViYXNlLW9mZmxpbmUiKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgiZmlyZWJhc2Utb2ZmbGluZSIpOw0KICAgICAgICBzaG93Tm90aWZpY2F0aW9uKA0KICAgICAgICAgICJDb25uZXNzaW9uZSBhIEZpcmViYXNlIHBlcnNhLiBMZSBtb2RpZmljaGUgcG90cmViYmVybyBub24gZXNzZXJlIHNpbmNyb25penphdGUuIiwNCiAgICAgICAgICAid2FybmluZyINCiAgICAgICAgKTsNCiAgICAgIH0NCiAgICB9KTsNCiAgfQ0KDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogIC8vIFRFTVBPL1NFU1NJT05FCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgYXN5bmMgZnVuY3Rpb24gc2V0VXNhZ2VTdGFydFRpbWUoKSB7CiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpLnRvU3RyaW5nKCk7DQogICAgY29uc3QgaGFzaCA9IGF3YWl0IGdlbmVyYXRlSGFzaChub3cgKyBTRUNSRVRfS0VZKTsNCiAgICBzZXRTdG9yYWdlKCJ1c2FnZV9zdGFydF90aW1lIiwgbm93LCBUSU1FX0xJTUlUX01JTlVURVMpOw0KICAgIHNldFN0b3JhZ2UoInVzYWdlX2hhc2giLCBoYXNoLCBUSU1FX0xJTUlUX01JTlVURVMpOw0KICAgIHVwZGF0ZVN0YXR1c0JhcigpOw0KICB9CgogIGFzeW5jIGZ1bmN0aW9uIHNldExvZ2luU3RhcnRUaW1lKCkgewogICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKS50b1N0cmluZygpOwogICAgY29uc3QgaGFzaCA9IGF3YWl0IGdlbmVyYXRlSGFzaChub3cgKyBTRUNSRVRfS0VZKTsKICAgIHNldFN0b3JhZ2UoImxvZ2luX3N0YXJ0X3RpbWUiLCBub3csIFBSRV9VU0VfTElNSVRfTUlOVVRFUyk7CiAgICBzZXRTdG9yYWdlKCJsb2dpbl9oYXNoIiwgaGFzaCwgUFJFX1VTRV9MSU1JVF9NSU5VVEVTKTsKICAgIHVwZGF0ZVN0YXR1c0JhcigpOwogIH0KCiAgYXN5bmMgZnVuY3Rpb24gc2V0VG9rZW5Vc2FnZVN0YXJ0VGltZSh0b2tlbklkKSB7CiAgICBpZiAoIXRva2VuSWQpIHJldHVybjsKICAgIGNvbnN0IGtleVQgPSBgdG9rZW5fdHNfJHt0b2tlbklkfWA7CiAgICBjb25zdCBrZXlIID0gYHRva2VuX3RoXyR7dG9rZW5JZH1gOwogICAgdHJ5IHsKICAgICAgaWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleVQpKSByZXR1cm47IC8vIG5vbiBzb3ZyYXNjcml2ZXJlIHNlIGdpw4PCoCBhdnZpYXRvCiAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCkudG9TdHJpbmcoKTsKICAgICAgY29uc3QgaGFzaCA9IGF3YWl0IGdlbmVyYXRlSGFzaChub3cgKyBTRUNSRVRfS0VZICsgdG9rZW5JZCk7CiAgICAgIHNldFN0b3JhZ2Uoa2V5VCwgbm93LCBUT0tFTl9MSU1JVF9NSU5VVEVTKTsKICAgICAgc2V0U3RvcmFnZShrZXlILCBoYXNoLCBUT0tFTl9MSU1JVF9NSU5VVEVTKTsKICAgIH0gY2F0Y2gge30KICB9CgogIGZ1bmN0aW9uIGNsZWFyVG9rZW5Vc2FnZVN0YXJ0KHRva2VuSWQpIHsKICAgIGlmICghdG9rZW5JZCkgcmV0dXJuOwogICAgdHJ5IHsKICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oYHRva2VuX3RzXyR7dG9rZW5JZH1gKTsKICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oYHRva2VuX3RoXyR7dG9rZW5JZH1gKTsKICAgIH0gY2F0Y2gge30KICB9CgogIGFzeW5jIGZ1bmN0aW9uIGNoZWNrVGltZUxpbWl0KCkgewogICAgLy8gVGltZXIgYW5jaGUgcGVyIHNlc3Npb25pIHRva2VuIGRvcG8gc3VibWl0CiAgICBpZiAoaXNUb2tlblNlc3Npb24pIHsKICAgICAgY29uc3QgdCA9CiAgICAgICAgY3VycmVudFRva2VuSWQgfHwgbmV3IFVSTFNlYXJjaFBhcmFtcyhsb2NhdGlvbi5zZWFyY2gpLmdldCgidG9rZW4iKTsKICAgICAgaWYgKCF0KSByZXR1cm4gZmFsc2U7CiAgICAgIGNvbnN0IGtleVQgPSBgdG9rZW5fdHNfJHt0fWA7CiAgICAgIGNvbnN0IGtleUggPSBgdG9rZW5fdGhfJHt0fWA7CiAgICAgIGNvbnN0IHRzID0gZ2V0U3RvcmFnZShrZXlUKTsKICAgICAgY29uc3QgaHMgPSBnZXRTdG9yYWdlKGtleUgpOwogICAgICBpZiAodHMgJiYgaHMpIHsKICAgICAgICBjb25zdCBjYWxjID0gYXdhaXQgZ2VuZXJhdGVIYXNoKHRzICsgU0VDUkVUX0tFWSArIHQpOwogICAgICAgIGlmIChjYWxjICE9PSBocykgewogICAgICAgICAgLy8gaGFzaCBtaXNtYXRjaCA9PiBjb25zaWRlcmEgc2NhZHV0YQogICAgICAgICAgY2xlYXJUb2tlblVzYWdlU3RhcnQodCk7CiAgICAgICAgICB0cnkgeyBmb3JjZUxvZ291dEZyb21Ub2tlbigiU2Vzc2lvbmUgdG9rZW4gbm9uIHZhbGlkYSIpOyB9IGNhdGNoIHt9CiAgICAgICAgICAvLyBOYXNjb25kaSBwYW5uZWxsbyBlIG1vc3RyYSBvdmVybGF5CiAgICAgICAgICBxcygiY29udHJvbFBhbmVsIik/LmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOwogICAgICAgICAgcXMoImV4cGlyZWRPdmVybGF5Iik/LmNsYXNzTGlzdC5yZW1vdmUoImhpZGRlbiIpOwogICAgICAgICAgcXMoInNlc3Npb25FeHBpcmVkIik/LmNsYXNzTGlzdC5yZW1vdmUoImhpZGRlbiIpOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IG1pbnMgPSAoRGF0ZS5ub3coKSAtIHBhcnNlSW50KHRzLCAxMCkpIC8gKDEwMDAgKiA2MCk7CiAgICAgICAgaWYgKG1pbnMgPj0gVE9LRU5fTElNSVRfTUlOVVRFUykgewogICAgICAgICAgY2xlYXJUb2tlblVzYWdlU3RhcnQodCk7CiAgICAgICAgICB0cnkgeyBmb3JjZUxvZ291dEZyb21Ub2tlbigiU2Vzc2lvbmUgdG9rZW4gc2NhZHV0YSIpOyB9IGNhdGNoIHt9CiAgICAgICAgICBxcygiY29udHJvbFBhbmVsIik/LmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOwogICAgICAgICAgcXMoImV4cGlyZWRPdmVybGF5Iik/LmNsYXNzTGlzdC5yZW1vdmUoImhpZGRlbiIpOwogICAgICAgICAgcXMoInNlc3Npb25FeHBpcmVkIik/LmNsYXNzTGlzdC5yZW1vdmUoImhpZGRlbiIpOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBpZiAoIXNlc3Npb25TdGFydFRpbWUpIHJldHVybiBmYWxzZTsKDQogICAgY29uc3Qgc3RhcnRUaW1lID0gZ2V0U3RvcmFnZSgidXNhZ2Vfc3RhcnRfdGltZSIpOw0KICAgIGNvbnN0IHN0b3JlZEhhc2ggPSBnZXRTdG9yYWdlKCJ1c2FnZV9oYXNoIik7DQogICAgaWYgKCFzdGFydFRpbWUgfHwgIXN0b3JlZEhhc2gpIHJldHVybiBmYWxzZTsNCg0KICAgIGNvbnN0IGNhbGNIYXNoID0gYXdhaXQgZ2VuZXJhdGVIYXNoKHN0YXJ0VGltZSArIFNFQ1JFVF9LRVkpOw0KICAgIGlmIChjYWxjSGFzaCAhPT0gc3RvcmVkSGFzaCkgew0KICAgICAgc2hvd0ZhdGFsRXJyb3IoIsOixaHCoMOvwrjCjyBWaW9sYXppb25lIGRpIHNpY3VyZXp6YSByaWxldmF0YSEiKTsNCiAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7DQogICAgY29uc3QgbWludXRlc1Bhc3NlZCA9IChub3cgLSBwYXJzZUludChzdGFydFRpbWUsIDEwKSkgLyAoMTAwMCAqIDYwKTsNCiAgICBpZiAobWludXRlc1Bhc3NlZCA+PSBUSU1FX0xJTUlUX01JTlVURVMpIHsNCiAgICAgIHNob3dTZXNzaW9uRXhwaXJlZCgpOw0KICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgdXBkYXRlU3RhdHVzQmFyKCk7DQogICAgcmV0dXJuIGZhbHNlOw0KICB9DQoNCiAgZnVuY3Rpb24gc2hvd0ZhdGFsRXJyb3IobWVzc2FnZSkgew0KICAgIGlmICh0aW1lQ2hlY2tJbnRlcnZhbCkgY2xlYXJJbnRlcnZhbCh0aW1lQ2hlY2tJbnRlcnZhbCk7DQogICAgaWYgKGNvZGVDaGVja0ludGVydmFsKSBjbGVhckludGVydmFsKGNvZGVDaGVja0ludGVydmFsKTsNCiAgICBkb2N1bWVudC5ib2R5LmlubmVySFRNTCA9IGANCiAgICAgIDxkaXYgc3R5bGU9InBvc2l0aW9uOmZpeGVkO2luc2V0OjA7ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpjZW50ZXI7YWxpZ24taXRlbXM6Y2VudGVyO2JhY2tncm91bmQ6IzEyMTExMTtjb2xvcjojZmY2YjZiO2ZvbnQtc2l6ZToyNHB4O3RleHQtYWxpZ246Y2VudGVyO3BhZGRpbmc6MjBweDt6LWluZGV4Ojk5OTk7Ij4NCiAgICAgICAgJHttZXNzYWdlfQ0KICAgICAgPC9kaXY+YDsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNob3dTZXNzaW9uRXhwaXJlZCgpIHsNCiAgICBpZiAoaXNUb2tlblNlc3Npb24pIHJldHVybjsgLy8gb3ZlcmxheSBzb2xvIHBlciBzZXNzaW9uaSBtYW51YWxpDQogICAgaWYgKHRpbWVDaGVja0ludGVydmFsKSBjbGVhckludGVydmFsKHRpbWVDaGVja0ludGVydmFsKTsNCiAgICBpZiAoY29kZUNoZWNrSW50ZXJ2YWwpIGNsZWFySW50ZXJ2YWwoY29kZUNoZWNrSW50ZXJ2YWwpOw0KDQogICAgcXMoImV4cGlyZWRPdmVybGF5Iik/LmNsYXNzTGlzdC5yZW1vdmUoImhpZGRlbiIpOw0KICAgIHFzKCJjb250cm9sUGFuZWwiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7DQogICAgcXMoInNlc3Npb25FeHBpcmVkIik/LmNsYXNzTGlzdC5yZW1vdmUoImhpZGRlbiIpOw0KICAgIHFzKCJ0ZXN0MiIpICYmIChxcygidGVzdDIiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiKTsNCg0KICAgIERFVklDRVMuZm9yRWFjaCgoZGV2aWNlKSA9PiB7DQogICAgICBjb25zdCBidG4gPSBxcyhkZXZpY2UuYnV0dG9uX2lkKTsNCiAgICAgIGlmIChidG4pIHsNCiAgICAgICAgYnRuLmRpc2FibGVkID0gdHJ1ZTsNCiAgICAgICAgYnRuLmNsYXNzTGlzdC5hZGQoImJ0bi1lcnJvciIpOw0KICAgICAgfQ0KICAgIH0pOw0KDQogICAgY29uc3Qgc2VjdXJpdHlTdGF0dXMgPSBxcygic2VjdXJpdHlTdGF0dXMiKTsNCiAgICBpZiAoc2VjdXJpdHlTdGF0dXMpIHsNCiAgICAgIHNlY3VyaXR5U3RhdHVzLnRleHRDb250ZW50ID0gIlNjYWR1dGEiOwogICAgICBzZWN1cml0eVN0YXR1cy5zdHlsZS5jb2xvciA9ICJ2YXIoLS1lcnJvcikiOw0KICAgIH0NCg0KICAgIHNlc3Npb25TdGFydFRpbWUgPSBudWxsOw0KICB9DQoNCiAgZnVuY3Rpb24gaXNTZXNzaW9uU3R1Y2soKSB7DQogICAgdHJ5IHsNCiAgICAgIGNvbnN0IGF1dGhWZXJpZmllZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJhdXRoX3ZlcmlmaWVkIik7DQogICAgICBjb25zdCBhdXRoVGltZXN0YW1wID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oImF1dGhfdGltZXN0YW1wIik7DQogICAgICBjb25zdCB1c2FnZVN0YXJ0VGltZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJ1c2FnZV9zdGFydF90aW1lIik7DQoNCiAgICAgIGlmIChhdXRoVmVyaWZpZWQgPT09ICJ0cnVlIiAmJiBhdXRoVGltZXN0YW1wKSB7DQogICAgICAgIGNvbnN0IGF1dGhUaW1lID0gcGFyc2VJbnQoYXV0aFRpbWVzdGFtcCwgMTApOw0KICAgICAgICBpZiAoRGF0ZS5ub3coKSAtIGF1dGhUaW1lID4gMjQgKiA2MCAqIDYwICogMTAwMCkgcmV0dXJuIHRydWU7DQogICAgICB9DQogICAgICBpZiAodXNhZ2VTdGFydFRpbWUpIHsNCiAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcGFyc2VJbnQodXNhZ2VTdGFydFRpbWUsIDEwKTsNCiAgICAgICAgY29uc3QgbWludXRlc1Bhc3NlZCA9IChEYXRlLm5vdygpIC0gc3RhcnRUaW1lKSAvICgxMDAwICogNjApOw0KICAgICAgICBpZiAobWludXRlc1Bhc3NlZCA+IFRJTUVfTElNSVRfTUlOVVRFUyArIDYwKSByZXR1cm4gdHJ1ZTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9IGNhdGNoIChlKSB7DQogICAgICBjb25zb2xlLmVycm9yKCJFcnJvcmUgbmVsIGNvbnRyb2xsbyBzZXNzaW9uZSBibG9jY2F0YToiLCBlKTsNCiAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogIH0NCg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgLy8gQ0hFQ0vDouKCrOKAmElOIFRJTUUNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIGZ1bmN0aW9uIGlzQ2hlY2tpblRpbWUoKSB7DQogICAgaWYgKCFDSEVDS0lOX1RJTUVfRU5BQkxFRCkgcmV0dXJuIHRydWU7DQoNCiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpOw0KICAgIGNvbnN0IGN1cnJlbnQgPSBub3cuZ2V0SG91cnMoKSAqIDYwICsgbm93LmdldE1pbnV0ZXMoKTsNCiAgICBjb25zdCBbc2gsIHNtXSA9IENIRUNLSU5fU1RBUlRfVElNRS5zcGxpdCgiOiIpLm1hcChOdW1iZXIpOw0KICAgIGNvbnN0IFtlaCwgZW1dID0gQ0hFQ0tJTl9FTkRfVElNRS5zcGxpdCgiOiIpLm1hcChOdW1iZXIpOw0KICAgIGNvbnN0IHN0YXJ0ID0gc2ggKiA2MCArIHNtOw0KICAgIGNvbnN0IGVuZCA9IGVoICogNjAgKyBlbTsNCiAgICByZXR1cm4gY3VycmVudCA+PSBzdGFydCAmJiBjdXJyZW50IDw9IGVuZDsNCiAgfQ0KDQogIGZ1bmN0aW9uIHVwZGF0ZUNoZWNraW5UaW1lRGlzcGxheSgpIHsNCiAgICBjb25zdCBzdGFydEVsID0gcXMoImNoZWNraW5TdGFydERpc3BsYXkiKTsNCiAgICBjb25zdCBlbmRFbCA9IHFzKCJjaGVja2luRW5kRGlzcGxheSIpOw0KICAgIGNvbnN0IHN0YXJ0UG9wdXAgPSBxcygiY2hlY2tpblN0YXJ0UG9wdXAiKTsNCiAgICBjb25zdCBlbmRQb3B1cCA9IHFzKCJjaGVja2luRW5kUG9wdXAiKTsNCiAgICBjb25zdCBjdXJyZW50U3RhcnQgPSBxcygiY3VycmVudENoZWNraW5TdGFydFRpbWUiKTsNCiAgICBjb25zdCBjdXJyZW50RW5kID0gcXMoImN1cnJlbnRDaGVja2luRW5kVGltZSIpOw0KICAgIGlmIChzdGFydEVsKSBzdGFydEVsLnRleHRDb250ZW50ID0gZm9ybWF0VGltZShDSEVDS0lOX1NUQVJUX1RJTUUpOw0KICAgIGlmIChlbmRFbCkgZW5kRWwudGV4dENvbnRlbnQgPSBmb3JtYXRUaW1lKENIRUNLSU5fRU5EX1RJTUUpOw0KICAgIGlmIChzdGFydFBvcHVwKSBzdGFydFBvcHVwLnRleHRDb250ZW50ID0gZm9ybWF0VGltZShDSEVDS0lOX1NUQVJUX1RJTUUpOw0KICAgIGlmIChlbmRQb3B1cCkgZW5kUG9wdXAudGV4dENvbnRlbnQgPSBmb3JtYXRUaW1lKENIRUNLSU5fRU5EX1RJTUUpOw0KICAgIGlmIChjdXJyZW50U3RhcnQpIGN1cnJlbnRTdGFydC50ZXh0Q29udGVudCA9IGZvcm1hdFRpbWUoQ0hFQ0tJTl9TVEFSVF9USU1FKTsNCiAgICBpZiAoY3VycmVudEVuZCkgY3VycmVudEVuZC50ZXh0Q29udGVudCA9IGZvcm1hdFRpbWUoQ0hFQ0tJTl9FTkRfVElNRSk7DQoNCiAgICBjb25zdCBzdGF0dXNFbGVtZW50ID0gcXMoImN1cnJlbnRUaW1lU3RhdHVzIik7DQogICAgaWYgKCFzdGF0dXNFbGVtZW50KSByZXR1cm47DQoNCiAgICBpZiAoIUNIRUNLSU5fVElNRV9FTkFCTEVEKSB7DQogICAgICBzdGF0dXNFbGVtZW50LmlubmVySFRNTCA9DQogICAgICAgICc8aSBjbGFzcz0iZmFzIGZhLXBvd2VyLW9mZiIgc3R5bGU9ImNvbG9yOm9yYW5nZTsiPjwvaT4gVGltZSBjb250cm9sIGRpc2FibGVkIMOi4oKs4oCdIGNoZWNrLWluIGFsbG93ZWQgYXQgYW55IHRpbWUnOw0KICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIGlmIChpc0NoZWNraW5UaW1lKCkpIHsNCiAgICAgIHN0YXR1c0VsZW1lbnQuaW5uZXJIVE1MID0NCiAgICAgICAgJzxpIGNsYXNzPSJmYXMgZmEtY2hlY2stY2lyY2xlIiBzdHlsZT0iY29sb3I6Z3JlZW47Ij48L2k+IENoZWNrLWluIG5vdyBhdmFpbGFibGUnOw0KICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7DQogICAgY29uc3QgY3VycmVudCA9IG5vdy5nZXRIb3VycygpICogNjAgKyBub3cuZ2V0TWludXRlcygpOw0KICAgIGNvbnN0IFtzaCwgc21dID0gQ0hFQ0tJTl9TVEFSVF9USU1FLnNwbGl0KCI6IikubWFwKE51bWJlcik7DQogICAgY29uc3QgW2VoLCBlbV0gPSBDSEVDS0lOX0VORF9USU1FLnNwbGl0KCI6IikubWFwKE51bWJlcik7DQogICAgY29uc3Qgc3RhcnQgPSBzaCAqIDYwICsgc207DQogICAgY29uc3QgZW5kID0gZWggKiA2MCArIGVtOw0KDQogICAgaWYgKGN1cnJlbnQgPCBzdGFydCkgew0KICAgICAgY29uc3QgZGlmZiA9IHN0YXJ0IC0gY3VycmVudDsNCiAgICAgIGNvbnN0IGggPSBNYXRoLmZsb29yKGRpZmYgLyA2MCk7DQogICAgICBjb25zdCBtID0gZGlmZiAlIDYwOw0KICAgICAgc3RhdHVzRWxlbWVudC5pbm5lckhUTUwgPSBgPGkgY2xhc3M9ImZhcyBmYS1jbG9jayIgc3R5bGU9ImNvbG9yOm9yYW5nZTsiPjwvaT4gQ2hlY2staW4gd2lsbCBiZSBhdmFpbGFibGUgaW4gJHtofWggJHttfW1gOw0KICAgIH0gZWxzZSB7DQogICAgICBjb25zdCB0b21vcnJvdyA9IG5ldyBEYXRlKG5vdyk7DQogICAgICB0b21vcnJvdy5zZXREYXRlKHRvbW9ycm93LmdldERhdGUoKSArIDEpOw0KICAgICAgdG9tb3Jyb3cuc2V0SG91cnMoc2gsIHNtLCAwLCAwKTsNCiAgICAgIGNvbnN0IGRpZmYgPSB0b21vcnJvdyAtIG5vdzsNCiAgICAgIGNvbnN0IGggPSBNYXRoLmZsb29yKGRpZmYgLyAoMTAwMCAqIDYwICogNjApKTsNCiAgICAgIGNvbnN0IG0gPSBNYXRoLmZsb29yKChkaWZmICUgKDEwMDAgKiA2MCAqIDYwKSkgLyAoMTAwMCAqIDYwKSk7DQogICAgICBzdGF0dXNFbGVtZW50LmlubmVySFRNTCA9IGA8aSBjbGFzcz0iZmFzIGZhLWNsb2NrIiBzdHlsZT0iY29sb3I6b3JhbmdlOyI+PC9pPiBDaGVjay1pbiB3aWxsIGJlIGF2YWlsYWJsZSB0b21vcnJvdyBpbiAke2h9aCAke219bWA7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gc2hvd0Vhcmx5Q2hlY2tpblBvcHVwKCkgew0KICAgIGNvbnN0IGVsID0gcXMoImVhcmx5Q2hlY2tpblBvcHVwIik7DQogICAgaWYgKGVsKSBlbC5zdHlsZS5kaXNwbGF5ID0gImZsZXgiOw0KICB9DQogIGZ1bmN0aW9uIGNsb3NlRWFybHlDaGVja2luUG9wdXAoKSB7DQogICAgY29uc3QgZWwgPSBxcygiZWFybHlDaGVja2luUG9wdXAiKTsNCiAgICBpZiAoZWwpIGVsLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogIH0NCg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgLy8gSU5URVJGQUNDSUEvU1RBVE8NCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIGZ1bmN0aW9uIHVwZGF0ZVN0YXR1c0JhcigpIHsNCiAgICBjb25zdCBtYWluRG9vckNvdW50ZXIgPSBxcygibWFpbkRvb3JDb3VudGVyIik7DQogICAgY29uc3QgYXB0RG9vckNvdW50ZXIgPSBxcygiYXB0RG9vckNvdW50ZXIiKTsNCiAgICBjb25zdCB0aW1lUmVtYWluaW5nID0gcXMoInRpbWVSZW1haW5pbmciKTsNCg0KICAgIGlmIChtYWluRG9vckNvdW50ZXIpIHsNCiAgICAgIG1haW5Eb29yQ291bnRlci50ZXh0Q29udGVudCA9IGAke2dldENsaWNrc0xlZnQoDQogICAgICAgIERFVklDRVNbMF0uc3RvcmFnZV9rZXkNCiAgICAgICl9IGNsaWNrIGxlZnRgOw0KICAgIH0NCiAgICBpZiAoYXB0RG9vckNvdW50ZXIpIHsNCiAgICAgIGFwdERvb3JDb3VudGVyLnRleHRDb250ZW50ID0gYCR7Z2V0Q2xpY2tzTGVmdCgNCiAgICAgICAgREVWSUNFU1sxXS5zdG9yYWdlX2tleQ0KICAgICAgKX0gY2xpY2sgbGVmdGA7DQogICAgfQ0KDQogICAgaWYgKCFzZXNzaW9uU3RhcnRUaW1lIHx8ICF0aW1lUmVtYWluaW5nKSB7DQogICAgICBpZiAodGltZVJlbWFpbmluZykgew0KICAgICAgICBjb25zdCBtaW51dGVzID0gTWF0aC5mbG9vcihUSU1FX0xJTUlUX01JTlVURVMpOw0KICAgICAgICBjb25zdCBzZWNvbmRzID0gTWF0aC5mbG9vcigoVElNRV9MSU1JVF9NSU5VVEVTICUgMSkgKiA2MCk7DQogICAgICAgIHRpbWVSZW1haW5pbmcudGV4dENvbnRlbnQgPSBgJHtTdHJpbmcobWludXRlcykucGFkU3RhcnQoDQogICAgICAgICAgMiwNCiAgICAgICAgICAiMCINCiAgICAgICAgKX06JHtTdHJpbmcoc2Vjb25kcykucGFkU3RhcnQoMiwgIjAiKX1gOw0KICAgICAgICB0aW1lUmVtYWluaW5nLnN0eWxlLmNvbG9yID0gInZhcigtLXByaW1hcnkpIjsNCiAgICAgIH0NCiAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICBjb25zdCBzdGFydFRpbWUgPSBnZXRTdG9yYWdlKCJ1c2FnZV9zdGFydF90aW1lIik7DQogICAgaWYgKCFzdGFydFRpbWUpIHJldHVybjsNCg0KICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7DQogICAgY29uc3QgbWludXRlc1Bhc3NlZCA9IChub3cgLSBwYXJzZUludChzdGFydFRpbWUsIDEwKSkgLyAoMTAwMCAqIDYwKTsNCiAgICBjb25zdCBtaW51dGVzTGVmdCA9IE1hdGgubWF4KA0KICAgICAgMCwNCiAgICAgIE1hdGguZmxvb3IoVElNRV9MSU1JVF9NSU5VVEVTIC0gbWludXRlc1Bhc3NlZCkNCiAgICApOw0KICAgIGNvbnN0IHNlY29uZHNMZWZ0ID0gTWF0aC5tYXgoMCwgTWF0aC5mbG9vcig2MCAtIChtaW51dGVzUGFzc2VkICUgMSkgKiA2MCkpOw0KDQogICAgdGltZVJlbWFpbmluZy50ZXh0Q29udGVudCA9IGAke1N0cmluZyhtaW51dGVzTGVmdCkucGFkU3RhcnQoDQogICAgICAyLA0KICAgICAgIjAiDQogICAgKX06JHtTdHJpbmcoc2Vjb25kc0xlZnQpLnBhZFN0YXJ0KDIsICIwIil9YDsNCiAgICBpZiAobWludXRlc0xlZnQgPCAxKSB0aW1lUmVtYWluaW5nLnN0eWxlLmNvbG9yID0gInZhcigtLWVycm9yKSI7DQogICAgZWxzZSBpZiAobWludXRlc0xlZnQgPCA1KSB0aW1lUmVtYWluaW5nLnN0eWxlLmNvbG9yID0gInZhcigtLXdhcm5pbmcpIjsNCiAgICBlbHNlIHRpbWVSZW1haW5pbmcuc3R5bGUuY29sb3IgPSAidmFyKC0tcHJpbWFyeSkiOw0KICB9DQoNCiAgZnVuY3Rpb24gZ2V0Q2xpY2tzTGVmdChrZXkpIHsNCiAgICBjb25zdCBzdG9yZWQgPSBnZXRTdG9yYWdlKGtleSk7DQogICAgcmV0dXJuIHN0b3JlZCA9PT0gbnVsbCA/IE1BWF9DTElDS1MgOiBwYXJzZUludChzdG9yZWQsIDEwKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNldENsaWNrc0xlZnQoa2V5LCBjb3VudCkgew0KICAgIHNldFN0b3JhZ2Uoa2V5LCBTdHJpbmcoY291bnQpLCBUSU1FX0xJTUlUX01JTlVURVMpOw0KICAgIHVwZGF0ZVN0YXR1c0JhcigpOw0KICB9DQoNCiAgZnVuY3Rpb24gdXBkYXRlQnV0dG9uU3RhdGUoZGV2aWNlKSB7DQogICAgY29uc3QgYnRuID0gcXMoZGV2aWNlLmJ1dHRvbl9pZCk7DQogICAgaWYgKCFidG4pIHJldHVybjsNCiAgICBjb25zdCBjbGlja3NMZWZ0ID0gZ2V0Q2xpY2tzTGVmdChkZXZpY2Uuc3RvcmFnZV9rZXkpOw0KICAgIGJ0bi5kaXNhYmxlZCA9IGNsaWNrc0xlZnQgPD0gMCB8fCAhaXNDaGVja2luVGltZSgpOw0KICAgIGlmIChjbGlja3NMZWZ0IDw9IDApIHsNCiAgICAgIGJ0bi5jbGFzc0xpc3QuYWRkKCJidG4tZXJyb3IiKTsNCiAgICAgIGJ0bi5jbGFzc0xpc3QucmVtb3ZlKCJidG4tc3VjY2VzcyIpOw0KICAgIH0gZWxzZSBpZiAoIWlzQ2hlY2tpblRpbWUoKSkgew0KICAgICAgYnRuLmNsYXNzTGlzdC5yZW1vdmUoImJ0bi1lcnJvciIsICJidG4tc3VjY2VzcyIpOw0KICAgIH0gZWxzZSB7DQogICAgICBidG4uY2xhc3NMaXN0LmFkZCgiYnRuLXN1Y2Nlc3MiKTsNCiAgICAgIGJ0bi5jbGFzc0xpc3QucmVtb3ZlKCJidG4tZXJyb3IiKTsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiB1cGRhdGVEb29yVmlzaWJpbGl0eSgpIHsNCiAgICBERVZJQ0VTLmZvckVhY2goKGRldmljZSkgPT4gew0KICAgICAgY29uc3QgY29udGFpbmVyID0gcXMoYCR7ZGV2aWNlLmJ1dHRvbl9pZH1Db250YWluZXJgKTsNCiAgICAgIGlmIChjb250YWluZXIpDQogICAgICAgIGNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gZGV2aWNlLnZpc2libGUgPyAiYmxvY2siIDogIm5vbmUiOw0KICAgIH0pOw0KICB9DQoNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIC8vIENBTUJJQU1FTlRPIENPRElDRQ0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgZnVuY3Rpb24gc2V0dXBDb2RlQ2hhbmdlTGlzdGVuZXIoKSB7DQogICAgaWYgKGNvZGVDaGVja0ludGVydmFsKSBjbGVhckludGVydmFsKGNvZGVDaGVja0ludGVydmFsKTsNCiAgICBpZiAoTElOS19DSEVDS19JTlRFUlZBTCkgY2xlYXJJbnRlcnZhbChMSU5LX0NIRUNLX0lOVEVSVkFMKTsNCg0KICAgIGNvZGVDaGVja0ludGVydmFsID0gc2V0SW50ZXJ2YWwoY2hlY2tDb2RlVmVyc2lvbiwgMjAwMCk7DQogICAgTElOS19DSEVDS19JTlRFUlZBTCA9IHNldEludGVydmFsKGNoZWNrRXhwaXJlZExpbmtzLCA2MDAwMCk7DQoNCiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigic3RvcmFnZSIsIChlKSA9PiB7DQogICAgICBpZiAoZS5rZXkgPT09ICJjb2RlX3ZlcnNpb24iIHx8IGUua2V5ID09PSAibGFzdF9jb2RlX3VwZGF0ZSIpIHsNCiAgICAgICAgY2hlY2tDb2RlVmVyc2lvbigpOw0KICAgICAgfQ0KICAgIH0pOw0KICB9DQoNCiAgZnVuY3Rpb24gY2hlY2tDb2RlVmVyc2lvbigpIHsNCiAgICBkYXRhYmFzZQ0KICAgICAgLnJlZigic2V0dGluZ3MvY29kZV92ZXJzaW9uIikNCiAgICAgIC5vbmNlKCJ2YWx1ZSIpDQogICAgICAudGhlbigoc25hcCkgPT4gew0KICAgICAgICBpZiAoc25hcC5leGlzdHMoKSkgew0KICAgICAgICAgIGNvbnN0IGZpcmViYXNlVmVyc2lvbiA9IHBhcnNlSW50KHNuYXAudmFsKCkpOw0KICAgICAgICAgIGNvbnN0IGxvY2FsVmVyc2lvbiA9DQogICAgICAgICAgICBwYXJzZUludChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiY29kZV92ZXJzaW9uIikpIHx8IDE7DQogICAgICAgICAgY29uc3Qgc2F2ZWRWZXJzaW9uID0gTWF0aC5tYXgoZmlyZWJhc2VWZXJzaW9uLCBsb2NhbFZlcnNpb24pOw0KICAgICAgICAgIGlmIChzYXZlZFZlcnNpb24gPiBjdXJyZW50Q29kZVZlcnNpb24pIGhhbmRsZUNvZGVDaGFuZ2Uoc2F2ZWRWZXJzaW9uKTsNCiAgICAgICAgfQ0KICAgICAgfSkNCiAgICAgIC5jYXRjaCgoKSA9PiB7DQogICAgICAgIGNvbnN0IHNhdmVkVmVyc2lvbiA9DQogICAgICAgICAgcGFyc2VJbnQobG9jYWxTdG9yYWdlLmdldEl0ZW0oImNvZGVfdmVyc2lvbiIpKSB8fCAxOw0KICAgICAgICBpZiAoc2F2ZWRWZXJzaW9uID4gY3VycmVudENvZGVWZXJzaW9uKSBoYW5kbGVDb2RlQ2hhbmdlKHNhdmVkVmVyc2lvbik7DQogICAgICB9KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGhhbmRsZUNvZGVDaGFuZ2UobmV3VmVyc2lvbikgew0KICAgIGN1cnJlbnRDb2RlVmVyc2lvbiA9IG5ld1ZlcnNpb247DQogICAgZGF0YWJhc2UNCiAgICAgIC5yZWYoInNldHRpbmdzL3NlY3JldF9jb2RlIikNCiAgICAgIC5vbmNlKCJ2YWx1ZSIpDQogICAgICAudGhlbigoY29kZVNuYXApID0+IHsNCiAgICAgICAgaWYgKGNvZGVTbmFwLmV4aXN0cygpKSB7CiAgICAgICAgICBDT1JSRUNUX0NPREUgPSBjb2RlU25hcC52YWwoKTsKICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJzZWNyZXRfY29kZSIsIENPUlJFQ1RfQ09ERSk7CiAgICAgICAgICBjb25zdCBoYWRMb2NhbFZlcnNpb24gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShDT0RFX1ZFUlNJT05fS0VZKSAhPT0gbnVsbDsKICAgICAgICAgIGNvbnN0IG1zZyA9ICJDb2RpY2UgYWdnaW9ybmF0bzogaWwgbGluayBub24gZScgcGl1JyB2YWxpZG8iOwogICAgICAgICAgaWYgKGhhZExvY2FsVmVyc2lvbikgewogICAgICAgICAgICBibG9ja0FjY2Vzcyhtc2cpOwogICAgICAgICAgICBzaG93U2Vzc2lvbkV4cGlyZWQoKTsKICAgICAgICAgIH0gZWxzZSBpZiAoaGFzVG9rZW5Gb290cHJpbnQoKSkgewogICAgICAgICAgICBmb3JjZUxvZ291dEZyb21Ub2tlbihtc2cpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdW5ibG9ja0FjY2VzcygpOwogICAgICAgICAgICBxcygiZXhwaXJlZE92ZXJsYXkiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7CiAgICAgICAgICAgIHFzKCJzZXNzaW9uRXhwaXJlZCIpPy5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsKICAgICAgICAgICAgcXMoImNvbnRyb2xQYW5lbCIpPy5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsKICAgICAgICAgICAgcmVzZXRTZXNzaW9uRm9yTmV3Q29kZSgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7DQogIH0NCg0KICBmdW5jdGlvbiByZXNldFNlc3Npb25Gb3JOZXdDb2RlKCkgew0KICAgIGNsZWFyU3RvcmFnZSgidXNhZ2Vfc3RhcnRfdGltZSIpOw0KICAgIGNsZWFyU3RvcmFnZSgidXNhZ2VfaGFzaCIpOw0KICAgIERFVklDRVMuZm9yRWFjaCgoZCkgPT4gY2xlYXJTdG9yYWdlKGQuc3RvcmFnZV9rZXkpKTsNCg0KICAgIHFzKCJjb250cm9sUGFuZWwiKSAmJiAocXMoImNvbnRyb2xQYW5lbCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSIpOw0KICAgIHFzKCJhdXRoQ29kZSIpICYmIChxcygiYXV0aENvZGUiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIik7DQogICAgcXMoImF1dGgtZm9ybSIpICYmIChxcygiYXV0aC1mb3JtIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayIpOw0KICAgIHFzKCJidG5DaGVja0NvZGUiKSAmJiAocXMoImJ0bkNoZWNrQ29kZSIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siKTsNCiAgICBxcygiaW1wb3J0YW50IikgJiYgKHFzKCJpbXBvcnRhbnQiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIik7DQoNCiAgICBzaG93Tm90aWZpY2F0aW9uKA0KICAgICAgIklsIGNvZGljZSBkaSBhY2Nlc3NvIMODwqggc3RhdG8gYWdnaW9ybmF0by4gSW5zZXJpc2NpIGlsIG51b3ZvIGNvZGljZS4iDQogICAgKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNoZWNrRXhwaXJlZExpbmtzKCkgew0KICAgIGNvbnN0IHNlY3VyZUxpbmtzID0gSlNPTi5wYXJzZSgNCiAgICAgIGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJzZWN1cmVfbGlua3MiKSB8fCAie30iDQogICAgKTsNCiAgICBsZXQgdXBkYXRlZCA9IGZhbHNlOw0KICAgIE9iamVjdC5rZXlzKHNlY3VyZUxpbmtzKS5mb3JFYWNoKChsaW5rSWQpID0+IHsNCiAgICAgIGNvbnN0IGxpbmsgPSBzZWN1cmVMaW5rc1tsaW5rSWRdOw0KICAgICAgaWYgKGxpbmsuZXhwaXJhdGlvbiA8IERhdGUubm93KCkgJiYgbGluay5zdGF0dXMgPT09ICJhY3RpdmUiKSB7DQogICAgICAgIHNlY3VyZUxpbmtzW2xpbmtJZF0uc3RhdHVzID0gImV4cGlyZWQiOw0KICAgICAgICB1cGRhdGVkID0gdHJ1ZTsNCiAgICAgIH0NCiAgICB9KTsNCiAgICBpZiAodXBkYXRlZCkNCiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJzZWN1cmVfbGlua3MiLCBKU09OLnN0cmluZ2lmeShzZWN1cmVMaW5rcykpOw0KICB9DQoNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIC8vIFBPUFVQDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICBmdW5jdGlvbiBzaG93Q29uZmlybWF0aW9uUG9wdXAoZGV2aWNlKSB7DQogICAgaWYgKCFpc0NoZWNraW5UaW1lKCkpIHsNCiAgICAgIHNob3dFYXJseUNoZWNraW5Qb3B1cCgpOw0KICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICBjdXJyZW50RGV2aWNlID0gZGV2aWNlOw0KICAgIGNvbnN0IGRvb3JOYW1lID0gZGV2aWNlLmJ1dHRvbl9pZA0KICAgICAgLnJlcGxhY2UoLyhbQS1aXSkvZywgIiAkMSIpDQogICAgICAucmVwbGFjZSgvXi4vLCAocykgPT4gcy50b1VwcGVyQ2FzZSgpKTsNCiAgICBjb25zdCBtc2cgPSBxcygiY29uZmlybWF0aW9uTWVzc2FnZSIpOw0KICAgIGlmIChtc2cpDQogICAgICBtc2cudGV4dENvbnRlbnQgPSBgQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIHVubG9jayB0aGUgJHtkb29yTmFtZX0/YDsNCiAgICBjb25zdCBwb3AgPSBxcygiY29uZmlybWF0aW9uUG9wdXAiKTsNCiAgICBpZiAocG9wKSBwb3Auc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsNCiAgfQ0KICBmdW5jdGlvbiBjbG9zZUNvbmZpcm1hdGlvblBvcHVwKCkgew0KICAgIGNvbnN0IHBvcCA9IHFzKCJjb25maXJtYXRpb25Qb3B1cCIpOw0KICAgIGlmIChwb3ApIHBvcC5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICAgIGN1cnJlbnREZXZpY2UgPSBudWxsOw0KICB9DQoNCiAgZnVuY3Rpb24gc2hvd0RldmljZVBvcHVwKGRldmljZSwgY2xpY2tzTGVmdCkgew0KICAgIGNvbnN0IHBvcHVwID0gcXMoYHBvcHVwLSR7ZGV2aWNlLmJ1dHRvbl9pZH1gKTsNCiAgICBpZiAoIXBvcHVwKSByZXR1cm47DQogICAgY29uc3QgdGV4dCA9IHFzKGBwb3B1cC10ZXh0LSR7ZGV2aWNlLmJ1dHRvbl9pZH1gKTsNCiAgICBpZiAodGV4dCkgew0KICAgICAgaWYgKGNsaWNrc0xlZnQgPiAwKSB7DQogICAgICAgIHRleHQuaW5uZXJIVE1MID0gYA0KICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtY2hlY2stY2lyY2xlIiBzdHlsZT0iY29sb3I6IzRDQUY1MDtmb250LXNpemU6Mi41cmVtO21hcmdpbi1ib3R0b206MTVweDsiPjwvaT4NCiAgICAgICAgICA8ZGl2PjxzdHJvbmc+JHtjbGlja3NMZWZ0fTwvc3Ryb25nPiBDbGljayBMZWZ0PC9kaXY+DQogICAgICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luLXRvcDoxMHB4O2ZvbnQtc2l6ZToxcmVtOyI+RG9vciBVbmxvY2tlZCE8L2Rpdj5gOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGV4dC5pbm5lckhUTUwgPSBgDQogICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1leGNsYW1hdGlvbi10cmlhbmdsZSIgc3R5bGU9ImNvbG9yOiNGRkMxMDc7Zm9udC1zaXplOjIuNXJlbTttYXJnaW4tYm90dG9tOjE1cHg7Ij48L2k+DQogICAgICAgICAgPGRpdj48c3Ryb25nPk5vIG1vcmUgY2xpY2tzIGxlZnQhPC9zdHJvbmc+PC9kaXY+DQogICAgICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luLXRvcDoxMHB4O2ZvbnQtc2l6ZToxcmVtOyI+Q29udGFjdCBmb3IgQXNzaXN0YW5jZS48L2Rpdj5gOw0KICAgICAgfQ0KICAgIH0NCiAgICBwb3B1cC5zdHlsZS5kaXNwbGF5ID0gImZsZXgiOw0KICAgIGlmIChjbGlja3NMZWZ0ID4gMCkgc2V0VGltZW91dCgoKSA9PiBjbG9zZVBvcHVwKGRldmljZS5idXR0b25faWQpLCAzMDAwKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNsb3NlUG9wdXAoYnV0dG9uSWQpIHsNCiAgICBjb25zdCBwb3B1cCA9IHFzKGBwb3B1cC0ke2J1dHRvbklkfWApOw0KICAgIGlmIChwb3B1cCkgcG9wdXAuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCiAgfQ0KDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICAvLyBTSEVMTFkNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIGFzeW5jIGZ1bmN0aW9uIGFjdGl2YXRlRGV2aWNlKGRldmljZSkgew0KICAgIGlmICghc2Vzc2lvblN0YXJ0VGltZSkgew0KICAgICAgLy8gTCd1dGVudGUgaGEgY2xpY2NhdG8gc2VuemEgbG9naW47IGluaXppYWxpenphIHVuYSBzZXNzaW9uZSBtYW51YWxlDQogICAgICBzZXNzaW9uU3RhcnRUaW1lID0gRGF0ZS5ub3coKTsNCiAgICAgIGF3YWl0IHNldFVzYWdlU3RhcnRUaW1lKCk7DQogICAgfQ0KDQogICAgaWYgKGF3YWl0IGNoZWNrVGltZUxpbWl0KCkpIHJldHVybjsNCiAgICBpZiAoIWlzQ2hlY2tpblRpbWUoKSkgew0KICAgICAgc2hvd0Vhcmx5Q2hlY2tpblBvcHVwKCk7DQogICAgICByZXR1cm47DQogICAgfQ0KDQogICAgbGV0IGNsaWNrc0xlZnQgPSBnZXRDbGlja3NMZWZ0KGRldmljZS5zdG9yYWdlX2tleSk7DQogICAgaWYgKGNsaWNrc0xlZnQgPD0gMCkgew0KICAgICAgc2hvd0RldmljZVBvcHVwKGRldmljZSwgY2xpY2tzTGVmdCk7DQogICAgICB1cGRhdGVCdXR0b25TdGF0ZShkZXZpY2UpOw0KICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIHNldENsaWNrc0xlZnQoZGV2aWNlLnN0b3JhZ2Vfa2V5LCAtLWNsaWNrc0xlZnQpOw0KICAgIHVwZGF0ZUJ1dHRvblN0YXRlKGRldmljZSk7DQoNCiAgICB0cnkgew0KICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaFdpdGhUaW1lb3V0KA0KICAgICAgICBCQVNFX1VSTF9TRVQsDQogICAgICAgIHsNCiAgICAgICAgICBtZXRob2Q6ICJQT1NUIiwNCiAgICAgICAgICBoZWFkZXJzOiB7ICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIgfSwNCiAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7DQogICAgICAgICAgICBpZDogZGV2aWNlLmlkLA0KICAgICAgICAgICAgYXV0aF9rZXk6IGRldmljZS5hdXRoX2tleSwNCiAgICAgICAgICAgIGNoYW5uZWw6IDAsDQogICAgICAgICAgICBvbjogdHJ1ZSwNCiAgICAgICAgICAgIHR1cm46ICJvbiIsDQogICAgICAgICAgfSksDQogICAgICAgIH0sDQogICAgICAgIDEyMDAwDQogICAgICApOw0KDQogICAgICBpZiAocmVzcG9uc2Uub2spIHsNCiAgICAgICAgc2hvd0RldmljZVBvcHVwKGRldmljZSwgY2xpY2tzTGVmdCk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBzZXRDbGlja3NMZWZ0KGRldmljZS5zdG9yYWdlX2tleSwgY2xpY2tzTGVmdCArIDEpOw0KICAgICAgICB1cGRhdGVCdXR0b25TdGF0ZShkZXZpY2UpOw0KICAgICAgICBjb25zb2xlLmVycm9yKA0KICAgICAgICAgICJFcnJvcmUgbmVsbCdhdHRpdmF6aW9uZSBkZWwgZGlzcG9zaXRpdm86IiwNCiAgICAgICAgICByZXNwb25zZS5zdGF0dXMsDQogICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzVGV4dA0KICAgICAgICApOw0KICAgICAgfQ0KICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICBjb25zb2xlLmVycm9yKCJBdHRpdmF6aW9uZSBkaXNwb3NpdGl2byBmYWxsaXRhOiIsIGVycm9yKTsNCiAgICAgIHNldENsaWNrc0xlZnQoZGV2aWNlLnN0b3JhZ2Vfa2V5LCBjbGlja3NMZWZ0ICsgMSk7DQogICAgICB1cGRhdGVCdXR0b25TdGF0ZShkZXZpY2UpOw0KICAgIH0NCiAgfQ0KDQogIGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUdsb2JhbENvZGVWZXJzaW9uKCkgew0KICAgIGNvbnN0IHNhdmVkVmVyc2lvbiA9IHBhcnNlSW50KGxvY2FsU3RvcmFnZS5nZXRJdGVtKENPREVfVkVSU0lPTl9LRVkpKSB8fCAxOw0KICAgIGlmIChzYXZlZFZlcnNpb24gPCBjdXJyZW50Q29kZVZlcnNpb24pIHsNCiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKENPREVfVkVSU0lPTl9LRVksIFN0cmluZyhjdXJyZW50Q29kZVZlcnNpb24pKTsNCiAgICAgIHJlc2V0U2Vzc2lvbkZvck5ld0NvZGUoKTsNCiAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICByZXR1cm4gZmFsc2U7DQogIH0NCg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgLy8gVE9LRU4gU0lDVVJJIChGaXJlYmFzZSBzZWN1cmVfbGlua3MvKikNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIGZ1bmN0aW9uIG1heWJlQ2xlYW5VcmwoKSB7DQogICAgaWYgKCFLRUVQX1RPS0VOX0lOX1VSTCkgY2xlYW5VcmwoKTsNCiAgfQ0KDQogIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZVNlY3VyZVRva2VuKCkgew0KICAgIGNvbnN0IHVybFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMod2luZG93LmxvY2F0aW9uLnNlYXJjaCk7DQogICAgY29uc3QgdG9rZW4gPSB1cmxQYXJhbXMuZ2V0KCJ0b2tlbiIpOw0KICAgIGlmICghdG9rZW4pIHsNCiAgICAgIGlzVG9rZW5TZXNzaW9uID0gZmFsc2U7DQogICAgICB3aW5kb3cuaXNUb2tlblNlc3Npb24gPSBmYWxzZTsNCiAgICAgIGN1cnJlbnRUb2tlbkN1c3RvbUNvZGUgPSBudWxsOw0KICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KICAgIHRyeSB7DQogICAgICBjb25zdCBzbmFwc2hvdCA9IGF3YWl0IGRhdGFiYXNlDQogICAgICAgIC5yZWYoInNlY3VyZV9saW5rcy8iICsgdG9rZW4pDQogICAgICAgIC5vbmNlKCJ2YWx1ZSIpOw0KICAgICAgaWYgKCFzbmFwc2hvdC5leGlzdHMoKSkgewogICAgICAgIHNob3dUb2tlbkVycm9yKCJJbnZhbGlkIHRva2VuIik7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGJsb2NrVG9rZW5Pbmx5KCJJbnZhbGlkIHRva2VuIiwgdG9rZW4pOwogICAgICAgIH0gY2F0Y2gge30KICAgICAgICBzaG93U2Vzc2lvbkV4cGlyZWQoKTsKICAgICAgICBtYXliZUNsZWFuVXJsKCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9Cg0KICAgICAgY29uc3QgbGlua0RhdGEgPSBzbmFwc2hvdC52YWwoKTsKCiAgICAgIC8vIFNlIHF1ZXN0byB0b2tlbiDDg8KoIHN0YXRvIGJsb2NjYXRvIHN1IHF1ZXN0byBkaXNwb3NpdGl2byAoZXMuIHRlbXBvIHNlc3Npb25lIHNjYWR1dG8pLCBub24gcmlhdHRpdmFybG8gc3UgcmVmcmVzaAogICAgICBpZiAoaXNUb2tlbkRldmljZUJsb2NrZWQodG9rZW4pKSB7CiAgICAgICAgY29uc3QgciA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGB0b2tlbl9kZXZpY2VfcmVhc29uXyR7dG9rZW59YCkgfHwgIlNlc3Npb25lIHRva2VuIHNjYWR1dGEgc3UgcXVlc3RvIGRpc3Bvc2l0aXZvIjsKICAgICAgICBzaG93VG9rZW5FcnJvcihyKTsKICAgICAgICB0cnkgeyBibG9ja1Rva2VuT25seShyLCB0b2tlbik7IH0gY2F0Y2gge30KICAgICAgICBzaG93U2Vzc2lvbkV4cGlyZWQoKTsKICAgICAgICBtYXliZUNsZWFuVXJsKCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGNvbnN0IGlzVmFsaWQgPSB2YWxpZGF0ZVNlY3VyZVRva2VuKGxpbmtEYXRhKTsNCiAgICAgIGlmICghaXNWYWxpZC52YWxpZCkgewogICAgICAgIHNob3dUb2tlbkVycm9yKGlzVmFsaWQucmVhc29uKTsKICAgICAgICB0cnkgewogICAgICAgICAgYmxvY2tUb2tlbk9ubHkoaXNWYWxpZC5yZWFzb24gfHwgIkFjY2VzcyBibG9ja2VkIiwgdG9rZW4pOwogICAgICAgIH0gY2F0Y2gge30KICAgICAgICBzaG93U2Vzc2lvbkV4cGlyZWQoKTsKICAgICAgICBtYXliZUNsZWFuVXJsKCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9Cg0KICAgICAgaXNUb2tlblNlc3Npb24gPSB0cnVlOwogICAgICB3aW5kb3cuaXNUb2tlblNlc3Npb24gPSB0cnVlOyAvLyBjb21wYXQgbGVnYWN5CiAgICAgIGN1cnJlbnRUb2tlbklkID0gdG9rZW47CiAgICAgIGN1cnJlbnRUb2tlbkN1c3RvbUNvZGUgPSBsaW5rRGF0YS5jdXN0b21Db2RlIHx8IG51bGw7CgogICAgICAvLyBzYmxvY2NhIGJsb2NjaGkgcHJlY2VkZW50aQogICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgiYmxvY2tfbWFudWFsX2xvZ2luIik7CiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJibG9ja2VkX3Rva2VuIik7CiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJibG9ja2VkX3JlYXNvbiIpOwogICAgICAvLyBBc3NpY3VyYXRpIGNoZSBldmVudHVhbGkgb3ZlcmxheSBkaSBzY2FkZW56YSBub24gcmVzdGlubyB2aXNpYmlsaQogICAgICB0cnkgewogICAgICAgIHVuYmxvY2tBY2Nlc3MoKTsKICAgICAgICBxcygiZXhwaXJlZE92ZXJsYXkiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7CiAgICAgICAgcXMoInNlc3Npb25FeHBpcmVkIik/LmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOwogICAgICB9IGNhdGNoIHt9Cg0KICAgICAgc2hvd1Rva2VuTm90aWZpY2F0aW9uKGlzVmFsaWQucmVtYWluaW5nVXNlcywgISFjdXJyZW50VG9rZW5DdXN0b21Db2RlKTsKICAgICAgYXdhaXQgaW5jcmVtZW50VG9rZW5Vc2FnZSh0b2tlbiwgbGlua0RhdGEpOwogICAgICBtYXliZUNsZWFuVXJsKCk7CiAgICAgIHN0YXJ0VG9rZW5FeHBpcmF0aW9uQ2hlY2sobGlua0RhdGEuZXhwaXJhdGlvbik7CiAgICAgIHN0YXJ0VG9rZW5SZWFsdGltZUxpc3RlbmVyKHRva2VuKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICBjb25zb2xlLmVycm9yKCJUb2tlbiB2ZXJpZmljYXRpb24gZXJyb3I6IiwgZXJyb3IpOwogICAgICBzaG93VG9rZW5FcnJvcigiVmVyaWZpY2F0aW9uIGVycm9yIik7CiAgICAgIHRyeSB7CiAgICAgICAgYmxvY2tUb2tlbk9ubHkoIlZlcmlmaWNhdGlvbiBlcnJvciIsIHRva2VuKTsKICAgICAgfSBjYXRjaCB7fQogICAgICBzaG93U2Vzc2lvbkV4cGlyZWQoKTsKICAgICAgbWF5YmVDbGVhblVybCgpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQ0KDQogIGZ1bmN0aW9uIHN0b3BUb2tlblJlYWx0aW1lTGlzdGVuZXIoKSB7DQogICAgaWYgKHRva2VuUmVmKSB7DQogICAgICB0b2tlblJlZi5vZmYoKTsNCiAgICAgIHRva2VuUmVmID0gbnVsbDsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBjbGVhck1hbnVhbFNlc3Npb24oKSB7DQogICAgdHJ5IHsNCiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJ1c2FnZV9zdGFydF90aW1lIik7DQogICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgidXNhZ2VfaGFzaCIpOw0KICAgICAgc2Vzc2lvblN0YXJ0VGltZSA9IG51bGw7DQogICAgfSBjYXRjaCB7fQ0KICB9DQoNCiAgZnVuY3Rpb24gYmxvY2tBY2Nlc3MocmVhc29uID0gIkFjY2Vzc28gYmxvY2NhdG8iLCB0b2tlbiA9IG51bGwpIHsKICAgIHRyeSB7CiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJibG9ja19tYW51YWxfbG9naW4iLCAiMSIpOwogICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgiYmxvY2tlZF9yZWFzb24iLCByZWFzb24pOwogICAgICBpZiAodG9rZW4pIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJibG9ja2VkX3Rva2VuIiwgdG9rZW4pOwogICAgfSBjYXRjaCAoZSkgewogICAgICBjb25zb2xlLmVycm9yKCJFcnJvcmUgYmxvY2tBY2Nlc3M6IiwgZSk7CiAgICB9CiAgfQoKICAvLyBCbG9jY2Egc29sbyBpbCB0b2tlbiBjb3JyZW50ZSBzZW56YSBhcHBsaWNhcmUgaWwgYmxvY2NvIGdsb2JhbGUgZGVsIGRpc3Bvc2l0aXZvCiAgZnVuY3Rpb24gYmxvY2tUb2tlbk9ubHkocmVhc29uID0gIkFjY2Vzc28gYmxvY2NhdG8iLCB0b2tlbiA9IG51bGwpIHsKICAgIHRyeSB7CiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJibG9ja2VkX3JlYXNvbiIsIHJlYXNvbik7CiAgICAgIGlmICh0b2tlbikgbG9jYWxTdG9yYWdlLnNldEl0ZW0oImJsb2NrZWRfdG9rZW4iLCB0b2tlbik7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yZSBibG9ja1Rva2VuT25seToiLCBlKTsKICAgIH0KICB9Cg0KICBmdW5jdGlvbiB1bmJsb2NrQWNjZXNzKCkgewogICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oImJsb2NrX21hbnVhbF9sb2dpbiIpOwogICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oImJsb2NrZWRfcmVhc29uIik7CiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgiYmxvY2tlZF90b2tlbiIpOwogIH0KCiAgLy8gRmxhZyBkaSBibG9jY28gcGVyIHF1ZXN0byB0b2tlbiBzdSBxdWVzdG8gZGlzcG9zaXRpdm8KICBmdW5jdGlvbiBtYXJrVG9rZW5EZXZpY2VCbG9ja2VkKHRva2VuLCByZWFzb24gPSAiIikgewogICAgdHJ5IHsKICAgICAgaWYgKCF0b2tlbikgcmV0dXJuOwogICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShgdG9rZW5fZGV2aWNlX2Jsb2NrXyR7dG9rZW59YCwgIjEiKTsKICAgICAgaWYgKHJlYXNvbikgbG9jYWxTdG9yYWdlLnNldEl0ZW0oYHRva2VuX2RldmljZV9yZWFzb25fJHt0b2tlbn1gLCByZWFzb24pOwogICAgfSBjYXRjaCAoZSkgewogICAgICBjb25zb2xlLmVycm9yKCJFcnJvcmUgbWFya1Rva2VuRGV2aWNlQmxvY2tlZDoiLCBlKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGlzVG9rZW5EZXZpY2VCbG9ja2VkKHRva2VuKSB7CiAgICB0cnkgewogICAgICBpZiAoIXRva2VuKSByZXR1cm4gZmFsc2U7CiAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShgdG9rZW5fZGV2aWNlX2Jsb2NrXyR7dG9rZW59YCkgPT09ICIxIjsKICAgIH0gY2F0Y2ggewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBjbGVhclRva2VuRGV2aWNlQmxvY2sodG9rZW4pIHsKICAgIHRyeSB7CiAgICAgIGlmICghdG9rZW4pIHJldHVybjsKICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oYHRva2VuX2RldmljZV9ibG9ja18ke3Rva2VufWApOwogICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShgdG9rZW5fZGV2aWNlX3JlYXNvbl8ke3Rva2VufWApOwogICAgfSBjYXRjaCB7fQogIH0KCiAgZnVuY3Rpb24gaGFzVG9rZW5Gb290cHJpbnQoKSB7DQogICAgdHJ5IHsNCiAgICAgIGlmIChpc1Rva2VuU2Vzc2lvbikgcmV0dXJuIHRydWU7DQogICAgICBjb25zdCB1cmxUb2sgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gpLmdldCgidG9rZW4iKTsNCiAgICAgIGlmICh1cmxUb2spIHJldHVybiB0cnVlOw0KICAgICAgaWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJibG9ja2VkX3Rva2VuIikpIHJldHVybiB0cnVlOw0KICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsb2NhbFN0b3JhZ2UubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgY29uc3QgayA9IGxvY2FsU3RvcmFnZS5rZXkoaSk7DQogICAgICAgIGlmIChrICYmIGsuaW5kZXhPZigidG9rZW5fb2tfIikgPT09IDApIHJldHVybiB0cnVlOw0KICAgICAgfQ0KICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgIGNvbnNvbGUud2FybigiaGFzVG9rZW5Gb290cHJpbnQgY2hlY2sgZmFpbGVkOiIsIGUpOw0KICAgIH0NCiAgICByZXR1cm4gZmFsc2U7DQogIH0NCg0KICBmdW5jdGlvbiBmb3JjZUdsb2JhbExvZ291dChyZWFzb24gPSAiQ29kaWNlIGFnZ2lvcm5hdG86IGFjY2VkaSBkaSBudW92byIpIHsKICAgIGlzVG9rZW5TZXNzaW9uID0gZmFsc2U7DQogICAgd2luZG93LmlzVG9rZW5TZXNzaW9uID0gZmFsc2U7DQogICAgY2xlYXJNYW51YWxTZXNzaW9uKCk7DQogICAgY29uc3QgdCA9DQogICAgICBjdXJyZW50VG9rZW5JZCB8fA0KICAgICAgbmV3IFVSTFNlYXJjaFBhcmFtcyhsb2NhdGlvbi5zZWFyY2gpLmdldCgidG9rZW4iKSB8fA0KICAgICAgbnVsbDsNCiAgICBibG9ja1Rva2VuT25seShyZWFzb24sIHQpOwogICAgdHJ5IHsNCiAgICAgIGlmICh0KSBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShgdG9rZW5fb2tfJHt0fWApOw0KICAgIH0gY2F0Y2gge30NCiAgICB0cnkgew0KICAgICAgc2hvd1Rva2VuRXJyb3IocmVhc29uKTsNCiAgICB9IGNhdGNoIHt9DQogICAgc2hvd1Nlc3Npb25FeHBpcmVkKCk7DQogICAgc3RvcFRva2VuUmVhbHRpbWVMaXN0ZW5lcigpOw0KICB9DQoNCiAgZnVuY3Rpb24gZm9yY2VMb2dvdXRGcm9tVG9rZW4ocmVhc29uID0gIkxpbmsgbm9uIHBpw4PCuSB2YWxpZG8iKSB7DQogICAgaXNUb2tlblNlc3Npb24gPSBmYWxzZTsNCiAgICB3aW5kb3cuaXNUb2tlblNlc3Npb24gPSBmYWxzZTsNCiAgICBjbGVhck1hbnVhbFNlc3Npb24oKTsNCiAgICBjb25zdCB0ID0NCiAgICAgIGN1cnJlbnRUb2tlbklkIHx8DQogICAgICBuZXcgVVJMU2VhcmNoUGFyYW1zKGxvY2F0aW9uLnNlYXJjaCkuZ2V0KCJ0b2tlbiIpIHx8DQogICAgICBudWxsOw0KICAgIC8vIE5vbiBibG9jY2FyZSBnbG9iYWxtZW50ZSBpbCBkaXNwb3NpdGl2byBwZXIgZXZlbnRpIGxlZ2F0aSBhIHF1ZXN0byB0b2tlbgogICAgYmxvY2tUb2tlbk9ubHkocmVhc29uLCB0KTsKICAgIGlmICh0KSBtYXJrVG9rZW5EZXZpY2VCbG9ja2VkKHQsIHJlYXNvbiB8fCAiU2Vzc2lvbmUgdG9rZW4gc2NhZHV0YSIpOwogICAgdHJ5IHsNCiAgICAgIGlmICh0KSBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShgdG9rZW5fb2tfJHt0fWApOw0KICAgIH0gY2F0Y2gge30NCiAgICB0cnkgew0KICAgICAgc2hvd1Rva2VuRXJyb3IocmVhc29uKTsNCiAgICB9IGNhdGNoIHt9DQogICAgc2hvd1Nlc3Npb25FeHBpcmVkKCk7DQogICAgc3RvcFRva2VuUmVhbHRpbWVMaXN0ZW5lcigpOw0KICB9DQoNCiAgZnVuY3Rpb24gc3RhcnRUb2tlblJlYWx0aW1lTGlzdGVuZXIodG9rZW4pIHsNCiAgICBzdG9wVG9rZW5SZWFsdGltZUxpc3RlbmVyKCk7DQogICAgdG9rZW5SZWYgPSBkYXRhYmFzZS5yZWYoInNlY3VyZV9saW5rcy8iICsgdG9rZW4pOw0KICAgIHRva2VuUmVmLm9uKCJ2YWx1ZSIsIChzbmFwKSA9PiB7DQogICAgICBpZiAoIXNuYXAuZXhpc3RzKCkpIHsNCiAgICAgICAgZm9yY2VMb2dvdXRGcm9tVG9rZW4oIkxpbmsgcmltb3NzbyIpOw0KICAgICAgICByZXR1cm47DQogICAgICB9DQogICAgICBjb25zdCBkID0gc25hcC52YWwoKTsNCiAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7DQogICAgICBjb25zdCBleGhhdXN0ZWQgPSAoZC51c2VkQ291bnQgfHwgMCkgPj0gKGQubWF4VXNhZ2UgfHwgMCk7DQogICAgICBjb25zdCBleHBpcmVkID0gKGQuZXhwaXJhdGlvbiB8fCAwKSA8PSBub3c7DQogICAgICBjb25zdCByZXZva2VkID0gZC5zdGF0dXMgIT09ICJhY3RpdmUiOw0KICAgICAgaWYgKHJldm9rZWQgfHwgZXhwaXJlZCB8fCBleGhhdXN0ZWQpIHsNCiAgICAgICAgY29uc3Qgd2h5ID0gcmV2b2tlZAogICAgICAgICAgPyAiTGluayByZXZvY2F0byIKICAgICAgICAgIDogZXhwaXJlZAogICAgICAgICAgPyAiTGluayBzY2FkdXRvIgogICAgICAgICAgOiAiVXRpbGl6emkgZXNhdXJpdGkiOwogICAgICAgIGZvcmNlTG9nb3V0RnJvbVRva2VuKHdoeSk7DQogICAgICB9DQogICAgfSk7DQogIH0NCg0KICBmdW5jdGlvbiB2YWxpZGF0ZVNlY3VyZVRva2VuKGxpbmtEYXRhKSB7DQogICAgdHJ5IHsNCiAgICAgIGlmICghbGlua0RhdGEpIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgcmVhc29uOiAiVG9rZW4gbm9uIHZhbGlkbyIgfTsKICAgICAgaWYgKGxpbmtEYXRhLnN0YXR1cyAhPT0gImFjdGl2ZSIpCiAgICAgICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCByZWFzb246ICJUb2tlbiByZXZvY2F0byIgfTsKICAgICAgaWYgKGxpbmtEYXRhLmV4cGlyYXRpb24gPCBEYXRlLm5vdygpKQ0KICAgICAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIHJlYXNvbjogIlRva2VuIHNjYWR1dG8iIH07DQogICAgICBpZiAoKGxpbmtEYXRhLnVzZWRDb3VudCB8fCAwKSA+PSAobGlua0RhdGEubWF4VXNhZ2UgfHwgMCkpCiAgICAgICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCByZWFzb246ICJVdGlsaXp6aSBlc2F1cml0aSIgfTsKICAgICAgY29uc3QgcmVtYWluaW5nVXNlcyA9DQogICAgICAgIChsaW5rRGF0YS5tYXhVc2FnZSB8fCAwKSAtIChsaW5rRGF0YS51c2VkQ291bnQgfHwgMCk7DQogICAgICByZXR1cm4geyB2YWxpZDogdHJ1ZSwgcmVtYWluaW5nVXNlcyB9Ow0KICAgIH0gY2F0Y2ggew0KICAgICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCByZWFzb246ICJFcnJvcmUgZGkgdmVyaWZpY2EiIH07CiAgICB9DQogIH0NCg0KICBhc3luYyBmdW5jdGlvbiBpbmNyZW1lbnRUb2tlblVzYWdlKHRva2VuLCBsaW5rRGF0YSkgew0KICAgIGNvbnN0IG5ld1VzZWRDb3VudCA9IChsaW5rRGF0YS51c2VkQ291bnQgfHwgMCkgKyAxOw0KICAgIGNvbnN0IG5ld1N0YXR1cyA9DQogICAgICBuZXdVc2VkQ291bnQgPj0gKGxpbmtEYXRhLm1heFVzYWdlIHx8IDApID8gInVzZWQiIDogImFjdGl2ZSI7DQogICAgdHJ5IHsNCiAgICAgIGF3YWl0IGRhdGFiYXNlDQogICAgICAgIC5yZWYoInNlY3VyZV9saW5rcy8iICsgdG9rZW4pDQogICAgICAgIC51cGRhdGUoeyB1c2VkQ291bnQ6IG5ld1VzZWRDb3VudCwgc3RhdHVzOiBuZXdTdGF0dXMgfSk7DQogICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yZSBuZWxsJ2FnZ2lvcm5hbWVudG8gZGVsIHRva2VuOiIsIGVycm9yKTsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBzaG93VG9rZW5Ob3RpZmljYXRpb24ocmVtYWluaW5nVXNlcywgaGFzQ3VzdG9tQ29kZSkgewogICAgY29uc3QgbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICAgIG4uc3R5bGUuY3NzVGV4dCA9IGANCiAgICAgIHBvc2l0aW9uOmZpeGVkOyB0b3A6MjBweDsgcmlnaHQ6MjBweDsgYmFja2dyb3VuZDp2YXIoLS1zdWNjZXNzKTsgY29sb3I6I2ZmZjsNCiAgICAgIHBhZGRpbmc6MTVweCAyMHB4OyBib3JkZXItcmFkaXVzOjhweDsgYm94LXNoYWRvdzowIDRweCAxMnB4IHJnYmEoMCwwLDAsLjEpOw0KICAgICAgei1pbmRleDoxMDAwMDsgZGlzcGxheTpmbGV4OyBnYXA6MTBweDsgYWxpZ24taXRlbXM6Y2VudGVyOyBtYXgtd2lkdGg6MzUwcHg7YDsNCiAgICBjb25zdCBjdXN0b20gPSBoYXNDdXN0b21Db2RlCiAgICAgID8gJzxkaXYgc3R5bGU9ImZvbnQtc2l6ZToxMnB4O29wYWNpdHk6Ljk7Ij5RdWVzdG8gbGluayB1c2EgdW4gY29kaWNlIGRlZGljYXRvPC9kaXY+JwogICAgICA6ICc8ZGl2IHN0eWxlPSJmb250LXNpemU6MTJweDtvcGFjaXR5Oi45OyI+UXVlc3RvIGxpbmsgdXNhIGlsIGNvZGljZSBwcmluY2lwYWxlPC9kaXY+JzsKICAgIG4uaW5uZXJIVE1MID0gYA0KICAgICAgPGkgY2xhc3M9ImZhcyBmYS1jaGVjay1jaXJjbGUiPjwvaT4NCiAgICAgIDxkaXY+DQogICAgICAgIDxkaXY+TGluayBzaWN1cm8gcmljb25vc2NpdXRvPC9kaXY+CiAgICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOjEycHg7b3BhY2l0eTouOTsiPlV0aWxpenppIHJpbWFuZW50aTogJHtyZW1haW5pbmdVc2VzfTwvZGl2PgogICAgICAgICR7Y3VzdG9tfQ0KICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MTJweDtvcGFjaXR5Oi45O21hcmdpbi10b3A6NXB4OyI+PGkgY2xhc3M9ImZhcyBmYS1pbmZvLWNpcmNsZSI+PC9pPiBJbnNlcmlzY2kgaWwgY29kaWNlIHF1aSBzb3R0bzwvZGl2Pg0KICAgICAgPC9kaXY+DQogICAgICA8YnV0dG9uIG9uY2xpY2s9InRoaXMucGFyZW50RWxlbWVudC5yZW1vdmUoKSIgc3R5bGU9ImJhY2tncm91bmQ6bm9uZTtib3JkZXI6bm9uZTtjb2xvcjojZmZmO21hcmdpbi1sZWZ0OjEwcHg7Y3Vyc29yOnBvaW50ZXIiPg0KICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXRpbWVzIj48L2k+DQogICAgICA8L2J1dHRvbj5gOw0KICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobik7DQogICAgc2V0VGltZW91dCgoKSA9PiBuLnBhcmVudEVsZW1lbnQgJiYgbi5yZW1vdmUoKSwgNTAwMCk7DQogIH0KCiAgCg0KICBmdW5jdGlvbiBzaG93VG9rZW5FcnJvcihyZWFzb24pIHsNCiAgICBjb25zdCBuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgbi5zdHlsZS5jc3NUZXh0ID0gYA0KICAgICAgcG9zaXRpb246Zml4ZWQ7IHRvcDoyMHB4OyByaWdodDoyMHB4OyBiYWNrZ3JvdW5kOnZhcigtLWVycm9yKTsgY29sb3I6I2ZmZjsNCiAgICAgIHBhZGRpbmc6MTVweCAyMHB4OyBib3JkZXItcmFkaXVzOjhweDsgYm94LXNoYWRvdzowIDRweCAxMnB4IHJnYmEoMCwwLDAsLjEpOw0KICAgICAgei1pbmRleDoxMDAwMDsgZGlzcGxheTpmbGV4OyBnYXA6MTBweDsgYWxpZ24taXRlbXM6Y2VudGVyOyBtYXgtd2lkdGg6MzIwcHg7YDsNCiAgICBuLmlubmVySFRNTCA9IGANCiAgICAgIDxpIGNsYXNzPSJmYXMgZmEtZXhjbGFtYXRpb24tdHJpYW5nbGUiPjwvaT4NCiAgICAgIDxkaXY+DQogICAgICAgIDxkaXY+TGluayBub24gdmFsaWRvPC9kaXY+CiAgICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOjEycHg7b3BhY2l0eTouOTsiPk1vdGl2bzogJHtyZWFzb259PC9kaXY+CiAgICAgIDwvZGl2Pg0KICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJ0aGlzLnBhcmVudEVsZW1lbnQucmVtb3ZlKCkiIHN0eWxlPSJiYWNrZ3JvdW5kOm5vbmU7Ym9yZGVyOm5vbmU7Y29sb3I6I2ZmZjttYXJnaW4tbGVmdDoxMHB4O2N1cnNvcjpwb2ludGVyIj4NCiAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS10aW1lcyI+PC9pPg0KICAgICAgPC9idXR0b24+YDsNCiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG4pOw0KICAgIHNldFRpbWVvdXQoKCkgPT4gbi5wYXJlbnRFbGVtZW50ICYmIG4ucmVtb3ZlKCksIDUwMDApOw0KICB9DQoNCiAgZnVuY3Rpb24gY2xlYW5VcmwoKSB7DQogICAgaWYgKHdpbmRvdy5oaXN0b3J5LnJlcGxhY2VTdGF0ZSkgew0KICAgICAgY29uc3QgY2xlYW4gPSB3aW5kb3cubG9jYXRpb24ub3JpZ2luICsgd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lOw0KICAgICAgd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlKHt9LCBkb2N1bWVudC50aXRsZSwgY2xlYW4pOw0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIHN0YXJ0VG9rZW5FeHBpcmF0aW9uQ2hlY2soZXhwaXJhdGlvblRpbWUpIHsNCiAgICBjb25zdCBpdiA9IHNldEludGVydmFsKCgpID0+IHsKICAgICAgaWYgKERhdGUubm93KCkgPiBleHBpcmF0aW9uVGltZSkgewogICAgICAgIGNsZWFySW50ZXJ2YWwoaXYpOwogICAgICAgIGlzVG9rZW5TZXNzaW9uID0gZmFsc2U7CiAgICAgICAgd2luZG93LmlzVG9rZW5TZXNzaW9uID0gZmFsc2U7CiAgICAgICAgY29uc3QgdCA9IGN1cnJlbnRUb2tlbklkIHx8IG51bGw7CiAgICAgICAgYmxvY2tUb2tlbk9ubHkoIkxpbmsgZXhwaXJlZCIsIHQpOwogICAgICAgIGlmICh0KSBtYXJrVG9rZW5EZXZpY2VCbG9ja2VkKHQsICJMaW5rIGV4cGlyZWQiKTsKICAgICAgICBzaG93U2Vzc2lvbkV4cGlyZWQoKTsKICAgICAgfQogICAgfSwgMTAwMCk7CiAgfQoNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIC8vIEFVVEVOVElDQVpJT05FDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICBhc3luYyBmdW5jdGlvbiBwZXJmb3JtTWFudWFsTG9naW4oKSB7DQogICAgaXNUb2tlblNlc3Npb24gPSBmYWxzZTsNCiAgICB3aW5kb3cuaXNUb2tlblNlc3Npb24gPSBmYWxzZTsNCiAgICBzZXNzaW9uU3RhcnRUaW1lID0gRGF0ZS5ub3coKTsNCiAgICBhd2FpdCBzZXRVc2FnZVN0YXJ0VGltZSgpOw0KDQogICAgaWYgKGF3YWl0IGNoZWNrVGltZUxpbWl0KCkpIHJldHVybjsNCg0KICAgIC8vIEFzc2ljdXJhdGkgZGkgbmFzY29uZGVyZSBldmVudHVhbGkgb3ZlcmxheSBkaSBzY2FkZW56YQ0KICAgIHRyeSB7DQogICAgICBxcygiZXhwaXJlZE92ZXJsYXkiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7DQogICAgICBxcygic2Vzc2lvbkV4cGlyZWQiKT8uY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7DQogICAgICB1bmJsb2NrQWNjZXNzKCk7DQogICAgfSBjYXRjaCB7fQ0KDQogICAgc2hvd0NvbnRyb2xQYW5lbCgpOw0KICAgIHFzKCJjaGVja2luVGltZUluZm8iKSAmJiAocXMoImNoZWNraW5UaW1lSW5mbyIpLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siKTsNCiAgICB1cGRhdGVDaGVja2luVGltZURpc3BsYXkoKTsNCiAgICBERVZJQ0VTLmZvckVhY2godXBkYXRlQnV0dG9uU3RhdGUpOw0KICAgIHVwZGF0ZVN0YXR1c0JhcigpOw0KICB9DQoNCiAgYXN5bmMgZnVuY3Rpb24gaGFuZGxlQ29kZVN1Ym1pdCgpIHsNCiAgICBjb25zdCBjb2RlSW5wdXQgPSBxcygiYXV0aENvZGUiKTsNCiAgICBjb25zdCBpbnNlcnRlZENvZGUgPSAoY29kZUlucHV0Py52YWx1ZSB8fCAiIikudHJpbSgpOw0KICAgIGxldCBleHBlY3RlZENvZGUgPSBDT1JSRUNUX0NPREU7DQoNCiAgICBpZiAoaXNUb2tlblNlc3Npb24gJiYgY3VycmVudFRva2VuQ3VzdG9tQ29kZSkNCiAgICAgIGV4cGVjdGVkQ29kZSA9IGN1cnJlbnRUb2tlbkN1c3RvbUNvZGU7DQoNCiAgICBpZiAoaW5zZXJ0ZWRDb2RlICE9PSBleHBlY3RlZENvZGUpIHsNCiAgICAgIGFsZXJ0KCJDb2RpY2UgZXJyYXRvISBSaXByb3ZhLiIpOw0KICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICAvLyBTZSBzaWFtbyBpbiBzZXNzaW9uZSB0b2tlbiwgcGVyc2lzdGkgdmFsaWRhemlvbmUgZSBtb3N0cmEgcGFubmVsbG8NCiAgICBpZiAoaXNUb2tlblNlc3Npb24pIHsKICAgICAgdHJ5IHsKICAgICAgICBpZiAoY3VycmVudFRva2VuSWQpCiAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShgdG9rZW5fb2tfJHtjdXJyZW50VG9rZW5JZH1gLCAiMSIpOwogICAgICAgIC8vIEF2dmlhIGlsIHRpbWVyIGRpIHV0aWxpenpvIHBlciBzZXNzaW9uZSB0b2tlbiBkb3BvIHN1Ym1pdAogICAgICAgIGlmIChjdXJyZW50VG9rZW5JZCkgYXdhaXQgc2V0VG9rZW5Vc2FnZVN0YXJ0VGltZShjdXJyZW50VG9rZW5JZCk7CiAgICAgICAgLy8gTmFzY29uZGkgcXVhbHNpYXNpIG92ZXJsYXkgZGkgc2NhZGVuemEgZXZlbnR1YWxtZW50ZSByaW1hc3RvCiAgICAgICAgcXMoImV4cGlyZWRPdmVybGF5Iik/LmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOwogICAgICAgIHFzKCJzZXNzaW9uRXhwaXJlZCIpPy5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsKICAgICAgICB1bmJsb2NrQWNjZXNzKCk7CiAgICAgIH0gY2F0Y2gge30KICAgICAgc2hvd0NvbnRyb2xQYW5lbCgpOw0KICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICBhd2FpdCBwZXJmb3JtTWFudWFsTG9naW4oKTsNCiAgfQ0KDQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICAvLyBJTklaSUFMSVpaQVpJT05FIEFQUA0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgYXN5bmMgZnVuY3Rpb24gaW5pdCgpIHsNCiAgICBjb25zb2xlLmxvZygiSW5pemlhbGl6emF6aW9uZSBhcHAuIik7DQoNCiAgICBjb25zdCBmaXJlYmFzZVNldHRpbmdzID0gYXdhaXQgbG9hZFNldHRpbmdzRnJvbUZpcmViYXNlKCk7DQogICAgaWYgKGZpcmViYXNlU2V0dGluZ3MpIGFwcGx5RmlyZWJhc2VTZXR0aW5ncyhmaXJlYmFzZVNldHRpbmdzKTsNCg0KICAgIGlmIChpc1Nlc3Npb25TdHVjaygpKSBjb25zb2xlLndhcm4oIlJpbGV2YXRhIHBvc3NpYmlsZSBzZXNzaW9uZSBibG9jY2F0YSIpOw0KDQogICAgY29uc3Qgc2F2ZWRDb2RlVmVyc2lvbiA9DQogICAgICBwYXJzZUludChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiY29kZV92ZXJzaW9uIikpIHx8IDE7DQogICAgaWYgKHNhdmVkQ29kZVZlcnNpb24gPCBjdXJyZW50Q29kZVZlcnNpb24pIHsNCiAgICAgIHJlc2V0U2Vzc2lvbkZvck5ld0NvZGUoKTsNCiAgICB9DQoNCiAgICBzZXR1cEV2ZW50TGlzdGVuZXJzKCk7DQogICAgc2V0dXBTZXR0aW5nc0xpc3RlbmVyKCk7DQogICAgbW9uaXRvckZpcmViYXNlQ29ubmVjdGlvbigpOw0KDQogICAgLy8gQkxPQ0NPIFBFUlNJU1RFTlRFIFBSSU1BIERJIFRVVFRPDQogICAgY29uc3QgaXNCbG9ja2VkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oImJsb2NrX21hbnVhbF9sb2dpbiIpID09PSAiMSI7CiAgICBpZiAoaXNCbG9ja2VkKSB7CiAgICAgIGlzVG9rZW5TZXNzaW9uID0gZmFsc2U7CiAgICAgIHdpbmRvdy5pc1Rva2VuU2Vzc2lvbiA9IGZhbHNlOwogICAgICBzaG93U2Vzc2lvbkV4cGlyZWQoKTsKICAgIH0KCiAgICAvLyBUT0tFTiBwcmltYSBkZWxsYSBzZXNzaW9uZSBtYW51YWxlCiAgICBhd2FpdCBoYW5kbGVTZWN1cmVUb2tlbigpOwogICAgc2V0dXBUb2tlblVJKCk7CiAgICBpZiAoaXNUb2tlblNlc3Npb24pIHVuYmxvY2tBY2Nlc3MoKTsKICAgIC8vIFNlIGlsIGRpc3Bvc2l0aXZvIMODwqggYmxvY2NhdG8gZSBub24gYWJiaWFtbyB1bmEgc2Vzc2lvbmUgdG9rZW4gdmFsaWRhLAogICAgLy8gaW50ZXJyb21waSBxdWkgcGVyIGV2aXRhcmUgY2hlIGwnb3ZlcmxheSB2ZW5nYSBuYXNjb3N0byBkYSBhbHRyZSByb3V0aW5lIFVJLgogICAgaWYgKGlzQmxvY2tlZCAmJiAhaXNUb2tlblNlc3Npb24pIHsKICAgICAgcmV0dXJuOwogICAgfQoNCiAgICAvLyBBdXRvLWFjY2Vzc28gc2UgdG9rZW4gZ2nDg8KgIHZhbGlkYXRvIHN1IHF1ZXN0byBkaXNwb3NpdGl2bw0KICAgIGlmIChpc1Rva2VuU2Vzc2lvbikgew0KICAgICAgY29uc3QgdG9rID0NCiAgICAgICAgY3VycmVudFRva2VuSWQgfHwgbmV3IFVSTFNlYXJjaFBhcmFtcyhsb2NhdGlvbi5zZWFyY2gpLmdldCgidG9rZW4iKTsNCiAgICAgIHRyeSB7DQogICAgICAgIGlmICh0b2sgJiYgbG9jYWxTdG9yYWdlLmdldEl0ZW0oYHRva2VuX29rXyR7dG9rfWApID09PSAiMSIpIHsNCiAgICAgICAgICBzaG93Q29udHJvbFBhbmVsKCk7DQogICAgICAgIH0NCiAgICAgIH0gY2F0Y2gge30NCiAgICB9DQoNCiAgICAvLyBTZSBub24gYmxvY2NhdG8gZSBzZW56YSB0b2tlbjogVUkgbWFudWFsZQ0KICAgIGlmICghaXNUb2tlblNlc3Npb24gJiYgbG9jYWxTdG9yYWdlLmdldEl0ZW0oImJsb2NrX21hbnVhbF9sb2dpbiIpICE9PSAiMSIpIHsNCiAgICAgIGNvbnN0IGV4cGlyZWQgPSBhd2FpdCBjaGVja1RpbWVMaW1pdCgpOw0KICAgICAgaWYgKCFleHBpcmVkKSB7DQogICAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IGdldFN0b3JhZ2UoInVzYWdlX3N0YXJ0X3RpbWUiKTsNCiAgICAgICAgaWYgKHN0YXJ0VGltZSkgew0KICAgICAgICAgIHNlc3Npb25TdGFydFRpbWUgPSBwYXJzZUludChzdGFydFRpbWUsIDEwKTsNCiAgICAgICAgICBzaG93Q29udHJvbFBhbmVsKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgc2hvd0F1dGhGb3JtKCk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHNob3dBdXRoRm9ybSgpOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHVwZGF0ZURvb3JWaXNpYmlsaXR5KCk7DQogICAgc2V0dXBJbnRlcnZhbHMoKTsNCiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjb250ZXh0bWVudSIsIChlKSA9PiBlLnByZXZlbnREZWZhdWx0KCkpOw0KICAgIHVwZGF0ZUNoZWNraW5UaW1lRGlzcGxheSgpOw0KICB9DQoNCiAgZnVuY3Rpb24gc2V0dXBFdmVudExpc3RlbmVycygpIHsNCiAgICBvbigiYnRuQ2hlY2tDb2RlIiwgImNsaWNrIiwgaGFuZGxlQ29kZVN1Ym1pdCk7DQoNCiAgICBERVZJQ0VTLmZvckVhY2goKGRldmljZSkgPT4gew0KICAgICAgY29uc3QgYnRuID0gcXMoZGV2aWNlLmJ1dHRvbl9pZCk7DQogICAgICBpZiAoYnRuKQ0KICAgICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiBzaG93Q29uZmlybWF0aW9uUG9wdXAoZGV2aWNlKSk7DQogICAgfSk7DQoNCiAgICBvbigiY29uZmlybVllcyIsICJjbGljayIsICgpID0+IHsNCiAgICAgIGlmIChjdXJyZW50RGV2aWNlKSB7DQogICAgICAgIGFjdGl2YXRlRGV2aWNlKGN1cnJlbnREZXZpY2UpOw0KICAgICAgICBjbG9zZUNvbmZpcm1hdGlvblBvcHVwKCk7DQogICAgICB9DQogICAgfSk7DQogICAgb24oImNvbmZpcm1ObyIsICJjbGljayIsIGNsb3NlQ29uZmlybWF0aW9uUG9wdXApOw0KDQogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLnBvcHVwIC5idG4iKS5mb3JFYWNoKChidXR0b24pID0+IHsNCiAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgY29uc3QgcG9wdXAgPSB0aGlzLmNsb3Nlc3QoIi5wb3B1cCIpOw0KICAgICAgICBpZiAocG9wdXApIHsNCiAgICAgICAgICBjb25zdCBpZCA9IHBvcHVwLmlkLnJlcGxhY2UoInBvcHVwLSIsICIiKTsNCiAgICAgICAgICBjbG9zZVBvcHVwKGlkKTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfSk7DQogIH0NCg0KICBmdW5jdGlvbiBzaG93Q29udHJvbFBhbmVsKCkgew0KICAgIGNvbnN0IGNwID0gcXMoImNvbnRyb2xQYW5lbCIpOw0KICAgIGlmIChjcCkgew0KICAgICAgY3AuY2xhc3NMaXN0LnJlbW92ZSgiaGlkZGVuIik7DQogICAgICBjcC5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsNCiAgICB9DQogICAgY29uc3Qgcm9vdCA9IHFzKCJ0ZXN0MiIpOw0KICAgIGlmIChyb290KSByb290LnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOw0KICAgIGNvbnN0IGFjID0gcXMoImF1dGhDb2RlIik7DQogICAgaWYgKGFjKSBhYy5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICAgIGNvbnN0IGFmID0gcXMoImF1dGgtZm9ybSIpOw0KICAgIGlmIChhZikgYWYuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCiAgICBjb25zdCBiYyA9IHFzKCJidG5DaGVja0NvZGUiKTsNCiAgICBpZiAoYmMpIGJjLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQogICAgY29uc3QgaW1wID0gcXMoImltcG9ydGFudCIpOw0KICAgIGlmIChpbXApIGltcC5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICAgIC8vIGFzc2ljdXJhdGkgY2hlIGV2ZW50dWFsaSBvdmVybGF5IG5vbiBjb3ByYW5vIGlsIHBhbm5lbGxvDQogICAgcXMoImV4cGlyZWRPdmVybGF5Iik/LmNsYXNzTGlzdC5hZGQoImhpZGRlbiIpOw0KICAgIHFzKCJzZXNzaW9uRXhwaXJlZCIpPy5jbGFzc0xpc3QuYWRkKCJoaWRkZW4iKTsNCiAgICBjb25zdCBpbmZvID0gcXMoImNoZWNraW5UaW1lSW5mbyIpOw0KICAgIGlmIChpbmZvKSBpbmZvLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOw0KICAgIHVwZGF0ZUNoZWNraW5UaW1lRGlzcGxheSgpOw0KICAgIERFVklDRVMuZm9yRWFjaCh1cGRhdGVCdXR0b25TdGF0ZSk7DQogICAgdXBkYXRlU3RhdHVzQmFyKCk7DQogIH0NCg0KICBmdW5jdGlvbiBzaG93QXV0aEZvcm0oKSB7DQogICAgY29uc3QgY3AgPSBxcygiY29udHJvbFBhbmVsIik7DQogICAgaWYgKGNwKSBjcC5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICAgIGNvbnN0IGFjID0gcXMoImF1dGhDb2RlIik7DQogICAgaWYgKGFjKSBhYy5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsNCiAgICBjb25zdCBhZiA9IHFzKCJhdXRoLWZvcm0iKTsNCiAgICBpZiAoYWYpIGFmLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOw0KICAgIGNvbnN0IGJjID0gcXMoImJ0bkNoZWNrQ29kZSIpOw0KICAgIGlmIChiYykgYmMuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7DQogICAgY29uc3QgaW1wID0gcXMoImltcG9ydGFudCIpOw0KICAgIGlmIChpbXApIGltcC5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNldHVwVG9rZW5VSSgpIHsNCiAgICBpZiAoIWlzVG9rZW5TZXNzaW9uKSByZXR1cm47DQoNCiAgICBjb25zdCBhZG1pbkxpbmsgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdhW2hyZWY9ImFkbWluLmh0bWwiXScpOw0KICAgIGlmIChhZG1pbkxpbmspIGFkbWluTGluay5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KDQogICAgY29uc3QgZXhwaXJlZE1lc3NhZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjc2Vzc2lvbkV4cGlyZWQgcCIpOw0KICAgIGlmIChleHBpcmVkTWVzc2FnZSkNCiAgICAgIGV4cGlyZWRNZXNzYWdlLnRleHRDb250ZW50ID0KICAgICAgICAiVGhlIGFjY2VzcyBsaW5rIGhhcyBleHBpcmVkLiBUbyBhY2Nlc3MgYWdhaW4sIHJlcXVlc3QgYSBuZXcgbGluay4iOwoNCiAgICBjb25zdCBhc3Npc3RhbmNlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigNCiAgICAgICIjc2Vzc2lvbkV4cGlyZWQgLmJ0bi13aGF0c2FwcCINCiAgICApOw0KICAgIGlmIChhc3Npc3RhbmNlQnRuKSB7DQogICAgICBhc3Npc3RhbmNlQnRuLmhyZWYgPQ0KICAgICAgICAiaHR0cHM6Ly9hcGkud2hhdHNhcHAuY29tL3NlbmQ/cGhvbmU9KzM5Mzg5ODg4MzYzNCZ0ZXh0PUhpLCBJIG5lZWQgYSBuZXcgYWNjZXNzIGxpbmsiOw0KICAgICAgYXNzaXN0YW5jZUJ0bi5pbm5lckhUTUwgPQogICAgICAgICc8aSBjbGFzcz0iZmFiIGZhLXdoYXRzYXBwIj48L2k+IFJlcXVlc3QgbmV3IGxpbmsnOwogICAgfQ0KDQogICAgY29uc3QgYXV0aENvZGVJbnB1dCA9IHFzKCJhdXRoQ29kZSIpOw0KICAgIGlmIChhdXRoQ29kZUlucHV0KSB7DQogICAgICBhdXRoQ29kZUlucHV0LnBsYWNlaG9sZGVyID0gY3VycmVudFRva2VuQ3VzdG9tQ29kZQ0KICAgICAgICA/ICJJbnNlcmlzY2kgaWwgY29kaWNlIGRlZGljYXRvIGRlbCBsaW5rIg0KICAgICAgICA6ICJJbnNlcmlzY2kgaWwgY29kaWNlIHByaW5jaXBhbGUiOw0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIHNldHVwSW50ZXJ2YWxzKCkgew0KICAgIHNldHVwQ29kZUNoYW5nZUxpc3RlbmVyKCk7DQoNCiAgICB0aW1lQ2hlY2tJbnRlcnZhbCA9IHNldEludGVydmFsKGFzeW5jICgpID0+IHsNCiAgICAgIGNvbnN0IGV4cGlyZWQgPSBhd2FpdCBjaGVja1RpbWVMaW1pdCgpOw0KICAgICAgaWYgKCFleHBpcmVkKSB7DQogICAgICAgIGF3YWl0IHVwZGF0ZUdsb2JhbENvZGVWZXJzaW9uKCk7DQogICAgICAgIHVwZGF0ZUNoZWNraW5UaW1lRGlzcGxheSgpOw0KICAgICAgfQ0KICAgIH0sIDEwMDApOw0KDQogICAgc2V0SW50ZXJ2YWwodXBkYXRlQ2hlY2tpblRpbWVEaXNwbGF5LCA2MDAwMCk7DQogIH0NCg0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgLy8gQVZWSU8vU1RPUA0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsIGluaXQpOw0KDQogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJiZWZvcmV1bmxvYWQiLCAoKSA9PiB7DQogICAgaWYgKHRpbWVDaGVja0ludGVydmFsKSBjbGVhckludGVydmFsKHRpbWVDaGVja0ludGVydmFsKTsNCiAgICBpZiAoY29kZUNoZWNrSW50ZXJ2YWwpIGNsZWFySW50ZXJ2YWwoY29kZUNoZWNrSW50ZXJ2YWwpOw0KICAgIGlmIChMSU5LX0NIRUNLX0lOVEVSVkFMKSBjbGVhckludGVydmFsKExJTktfQ0hFQ0tfSU5URVJWQUwpOw0KICAgIHN0b3BUb2tlblJlYWx0aW1lTGlzdGVuZXIoKTsNCiAgICBpZiAoc2V0dGluZ3NSZWYpIHNldHRpbmdzUmVmLm9mZiAmJiBzZXR0aW5nc1JlZi5vZmYoKTsNCiAgfSk7DQoNCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogIC8vIEVTUE9SVEFaSU9ORSBGVU5aSU9OSSBHTE9CQUxJIChjb21wYXRpYmlsaXTDg8KgKQ0KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCiAgT2JqZWN0LmFzc2lnbih3aW5kb3csIHsNCiAgICAvLyB1dGlscw0KICAgIHFzLA0KICAgIG9uLA0KICAgIHNob3dOb3RpZmljYXRpb24sDQogICAgZm9ybWF0VGltZSwNCiAgICBmZXRjaFdpdGhUaW1lb3V0LA0KICAgIC8vIHN0b3JhZ2UNCiAgICBzZXRTdG9yYWdlLA0KICAgIGdldFN0b3JhZ2UsDQogICAgY2xlYXJTdG9yYWdlLA0KICAgIC8vIGNyeXB0bw0KICAgIGdlbmVyYXRlSGFzaCwNCiAgICAvLyBzZXR0aW5ncw0KICAgIGxvYWRTZXR0aW5nc0Zyb21GaXJlYmFzZSwNCiAgICBhcHBseUZpcmViYXNlU2V0dGluZ3MsDQogICAgc2V0dXBTZXR0aW5nc0xpc3RlbmVyLA0KICAgIG1vbml0b3JGaXJlYmFzZUNvbm5lY3Rpb24sDQogICAgLy8gdGVtcG8vc2Vzc2lvbmUNCiAgICBzZXRVc2FnZVN0YXJ0VGltZSwNCiAgICBjaGVja1RpbWVMaW1pdCwNCiAgICBzaG93RmF0YWxFcnJvciwNCiAgICBzaG93U2Vzc2lvbkV4cGlyZWQsDQogICAgaXNTZXNzaW9uU3R1Y2ssDQogICAgLy8gY2hlY2staW4gdGltZQ0KICAgIGlzQ2hlY2tpblRpbWUsDQogICAgdXBkYXRlQ2hlY2tpblRpbWVEaXNwbGF5LA0KICAgIHNob3dFYXJseUNoZWNraW5Qb3B1cCwNCiAgICBjbG9zZUVhcmx5Q2hlY2tpblBvcHVwLA0KICAgIC8vIFVJDQogICAgdXBkYXRlU3RhdHVzQmFyLA0KICAgIGdldENsaWNrc0xlZnQsDQogICAgc2V0Q2xpY2tzTGVmdCwNCiAgICB1cGRhdGVCdXR0b25TdGF0ZSwNCiAgICB1cGRhdGVEb29yVmlzaWJpbGl0eSwNCiAgICAvLyBjb2RlIGNoYW5nZQ0KICAgIHNldHVwQ29kZUNoYW5nZUxpc3RlbmVyLA0KICAgIGNoZWNrQ29kZVZlcnNpb24sDQogICAgaGFuZGxlQ29kZUNoYW5nZSwNCiAgICByZXNldFNlc3Npb25Gb3JOZXdDb2RlLA0KICAgIGNoZWNrRXhwaXJlZExpbmtzLA0KICAgIC8vIHBvcHVwDQogICAgc2hvd0NvbmZpcm1hdGlvblBvcHVwLA0KICAgIGNsb3NlQ29uZmlybWF0aW9uUG9wdXAsDQogICAgc2hvd0RldmljZVBvcHVwLA0KICAgIGNsb3NlUG9wdXAsDQogICAgLy8gc2hlbGx5DQogICAgYWN0aXZhdGVEZXZpY2UsDQogICAgdXBkYXRlR2xvYmFsQ29kZVZlcnNpb24sDQogICAgLy8gdG9rZW4NCiAgICBoYW5kbGVTZWN1cmVUb2tlbiwNCiAgICBzdG9wVG9rZW5SZWFsdGltZUxpc3RlbmVyLA0KICAgIGNsZWFyTWFudWFsU2Vzc2lvbiwNCiAgICBibG9ja0FjY2VzcywNCiAgICB1bmJsb2NrQWNjZXNzLA0KICAgIGZvcmNlR2xvYmFsTG9nb3V0LA0KICAgIGZvcmNlTG9nb3V0RnJvbVRva2VuLA0KICAgIHN0YXJ0VG9rZW5SZWFsdGltZUxpc3RlbmVyLA0KICAgIHZhbGlkYXRlU2VjdXJlVG9rZW4sDQogICAgaW5jcmVtZW50VG9rZW5Vc2FnZSwNCiAgICBzaG93VG9rZW5Ob3RpZmljYXRpb24sDQogICAgc2hvd1Rva2VuRXJyb3IsDQogICAgY2xlYW5VcmwsDQogICAgc3RhcnRUb2tlbkV4cGlyYXRpb25DaGVjaywNCiAgICAvLyBhdXRoDQogICAgcGVyZm9ybU1hbnVhbExvZ2luLA0KICAgIGhhbmRsZUNvZGVTdWJtaXQsDQogICAgLy8gYXBwIGxpZmVjeWNsZQ0KICAgIGluaXQsDQogICAgc2V0dXBFdmVudExpc3RlbmVycywNCiAgICBzaG93Q29udHJvbFBhbmVsLA0KICAgIHNob3dBdXRoRm9ybSwNCiAgICBzZXR1cFRva2VuVUksDQogICAgc2V0dXBJbnRlcnZhbHMsDQogIH0pOw0KfSkoKTsNCg==');